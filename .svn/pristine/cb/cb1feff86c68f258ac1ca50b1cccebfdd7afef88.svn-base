/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package PanelForm;

import Conexion.ExeSql;
import Dialogos.jdBuscarCliPrv;
import Dialogos.jdOC_PendientesFac;
import Dialogos.jdPagadoPrvCli;
import Dialogos.jdPagarPrv;
import Formularios.fmMain;
import static Formularios.fmMain.pnPestanas;
import Utilidades.Exporter;
import Utilidades.PanelTab;
import java.awt.Color;
import java.awt.event.KeyEvent;
import java.io.File;
import java.io.IOException;
import java.math.BigInteger;
import java.net.URL;
import java.sql.ResultSet;
import java.text.NumberFormat;
import java.text.SimpleDateFormat;
import java.util.ArrayList;
import java.util.List;
import javax.swing.JFileChooser;
import javax.swing.JTable;
import javax.swing.SwingConstants;
import javax.swing.filechooser.FileNameExtensionFilter;
import javax.swing.table.DefaultTableCellRenderer;
import javax.swing.table.DefaultTableModel;
import java.util.*;
import java.util.logging.Level;
import java.util.logging.Logger;
import javax.swing.ImageIcon;
import javax.swing.event.ListSelectionEvent;
import javax.swing.event.ListSelectionListener;
import org.jdesktop.swingx.renderer.StringValues;
/**
 *
 * @author David Alcaman
 */
public class pfReporteMargen_FAC_OC1 extends javax.swing.JPanel {
    DefaultTableCellRenderer rightRenderer = new DefaultTableCellRenderer();
    /**
     * Creates new form pfReportePagosPrv
     */
    Boolean Entra = false;
    public pfReporteMargen_FAC_OC1() {
        initComponents();
         Calendar fecha = new GregorianCalendar();
         chk_oc.setVisible(false);
         cboAgno1.setVisible(false);
         cboMes1.setVisible(false);

        int año = fecha.get(Calendar.YEAR);
        int mes = fecha.get(Calendar.MONTH);

        String anox ="x";
        String mesx ="x";
        
        anox = String.valueOf(año);
        mesx = String.valueOf(mes+1);

        cboAgno.setSelectedItem(anox); 
        cboMes.setSelectedItem(mesx); 
        
        cboAgno1.setSelectedItem(anox); 
        cboMes1.setSelectedItem(mesx); 
        
          
        rightRenderer.setHorizontalAlignment(SwingConstants.RIGHT);
        GrillaC.getColumnModel().getColumn(2).setCellRenderer(rightRenderer);
        GrillaC.getColumnModel().getColumn(3).setCellRenderer(rightRenderer);
        GrillaC.getColumnModel().getColumn(4).setCellRenderer(rightRenderer);
        GrillaC.getColumnModel().getColumn(5).setCellRenderer(rightRenderer);
        GrillaC.getColumnModel().getColumn(6).setCellRenderer(rightRenderer);
         
        Grilla_OC.getColumnModel().getColumn(1).setCellRenderer(rightRenderer);
        Grilla_OC.getColumnModel().getColumn(2).setCellRenderer(rightRenderer);
        Grilla_OC.getColumnModel().getColumn(3).setCellRenderer(rightRenderer);
         Grilla_OC.getColumnModel().getColumn(4).setCellRenderer(rightRenderer);
        Grilla_OC.getColumnModel().getColumn(5).setCellRenderer(rightRenderer);
        Grilla_OC.getColumnModel().getColumn(6).setCellRenderer(rightRenderer);
        
        GrillaOCS.getColumnModel().getColumn(2).setCellRenderer(rightRenderer);
        GrillaOCS.getColumnModel().getColumn(3).setCellRenderer(rightRenderer);
        GrillaOCS.getColumnModel().getColumn(5).setCellRenderer(rightRenderer);
        btExcel.setVisible(true);
        
        lbmar.setVisible(true);
        lblTotalFac.setVisible(true);
    
//        Enlaza Grilla de Factura con su Grilla de Detalle
        Grilla_OC.getSelectionModel().addListSelectionListener(new ListSelectionListener(){
        @Override
       public void valueChanged(ListSelectionEvent e){
        
       
           
           if (Grilla_OC.getSelectedRowCount()>0)
               limpiaTablaOCS();
               CargaOC(Integer.valueOf(cboAgno.getSelectedItem().toString()),Integer.valueOf(cboMes.getSelectedItem().toString()),Grilla_OC.getSelectedRow()+1);
               //CargaOC(2017,3,1);
              // fmMain.Mensaje("Posicion Fila:" + Integer.valueOf(Grilla_OC.getSelectedRow()+1));
       } 
    }); 
        
        
    }
    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        jXDatePicker1 = new org.jdesktop.swingx.JXDatePicker();
        buttonGroup1 = new javax.swing.ButtonGroup();
        buttonGroup2 = new javax.swing.ButtonGroup();
        buttonGroup3 = new javax.swing.ButtonGroup();
        jPopupMenu1 = new javax.swing.JPopupMenu();
        jMenuVerProducto = new javax.swing.JMenuItem();
        AGNO = new javax.swing.JPanel();
        cboAgno = new javax.swing.JComboBox<>();
        cboMes = new javax.swing.JComboBox<>();
        lblAgno = new javax.swing.JLabel();
        jLabel8 = new javax.swing.JLabel();
        jPanel1 = new javax.swing.JPanel();
        jLabel5 = new javax.swing.JLabel();
        lbRegC = new javax.swing.JLabel();
        lbTotalC = new javax.swing.JLabel();
        jScrollPane3 = new javax.swing.JScrollPane();
        GrillaC = new javax.swing.JTable();
        lbmar = new javax.swing.JLabel();
        lblTotalFac = new javax.swing.JLabel();
        jLabel6 = new javax.swing.JLabel();
        jLabel2 = new javax.swing.JLabel();
        lbmar1 = new javax.swing.JLabel();
        lblDiferencia = new javax.swing.JLabel();
        jScrollPane2 = new javax.swing.JScrollPane();
        Grilla_OC = new javax.swing.JTable();
        jScrollPane1 = new javax.swing.JScrollPane();
        OCS = new javax.swing.JTable();
        jScrollPane4 = new javax.swing.JScrollPane();
        OCS1 = new javax.swing.JTable();
        jScrollPane5 = new javax.swing.JScrollPane();
        OCS2 = new javax.swing.JTable();
        jScrollPane6 = new javax.swing.JScrollPane();
        OCS3 = new javax.swing.JTable();
        jScrollPane7 = new javax.swing.JScrollPane();
        OCS4 = new javax.swing.JTable();
        jScrollPane8 = new javax.swing.JScrollPane();
        OCS5 = new javax.swing.JTable();
        jScrollPane9 = new javax.swing.JScrollPane();
        OCS6 = new javax.swing.JTable();
        jScrollPane10 = new javax.swing.JScrollPane();
        OCS7 = new javax.swing.JTable();
        jScrollPane11 = new javax.swing.JScrollPane();
        OCS8 = new javax.swing.JTable();
        jScrollPane12 = new javax.swing.JScrollPane();
        OCS9 = new javax.swing.JTable();
        jScrollPane13 = new javax.swing.JScrollPane();
        OCS10 = new javax.swing.JTable();
        jScrollPane14 = new javax.swing.JScrollPane();
        OCS11 = new javax.swing.JTable();
        jScrollPane15 = new javax.swing.JScrollPane();
        OCS12 = new javax.swing.JTable();
        jScrollPane16 = new javax.swing.JScrollPane();
        OCS13 = new javax.swing.JTable();
        jScrollPane17 = new javax.swing.JScrollPane();
        OCS14 = new javax.swing.JTable();
        jScrollPane18 = new javax.swing.JScrollPane();
        OCS15 = new javax.swing.JTable();
        jScrollPane19 = new javax.swing.JScrollPane();
        OCS16 = new javax.swing.JTable();
        jScrollPane20 = new javax.swing.JScrollPane();
        OCS17 = new javax.swing.JTable();
        jScrollPane21 = new javax.swing.JScrollPane();
        OCS18 = new javax.swing.JTable();
        jScrollPane22 = new javax.swing.JScrollPane();
        OCS19 = new javax.swing.JTable();
        jScrollPane23 = new javax.swing.JScrollPane();
        OCS20 = new javax.swing.JTable();
        jScrollPane24 = new javax.swing.JScrollPane();
        OCS21 = new javax.swing.JTable();
        jScrollPane25 = new javax.swing.JScrollPane();
        OCS22 = new javax.swing.JTable();
        jScrollPane26 = new javax.swing.JScrollPane();
        OCS23 = new javax.swing.JTable();
        jScrollPane27 = new javax.swing.JScrollPane();
        OCS24 = new javax.swing.JTable();
        jScrollPane28 = new javax.swing.JScrollPane();
        OCS25 = new javax.swing.JTable();
        jScrollPane29 = new javax.swing.JScrollPane();
        OCS26 = new javax.swing.JTable();
        jScrollPane30 = new javax.swing.JScrollPane();
        GrillaOCS = new javax.swing.JTable();
        BtnOCPendientes = new javax.swing.JButton();
        lblTotal = new javax.swing.JLabel();
        lbmar3 = new javax.swing.JLabel();
        btExcel = new javax.swing.JButton();
        btExcelOr = new javax.swing.JButton();
        btBuscar = new javax.swing.JButton();
        cboAgno1 = new javax.swing.JComboBox<>();
        cboMes1 = new javax.swing.JComboBox<>();
        chk_oc = new javax.swing.JCheckBox();
        lbFacturasRelacionadas = new javax.swing.JLabel();

        jMenuVerProducto.setActionCommand("Ver OC");
        jMenuVerProducto.setLabel("Ver OC");
        jMenuVerProducto.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jMenuVerProductoActionPerformed(evt);
            }
        });
        jPopupMenu1.add(jMenuVerProducto);

        jPopupMenu1.getAccessibleContext().setAccessibleParent(GrillaOCS);

        AGNO.setBorder(javax.swing.BorderFactory.createTitledBorder(javax.swing.BorderFactory.createEtchedBorder(), "PERIODO VENCIMIENTO", javax.swing.border.TitledBorder.DEFAULT_JUSTIFICATION, javax.swing.border.TitledBorder.DEFAULT_POSITION, new java.awt.Font("Tahoma", 1, 11))); // NOI18N

        cboAgno.setModel(new javax.swing.DefaultComboBoxModel<>(new String[] { "2015", "2016", "2017", "2018", "2019", "2020", "2021", "2022", "2023" }));
        cboAgno.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                cboAgnoActionPerformed(evt);
            }
        });

        cboMes.setModel(new javax.swing.DefaultComboBoxModel<>(new String[] { "1", "2", "3", "4", "5", "6", "7", "8", "9", "10", "11", "12" }));
        cboMes.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                cboMesActionPerformed(evt);
            }
        });

        lblAgno.setText("AÑO:");

        jLabel8.setText("MES:");

        jPanel1.setBorder(javax.swing.BorderFactory.createTitledBorder("FACTURAS"));
        jPanel1.setToolTipText("");
        jPanel1.setName(""); // NOI18N

        jLabel5.setFont(new java.awt.Font("Tahoma", 1, 11)); // NOI18N
        jLabel5.setText("Nro Registros:");

        lbRegC.setText("0.00");

        lbTotalC.setText("0.00");

        GrillaC.setAutoCreateRowSorter(true);
        GrillaC.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {

            },
            new String [] {
                "Cod", "Convenio", "Total OC", "Fact c/OC mes", "Margen", "Diferencia", "     %"
            }
        ) {
            boolean[] canEdit = new boolean [] {
                false, false, false, false, false, false, false
            };

            public boolean isCellEditable(int rowIndex, int columnIndex) {
                return canEdit [columnIndex];
            }
        });
        GrillaC.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                GrillaCMouseClicked(evt);
            }
        });
        jScrollPane3.setViewportView(GrillaC);
        if (GrillaC.getColumnModel().getColumnCount() > 0) {
            GrillaC.getColumnModel().getColumn(0).setMinWidth(50);
            GrillaC.getColumnModel().getColumn(0).setPreferredWidth(50);
            GrillaC.getColumnModel().getColumn(0).setMaxWidth(50);
            GrillaC.getColumnModel().getColumn(1).setMinWidth(300);
            GrillaC.getColumnModel().getColumn(1).setPreferredWidth(300);
            GrillaC.getColumnModel().getColumn(1).setMaxWidth(300);
            GrillaC.getColumnModel().getColumn(2).setMinWidth(150);
            GrillaC.getColumnModel().getColumn(2).setPreferredWidth(150);
            GrillaC.getColumnModel().getColumn(2).setMaxWidth(150);
            GrillaC.getColumnModel().getColumn(3).setMinWidth(150);
            GrillaC.getColumnModel().getColumn(3).setPreferredWidth(150);
            GrillaC.getColumnModel().getColumn(3).setMaxWidth(150);
            GrillaC.getColumnModel().getColumn(4).setMinWidth(60);
            GrillaC.getColumnModel().getColumn(4).setPreferredWidth(60);
            GrillaC.getColumnModel().getColumn(4).setMaxWidth(60);
            GrillaC.getColumnModel().getColumn(5).setMinWidth(150);
            GrillaC.getColumnModel().getColumn(5).setPreferredWidth(150);
            GrillaC.getColumnModel().getColumn(5).setMaxWidth(150);
            GrillaC.getColumnModel().getColumn(6).setMinWidth(50);
            GrillaC.getColumnModel().getColumn(6).setPreferredWidth(50);
            GrillaC.getColumnModel().getColumn(6).setMaxWidth(50);
        }

        lbmar.setFont(new java.awt.Font("Tahoma", 1, 11)); // NOI18N
        lbmar.setText("Total Fact.");

        lblTotalFac.setText("0.00");

        jLabel6.setFont(new java.awt.Font("Tahoma", 1, 11)); // NOI18N
        jLabel6.setText("Total OC");

        jLabel2.setFont(new java.awt.Font("Tahoma", 1, 18)); // NOI18N
        jLabel2.setText("ORDENES DE COMPRAS");

        lbmar1.setFont(new java.awt.Font("Tahoma", 1, 11)); // NOI18N
        lbmar1.setText("Diferencia");

        lblDiferencia.setText("0.00");

        Grilla_OC.setAutoCreateRowSorter(true);
        Grilla_OC.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {

            },
            new String [] {
                "Periodo", "TotalOC", "TotalFact", "Facturado/OC  Mes", "FAC + FEC - NCC", "Diferencia", "        %"
            }
        ) {
            boolean[] canEdit = new boolean [] {
                false, false, false, false, false, false, false
            };

            public boolean isCellEditable(int rowIndex, int columnIndex) {
                return canEdit [columnIndex];
            }
        });
        Grilla_OC.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                Grilla_OCMouseClicked(evt);
            }
        });
        jScrollPane2.setViewportView(Grilla_OC);
        if (Grilla_OC.getColumnModel().getColumnCount() > 0) {
            Grilla_OC.getColumnModel().getColumn(0).setMinWidth(100);
            Grilla_OC.getColumnModel().getColumn(0).setPreferredWidth(100);
            Grilla_OC.getColumnModel().getColumn(0).setMaxWidth(100);
            Grilla_OC.getColumnModel().getColumn(1).setMinWidth(150);
            Grilla_OC.getColumnModel().getColumn(1).setPreferredWidth(150);
            Grilla_OC.getColumnModel().getColumn(1).setMaxWidth(150);
            Grilla_OC.getColumnModel().getColumn(2).setMinWidth(150);
            Grilla_OC.getColumnModel().getColumn(2).setPreferredWidth(150);
            Grilla_OC.getColumnModel().getColumn(2).setMaxWidth(150);
            Grilla_OC.getColumnModel().getColumn(4).setMinWidth(150);
            Grilla_OC.getColumnModel().getColumn(4).setPreferredWidth(150);
            Grilla_OC.getColumnModel().getColumn(4).setMaxWidth(150);
            Grilla_OC.getColumnModel().getColumn(5).setMinWidth(150);
            Grilla_OC.getColumnModel().getColumn(5).setPreferredWidth(150);
            Grilla_OC.getColumnModel().getColumn(5).setMaxWidth(150);
            Grilla_OC.getColumnModel().getColumn(6).setMinWidth(50);
            Grilla_OC.getColumnModel().getColumn(6).setPreferredWidth(50);
            Grilla_OC.getColumnModel().getColumn(6).setMaxWidth(50);
        }

        OCS.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {

            },
            new String [] {
                "cod", "convenio", "Rut", "Codigo_OC", "Orden", "Total"
            }
        ));
        jScrollPane1.setViewportView(OCS);
        if (OCS.getColumnModel().getColumnCount() > 0) {
            OCS.getColumnModel().getColumn(2).setPreferredWidth(70);
            OCS.getColumnModel().getColumn(4).setPreferredWidth(70);
            OCS.getColumnModel().getColumn(5).setResizable(false);
            OCS.getColumnModel().getColumn(5).setPreferredWidth(100);
        }

        OCS1.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {

            },
            new String [] {
                "cod", "convenio", "Rut", "Codigo_OC", "Orden", "Total"
            }
        ));
        jScrollPane4.setViewportView(OCS1);
        if (OCS1.getColumnModel().getColumnCount() > 0) {
            OCS1.getColumnModel().getColumn(2).setPreferredWidth(70);
            OCS1.getColumnModel().getColumn(4).setPreferredWidth(70);
            OCS1.getColumnModel().getColumn(5).setResizable(false);
            OCS1.getColumnModel().getColumn(5).setPreferredWidth(100);
        }

        OCS2.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {

            },
            new String [] {
                "cod", "convenio", "Rut", "Codigo_OC", "Orden", "Total"
            }
        ));
        jScrollPane5.setViewportView(OCS2);
        if (OCS2.getColumnModel().getColumnCount() > 0) {
            OCS2.getColumnModel().getColumn(2).setPreferredWidth(70);
            OCS2.getColumnModel().getColumn(4).setPreferredWidth(70);
            OCS2.getColumnModel().getColumn(5).setResizable(false);
            OCS2.getColumnModel().getColumn(5).setPreferredWidth(100);
        }

        OCS3.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {

            },
            new String [] {
                "cod", "convenio", "Rut", "Codigo_OC", "Orden", "Total"
            }
        ));
        jScrollPane6.setViewportView(OCS3);
        if (OCS3.getColumnModel().getColumnCount() > 0) {
            OCS3.getColumnModel().getColumn(2).setPreferredWidth(70);
            OCS3.getColumnModel().getColumn(4).setPreferredWidth(70);
            OCS3.getColumnModel().getColumn(5).setResizable(false);
            OCS3.getColumnModel().getColumn(5).setPreferredWidth(100);
        }

        OCS4.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {

            },
            new String [] {
                "cod", "convenio", "Rut", "Codigo_OC", "Orden", "Total"
            }
        ));
        jScrollPane7.setViewportView(OCS4);
        if (OCS4.getColumnModel().getColumnCount() > 0) {
            OCS4.getColumnModel().getColumn(2).setPreferredWidth(70);
            OCS4.getColumnModel().getColumn(4).setPreferredWidth(70);
            OCS4.getColumnModel().getColumn(5).setResizable(false);
            OCS4.getColumnModel().getColumn(5).setPreferredWidth(100);
        }

        OCS5.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {

            },
            new String [] {
                "cod", "convenio", "Rut", "Codigo_OC", "Orden", "Total"
            }
        ));
        jScrollPane8.setViewportView(OCS5);
        if (OCS5.getColumnModel().getColumnCount() > 0) {
            OCS5.getColumnModel().getColumn(2).setPreferredWidth(70);
            OCS5.getColumnModel().getColumn(4).setPreferredWidth(70);
            OCS5.getColumnModel().getColumn(5).setResizable(false);
            OCS5.getColumnModel().getColumn(5).setPreferredWidth(100);
        }

        OCS6.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {

            },
            new String [] {
                "cod", "convenio", "Rut", "Codigo_OC", "Orden", "Total"
            }
        ));
        jScrollPane9.setViewportView(OCS6);
        if (OCS6.getColumnModel().getColumnCount() > 0) {
            OCS6.getColumnModel().getColumn(2).setPreferredWidth(70);
            OCS6.getColumnModel().getColumn(4).setPreferredWidth(70);
            OCS6.getColumnModel().getColumn(5).setResizable(false);
            OCS6.getColumnModel().getColumn(5).setPreferredWidth(100);
        }

        OCS7.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {

            },
            new String [] {
                "cod", "convenio", "Rut", "Codigo_OC", "Orden", "Total"
            }
        ));
        jScrollPane10.setViewportView(OCS7);
        if (OCS7.getColumnModel().getColumnCount() > 0) {
            OCS7.getColumnModel().getColumn(2).setPreferredWidth(70);
            OCS7.getColumnModel().getColumn(4).setPreferredWidth(70);
            OCS7.getColumnModel().getColumn(5).setResizable(false);
            OCS7.getColumnModel().getColumn(5).setPreferredWidth(100);
        }

        OCS8.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {

            },
            new String [] {
                "cod", "convenio", "Rut", "Codigo_OC", "Orden", "Total"
            }
        ));
        jScrollPane11.setViewportView(OCS8);
        if (OCS8.getColumnModel().getColumnCount() > 0) {
            OCS8.getColumnModel().getColumn(2).setPreferredWidth(70);
            OCS8.getColumnModel().getColumn(4).setPreferredWidth(70);
            OCS8.getColumnModel().getColumn(5).setResizable(false);
            OCS8.getColumnModel().getColumn(5).setPreferredWidth(100);
        }

        OCS9.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {

            },
            new String [] {
                "cod", "convenio", "Rut", "Codigo_OC", "Orden", "Total"
            }
        ));
        jScrollPane12.setViewportView(OCS9);
        if (OCS9.getColumnModel().getColumnCount() > 0) {
            OCS9.getColumnModel().getColumn(2).setPreferredWidth(70);
            OCS9.getColumnModel().getColumn(4).setPreferredWidth(70);
            OCS9.getColumnModel().getColumn(5).setResizable(false);
            OCS9.getColumnModel().getColumn(5).setPreferredWidth(100);
        }

        OCS10.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {

            },
            new String [] {
                "cod", "convenio", "Rut", "Codigo_OC", "Orden", "Total"
            }
        ));
        jScrollPane13.setViewportView(OCS10);
        if (OCS10.getColumnModel().getColumnCount() > 0) {
            OCS10.getColumnModel().getColumn(2).setPreferredWidth(70);
            OCS10.getColumnModel().getColumn(4).setPreferredWidth(70);
            OCS10.getColumnModel().getColumn(5).setResizable(false);
            OCS10.getColumnModel().getColumn(5).setPreferredWidth(100);
        }

        OCS11.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {

            },
            new String [] {
                "cod", "convenio", "Rut", "Codigo_OC", "Orden", "Total"
            }
        ));
        jScrollPane14.setViewportView(OCS11);
        if (OCS11.getColumnModel().getColumnCount() > 0) {
            OCS11.getColumnModel().getColumn(2).setPreferredWidth(70);
            OCS11.getColumnModel().getColumn(4).setPreferredWidth(70);
            OCS11.getColumnModel().getColumn(5).setResizable(false);
            OCS11.getColumnModel().getColumn(5).setPreferredWidth(100);
        }

        OCS12.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {

            },
            new String [] {
                "cod", "convenio", "Rut", "Codigo_OC", "Orden", "Total"
            }
        ));
        jScrollPane15.setViewportView(OCS12);
        if (OCS12.getColumnModel().getColumnCount() > 0) {
            OCS12.getColumnModel().getColumn(2).setPreferredWidth(70);
            OCS12.getColumnModel().getColumn(4).setPreferredWidth(70);
            OCS12.getColumnModel().getColumn(5).setResizable(false);
            OCS12.getColumnModel().getColumn(5).setPreferredWidth(100);
        }

        OCS13.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {

            },
            new String [] {
                "cod", "convenio", "Rut", "Codigo_OC", "Orden", "Total"
            }
        ));
        jScrollPane16.setViewportView(OCS13);
        if (OCS13.getColumnModel().getColumnCount() > 0) {
            OCS13.getColumnModel().getColumn(2).setPreferredWidth(70);
            OCS13.getColumnModel().getColumn(4).setPreferredWidth(70);
            OCS13.getColumnModel().getColumn(5).setResizable(false);
            OCS13.getColumnModel().getColumn(5).setPreferredWidth(100);
        }

        OCS14.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {

            },
            new String [] {
                "cod", "convenio", "Rut", "Codigo_OC", "Orden", "Total"
            }
        ));
        jScrollPane17.setViewportView(OCS14);
        if (OCS14.getColumnModel().getColumnCount() > 0) {
            OCS14.getColumnModel().getColumn(2).setPreferredWidth(70);
            OCS14.getColumnModel().getColumn(4).setPreferredWidth(70);
            OCS14.getColumnModel().getColumn(5).setResizable(false);
            OCS14.getColumnModel().getColumn(5).setPreferredWidth(100);
        }

        OCS15.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {

            },
            new String [] {
                "cod", "convenio", "Rut", "Codigo_OC", "Orden", "Total"
            }
        ));
        jScrollPane18.setViewportView(OCS15);
        if (OCS15.getColumnModel().getColumnCount() > 0) {
            OCS15.getColumnModel().getColumn(2).setPreferredWidth(70);
            OCS15.getColumnModel().getColumn(4).setPreferredWidth(70);
            OCS15.getColumnModel().getColumn(5).setResizable(false);
            OCS15.getColumnModel().getColumn(5).setPreferredWidth(100);
        }

        OCS16.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {

            },
            new String [] {
                "cod", "convenio", "Rut", "Codigo_OC", "Orden", "Total"
            }
        ));
        jScrollPane19.setViewportView(OCS16);
        if (OCS16.getColumnModel().getColumnCount() > 0) {
            OCS16.getColumnModel().getColumn(2).setPreferredWidth(70);
            OCS16.getColumnModel().getColumn(4).setPreferredWidth(70);
            OCS16.getColumnModel().getColumn(5).setResizable(false);
            OCS16.getColumnModel().getColumn(5).setPreferredWidth(100);
        }

        OCS17.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {

            },
            new String [] {
                "cod", "convenio", "Rut", "Codigo_OC", "Orden", "Total"
            }
        ));
        jScrollPane20.setViewportView(OCS17);
        if (OCS17.getColumnModel().getColumnCount() > 0) {
            OCS17.getColumnModel().getColumn(2).setPreferredWidth(70);
            OCS17.getColumnModel().getColumn(4).setPreferredWidth(70);
            OCS17.getColumnModel().getColumn(5).setResizable(false);
            OCS17.getColumnModel().getColumn(5).setPreferredWidth(100);
        }

        OCS18.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {

            },
            new String [] {
                "cod", "convenio", "Rut", "Codigo_OC", "Orden", "Total"
            }
        ));
        jScrollPane21.setViewportView(OCS18);
        if (OCS18.getColumnModel().getColumnCount() > 0) {
            OCS18.getColumnModel().getColumn(2).setPreferredWidth(70);
            OCS18.getColumnModel().getColumn(4).setPreferredWidth(70);
            OCS18.getColumnModel().getColumn(5).setResizable(false);
            OCS18.getColumnModel().getColumn(5).setPreferredWidth(100);
        }

        OCS19.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {

            },
            new String [] {
                "cod", "convenio", "Rut", "Codigo_OC", "Orden", "Total"
            }
        ));
        jScrollPane22.setViewportView(OCS19);
        if (OCS19.getColumnModel().getColumnCount() > 0) {
            OCS19.getColumnModel().getColumn(2).setPreferredWidth(70);
            OCS19.getColumnModel().getColumn(4).setPreferredWidth(70);
            OCS19.getColumnModel().getColumn(5).setResizable(false);
            OCS19.getColumnModel().getColumn(5).setPreferredWidth(100);
        }

        OCS20.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {

            },
            new String [] {
                "cod", "convenio", "Rut", "Codigo_OC", "Orden", "Total"
            }
        ));
        jScrollPane23.setViewportView(OCS20);
        if (OCS20.getColumnModel().getColumnCount() > 0) {
            OCS20.getColumnModel().getColumn(2).setPreferredWidth(70);
            OCS20.getColumnModel().getColumn(4).setPreferredWidth(70);
            OCS20.getColumnModel().getColumn(5).setResizable(false);
            OCS20.getColumnModel().getColumn(5).setPreferredWidth(100);
        }

        OCS21.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {

            },
            new String [] {
                "cod", "convenio", "Rut", "Codigo_OC", "Orden", "Total"
            }
        ));
        jScrollPane24.setViewportView(OCS21);
        if (OCS21.getColumnModel().getColumnCount() > 0) {
            OCS21.getColumnModel().getColumn(2).setPreferredWidth(70);
            OCS21.getColumnModel().getColumn(4).setPreferredWidth(70);
            OCS21.getColumnModel().getColumn(5).setResizable(false);
            OCS21.getColumnModel().getColumn(5).setPreferredWidth(100);
        }

        OCS22.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {

            },
            new String [] {
                "cod", "convenio", "Rut", "Codigo_OC", "Orden", "Total"
            }
        ));
        jScrollPane25.setViewportView(OCS22);
        if (OCS22.getColumnModel().getColumnCount() > 0) {
            OCS22.getColumnModel().getColumn(2).setPreferredWidth(70);
            OCS22.getColumnModel().getColumn(4).setPreferredWidth(70);
            OCS22.getColumnModel().getColumn(5).setResizable(false);
            OCS22.getColumnModel().getColumn(5).setPreferredWidth(100);
        }

        OCS23.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {

            },
            new String [] {
                "cod", "convenio", "Rut", "Codigo_OC", "Orden", "Total"
            }
        ));
        jScrollPane26.setViewportView(OCS23);
        if (OCS23.getColumnModel().getColumnCount() > 0) {
            OCS23.getColumnModel().getColumn(2).setPreferredWidth(70);
            OCS23.getColumnModel().getColumn(4).setPreferredWidth(70);
            OCS23.getColumnModel().getColumn(5).setResizable(false);
            OCS23.getColumnModel().getColumn(5).setPreferredWidth(100);
        }

        OCS24.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {

            },
            new String [] {
                "cod", "convenio", "Rut", "Codigo_OC", "Orden", "Total"
            }
        ));
        jScrollPane27.setViewportView(OCS24);
        if (OCS24.getColumnModel().getColumnCount() > 0) {
            OCS24.getColumnModel().getColumn(2).setPreferredWidth(70);
            OCS24.getColumnModel().getColumn(4).setPreferredWidth(70);
            OCS24.getColumnModel().getColumn(5).setResizable(false);
            OCS24.getColumnModel().getColumn(5).setPreferredWidth(100);
        }

        OCS25.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {

            },
            new String [] {
                "cod", "convenio", "Rut", "Codigo_OC", "Orden", "Total"
            }
        ));
        jScrollPane28.setViewportView(OCS25);
        if (OCS25.getColumnModel().getColumnCount() > 0) {
            OCS25.getColumnModel().getColumn(2).setPreferredWidth(70);
            OCS25.getColumnModel().getColumn(4).setPreferredWidth(70);
            OCS25.getColumnModel().getColumn(5).setResizable(false);
            OCS25.getColumnModel().getColumn(5).setPreferredWidth(100);
        }

        OCS26.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {

            },
            new String [] {
                "cod", "convenio", "Rut", "Codigo_OC", "Orden", "Total"
            }
        ));
        jScrollPane29.setViewportView(OCS26);
        if (OCS26.getColumnModel().getColumnCount() > 0) {
            OCS26.getColumnModel().getColumn(2).setPreferredWidth(70);
            OCS26.getColumnModel().getColumn(4).setPreferredWidth(70);
            OCS26.getColumnModel().getColumn(5).setResizable(false);
            OCS26.getColumnModel().getColumn(5).setPreferredWidth(100);
        }

        GrillaOCS.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {

            },
            new String [] {
                "cod", "convenio", "Rut", "Codigo_OC", "Orden", "Total"
            }
        ) {
            boolean[] canEdit = new boolean [] {
                false, false, false, false, false, false
            };

            public boolean isCellEditable(int rowIndex, int columnIndex) {
                return canEdit [columnIndex];
            }
        });
        GrillaOCS.setColumnSelectionAllowed(true);
        GrillaOCS.setComponentPopupMenu(jPopupMenu1);
        jScrollPane30.setViewportView(GrillaOCS);
        GrillaOCS.getColumnModel().getSelectionModel().setSelectionMode(javax.swing.ListSelectionModel.SINGLE_SELECTION);
        if (GrillaOCS.getColumnModel().getColumnCount() > 0) {
            GrillaOCS.getColumnModel().getColumn(0).setMinWidth(50);
            GrillaOCS.getColumnModel().getColumn(0).setPreferredWidth(50);
            GrillaOCS.getColumnModel().getColumn(0).setMaxWidth(50);
            GrillaOCS.getColumnModel().getColumn(1).setMinWidth(250);
            GrillaOCS.getColumnModel().getColumn(1).setPreferredWidth(250);
            GrillaOCS.getColumnModel().getColumn(1).setMaxWidth(250);
            GrillaOCS.getColumnModel().getColumn(2).setMinWidth(120);
            GrillaOCS.getColumnModel().getColumn(2).setPreferredWidth(120);
            GrillaOCS.getColumnModel().getColumn(2).setMaxWidth(120);
            GrillaOCS.getColumnModel().getColumn(3).setMinWidth(80);
            GrillaOCS.getColumnModel().getColumn(3).setPreferredWidth(80);
            GrillaOCS.getColumnModel().getColumn(3).setMaxWidth(80);
            GrillaOCS.getColumnModel().getColumn(4).setMinWidth(120);
            GrillaOCS.getColumnModel().getColumn(4).setPreferredWidth(120);
            GrillaOCS.getColumnModel().getColumn(4).setMaxWidth(120);
            GrillaOCS.getColumnModel().getColumn(5).setMinWidth(150);
            GrillaOCS.getColumnModel().getColumn(5).setPreferredWidth(150);
            GrillaOCS.getColumnModel().getColumn(5).setMaxWidth(150);
        }

        BtnOCPendientes.setText("OC Pendientes");
        BtnOCPendientes.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                BtnOCPendientesActionPerformed(evt);
            }
        });

        lblTotal.setFont(new java.awt.Font("Tahoma", 0, 14)); // NOI18N
        lblTotal.setHorizontalAlignment(javax.swing.SwingConstants.RIGHT);
        lblTotal.setText("0.00");

        lbmar3.setFont(new java.awt.Font("Tahoma", 1, 18)); // NOI18N
        lbmar3.setText("Total");

        btExcel.setText("Excel");
        btExcel.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btExcelActionPerformed(evt);
            }
        });

        btExcelOr.setText("Excel");
        btExcelOr.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btExcelOrActionPerformed(evt);
            }
        });

        javax.swing.GroupLayout jPanel1Layout = new javax.swing.GroupLayout(jPanel1);
        jPanel1.setLayout(jPanel1Layout);
        jPanel1Layout.setHorizontalGroup(
            jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel1Layout.createSequentialGroup()
                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(jPanel1Layout.createSequentialGroup()
                        .addContainerGap()
                        .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(jLabel2, javax.swing.GroupLayout.PREFERRED_SIZE, 589, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addGroup(jPanel1Layout.createSequentialGroup()
                                .addComponent(jLabel5)
                                .addGap(34, 34, 34)
                                .addComponent(lbRegC, javax.swing.GroupLayout.PREFERRED_SIZE, 30, javax.swing.GroupLayout.PREFERRED_SIZE)
                                .addGap(89, 89, 89)
                                .addComponent(jLabel6, javax.swing.GroupLayout.PREFERRED_SIZE, 57, javax.swing.GroupLayout.PREFERRED_SIZE)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                .addComponent(lbTotalC, javax.swing.GroupLayout.PREFERRED_SIZE, 154, javax.swing.GroupLayout.PREFERRED_SIZE)
                                .addGap(36, 36, 36)
                                .addComponent(lbmar)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                .addComponent(lblTotalFac, javax.swing.GroupLayout.PREFERRED_SIZE, 126, javax.swing.GroupLayout.PREFERRED_SIZE)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                .addComponent(lbmar1)))
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                        .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(jScrollPane1, javax.swing.GroupLayout.PREFERRED_SIZE, 653, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(jScrollPane4, javax.swing.GroupLayout.PREFERRED_SIZE, 653, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(jScrollPane5, javax.swing.GroupLayout.PREFERRED_SIZE, 653, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(jScrollPane6, javax.swing.GroupLayout.PREFERRED_SIZE, 653, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(jScrollPane7, javax.swing.GroupLayout.PREFERRED_SIZE, 653, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(jScrollPane8, javax.swing.GroupLayout.PREFERRED_SIZE, 653, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(jScrollPane9, javax.swing.GroupLayout.PREFERRED_SIZE, 653, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(jScrollPane10, javax.swing.GroupLayout.PREFERRED_SIZE, 653, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(jScrollPane11, javax.swing.GroupLayout.PREFERRED_SIZE, 653, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(jScrollPane12, javax.swing.GroupLayout.PREFERRED_SIZE, 653, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(jScrollPane13, javax.swing.GroupLayout.PREFERRED_SIZE, 653, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(jScrollPane14, javax.swing.GroupLayout.PREFERRED_SIZE, 653, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(jScrollPane15, javax.swing.GroupLayout.PREFERRED_SIZE, 653, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(jScrollPane16, javax.swing.GroupLayout.PREFERRED_SIZE, 653, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(jScrollPane17, javax.swing.GroupLayout.PREFERRED_SIZE, 653, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(jScrollPane18, javax.swing.GroupLayout.PREFERRED_SIZE, 653, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(jScrollPane19, javax.swing.GroupLayout.PREFERRED_SIZE, 653, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(jScrollPane20, javax.swing.GroupLayout.PREFERRED_SIZE, 653, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(jScrollPane21, javax.swing.GroupLayout.PREFERRED_SIZE, 653, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(jScrollPane22, javax.swing.GroupLayout.PREFERRED_SIZE, 653, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(jScrollPane23, javax.swing.GroupLayout.PREFERRED_SIZE, 653, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(jScrollPane24, javax.swing.GroupLayout.PREFERRED_SIZE, 653, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(jScrollPane25, javax.swing.GroupLayout.PREFERRED_SIZE, 653, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(jScrollPane26, javax.swing.GroupLayout.PREFERRED_SIZE, 653, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(jScrollPane27, javax.swing.GroupLayout.PREFERRED_SIZE, 653, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(jScrollPane28, javax.swing.GroupLayout.PREFERRED_SIZE, 653, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(jScrollPane29, javax.swing.GroupLayout.PREFERRED_SIZE, 653, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(lblDiferencia)))
                    .addGroup(jPanel1Layout.createSequentialGroup()
                        .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                            .addGroup(jPanel1Layout.createSequentialGroup()
                                .addComponent(jScrollPane30, javax.swing.GroupLayout.DEFAULT_SIZE, 824, Short.MAX_VALUE)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                .addComponent(BtnOCPendientes))
                            .addComponent(jScrollPane3)
                            .addComponent(jScrollPane2))
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(btExcel)
                            .addComponent(btExcelOr))
                        .addGap(0, 0, Short.MAX_VALUE)))
                .addContainerGap())
            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, jPanel1Layout.createSequentialGroup()
                .addGap(0, 0, Short.MAX_VALUE)
                .addComponent(lbmar3)
                .addGap(42, 42, 42)
                .addComponent(lblTotal, javax.swing.GroupLayout.PREFERRED_SIZE, 156, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(635, 635, 635))
        );
        jPanel1Layout.setVerticalGroup(
            jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, jPanel1Layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(jLabel2, javax.swing.GroupLayout.PREFERRED_SIZE, 20, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(24, 24, 24)
                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                        .addComponent(jLabel5)
                        .addComponent(lbRegC)
                        .addComponent(lbTotalC)
                        .addComponent(jLabel6))
                    .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                        .addComponent(lbmar)
                        .addComponent(lblTotalFac)
                        .addComponent(lblDiferencia)
                        .addComponent(lbmar1)))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(jScrollPane3, javax.swing.GroupLayout.PREFERRED_SIZE, 125, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(btExcel))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(jScrollPane2, javax.swing.GroupLayout.PREFERRED_SIZE, 92, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(btExcelOr))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(jScrollPane30, javax.swing.GroupLayout.PREFERRED_SIZE, 113, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(BtnOCPendientes, javax.swing.GroupLayout.PREFERRED_SIZE, 40, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(lblTotal)
                    .addComponent(lbmar3))
                .addGap(182, 182, 182)
                .addComponent(jScrollPane10, javax.swing.GroupLayout.DEFAULT_SIZE, 394, Short.MAX_VALUE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(jScrollPane9, javax.swing.GroupLayout.DEFAULT_SIZE, 394, Short.MAX_VALUE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(jScrollPane11, javax.swing.GroupLayout.DEFAULT_SIZE, 394, Short.MAX_VALUE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(jScrollPane12, javax.swing.GroupLayout.DEFAULT_SIZE, 394, Short.MAX_VALUE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(jScrollPane14, javax.swing.GroupLayout.DEFAULT_SIZE, 394, Short.MAX_VALUE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(jScrollPane13, javax.swing.GroupLayout.DEFAULT_SIZE, 394, Short.MAX_VALUE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(jScrollPane29, javax.swing.GroupLayout.DEFAULT_SIZE, 394, Short.MAX_VALUE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(jScrollPane28, javax.swing.GroupLayout.DEFAULT_SIZE, 394, Short.MAX_VALUE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(jScrollPane27, javax.swing.GroupLayout.DEFAULT_SIZE, 394, Short.MAX_VALUE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(jScrollPane25, javax.swing.GroupLayout.DEFAULT_SIZE, 394, Short.MAX_VALUE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(jScrollPane24, javax.swing.GroupLayout.DEFAULT_SIZE, 394, Short.MAX_VALUE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(jScrollPane26, javax.swing.GroupLayout.DEFAULT_SIZE, 394, Short.MAX_VALUE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(jScrollPane22, javax.swing.GroupLayout.DEFAULT_SIZE, 394, Short.MAX_VALUE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(jScrollPane21, javax.swing.GroupLayout.DEFAULT_SIZE, 394, Short.MAX_VALUE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(jScrollPane23, javax.swing.GroupLayout.DEFAULT_SIZE, 394, Short.MAX_VALUE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(jScrollPane18, javax.swing.GroupLayout.DEFAULT_SIZE, 394, Short.MAX_VALUE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(jScrollPane20, javax.swing.GroupLayout.DEFAULT_SIZE, 394, Short.MAX_VALUE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(jScrollPane19, javax.swing.GroupLayout.DEFAULT_SIZE, 394, Short.MAX_VALUE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(jScrollPane15, javax.swing.GroupLayout.DEFAULT_SIZE, 394, Short.MAX_VALUE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(jScrollPane16, javax.swing.GroupLayout.DEFAULT_SIZE, 394, Short.MAX_VALUE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(jScrollPane17, javax.swing.GroupLayout.DEFAULT_SIZE, 394, Short.MAX_VALUE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(jScrollPane6, javax.swing.GroupLayout.DEFAULT_SIZE, 394, Short.MAX_VALUE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(jScrollPane7, javax.swing.GroupLayout.DEFAULT_SIZE, 394, Short.MAX_VALUE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(jScrollPane8, javax.swing.GroupLayout.DEFAULT_SIZE, 394, Short.MAX_VALUE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(jScrollPane5, javax.swing.GroupLayout.DEFAULT_SIZE, 419, Short.MAX_VALUE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(jScrollPane4, javax.swing.GroupLayout.DEFAULT_SIZE, 821, Short.MAX_VALUE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(jScrollPane1, javax.swing.GroupLayout.DEFAULT_SIZE, 821, Short.MAX_VALUE)
                .addGap(12, 12, 12))
        );

        btBuscar.setText("Buscar Fact.");
        btBuscar.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btBuscarActionPerformed(evt);
            }
        });

        cboAgno1.setModel(new javax.swing.DefaultComboBoxModel<>(new String[] { "2015", "2016", "2017", "2018", "2019", "2020", "2021", "2022", "2023" }));
        cboAgno1.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                cboAgno1ActionPerformed(evt);
            }
        });

        cboMes1.setModel(new javax.swing.DefaultComboBoxModel<>(new String[] { "1", "2", "3", "4", "5", "6", "7", "8", "9", "10", "11", "12" }));
        cboMes1.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                cboMes1ActionPerformed(evt);
            }
        });

        chk_oc.setText("OC");
        chk_oc.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                chk_ocActionPerformed(evt);
            }
        });

        lbFacturasRelacionadas.setFont(new java.awt.Font("Arial", 1, 18)); // NOI18N
        lbFacturasRelacionadas.setHorizontalAlignment(javax.swing.SwingConstants.CENTER);
        lbFacturasRelacionadas.setText("-Busqueda-");
        lbFacturasRelacionadas.setBorder(javax.swing.BorderFactory.createEtchedBorder());
        lbFacturasRelacionadas.setEnabled(false);

        javax.swing.GroupLayout AGNOLayout = new javax.swing.GroupLayout(AGNO);
        AGNO.setLayout(AGNOLayout);
        AGNOLayout.setHorizontalGroup(
            AGNOLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(AGNOLayout.createSequentialGroup()
                .addGap(45, 45, 45)
                .addGroup(AGNOLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                    .addComponent(lblAgno)
                    .addComponent(jLabel8))
                .addGap(37, 37, 37)
                .addGroup(AGNOLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                    .addComponent(cboMes, 0, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                    .addComponent(cboAgno, 0, 70, Short.MAX_VALUE))
                .addGap(39, 39, 39)
                .addComponent(chk_oc)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addGroup(AGNOLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                    .addComponent(cboMes1, 0, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                    .addComponent(cboAgno1, javax.swing.GroupLayout.PREFERRED_SIZE, 70, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addGap(38, 38, 38)
                .addComponent(btBuscar, javax.swing.GroupLayout.PREFERRED_SIZE, 119, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addComponent(lbFacturasRelacionadas, javax.swing.GroupLayout.PREFERRED_SIZE, 131, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
            .addGroup(AGNOLayout.createSequentialGroup()
                .addComponent(jPanel1, javax.swing.GroupLayout.PREFERRED_SIZE, 1239, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(0, 0, Short.MAX_VALUE))
        );
        AGNOLayout.setVerticalGroup(
            AGNOLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(AGNOLayout.createSequentialGroup()
                .addGroup(AGNOLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(AGNOLayout.createSequentialGroup()
                        .addContainerGap()
                        .addGroup(AGNOLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addGroup(AGNOLayout.createSequentialGroup()
                                .addGroup(AGNOLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                                    .addComponent(cboAgno, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                                    .addComponent(lblAgno))
                                .addGap(9, 9, 9)
                                .addGroup(AGNOLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                                    .addComponent(jLabel8)
                                    .addComponent(cboMes, javax.swing.GroupLayout.PREFERRED_SIZE, 20, javax.swing.GroupLayout.PREFERRED_SIZE)))
                            .addGroup(AGNOLayout.createSequentialGroup()
                                .addGroup(AGNOLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                                    .addComponent(chk_oc)
                                    .addComponent(cboAgno1, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                                    .addComponent(btBuscar))
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                .addComponent(cboMes1, javax.swing.GroupLayout.PREFERRED_SIZE, 20, javax.swing.GroupLayout.PREFERRED_SIZE))))
                    .addComponent(lbFacturasRelacionadas, javax.swing.GroupLayout.PREFERRED_SIZE, 84, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                .addComponent(jPanel1, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );

        jPanel1.getAccessibleContext().setAccessibleName("");
        chk_oc.getAccessibleContext().setAccessibleParent(this);

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(this);
        this.setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addComponent(AGNO, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(0, 0, Short.MAX_VALUE))
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
            .addGroup(javax.swing.GroupLayout.Alignment.LEADING, layout.createSequentialGroup()
                .addComponent(AGNO, javax.swing.GroupLayout.PREFERRED_SIZE, 595, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(0, 119, Short.MAX_VALUE))
        );

        AGNO.getAccessibleContext().setAccessibleName("PERIODO VENCIMIENTO1");
    }// </editor-fold>//GEN-END:initComponents

    

public void buscando()    {
         ExeSql Sql = new ExeSql();
        ResultSet Rs,Rs1;
        String Query, QTot="";
        String NombrePersonal;
//        DefaultTableModel TableModel = (DefaultTableModel) Grilla.getModel();
//         DefaultTableModel TableGrillaC = (DefaultTableModel) GrillaC.getModel();     
//        DefaultTableModel TableModel2 = (DefaultTableModel) Grilla_Det.getModel();

        int ContPagos      =    0;
        double Total       = 0.00;
        double Margen      = 0.00;
        double ponderado   = 0.00;
        double Total_P     = 0.00;
        double Total_Linea = 0.00;
       
//limpiaTablaEncabezadoFAC();
 

try {
     //Carga las Ordenes de Compra
     carga_costopromedio();   
     Diferencia();
            lbFacturasRelacionadas.setIcon(null);
            lbFacturasRelacionadas.setText("-Busqueda-");
            lbFacturasRelacionadas.setForeground(Color.black);
               
  }
catch (Exception e) {
            fmMain.Mensaje("Existe una inconsistencia en la información. 1");
        }finally{
            Sql.Close();
        }     
}
    
    
    private void btBuscarActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btBuscarActionPerformed
   Runnable miRunnable = new Runnable() {
            public void run() {
                try{
                        buscando();
                        
                } catch (Exception e) {
                    e.printStackTrace();
                }
            }
        };
        Thread hilo = new Thread(miRunnable);
        hilo.start();
        lbFacturasRelacionadas.setText("CARGANDO  -  CARGANDO  -  CARGANDO  -  CARGANDO ");
        URL urlInfo =  this.getClass().getResource("/Iconos16/wait.gif");
        ImageIcon IconoInfo =  new ImageIcon(urlInfo); 
        lbFacturasRelacionadas.setIcon(IconoInfo);
        lbFacturasRelacionadas.setForeground(Color.red);
    }//GEN-LAST:event_btBuscarActionPerformed


//void limpiaTablaEncabezadoFAC(){
////        try{
////            DefaultTableModel temp = (DefaultTableModel) Grilla.getModel();
////            int a =temp.getRowCount()-1;
////            for(int i=0; i<=a; i++)
////                temp.removeRow(0); //aquí estaba el error, antes pasaba la i como parametro.... soy un bacín  XD
////        }catch(Exception e){
////            System.out.println(e);
////        }
//    }    
//    void limpiaTablaEncabezadoFACDetalle(){
//        try{
//            DefaultTableModel temp = (DefaultTableModel) Grilla_Det.getModel();
//            int a =temp.getRowCount()-1;
//            for(int i=0; i<=a; i++)
//                temp.removeRow(0); //aquí estaba el error, antes pasaba la i como parametro.... soy un bacín  XD
//        }catch(Exception e){
//            System.out.println(e);
//        }
//    }   
    
    
    void limpiaTablaEncabezadoOrdenes(){
        try{
            DefaultTableModel temp = (DefaultTableModel) GrillaC.getModel();
            int a =temp.getRowCount()-1;
            for(int i=0; i<=a; i++)
                temp.removeRow(0); //aquí estaba el error, antes pasaba la i como parametro.... soy un bacín  XD
        }catch(Exception e){
             System.out.println(e);
        }
    }    
    void limpiaTablaDiferencia(){
        try{
            DefaultTableModel temp = (DefaultTableModel) Grilla_OC.getModel();
            int a =temp.getRowCount()-1;
            for(int i=0; i<=a; i++)
                temp.removeRow(0); //aquí estaba el error, antes pasaba la i como parametro.... soy un bacín  XD
        }catch(Exception e){
            System.out.println(e);
        }
    }   
    
    void limpiaTablaOCS(){
        try{
            DefaultTableModel temp = (DefaultTableModel) GrillaOCS.getModel();
            int a =temp.getRowCount()-1;
            for(int i=0; i<=a; i++)
                temp.removeRow(0); //aquí estaba el error, antes pasaba la i como parametro.... soy un bacín  XD
        }catch(Exception e){
            System.out.println(e);
        }
    }   
    
    
   public void CargaOC(int agno, int mes, int mes_oc  ){
        ExeSql Sql = new ExeSql();
        ResultSet Rs;
        DefaultTableModel TableModel = (DefaultTableModel) GrillaOCS.getModel();
        double Sumador = 0.00;
        String Query ="";
        
        lblTotal.setText(String.valueOf(fmMain.FormatoNumero(Sumador)));   
        
        int ContReg=0;
         while(TableModel.getRowCount()>0)
             TableModel.removeRow(0);
        try {
             /*Query ="select ALL_OC.codigo, ALL_OC.convenio,ALL_OC.rut,ALL_OC.codigo_OC,ALL_OC.orden,ALL_OC.sum_oc\n" +
                "FROM\n" +
                "(select \n" +
                "conv.codigo, conv.convenio,c.rut,c.codigo_oc,c.orden,\n" +
                "SUM(d.cantidad * d.valorunitario) sum_oc\n" +
                "          from occh c\n" +
                "         left join occhdet d on c.rut = d.rut and \n" +
                "          c.orden = d.orden \n" +
                "          and  c.codigo_oc   = d.codigo_oc\n" +
                "     left join producto p on d.sku = p.sku\n" +
                "     left join par_convenio conv on conv.codigo = p.convenio\n" +
                "          where \n" +
                "          extract(year from c.femision) =" + agno +" and \n" +
                "          extract(month from c.femision) =" + mes_oc + "  and \n" +
                "          conv.convenio is  not null\n" +
                "group by \n" +
                "conv.codigo, conv.convenio,c.rut,c.codigo_oc,c.orden) ALL_OC\n" +
                "Left join (SELECT  \n" +
                "                         conv.codigo, conv.convenio,\n" +
                "                         c.rut, c.codigo_oc , c.occh, \n" +
                "                          SUM(d.cantidad * d.valorunitario) sum_fac\n" +
                "					from ctactecli c\n" +
                "                       left join ctacteclidet d on c.rut = d.rut and c.tipdocto =\n" +
                "                        d.tipdocto and c.nrodocto = d.nrodocto\n" +
                "                       left join producto p on d.sku = p.sku\n" +
                "                       left join par_convenio conv on conv.codigo = p.convenio\n" +
                "                       inner join \n" +
                "                       (\n" +
                "                         select distinct orden,\n" +
                "                                codigo_oc\n" +
                "                         from occh  where \n" +
                "          extract(year from femision) =" + agno + " and \n" +
                "          extract(month from femision) =" + mes_oc + " \n"+
                "                       ) oc on c.occh = oc.orden and c.codigo_oc = oc.codigo_oc\n" +
                "                  where c.tipdocto in ('NCC','FAC','FEC') and\n" +
                "                       extract(year from c.femision) = " + agno + " and \n" +
                "                       extract(month from c.femision) BETWEEN 1 and " + mes + " and\n" +
                "                   conv.convenio is not null\n" +
                "                  group by  \n" +
                "					conv.codigo, conv.convenio,c.rut, c.codigo_oc , c.occh) ALL_FAC \n" +
                "on \n" +
                "		ALL_FAC.rut  = all_oc.rut and\n" +
                "		ALL_FAC.codigo_oc  = all_oc.codigo_oc and\n" +
                "        ALL_FAC.occh  = all_oc.orden and\n" +
                "        ALL_FAC.codigo  = all_oc.codigo \n" +
                "    where ALL_FAC.rut is NULL\n" +
                "order by ALL_OC.rut,all_oc.codigo_oc DESC   ";*/
            
            
                        Query = "SELECT \n" +
                        "p.codigo,p.convenio,p.rut,p.codigo_oc,p.orden,sum(TOTAL_FACTURA) sum_oc\n" +
                        "from \n" +
                        "(select \n" +
                        "conv.codigo, \n" +
                        "conv.convenio,\n" +
                        "c.rut,\n" +
                        "c.codigo_oc,\n" +
                        "c.orden,\n" +
                        "d.despachado, \n" +
                        "d.facturado, \n" +
                        "d.separado,\n" +
                        "CASE f.tipdocto\n" +
                        "    WHEN 'FAC' THEN  sum(d.cantidad * d.valorunitario) \n" +  //crm
                        "    WHEN 'FEC' THEN  sum(d.cantidad * d.valorunitario) \n" +
                        "    WHEN 'NCC' THEN  sum(d.cantidad * d.valorunitario*-1)\n" +
                        "ELSE\n" +
                        "	sum(d.cantidad * d.valorunitario) \n" +
                        "  END TOTAL_FACTURA\n" +
                        "          from occh c\n" +
                        "         left join occhdet d on c.rut = d.rut and \n" +
                        "          c.orden = d.orden \n" +
                        "          and  c.codigo_oc   = d.codigo_oc\n" +
                        "     left join producto p on d.sku = p.sku\n" +
                        "     left join par_convenio conv on conv.codigo = p.convenio\n" +
                        "     left join ctactecli f\n" +
                        "     on f.codigo_oc = c.codigo_oc\n" +
                        "     	and c.orden = f.occh\n" +
                        "        and c.rut= f.rut\n" +
                        "     where \n" +
                        "          extract(year from c.femision) =" + agno + " and \n" +
                        "          extract(month from c.femision) =" + mes_oc + " and \n" +
                        "          conv.convenio is  not null\n" +
                        //"		  and d.facturado < d.cantidad \n" +
                        "  and ((d.facturado < d.cantidad) and (d.despachado <> d.cantidad))" +         
                        //"          and f.tipdocto in ('FAC','FEC','NCC')\n" +
                        " and (f.tipdocto is NULL  or f.tipdocto ='FAC' or f.tipdocto ='FEC'or f.tipdocto ='NCC')\n"  +      ////crm
                        " group by \n" +
                        " conv.codigo, conv.convenio,c.rut,c.codigo_oc,\n" +
                        " c.orden,d.despachado, d.facturado, d.separado,f.tipdocto) p\n" +
                        " group by p.codigo,p.convenio,p.rut,p.codigo_oc,p.orden " +
                        " having sum(TOTAL_FACTURA)>0";        
            
            
            
            
            Rs = Sql.Select(Query);
            
            while (Rs.next()){
                ContReg++;
                        TableModel.addRow(new Object[]{
                                               Rs.getString("codigo").trim(),
                                               Rs.getString("convenio").trim(), 
                                               Rs.getString("rut"),
                                               Rs.getString("codigo_oc"),
                                               Rs.getString("orden").trim(), 
                                               fmMain.FormatoNumeroSinDecimal(Rs.getDouble("sum_oc"))});
                                               
                        
                        //fmMain.FormatoNumero(Rs.getDouble("sum_oc"))});

                        
                        
                        
                        
                Sumador = Sumador + Rs.getDouble("sum_oc");
            
               lblTotal.setText(String.valueOf(fmMain.FormatoNumero(Sumador)));
               }
                
               Rs.close();
            
        } catch (Exception e) {
          
        } finally{
            Sql.Close();
  
        }
        
    }   
    
    
    
    public void carga_costopromedio(){
        
//    Creado por: Cristian Ramìrez    
//    Fecha: 27-01.2016    
//    Objetivo:Resumen de Costo Promedio agrupado por convenio con respecto a las ordenes de compra realizadas.
    
        ExeSql Sql = new ExeSql();
        ResultSet Rs;
        ResultSet Rs1;
        String Query, QueryFac="";
        String QTot="";
        String NombrePersonal;
        double Total_P         = 0.00;
        double Total_Linea     = 0.00;
        DefaultTableModel TableModel = (DefaultTableModel) GrillaC.getModel();
        limpiaTablaEncabezadoOrdenes();          
        int ContPagos_Det  =    0;
        int i =0;
        double Total_Det    = 0.00;
        double Total_Fac       = 0.00;
        double Diferencia =0;
        double TotalLineaOrd =0;
        double TotalLineaFact =0;
        double codigo_query =0;
        double codigo_grilla=0;
           
 try {
                    Query="select base.codigo,base.convenio,avg(base.Margen) margen ,SUM(base.totalVta) total from (\n" +
                   "          select conv.codigo,conv.convenio as convenio,\n" +
                   "           ((d.valorunitario - p.costopromedio) / d.valorunitario) * 100 as Margen,\n" +                           
                   "           (sum(d.cantidad)) * d.valorunitario as totalVta\n" +
                   "          from occh c\n" +
                   "         left join occhdet d on c.rut = d.rut and \n" +
                   "          c.orden = d.orden \n" +
                   "          and  c.codigo_oc   = d.codigo_oc\n" +
                   "     left join producto p on d.sku = p.sku\n" +
                   "     left join par_convenio conv on conv.codigo = p.convenio\n" +
                   "          where \n" +
                   "          extract(year from c.femision) =" + cboAgno.getSelectedItem().toString() + " and \n" +
                   "          extract(month from c.femision) =" + cboMes.getSelectedItem().toString() + " and \n"+
                   "          conv.convenio is  not null\n" +
                   "          group by conv.codigo,conv.convenio,\n" +
                   "                   d.sku,\n" +
                   "                   p.nombre,\n" +
                   "                   p.costopromedio,\n" +
//                   "                   p.costofinal,\n" +
                   "                   d.valorunitario,\n" +
                   "                   c.orden) base\n" +
                   "   group by codigo,convenio     " +
                   "  order by codigo,convenio";

//     Limpia Ordenes Encabezado   
               while(TableModel.getRowCount()>0)
                   TableModel.removeRow(0); 
               
  
  // EJECUTA CONSULTA
            Rs = Sql.Select(Query);        
            while(Rs.next()){
               ContPagos_Det++;
               Total_Det  = Total_Det + Rs.getDouble("total");
               Total_Linea = (Rs.getDouble("total") / Total_P)*100;
//               Margen = Margen +  Rs.getDouble("margen");
                            
               TableModel.addRow(new Object[]{Rs.getString("codigo").trim(), 
                                              Rs.getString("convenio").trim(), 
                                              fmMain.FormatoNumero(Rs.getDouble("total")),
                                              fmMain.FormatoNumero(0), 
                                              fmMain.FormatoNumero(0),fmMain.FormatoNumero(0)});
              }
            
  QueryFac="select \n" +
"           base.codigo,\n" +
"            base.convenio,\n" +
"            AVG(base.Margen) Margen,\n" +
"            SUM(base.totalVta) total \n" +
"	from (\n" +
"              select \n" +
"                conv.codigo,conv.convenio as convenio,\n" +
"               ((d.valorunitario - p.costopromedio) / d.valorunitario) * 100 as Margen,\n" +
"               (sum(d.cantidad)) * d.valorunitario as totalVta\n" +
"              from ctactecli c\n" +
"                   left join ctacteclidet d \n" +
"                        on c.rut = d.rut and \n" +
"                        c.tipdocto = d.tipdocto and\n" +
"                        c.nrodocto = d.nrodocto\n" +
"                   left join producto p \n" +
"                        on d.sku = p.sku\n" +
"                   left join par_convenio conv \n" +
"                        on conv.codigo = p.convenio\n" +
"                   inner join (select \n" +
"                                    distinct orden,codigo_oc \n" +
"                                    from occh \n" +
"                                    where \n" +
        "          extract(year from femision) =" + cboAgno.getSelectedItem().toString() + " and \n" +
        "          extract(month from femision) =" + cboMes.getSelectedItem().toString() + "\n" +
            "      ) oc\n" +
"                    on c.occh = oc.orden  and c.codigo_oc = oc.codigo_oc     \n" +
"              where \n" +
"              c.tipdocto in ('FAC', 'FEC') and \n" + //crm
"          extract(year from c.femision) =" + cboAgno.getSelectedItem().toString() + " and \n" +
"          extract(month from c.femision) =" + cboMes.getSelectedItem().toString() + " and \n" +
"              conv.convenio is  not null\n" +
"              group by \n" +
"                      conv.codigo,conv.convenio,\n" +
"                      d.sku,\n" +
"                      p.nombre,\n" +
"                       p.valultcompra,\n" +
"                       p.costopromedio,\n" +
"                       d.valorunitario,\n" +
"                       c.tipdocto,\n" +
"                       c.nrodocto) base\n" +
"   	group by codigo,convenio                \n" +
" 	order by codigo,convenio ";         
            
            
            
            
            Rs1 = Sql.Select(QueryFac);
           i = 0;
           Total_Fac =0;
           
           while ( Rs1.next()){
               
                   
                    codigo_query = Rs1.getDouble("codigo") ;
                    codigo_grilla =Double.parseDouble(GrillaC.getValueAt(i,0).toString().trim());
                    
               if (  codigo_query == codigo_grilla){
                    GrillaC.setValueAt(String.valueOf(fmMain.FormatoNumero( Rs1.getDouble("total"))), i, 3);
                    GrillaC.setValueAt(String.valueOf(fmMain.FormatoNumero( Rs1.getDouble("Margen"))), i, 4);
                    
                    // Calcula la diferencia entre las OC y Facturado
                    TotalLineaOrd =  Double.valueOf(GrillaC.getValueAt(i,2).toString().trim().replace(",", ""));
                    TotalLineaFact =  Rs1.getDouble("total");
                    Diferencia = TotalLineaOrd-TotalLineaFact;
                    GrillaC.setValueAt(String.valueOf(fmMain.FormatoNumero(Diferencia)), i, 5);
                    GrillaC.setValueAt(String.valueOf(fmMain.FormatoNumero((TotalLineaFact/TotalLineaOrd)*100)), i, 6);
                     Total_Fac = Total_Fac +Rs1.getDouble("total");
                    i= i+1;
               }
                else if (codigo_query < codigo_grilla){
                 
                    TableModel.addRow(new Object[]{String.valueOf(codigo_query).trim(), 
                                              Rs1.getString("convenio").trim(), 
                                              fmMain.FormatoNumero(0),
                                              fmMain.FormatoNumero( Rs1.getDouble("total")), 
                                              fmMain.FormatoNumero(0),fmMain.FormatoNumero(Rs1.getDouble("total")*-1)});
                    // Avanzo otro registro
                     Total_Fac = Total_Fac +Rs1.getDouble("total");
                    Rs1.next();
                    
                    GrillaC.setValueAt(String.valueOf(fmMain.FormatoNumero( Rs1.getDouble("total"))), i, 3);
                    GrillaC.setValueAt(String.valueOf(fmMain.FormatoNumero( Rs1.getDouble("Margen"))), i, 4);
                    
                    // Calcula la diferencia entre las OC y Facturado
                    TotalLineaOrd =  Double.valueOf(GrillaC.getValueAt(i,2).toString().trim().replace(",", ""));
                    TotalLineaFact =  Rs1.getDouble("total");
                    Diferencia = TotalLineaOrd-TotalLineaFact;
                    GrillaC.setValueAt(String.valueOf(fmMain.FormatoNumero(Diferencia)), i, 5);
                    GrillaC.setValueAt(String.valueOf(fmMain.FormatoNumero((TotalLineaFact/TotalLineaOrd)*100)), i, 6);
                    Total_Fac = Total_Fac +Rs1.getDouble("total");
                    
                    i=i+2;                         
                                              
                        }
                else if (codigo_query > codigo_grilla)
                {
                    TotalLineaOrd =  Double.valueOf(GrillaC.getValueAt(i,2).toString().trim().replace(",", ""));
                    Diferencia = TotalLineaOrd;
                    GrillaC.setValueAt(String.valueOf(fmMain.FormatoNumero(Diferencia)), i, 5);
                    i= +i+1;
                
                    
                    GrillaC.setValueAt(String.valueOf(fmMain.FormatoNumero( Rs1.getDouble("total"))), i, 3);
                    GrillaC.setValueAt(String.valueOf(fmMain.FormatoNumero( Rs1.getDouble("Margen"))), i, 4);
                     Total_Fac = Total_Fac +Rs1.getDouble("total");
                    // Calcula la diferencia entre las OC y Facturado
                    TotalLineaOrd =  Double.valueOf(GrillaC.getValueAt(i,2).toString().trim().replace(",", ""));
                    TotalLineaFact =  Rs1.getDouble("total");
                    Diferencia = TotalLineaOrd-TotalLineaFact;
                    GrillaC.setValueAt(String.valueOf(fmMain.FormatoNumero(Diferencia)), i, 5);
                    GrillaC.setValueAt(String.valueOf(fmMain.FormatoNumero((TotalLineaFact/TotalLineaOrd)*100)), i, 6);
                  
                    i=i+1;
                                        
                }
              
                 //GrillaC.setValueAt("Hola", i, 3);
                
           }  

        
             if (ContPagos_Det ==0){
                limpiaTablaEncabezadoOrdenes();
//                limpiaTablaEncabezadoOrdenesDet();
                lbTotalC.setText(fmMain.FormatoNumero(0));
                lbRegC.setText(fmMain.FormatoTotal(0));
                lblTotalFac.setText(fmMain.FormatoNumero(0.00));
               
                     
//                lbRegDet4.setText(fmMain.FormatoTotal(0));
//                lbTotalVtasDet4.setText(fmMain.FormatoTotal(0));
                 fmMain.Mensaje("No existe Información en Ordenes");
       
            }
            else  if (ContPagos_Det >0) {
                 GrillaC.changeSelection(0, 0 , false, false);
//                 Margen= Margen / ContPagos_Det;
                 lblTotalFac.setText(fmMain.FormatoNumero(Total_Fac));
            }
          
            lbTotalC.setText(fmMain.FormatoNumero(Total_Det));
            lbRegC.setText(fmMain.FormatoTotal(ContPagos_Det));
            lblDiferencia.setText(fmMain.FormatoTotal(Total_Det-Total_Fac));
             Rs.close();
            Rs1.close();
           
     }
catch (Exception e) {
            fmMain.Mensaje("Existe una inconsistencia en la información. 2");
        }finally{
            Sql.Close();
          
         
            
        }
       
}
 

    
     public void Diferencia(){
     ExeSql Sql = new ExeSql();
     ResultSet Rs1;
     String Query="";
     double TotalFact =0.0;
     double TotalOC =0.0;
     double Acum = 0.0;
     double dife = 0;
     String Per ="";
     double Ponderado;
     DefaultTableModel TableModel = (DefaultTableModel) Grilla_OC.getModel();        
     
 try{    
        int mes = Integer.valueOf(cboMes.getSelectedItem().toString()) ;
        int ano = Integer.valueOf(cboAgno.getSelectedItem().toString()) ;
        
        String var_mes = "";
       for (int i=1; i<=mes;i++){
           var_mes =   var_mes + String.valueOf(i) + ',';
       }
         var_mes = var_mes.substring(0,var_mes.length()-1);
        
        
        limpiaTablaDiferencia();
        int j; 
        	for(int i = 1; i <= mes ; i++)
		{
                        j = mes-1;
                        Query="select \n" +
                            "   (select \n" +
                            "               sum(d.cantidad * d.valorunitario) as totalFactura\n" +
                            "              from ctactecli c\n" +
                            "                   left join ctacteclidet d \n" +
                            "                        on c.rut = d.rut and \n" +
                            "                        c.tipdocto = d.tipdocto and\n" +
                            "                        c.nrodocto = d.nrodocto\n" +
                            "                   left join producto p \n" +
                            "                        on d.sku = p.sku\n" +
                            "                   left join par_convenio conv \n" +
                            "                        on conv.codigo = p.convenio\n" +
                            "                   inner join (select \n" +
                            "                                    distinct orden, codigo_oc\n" +
                            "                                    from occh \n" +
                            "                                    where \n" +
                            "          extract(year from femision) =" + cboAgno.getSelectedItem().toString() + " and \n" +
                            "          extract(month from femision) =" + i + ")oc  \n"+
                            "                    on c.occh = oc.orden  and c.codigo_oc = oc.codigo_oc \n" +
                            "              where \n" +
                            "              c.tipdocto in ('FAC', 'FEC') and \n" + //crm
                            "          extract(year from c.femision) =" + cboAgno.getSelectedItem().toString() + " and \n" +
                            "          extract(month from c.femision) =" + cboMes.getSelectedItem().toString() + " and \n" +                                
                            "              conv.convenio is  not null) total_FACTURA,\n" +
                        "          (select SUM(d.cantidad * d.valorunitario) total_OC\n" +
                        "          from occh c\n" +
                        "         left join occhdet d on c.rut = d.rut and \n" +
                        "          c.orden = d.orden \n" +
                        "          and  c.codigo_oc   = d.codigo_oc\n" +
                        "     left join producto p on d.sku = p.sku\n" +
                        "     left join par_convenio conv on conv.codigo = p.convenio\n" +
                        "          where \n" +
                        "          extract(year from c.femision) =" + cboAgno.getSelectedItem().toString() + " and \n" +
                        "          extract(month from c.femision) =" + i + " and \n"+
                        "          conv.convenio is  not null)total_OC , " +
                        "          ( select \n" +
                    "               sum(d.cantidad* d.valorunitario) as totalFacturado\n" +
                    "              from ctactecli c\n" +
                    "                   left join ctacteclidet d \n" +
                    "                        on c.rut = d.rut and \n" +
                    "                        c.tipdocto = d.tipdocto and\n" +
                    "                        c.nrodocto = d.nrodocto\n" +
                    "                   left join producto p \n" +
                    "                        on d.sku = p.sku\n" +
                    "                   left join par_convenio conv \n" +
                    "                        on conv.codigo = p.convenio\n" +
                    "              where \n" +
                    "              c.tipdocto in ('FAC', 'FEC') and \n" +  //crm
                    "          extract(year from c.femision) =" + cboAgno.getSelectedItem().toString() + " and \n" +
                        "          extract(month from c.femision) =" + i + " and \n"+
                    "              conv.convenio is  not null) TotalFac," +
                    "   (select fn_fact_pendiente_mes(" +cboAgno.getSelectedItem().toString() + "," + cboMes.getSelectedItem().toString() + "," + i + ")) Fact_Meses ";
                    

                        Rs1 = Sql.Select(Query);
             if ( Rs1.next()){
                   TotalFact= Rs1.getDouble("totalFac");
                   TotalOC = Rs1.getDouble("total_OC");
                   
                  // Acum = Acum + (TotalOC - TotalFact) ;
                  
                   if (i <10) {
                       Per = "0" +   i + "";
                   }
                   else{
                       Per = mes + "";
                     }
                   
                   switch(Per){
                       case "01":
                            Per = Per + "-ENE";
                           break;
                       case "02":
                            Per= Per + "-FEB";
                           break;
                       case "03":
                            Per = Per + "-MAR";break;
                       case "04":
                            Per= Per + "-ABR";break;
                       case "05":
                            Per = Per + "-MAY";break;
                       case "06":
                            Per= Per + "-JUN";break;
                       case "07":
                            Per = Per + "-JUL";break;
                       case "08":
                            Per= Per + "-AGO";    break;
                       case "09":
                            Per = Per + "-SEP";break;
                       case "10":
                            Per= Per + "-OCT";break;
                       case "11":
                            Per = Per + "-NOV";break;
                       case "12":
                            Per= Per + "-DIC"; break;   
                   } 
                   
                   Per = cboAgno.getSelectedItem().toString() + Per;
                   dife = TotalOC - Rs1.getDouble("Fact_Meses");
                   Ponderado = ((Rs1.getDouble("Fact_Meses")/TotalOC))*100;
                     TableModel.addRow(new Object[]{ Per, 
                                              fmMain.FormatoNumero(Rs1.getDouble("total_OC")), 
                                              fmMain.FormatoNumero(Rs1.getDouble("TotalFac")), 
                                              fmMain.FormatoNumero(Rs1.getDouble("total_FACTURA")),
                                              fmMain.FormatoNumero(Rs1.getDouble("Fact_Meses")),
                                              fmMain.FormatoNumero(dife),
                                              fmMain.FormatoNumero(Ponderado)});
                }
             else {
                   // lbAcumulada.setText("0.00"); 
                  }
              } //exit for
        
        //lbAcumulada.setText(fmMain.FormatoNumero(Acum)); 
   
 }
 
 catch (Exception e) {
            fmMain.Mensaje("Existe una inconsistencia en la información. 3");
        }finally{
            Sql.Close();
        }
    
}
            
    
// public void CargaDetMargen(String convenio){
//        ExeSql Sql = new ExeSql();
//        ResultSet Rs;
//        DefaultTableModel TableModel = (DefaultTableModel) Grilla_Det.getModel();
//        double Sumador = 0.00;
//        double Margen  = 0.00;
//            
//        
//        int ContReg=0;
//         while(TableModel.getRowCount()>0)
//             TableModel.removeRow(0);
//        try {
//            Rs = Sql.Select("     select \n" +
//"                   conv.codigo,"+ 
//"                   conv.convenio as convenio,\n" +
//"                   d.sku,\n" +
//"                   p.nombre,\n" +
//"                   p.valultcompra,\n" +
//"                   p.costopromedio,\n" +
//"                   d.valorunitario,\n" +
//"                   c.tipdocto,\n" +
//"                   c.femision,\n" +
//"                   c.nrodocto, \n" +
//"                  ((d.valorunitario - p.valultcompra) / d.valorunitario) * 100 as Margen,\n" +
//"          	   (sum(d.cantidad)) * d.valorunitario as totalVta\n" +
//"          from ctactecli c\n" +
//"               left join ctacteclidet d on c.rut = d.rut and c.tipdocto = d.tipdocto and\n" +
//"                c.nrodocto = d.nrodocto\n" +
//"               left join producto p on d.sku = p.sku\n" +
//"               left join par_convenio conv on conv.codigo = p.convenio\n" +
//"          where \n" +
//"          extract(year from c.femision) =" + cboAgno.getSelectedItem().toString() + " and \n" +
//"          extract(month from c.femision) =" + cboMes.getSelectedItem().toString() + " and \n"+
//"          c.tipdocto in ('FAC', 'FEC') and \n" +
//"          conv.convenio is  not null    \n" +
//"           group by     \n" +
//"                   conv.codigo,conv.convenio,\n" +
//"                   d.sku,\n" +
//"                   p.nombre,\n" +
//"                   p.valultcompra,\n" +
//"                   p.costopromedio,\n" +
//"                   d.valorunitario,\n" +
//"                   c.tipdocto,\n" +
//"                   c.nrodocto,\n" +
//"                   c.femision\n" +
//"     having   conv.codigo = " + convenio );
//            
//            while (Rs.next()){
//                ContReg++;
//                        TableModel.addRow(new Object[]{
//                                               Rs.getString("sku").trim(),
//                                               Rs.getString("nombre").trim(), 
//                                               fmMain.FormatoNumero(Rs.getDouble("costopromedio")),
//                                               fmMain.FormatoNumero(Rs.getDouble("valorunitario")),
//                                               Rs.getString("tipdocto").trim(), 
//                                               Rs.getString("femision").trim(), 
//                                               fmMain.FormatoNumero(Rs.getDouble("nrodocto")),
//                                                fmMain.FormatoTotal(Rs.getDouble("Margen")),
//                                               fmMain.FormatoTotal(Rs.getDouble("totalVta"))});
//                Sumador = Sumador + Rs.getDouble("totalVta");
//                
//               
//               }
////                lbTotalVtasDet.setText(fmMain.FormatoNumero(Sumador));
////                lbRegDet.setText(fmMain.FormatoTotal(ContReg));
////                Grilla_Det.changeSelection(0, 0 , false, false);
//            
//        } catch (Exception e) {
//          
//        } finally{
//            Sql.Close();
//        }
//        
//    }   
    
//    public void CargaDetMargenOrdenes(String  convenio){
//        ExeSql Sql = new ExeSql();
//        ResultSet Rs;
//       String  Query = " ";
//        DefaultTableModel TableModel = (DefaultTableModel) Grilla_Det4.getModel();
//        double Sumador=0;
//        int ContReg=0;
//      
////limpiaTablaEncabezadoOrdenesDet();
//        try {
//          
//Query = "   select \n" +
//"   				  conv.codigo,\n" +
//"   				  d.sku,\n" +
//"                   p.nombre,\n" +
//"                   d.valorunitario,\n" +        
//"                   p.valultcompra,\n" +
//"                   p.costopromedio,\n" +
//"                   c.femision,\n" +
//"                   c.orden, \n" +
//"                  ((d.valorunitario - p.costopromedio) / d.valorunitario) * 100 as Margen,\n" +
//"          	   (sum(d.cantidad)) * d.valorunitario as totalVta\n" +
//"         from occh c\n" +
//"         left join occhdet d on c.rut = d.rut and \n" +
//"          c.orden = d.orden \n" +
//"          and  c.codigo_oc   = d.codigo_oc\n" +
//"     left join producto p on d.sku = p.sku\n" +
//"     left join par_convenio conv on conv.codigo = p.convenio\n" +
//"          where \n" +
//"          extract(year from c.femision) =" + cboAgno.getSelectedItem().toString() + " and \n" +
//"          extract(month from c.femision) =" + cboMes.getSelectedItem().toString() + " and \n"+
//"          conv.convenio is  not null\n" +
//"          group by conv.codigo,conv.convenio,\n" +
//"                   d.sku,\n" +
//"                   p.nombre,\n" +
//"                   p.valultcompra,\n" +
//"                   d.valorunitario,\n" +
//"                   p.costopromedio,\n" +
//"                 c.femision,\n" +
//"                   c.orden\n" +
//"     having conv.codigo =" + convenio ;
//        
//            
//            Rs = Sql.Select(Query );
//      
//            while (Rs.next()){
//                ContReg++;
//                        TableModel.addRow(new Object[]{
//                                               Rs.getString("sku").trim(),
//                                               Rs.getString("nombre").trim(), 
//                                               fmMain.FormatoNumero(Rs.getDouble("costopromedio")),
//                                               fmMain.FormatoNumero(Rs.getDouble("valorunitario")),
//                                               Rs.getString("femision").trim(), 
//                                               Rs.getString("orden").trim(), 
//                                               fmMain.FormatoTotal(Rs.getDouble("Margen")),
//                                               fmMain.FormatoTotal(Rs.getDouble("totalVta"))});
//                Sumador = Sumador + Rs.getDouble("totalVta");
//                
//               }
//         
//              if (ContReg ==0){
//                limpiaTablaEncabezadoOrdenes();
//                limpiaTablaEncabezadoOrdenesDet();
//            }
//            else  if (ContReg >0) {
//                 Grilla_Det4.changeSelection(0, 0 , false, false);
//            }
//             
//            lbTotalVtasDet4.setText(fmMain.FormatoNumero(Sumador));
//            lbRegDet4.setText(fmMain.FormatoTotal(ContReg));
//
//          
//        } catch (Exception e) {
//          
//        } finally{
//            Sql.Close();
//        }
//        
//    }
    
    private void jMenuVerProductoActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jMenuVerProductoActionPerformed
        
        pfOCCliente OCC = new pfOCCliente();
        
        
        
        OCC.AbreOCC(GrillaOCS.getValueAt(GrillaOCS.getSelectedRow(),2).toString().trim(),GrillaOCS.getValueAt(GrillaOCS.getSelectedRow(),3).toString().trim(),GrillaOCS.getValueAt(GrillaOCS.getSelectedRow(),4).toString().trim());
        pnPestanas.addTab("OC Cliente", OCC);
        PanelTab btc=new PanelTab(pnPestanas,0);
        pnPestanas.setTabComponentAt(pnPestanas.indexOfComponent(OCC), btc);
        pnPestanas.setSelectedIndex(pnPestanas.getTabCount()-1);
    }//GEN-LAST:event_jMenuVerProductoActionPerformed

    
    private void imprime_excel(javax.swing.JTable Grilla, String Nombre){
        //--------------------------------------------
    String Carpeta = "c:/temp/";    
        if(Grilla.getRowCount()==0){
            fmMain.Mensaje("Nada que exportar");
            return;
        }


            List<JTable> tb=new ArrayList<>();
            List<String> nom=new ArrayList<>();
            
            tb.add(Grilla);
            nom.add(Nombre);
            
            File folder = new File("c:/temp");
            if (!folder.exists())
            {
                folder.mkdir();
            }
            
             String file = Carpeta + Nombre +".xls";       
            
            
            try {
                Exporter e = new Exporter(new File(file), tb, nom);
                
                if(e.export())
                abrir(file);
                //CargaDetMargenOrdenes(GrillaC.getValueAt(GrillaC.getSelectedRow(), 0).toString().trim());
                fmMain.Mensaje("Datos Exportados");
            } catch (Exception e) {
                fmMain.Mensaje(e.getMessage());
            }
    }
    
    
    
    
    private void btExcelActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btExcelActionPerformed
            int mes= Integer.valueOf(cboMes.getSelectedItem().toString());
            String Smes ="";
            if (mes <10){
                Smes = "0" + cboMes.getSelectedItem().toString();
            }
            else{
                Smes = cboMes.getSelectedItem().toString();
                }
            String Nombre = "Resumen_Mes_" + cboAgno.getSelectedItem().toString() + Smes;
           imprime_excel(GrillaC,  Nombre);


    }//GEN-LAST:event_btExcelActionPerformed

      public void abrir(String file ){
        
       try {
           String url = file;
           ProcessBuilder p = new ProcessBuilder();
           p.command("cmd.exe", "/c",url);
           p.start();
       } catch (IOException ex) {
           Logger.getLogger(jdOC_PendientesFac.class.getName()).log(Level.SEVERE, null, ex);
       }
        
    }
    private void cboMesActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cboMesActionPerformed

      if (Entra) {   
        btBuscar.doClick();}
 
    }//GEN-LAST:event_cboMesActionPerformed

    private void cboAgnoActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cboAgnoActionPerformed
       
     if (Entra) {   
        btBuscar.doClick();}
    }//GEN-LAST:event_cboAgnoActionPerformed

    private void btExcelOrActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btExcelOrActionPerformed
       // TODO add your handling code here:
        
        
            int mes= Integer.valueOf(cboMes.getSelectedItem().toString());
            String Smes ="";
            if (mes <10){
                Smes = "0" + cboMes.getSelectedItem().toString();
            }
            else{
                Smes = cboMes.getSelectedItem().toString();
                }
           String Nombre = "OC_Pendiente_FAC" + cboAgno.getSelectedItem().toString() + Smes;
           imprime_excel(Grilla_OC,  Nombre);
    }//GEN-LAST:event_btExcelOrActionPerformed

    private void cboAgno1ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cboAgno1ActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_cboAgno1ActionPerformed

    private void cboMes1ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cboMes1ActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_cboMes1ActionPerformed

    private void chk_ocActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_chk_ocActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_chk_ocActionPerformed

    private void GrillaCMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_GrillaCMouseClicked
        // TODO add your handling code here:
    }//GEN-LAST:event_GrillaCMouseClicked

    private void Grilla_OCMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_Grilla_OCMouseClicked
        // TODO add your handling code here:
    }//GEN-LAST:event_Grilla_OCMouseClicked

    private void BtnOCPendientesActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_BtnOCPendientesActionPerformed
                jdOC_PendientesFac OC_Pend = new jdOC_PendientesFac(null, true);
//            Vouch.Tipo=Tipo;
//            Vouch.Numero=Numero;
//            Vouch.Trans=Trans; 
//            Vouch.Voucher=Voucher;         
//            Vouch.CargaImagen(Tipo, Numero);

              int mes = Integer.valueOf(Grilla_OC.getSelectedRow())+1;  
                
                OC_Pend.setTitle("Año: "+cboAgno.getSelectedItem().toString()+" Mes: "+ cboMes.getSelectedItem().toString() + " Mes OC: "+ mes);
                OC_Pend.CargaOC(Integer.valueOf(cboAgno.getSelectedItem().toString())  , Integer.valueOf(cboMes.getSelectedItem().toString())  , Integer.valueOf(Grilla_OC.getSelectedRow())+1);
            
            OC_Pend.setLocationRelativeTo(null);
            OC_Pend.setVisible(true);
           OC_Pend.dispose();        
    }//GEN-LAST:event_BtnOCPendientesActionPerformed
//6700

    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JPanel AGNO;
    private javax.swing.JButton BtnOCPendientes;
    private javax.swing.JTable GrillaC;
    private javax.swing.JTable GrillaOCS;
    private javax.swing.JTable Grilla_OC;
    private javax.swing.JTable OCS;
    private javax.swing.JTable OCS1;
    private javax.swing.JTable OCS10;
    private javax.swing.JTable OCS11;
    private javax.swing.JTable OCS12;
    private javax.swing.JTable OCS13;
    private javax.swing.JTable OCS14;
    private javax.swing.JTable OCS15;
    private javax.swing.JTable OCS16;
    private javax.swing.JTable OCS17;
    private javax.swing.JTable OCS18;
    private javax.swing.JTable OCS19;
    private javax.swing.JTable OCS2;
    private javax.swing.JTable OCS20;
    private javax.swing.JTable OCS21;
    private javax.swing.JTable OCS22;
    private javax.swing.JTable OCS23;
    private javax.swing.JTable OCS24;
    private javax.swing.JTable OCS25;
    private javax.swing.JTable OCS26;
    private javax.swing.JTable OCS3;
    private javax.swing.JTable OCS4;
    private javax.swing.JTable OCS5;
    private javax.swing.JTable OCS6;
    private javax.swing.JTable OCS7;
    private javax.swing.JTable OCS8;
    private javax.swing.JTable OCS9;
    private javax.swing.JButton btBuscar;
    private javax.swing.JButton btExcel;
    private javax.swing.JButton btExcelOr;
    private javax.swing.ButtonGroup buttonGroup1;
    private javax.swing.ButtonGroup buttonGroup2;
    private javax.swing.ButtonGroup buttonGroup3;
    private javax.swing.JComboBox<String> cboAgno;
    private javax.swing.JComboBox<String> cboAgno1;
    private javax.swing.JComboBox<String> cboMes;
    private javax.swing.JComboBox<String> cboMes1;
    private javax.swing.JCheckBox chk_oc;
    private javax.swing.JLabel jLabel2;
    private javax.swing.JLabel jLabel5;
    private javax.swing.JLabel jLabel6;
    private javax.swing.JLabel jLabel8;
    private javax.swing.JMenuItem jMenuVerProducto;
    private javax.swing.JPanel jPanel1;
    private javax.swing.JPopupMenu jPopupMenu1;
    private javax.swing.JScrollPane jScrollPane1;
    private javax.swing.JScrollPane jScrollPane10;
    private javax.swing.JScrollPane jScrollPane11;
    private javax.swing.JScrollPane jScrollPane12;
    private javax.swing.JScrollPane jScrollPane13;
    private javax.swing.JScrollPane jScrollPane14;
    private javax.swing.JScrollPane jScrollPane15;
    private javax.swing.JScrollPane jScrollPane16;
    private javax.swing.JScrollPane jScrollPane17;
    private javax.swing.JScrollPane jScrollPane18;
    private javax.swing.JScrollPane jScrollPane19;
    private javax.swing.JScrollPane jScrollPane2;
    private javax.swing.JScrollPane jScrollPane20;
    private javax.swing.JScrollPane jScrollPane21;
    private javax.swing.JScrollPane jScrollPane22;
    private javax.swing.JScrollPane jScrollPane23;
    private javax.swing.JScrollPane jScrollPane24;
    private javax.swing.JScrollPane jScrollPane25;
    private javax.swing.JScrollPane jScrollPane26;
    private javax.swing.JScrollPane jScrollPane27;
    private javax.swing.JScrollPane jScrollPane28;
    private javax.swing.JScrollPane jScrollPane29;
    private javax.swing.JScrollPane jScrollPane3;
    private javax.swing.JScrollPane jScrollPane30;
    private javax.swing.JScrollPane jScrollPane4;
    private javax.swing.JScrollPane jScrollPane5;
    private javax.swing.JScrollPane jScrollPane6;
    private javax.swing.JScrollPane jScrollPane7;
    private javax.swing.JScrollPane jScrollPane8;
    private javax.swing.JScrollPane jScrollPane9;
    private org.jdesktop.swingx.JXDatePicker jXDatePicker1;
    private javax.swing.JLabel lbFacturasRelacionadas;
    private javax.swing.JLabel lbRegC;
    private javax.swing.JLabel lbTotalC;
    private javax.swing.JLabel lblAgno;
    private javax.swing.JLabel lblDiferencia;
    private javax.swing.JLabel lblTotal;
    private javax.swing.JLabel lblTotalFac;
    private javax.swing.JLabel lbmar;
    private javax.swing.JLabel lbmar1;
    private javax.swing.JLabel lbmar3;
    // End of variables declaration//GEN-END:variables

    private void cargaOC(int i, int i0, int i1) {
        throw new UnsupportedOperationException("Not supported yet."); //To change body of generated methods, choose Tools | Templates.
    }

  
}
