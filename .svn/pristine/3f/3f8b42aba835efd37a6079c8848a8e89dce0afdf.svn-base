/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package PanelForm;

import Conexion.ExeSql;
import Dialogos.jdAgregaBlog_gsf;
import Formularios.fmMain;
import static Formularios.fmMain.pnPestanas;
import Utilidades.Combo_CodStr;
import Utilidades.Ftp;
import Utilidades.ImgTabla;
import Utilidades.LogError;
import Utilidades.PanelTab;
import java.awt.Color;
import java.awt.Component;
import java.awt.Desktop;
import java.awt.Image;
import java.awt.Toolkit;
import java.awt.datatransfer.Clipboard;
import java.awt.datatransfer.StringSelection;
import java.awt.event.KeyEvent;
import java.awt.image.BufferedImage;
import java.io.File;
import java.net.URL;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.text.ParseException;
import java.text.SimpleDateFormat;
import java.util.Calendar;
import java.util.Date;
import java.util.logging.Level;
import java.util.logging.Logger;
import javax.imageio.ImageIO;
import static javax.management.Query.value;
import javax.swing.DefaultComboBoxModel;
import javax.swing.ImageIcon;
import javax.swing.JLabel;
import javax.swing.JOptionPane;
import javax.swing.JTable;
import javax.swing.RowFilter;
import static javax.swing.ScrollPaneConstants.HORIZONTAL_SCROLLBAR_NEVER;
import javax.swing.event.ListSelectionEvent;
import javax.swing.event.ListSelectionListener;
import javax.swing.table.DefaultTableCellRenderer;
import javax.swing.table.DefaultTableModel;
import javax.swing.table.TableModel;
import javax.swing.table.TableRowSorter;


/**
 *
 * @author luvaly
 */
public class pfGuiasReporteEntrega extends javax.swing.JPanel {

    int usuario_nivel = 0;
    SimpleDateFormat FormatoFecha = new SimpleDateFormat("dd-MM-yyyy");
    Date efecha = new Date();
    
    public int GetNivel() {
        return this.usuario_nivel;
    }
    public pfGuiasReporteEntrega(int nivel) {
        this.usuario_nivel = nivel;
        initComponents();
        //carga();
        if(GetNivel()>=70){
            total_label.setEnabled(true);
            total_valor.setEnabled(true);
            total_label.setVisible(true);
            total_valor.setVisible(true);
            ordenar_valor.setEnabled(true);
            ordenar_valor.setVisible(true);
            ordenar_fecha.setEnabled(true);
            ordenar_fecha.setVisible(true);
            carga_factura.setVisible(true);
            carga_factura.setEnabled(true);
            total_valor.setText("0");
        }
        else {
            carga_factura.setVisible(false);
            carga_factura.setEnabled(false);
            ordenar_valor.setEnabled(false);
            ordenar_valor.setVisible(false);
            ordenar_fecha.setEnabled(false);
            ordenar_fecha.setVisible(false);
            total_label.setEnabled(false);
            total_valor.setEnabled(false);
            total_label.setVisible(false);
            total_valor.setVisible(false);
        }
        
        
        CargaTransporte();
        btAgregarBlog.setVisible(true);
        TxHistorial.setEnabled(true);
        TxHistorial.setEditable(false);

            // Setea valores de Fecha
            //Setea fecha inicial Desde y Hasta
            Date date = new Date();
            dtDesde.setDate(sumarRestarDiasFecha(date,-30));
            dtHasta.setDate(date);
            dtDesde.setEnabled(true);
            dtHasta.setEnabled(true);
            
            jLabel6.setVisible(false);
            lblSumaDias.setVisible(false);
            
            TxHistorial.setLineWrap(true);
            TxHistorial.setWrapStyleWord(true);
            jScrollPane3.setHorizontalScrollBarPolicy(HORIZONTAL_SCROLLBAR_NEVER);
            
            Grilla.getSelectionModel().addListSelectionListener(new ListSelectionListener() {
            //Se ejecuta automáticamente cada vez que se hace una nueva selección. 
            @Override
            public void valueChanged(ListSelectionEvent e) {
                if(Grilla.getSelectedRowCount()>0)
                   CargaBlog();
                    
            }
        });

    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        Menu_FActura = new javax.swing.JPopupMenu();
        MnuCopiaTransporte = new javax.swing.JMenuItem();
        MnuCopiaOrden = new javax.swing.JMenuItem();
        MnuCopiaNro = new javax.swing.JMenuItem();
        MnuImagen = new javax.swing.JMenuItem();
        MnuFacturar = new javax.swing.JMenuItem();
        buttonGroup1 = new javax.swing.ButtonGroup();
        jScrollPane1 = new javax.swing.JScrollPane();
        Grilla = new javax.swing.JTable();
        jLabel1 = new javax.swing.JLabel();
        lblGuiasRef = new javax.swing.JLabel();
        jLabel3 = new javax.swing.JLabel();
        lblGuias = new javax.swing.JLabel();
        jLabel4 = new javax.swing.JLabel();
        lblGuiasTotal = new javax.swing.JLabel();
        btActualizar = new javax.swing.JButton();
        lbGuiasCon = new javax.swing.JLabel();
        lbAlbaran = new javax.swing.JLabel();
        btAgregarBlog = new javax.swing.JButton();
        jScrollPane4 = new javax.swing.JScrollPane();
        GrillaBlog = new javax.swing.JTable();
        lblFecha = new javax.swing.JLabel();
        dtDesde = new org.jdesktop.swingx.JXDatePicker();
        dtHasta = new org.jdesktop.swingx.JXDatePicker();
        jLabel2 = new javax.swing.JLabel();
        jLabel8 = new javax.swing.JLabel();
        cbTransporte = new javax.swing.JComboBox();
        jLabel5 = new javax.swing.JLabel();
        lblPromediodias = new javax.swing.JLabel();
        jLabel6 = new javax.swing.JLabel();
        lblSumaDias = new javax.swing.JLabel();
        jLabel7 = new javax.swing.JLabel();
        lblPromedioAlbaran = new javax.swing.JLabel();
        jLabel9 = new javax.swing.JLabel();
        txSku = new javax.swing.JTextField();
        jScrollPane3 = new javax.swing.JScrollPane();
        TResumen = new javax.swing.JTable();
        jScrollPane5 = new javax.swing.JScrollPane();
        TxHistorial = new javax.swing.JTextArea();
        total_label = new javax.swing.JLabel();
        total_valor = new javax.swing.JLabel();
        jPanel2 = new javax.swing.JPanel();
        carga_factura = new javax.swing.JButton();
        jLabel10 = new javax.swing.JLabel();
        ordenar_fecha = new javax.swing.JRadioButton();
        ordenar_valor = new javax.swing.JRadioButton();
        lbcargando = new javax.swing.JLabel();
        comprobante = new javax.swing.JToggleButton();

        MnuCopiaTransporte.setText("Copia Transporte");
        MnuCopiaTransporte.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                MnuCopiaTransporteActionPerformed(evt);
            }
        });
        Menu_FActura.add(MnuCopiaTransporte);

        MnuCopiaOrden.setText("Copia Orden Compra");
        MnuCopiaOrden.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                MnuCopiaOrdenActionPerformed(evt);
            }
        });
        Menu_FActura.add(MnuCopiaOrden);

        MnuCopiaNro.setText("Copia Nro Documento");
        MnuCopiaNro.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                MnuCopiaNroActionPerformed(evt);
            }
        });
        Menu_FActura.add(MnuCopiaNro);

        MnuImagen.setText("Imagen Voucher");
        MnuImagen.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                MnuImagenActionPerformed(evt);
            }
        });
        Menu_FActura.add(MnuImagen);

        MnuFacturar.setText("Facturar");
        MnuFacturar.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                MnuFacturarActionPerformed(evt);
            }
        });
        Menu_FActura.add(MnuFacturar);

        setLayout(new org.netbeans.lib.awtextra.AbsoluteLayout());

        Grilla.setAutoCreateRowSorter(true);
        Grilla.setFont(new java.awt.Font("Tahoma", 0, 9)); // NOI18N
        Grilla.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {

            },
            new String [] {
                "RUT", "NOMBRE", "ORDEN", "Nro.Doc", "FECHA", "codigo_oc", "orden", "Transporte", "Referencia", "Situacion", "Comp.", "cod_transporte", "Dias", "TipoDoc", "totaldocto"
            }
        ) {
            Class[] types = new Class [] {
                java.lang.Object.class, java.lang.Object.class, java.lang.Object.class, java.lang.String.class, java.lang.Object.class, java.lang.Object.class, java.lang.Object.class, java.lang.Object.class, java.lang.Object.class, java.lang.Object.class, java.lang.Object.class, java.lang.Object.class, java.lang.Integer.class, java.lang.Object.class, java.lang.Object.class
            };
            boolean[] canEdit = new boolean [] {
                false, false, false, false, false, false, false, false, false, false, false, false, false, false, false
            };

            public Class getColumnClass(int columnIndex) {
                return types [columnIndex];
            }

            public boolean isCellEditable(int rowIndex, int columnIndex) {
                return canEdit [columnIndex];
            }
        });
        Grilla.setComponentPopupMenu(Menu_FActura);
        Grilla.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                GrillaMouseClicked(evt);
            }
        });
        Grilla.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                GrillaKeyPressed(evt);
            }
            public void keyReleased(java.awt.event.KeyEvent evt) {
                GrillaKeyReleased(evt);
            }
        });
        jScrollPane1.setViewportView(Grilla);
        if (Grilla.getColumnModel().getColumnCount() > 0) {
            Grilla.getColumnModel().getColumn(0).setMinWidth(80);
            Grilla.getColumnModel().getColumn(0).setPreferredWidth(80);
            Grilla.getColumnModel().getColumn(0).setMaxWidth(100);
            Grilla.getColumnModel().getColumn(1).setMinWidth(230);
            Grilla.getColumnModel().getColumn(1).setPreferredWidth(230);
            Grilla.getColumnModel().getColumn(1).setMaxWidth(380);
            Grilla.getColumnModel().getColumn(2).setMinWidth(70);
            Grilla.getColumnModel().getColumn(2).setPreferredWidth(70);
            Grilla.getColumnModel().getColumn(2).setMaxWidth(120);
            Grilla.getColumnModel().getColumn(3).setMinWidth(50);
            Grilla.getColumnModel().getColumn(3).setPreferredWidth(50);
            Grilla.getColumnModel().getColumn(3).setMaxWidth(70);
            Grilla.getColumnModel().getColumn(4).setMinWidth(50);
            Grilla.getColumnModel().getColumn(4).setPreferredWidth(50);
            Grilla.getColumnModel().getColumn(4).setMaxWidth(100);
            Grilla.getColumnModel().getColumn(5).setMinWidth(0);
            Grilla.getColumnModel().getColumn(5).setPreferredWidth(0);
            Grilla.getColumnModel().getColumn(5).setMaxWidth(0);
            Grilla.getColumnModel().getColumn(6).setMinWidth(0);
            Grilla.getColumnModel().getColumn(6).setPreferredWidth(0);
            Grilla.getColumnModel().getColumn(6).setMaxWidth(0);
            Grilla.getColumnModel().getColumn(7).setMinWidth(60);
            Grilla.getColumnModel().getColumn(7).setPreferredWidth(60);
            Grilla.getColumnModel().getColumn(7).setMaxWidth(135);
            Grilla.getColumnModel().getColumn(8).setMinWidth(40);
            Grilla.getColumnModel().getColumn(8).setPreferredWidth(40);
            Grilla.getColumnModel().getColumn(8).setMaxWidth(110);
            Grilla.getColumnModel().getColumn(9).setMinWidth(140);
            Grilla.getColumnModel().getColumn(9).setPreferredWidth(140);
            Grilla.getColumnModel().getColumn(9).setMaxWidth(200);
            Grilla.getColumnModel().getColumn(10).setMinWidth(0);
            Grilla.getColumnModel().getColumn(10).setPreferredWidth(0);
            Grilla.getColumnModel().getColumn(10).setMaxWidth(0);
            Grilla.getColumnModel().getColumn(11).setMinWidth(0);
            Grilla.getColumnModel().getColumn(11).setPreferredWidth(0);
            Grilla.getColumnModel().getColumn(11).setMaxWidth(0);
            Grilla.getColumnModel().getColumn(12).setMinWidth(50);
            Grilla.getColumnModel().getColumn(12).setPreferredWidth(50);
            Grilla.getColumnModel().getColumn(12).setMaxWidth(80);
            Grilla.getColumnModel().getColumn(13).setMinWidth(70);
            Grilla.getColumnModel().getColumn(13).setPreferredWidth(50);
            Grilla.getColumnModel().getColumn(13).setMaxWidth(90);
        }

        add(jScrollPane1, new org.netbeans.lib.awtextra.AbsoluteConstraints(10, 60, 1060, 340));

        jLabel1.setText("Total Guias con Referencia");
        add(jLabel1, new org.netbeans.lib.awtextra.AbsoluteConstraints(760, 440, -1, -1));

        lblGuiasRef.setHorizontalAlignment(javax.swing.SwingConstants.RIGHT);
        lblGuiasRef.setText("0");
        add(lblGuiasRef, new org.netbeans.lib.awtextra.AbsoluteConstraints(940, 440, 120, -1));

        jLabel3.setText("Total Guias Sin Ref");
        add(jLabel3, new org.netbeans.lib.awtextra.AbsoluteConstraints(760, 460, -1, -1));

        lblGuias.setHorizontalAlignment(javax.swing.SwingConstants.RIGHT);
        lblGuias.setText("0");
        add(lblGuias, new org.netbeans.lib.awtextra.AbsoluteConstraints(980, 460, 79, -1));

        jLabel4.setText("Total Guias");
        add(jLabel4, new org.netbeans.lib.awtextra.AbsoluteConstraints(760, 480, -1, -1));

        lblGuiasTotal.setHorizontalAlignment(javax.swing.SwingConstants.RIGHT);
        lblGuiasTotal.setText("0");
        add(lblGuiasTotal, new org.netbeans.lib.awtextra.AbsoluteConstraints(980, 480, 79, -1));

        btActualizar.setText("Actualizar");
        btActualizar.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btActualizarActionPerformed(evt);
            }
        });
        add(btActualizar, new org.netbeans.lib.awtextra.AbsoluteConstraints(868, 26, -1, -1));

        lbGuiasCon.setText("Guias Con Albaran");
        add(lbGuiasCon, new org.netbeans.lib.awtextra.AbsoluteConstraints(760, 420, -1, -1));

        lbAlbaran.setHorizontalAlignment(javax.swing.SwingConstants.RIGHT);
        lbAlbaran.setText("0");
        add(lbAlbaran, new org.netbeans.lib.awtextra.AbsoluteConstraints(950, 420, 110, -1));

        btAgregarBlog.setIcon(new javax.swing.ImageIcon(getClass().getResource("/Iconos16/Agregar.png"))); // NOI18N
        btAgregarBlog.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btAgregarBlogActionPerformed(evt);
            }
        });
        add(btAgregarBlog, new org.netbeans.lib.awtextra.AbsoluteConstraints(975, 24, 26, -1));

        GrillaBlog.setFont(new java.awt.Font("Tahoma", 0, 10)); // NOI18N
        GrillaBlog.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {

            },
            new String [] {
                "", "Historial", "id"
            }
        ) {
            boolean[] canEdit = new boolean [] {
                false, false, false
            };

            public boolean isCellEditable(int rowIndex, int columnIndex) {
                return canEdit [columnIndex];
            }
        });
        GrillaBlog.setToolTipText("Tool");
        GrillaBlog.setGridColor(new java.awt.Color(255, 255, 255));
        GrillaBlog.setRowHeight(20);
        GrillaBlog.setSelectionMode(javax.swing.ListSelectionModel.SINGLE_SELECTION);
        GrillaBlog.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                GrillaBlogMouseClicked(evt);
            }
        });
        jScrollPane4.setViewportView(GrillaBlog);
        if (GrillaBlog.getColumnModel().getColumnCount() > 0) {
            GrillaBlog.getColumnModel().getColumn(0).setMinWidth(40);
            GrillaBlog.getColumnModel().getColumn(0).setPreferredWidth(20);
            GrillaBlog.getColumnModel().getColumn(0).setMaxWidth(60);
            GrillaBlog.getColumnModel().getColumn(1).setMinWidth(280);
            GrillaBlog.getColumnModel().getColumn(1).setPreferredWidth(250);
            GrillaBlog.getColumnModel().getColumn(1).setMaxWidth(300);
            GrillaBlog.getColumnModel().getColumn(2).setMinWidth(0);
            GrillaBlog.getColumnModel().getColumn(2).setPreferredWidth(0);
            GrillaBlog.getColumnModel().getColumn(2).setMaxWidth(0);
        }

        add(jScrollPane4, new org.netbeans.lib.awtextra.AbsoluteConstraints(1088, 59, 190, 280));

        lblFecha.setText("Fecha");
        add(lblFecha, new org.netbeans.lib.awtextra.AbsoluteConstraints(20, 10, 37, -1));

        dtDesde.setEnabled(false);
        dtDesde.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                dtDesdeMouseClicked(evt);
            }
            public void mousePressed(java.awt.event.MouseEvent evt) {
                dtDesdeMousePressed(evt);
            }
        });
        dtDesde.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                dtDesdeActionPerformed(evt);
            }
        });
        add(dtDesde, new org.netbeans.lib.awtextra.AbsoluteConstraints(20, 30, 131, -1));

        dtHasta.setEnabled(false);
        dtHasta.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                dtHastaMouseClicked(evt);
            }
            public void mousePressed(java.awt.event.MouseEvent evt) {
                dtHastaMousePressed(evt);
            }
        });
        dtHasta.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                dtHastaActionPerformed(evt);
            }
        });
        add(dtHasta, new org.netbeans.lib.awtextra.AbsoluteConstraints(160, 30, 141, -1));

        jLabel2.setFont(new java.awt.Font("Tahoma", 1, 11)); // NOI18N
        jLabel2.setText("F12: Ver Albaran  <F12>");
        add(jLabel2, new org.netbeans.lib.awtextra.AbsoluteConstraints(10, 410, 175, -1));

        jLabel8.setText("Transporte");
        add(jLabel8, new org.netbeans.lib.awtextra.AbsoluteConstraints(330, 10, -1, -1));

        cbTransporte.setFont(new java.awt.Font("Arial", 0, 10)); // NOI18N
        cbTransporte.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                cbTransporteMouseClicked(evt);
            }
        });
        cbTransporte.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                cbTransporteActionPerformed(evt);
            }
        });
        add(cbTransporte, new org.netbeans.lib.awtextra.AbsoluteConstraints(320, 30, 250, -1));

        jLabel5.setText("Promedio dias");
        add(jLabel5, new org.netbeans.lib.awtextra.AbsoluteConstraints(760, 540, -1, -1));

        lblPromediodias.setHorizontalAlignment(javax.swing.SwingConstants.RIGHT);
        lblPromediodias.setText("0");
        add(lblPromediodias, new org.netbeans.lib.awtextra.AbsoluteConstraints(980, 540, 79, -1));

        jLabel6.setText("Suma Dias");
        add(jLabel6, new org.netbeans.lib.awtextra.AbsoluteConstraints(760, 500, -1, -1));

        lblSumaDias.setHorizontalAlignment(javax.swing.SwingConstants.RIGHT);
        lblSumaDias.setText("0");
        add(lblSumaDias, new org.netbeans.lib.awtextra.AbsoluteConstraints(980, 500, 79, -1));

        jLabel7.setText("Promedio Albaran");
        add(jLabel7, new org.netbeans.lib.awtextra.AbsoluteConstraints(760, 520, -1, -1));

        lblPromedioAlbaran.setHorizontalAlignment(javax.swing.SwingConstants.RIGHT);
        lblPromedioAlbaran.setText("0");
        add(lblPromedioAlbaran, new org.netbeans.lib.awtextra.AbsoluteConstraints(980, 520, 79, -1));

        jLabel9.setText("FILTRO:");
        add(jLabel9, new org.netbeans.lib.awtextra.AbsoluteConstraints(600, 10, -1, -1));

        txSku.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                txSkuKeyPressed(evt);
            }
            public void keyTyped(java.awt.event.KeyEvent evt) {
                txSkuKeyTyped(evt);
            }
        });
        add(txSku, new org.netbeans.lib.awtextra.AbsoluteConstraints(596, 30, 250, -1));

        TResumen.setAutoCreateRowSorter(true);
        TResumen.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {
                {null, null, null, null},
                {null, null, null, null},
                {null, null, null, null},
                {null, null, null, null}
            },
            new String [] {
                "Fecha", "Transporte", "Reg.", "%"
            }
        ) {
            Class[] types = new Class [] {
                java.lang.Object.class, java.lang.Object.class, java.lang.Integer.class, java.lang.Double.class
            };
            boolean[] canEdit = new boolean [] {
                false, false, false, false
            };

            public Class getColumnClass(int columnIndex) {
                return types [columnIndex];
            }

            public boolean isCellEditable(int rowIndex, int columnIndex) {
                return canEdit [columnIndex];
            }
        });
        jScrollPane3.setViewportView(TResumen);
        if (TResumen.getColumnModel().getColumnCount() > 0) {
            TResumen.getColumnModel().getColumn(0).setMinWidth(80);
            TResumen.getColumnModel().getColumn(0).setPreferredWidth(80);
            TResumen.getColumnModel().getColumn(0).setMaxWidth(90);
            TResumen.getColumnModel().getColumn(1).setMinWidth(180);
            TResumen.getColumnModel().getColumn(1).setPreferredWidth(180);
            TResumen.getColumnModel().getColumn(1).setMaxWidth(220);
            TResumen.getColumnModel().getColumn(2).setMinWidth(35);
            TResumen.getColumnModel().getColumn(2).setPreferredWidth(35);
            TResumen.getColumnModel().getColumn(2).setMaxWidth(55);
            TResumen.getColumnModel().getColumn(3).setMinWidth(30);
            TResumen.getColumnModel().getColumn(3).setPreferredWidth(30);
            TResumen.getColumnModel().getColumn(3).setMaxWidth(50);
        }

        add(jScrollPane3, new org.netbeans.lib.awtextra.AbsoluteConstraints(180, 410, 400, 190));

        TxHistorial.setEditable(false);
        TxHistorial.setColumns(20);
        TxHistorial.setFont(new java.awt.Font("Tahoma", 0, 10)); // NOI18N
        TxHistorial.setRows(20);
        TxHistorial.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                TxHistorialKeyPressed(evt);
            }
            public void keyReleased(java.awt.event.KeyEvent evt) {
                TxHistorialKeyReleased(evt);
            }
        });
        jScrollPane5.setViewportView(TxHistorial);

        add(jScrollPane5, new org.netbeans.lib.awtextra.AbsoluteConstraints(1090, 350, 190, 200));

        total_label.setText("Total : ");
        total_label.setEnabled(false);
        add(total_label, new org.netbeans.lib.awtextra.AbsoluteConstraints(760, 560, -1, -1));

        total_valor.setText("jLabel5");
        total_valor.setEnabled(false);
        add(total_valor, new org.netbeans.lib.awtextra.AbsoluteConstraints(1030, 560, -1, -1));

        jPanel2.setBorder(javax.swing.BorderFactory.createEtchedBorder());

        carga_factura.setText("Cargar sin Factura");
        carga_factura.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                carga_facturaActionPerformed(evt);
            }
        });
        jPanel2.add(carga_factura);
        jPanel2.add(jLabel10);

        buttonGroup1.add(ordenar_fecha);
        ordenar_fecha.setSelected(true);
        ordenar_fecha.setText("Ordenar por fecha");
        jPanel2.add(ordenar_fecha);

        buttonGroup1.add(ordenar_valor);
        ordenar_valor.setText("Ordenar por valor");
        jPanel2.add(ordenar_valor);

        add(jPanel2, new org.netbeans.lib.awtextra.AbsoluteConstraints(10, 430, 160, 170));

        lbcargando.setText("Cargando");
        add(lbcargando, new org.netbeans.lib.awtextra.AbsoluteConstraints(1020, 30, -1, -1));

        comprobante.setText("Sin Comprobante");
        comprobante.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                comprobanteActionPerformed(evt);
            }
        });
        add(comprobante, new org.netbeans.lib.awtextra.AbsoluteConstraints(590, 410, -1, -1));
    }// </editor-fold>//GEN-END:initComponents

    private void GrillaMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_GrillaMouseClicked
        CargaBlog();
        if(evt.getClickCount()==2){
            
            if(evt.isAltDown())
            {
              
            }
            else{
              CargaOCC();  
            }
            
        }
    }//GEN-LAST:event_GrillaMouseClicked
    public void CargaTotal (){//Carga el total de las guias en el label
            int suma = 0;
            DefaultTableModel model = (DefaultTableModel) Grilla.getModel();
            for(int i = 0; i< model.getRowCount(); i++){
                suma = suma +Integer.parseInt(model.getValueAt(i, 14).toString());
            }
           
            total_valor.setText(""+fmMain.FormatoTotal(suma));
        }
    public void CargaSinFactura(String filtro){//Carga las guias sin factura

            ExeSql Sql = new ExeSql();
            ResultSet Rs;
            int contGuias =0;
            int contGuiasSF =0;
             Grilla.setDefaultRenderer(Object.class, new ImgTabla());
            DefaultTableModel TableModel = (DefaultTableModel) Grilla.getModel();
            while(TableModel.getRowCount()>0)
                TableModel.removeRow(0);


            try{
                int contador = 0;

                Rs = Sql.Select("select c.nrodocto, cli.rut,cli.nombre, c.codigo_oc, c.occh,c.codigo_oc || '-' || c.occh as orden, td.fdespacho as fecha, \n "+
                                " case when pg.nombre is null then 'PENDIENTE' else pg.nombre end as transporte, td.voucher, td.situacion, pg.codigo as codtransporte, \n" +
                                " case when td.pdf_voucher is null then 'NO' else 'SI' end as pdf \n"+
                                "from ctactecli c\n" +
                                "left join cliente cli on cli.rut=c.rut\n" +
                                "left join transporte_despachos td on c.tipdocto=td.tipdocto and c.nrodocto=td.nrodocto \n " +
                                "left join par_general pg on td.transporte=pg.codigo and pg.tipo='TRANSPORTE' \n " +
                                "where c.tipdocto in ('GDC','NVC')\n" +
                                "and c.tipdocrel is null\n" +
                                "and c.estado>0\n" +
                                " " + filtro);
                if(GetNivel()>=70){
                    Rs = Sql.Select("select c.nrodocto, cli.rut,cli.nombre, c.codigo_oc, c.occh,c.codigo_oc || '-' || c.occh as orden, td.fdespacho as fecha, \n "+
                                " case when pg.nombre is null then 'PENDIENTE' else pg.nombre end as transporte, td.voucher, td.situacion, pg.codigo as codtransporte, \n" +
                                " case when td.pdf_voucher is null then 'NO' else 'SI' end as pdf \n"+
                                ", c.totaldocto \n"+
                                "from ctactecli c\n" +
                                "left join cliente cli on cli.rut=c.rut\n" +
                                "left join transporte_despachos td on c.tipdocto=td.tipdocto and c.nrodocto=td.nrodocto \n " +
                                "left join par_general pg on td.transporte=pg.codigo and pg.tipo='TRANSPORTE' \n " +
                                "where c.tipdocto in ('GDC','NVC')\n" +
                                "and c.tipdocrel is null\n" +
                                "and c.estado>0\n" +
                                "" + filtro);//SQL para administrador

                }
                Rs.last();
                if(Rs.getRow()>0){
                    
                }
                else {
                    JOptionPane.showMessageDialog(null, "No hay documentos sin facturar");
                    return;
                }
                Rs.beforeFirst();
                while(Rs.next()){

                    if (Rs.getString("voucher")==null || Rs.getString("voucher").equals("") ){
                    contGuiasSF++;
                    }
                    else{
                      contGuias++;      
                    }     


                JLabel lb = new JLabel();
                URL si =  this.getClass().getResource("/Iconos16/ok_16.png");  
                URL no =  this.getClass().getResource("/Iconos16/Eliminar.png");

                if (Rs.getString("pdf").trim().equals("SI"))
                    {
                    ImageIcon imagen =  new ImageIcon(si); 
                    lb.setIcon(imagen);
                    contador++;
                    }
                else
                    {
                    ImageIcon imagen =  new ImageIcon(no);
                    lb.setIcon(imagen);
                    }

                    if(GetNivel()<70){
                        Grilla.getColumnModel().getColumn(10).setMinWidth(100);
                        Grilla.getColumnModel().getColumn(10).setPreferredWidth(100);
                        Grilla.getColumnModel().getColumn(10).setMaxWidth(100);    
                         
                        TableModel.addRow(new Object[]{
                                          Rs.getString("rut"),
                                          Rs.getString("nombre").trim(),
                                          Rs.getString("orden"),
                                          Rs.getString("nrodocto"),
                                          Rs.getString("fecha"),
                                          Rs.getString("codigo_oc"),
                                          Rs.getString("occh"),
                                          Rs.getString("transporte"),
                                          Rs.getString("voucher"),
                                          Rs.getString("situacion"),
                                          lb,
                                          Rs.getInt("codtransporte"),"","",""
                                      });
                    }

                    if(GetNivel()>=70){
                        Grilla.getColumnModel().getColumn(10).setMinWidth(30);//Se modifica algunas columnas para que no se ve desordenado
                        Grilla.getColumnModel().getColumn(10).setPreferredWidth(30);
                        Grilla.getColumnModel().getColumn(10).setMaxWidth(30);    
                        Grilla.getColumnModel().getColumn(12).setMinWidth(30);
                        Grilla.getColumnModel().getColumn(12).setPreferredWidth(30);
                        Grilla.getColumnModel().getColumn(12).setMaxWidth(30); 
                        Grilla.getColumnModel().getColumn(13).setMinWidth(30);
                        Grilla.getColumnModel().getColumn(13).setPreferredWidth(30);
                        Grilla.getColumnModel().getColumn(13).setMaxWidth(30); 
                        DefaultTableCellRenderer rightRenderer = new DefaultTableCellRenderer();
                        rightRenderer.setHorizontalAlignment(JLabel.RIGHT);
                        Grilla.getColumnModel().getColumn(14).setCellRenderer(rightRenderer);


                        TableModel.addRow(new Object[]{
                                          Rs.getString("rut"),
                                          Rs.getString("nombre").trim(),
                                          Rs.getString("orden"),
                                          Rs.getString("nrodocto"),
                                          Rs.getString("fecha"),
                                          Rs.getString("codigo_oc"),
                                          Rs.getString("occh"),
                                          Rs.getString("transporte"),
                                          Rs.getString("voucher"),
                                          Rs.getString("situacion"),
                                          lb,
                                          Rs.getInt("codtransporte"),"","",
                                          (Rs.getInt("totaldocto"))//Se agrega total a las columnas
                                      });   
                    }

                }
                Grilla.repaint();
                
             // Seteado en la primera  posicion.
             Grilla.changeSelection(0, 0 , false, false);
                CargaBlog();
                lbAlbaran.setText(String.valueOf(contador));
                lblGuias.setText(String.valueOf(contGuiasSF));
                lblGuiasRef.setText(String.valueOf(contGuias));
                lblGuiasTotal.setText(String.valueOf(contGuias+contGuiasSF));
            } catch (Exception e) {
                fmMain.Mensaje("Se produjo un error al cargar la tabla: "+e);
              }finally{
                Sql.Close();
            }
            
    }
    public void CargaTransporte(){
        DefaultComboBoxModel value;
        ExeSql Sql = new ExeSql();
        ResultSet Rs;
        String Query="";
        cbTransporte.removeAllItems();
        value =new DefaultComboBoxModel();
        int i =0;
        try {
            Query="   select pg.codigo, pg.nombre from par_general pg\n" +
                        "  where pg.tipo ='TRANSPORTE'\n" +
                        "  order by valor DESC";
            Rs = Sql.Select(Query);
            if(Sql.GetRowCount()==0) return;
           //value.addElement(new ComboCodigos("Seleccione",0));   
           i=1;
           
           value.addElement(new Combo_CodStr("<Seleccione>","-1",i));
           while(Rs.next()){
               value.addElement(new Combo_CodStr(Rs.getString("nombre").trim(),Rs.getString("codigo").trim(),i));
               i++;
            System.out.println(Rs.getString("nombre").trim());
           } 
           cbTransporte.setModel(value);
           cbTransporte.setSelectedIndex(0);

           
           
        } catch (Exception e) {
            System.out.println(e);
        }
        finally{
            Sql.Close();
        }
    }
    
    public void CargaPdf(int Transporte, String Voucher, int numero){
        ResultSet Rs;
        ExeSql Sql = new ExeSql();
        String server,user,pass,ruta_local="";
        int puerto =21;
         String rutaimage="";
        try {

//            server= "192.168.0.130";
//            user="voucher";
//            pass="V2369";
            
            
           //trae datos ftp
            server="";
            puerto=0;
            user=""; 
            pass="";
            	Rs = Sql.Select("SELECT * from conexiones where tipo='ftp'");
                if (Rs.next())
                {
                    if(!fmMain.GetInternet()){
                        server = Rs.getString("serv");
                        user  = Rs.getString("usu");
                        puerto  = Rs.getInt("port");
                        pass = Rs.getString("pass");
                    }
                    else {
                        server = "179.57.172.101";
                        user  = Rs.getString("usu");
                        puerto  = 21;
                        pass = Rs.getString("pass");
                    }
                }
           //trae datos ftp
            
            Rs = Sql.Select("SELECT count(pdf_voucher) as hay from transporte_despachos where transporte="+Transporte+" and voucher='"+Voucher+"' and nrodocto = "+numero+"");
            Rs.next();
            if (Rs.getInt("hay")>=1)
            {
                if (Voucher.equals("")){
                    Voucher = Rs.getString("voucher");
                }                    
                Rs = Sql.Select("SELECT pdf_voucher as pdf from transporte_despachos where transporte ="+Transporte+" and voucher = '" + Voucher + "' and nrodocto = "+numero+"");
                Rs.next();
                if (Rs.getString("pdf") != null)
                {

                    //Verifica SO
                    String sistema = System.getProperty("os.name").toLowerCase();
                    File folder = new File("");
                    if (sistema.contains("win"))
                    {
                         ruta_local = "c:/fotos2/";
                         folder = new File(ruta_local.substring(0,ruta_local.length()-1));
                    }
                    else{
                          ruta_local = "/fotos2/";
                          folder = new File(ruta_local);
                    }
                    if (!folder.exists())
                    {
                        folder.mkdir();
                    }
                    String archivo = "";
                    rutaimage=Rs.getString("pdf");
                    
                    String rutrans="";
                    if (Transporte == 1)
                    {
                        rutrans = "/tnt/";
                        //archivo = rutaimage.substring(33,rutaimage.length());
                         archivo = fmMain.GetStringDeFinal('\\', rutaimage);
                    }
                    else if (Transporte == 7)
                    {
                        rutrans = "/blue/";
                        //archivo = rutaimage.substring(34,rutaimage.length());
                         archivo = fmMain.GetStringDeFinal('\\', rutaimage);
                    }
                    else
                        {
                        rutrans = "/";
                        archivo = fmMain.GetStringDeFinal('\\', rutaimage);
                    }
                    
                   String  Archivo_buscado = Ftp.busca_archivoFTP(server, puerto, user, pass, ruta_local, "",archivo);

                   if (Archivo_buscado.equals("") )
                   {
                    Ftp.baja_archivo_ftp(server, puerto,user, pass,rutrans+archivo,ruta_local + archivo);
                    File file = new File(archivo);
                    File pathCompleto = new File(ruta_local + file);
                    Desktop.getDesktop().open(pathCompleto); 
                   }     
                   else
                   {
                        rutrans = "/";
                        Ftp.baja_archivo_ftp(server, puerto,user, pass,rutrans+archivo,ruta_local + Archivo_buscado);
                        File file = new File(archivo);
                        File pathCompleto = new File(ruta_local + file);
                        Desktop.getDesktop().open(pathCompleto); 
                   }
                                      
                }
               
            }
        }
        catch (Exception e) {
            JOptionPane.showMessageDialog(null, "Error: " + e.getMessage());
        }
        finally{
            Sql.Close();
            
        }
    }
    
    
    public void CargaPdf_OLD(int Transporte, String Voucher){
        ResultSet Rs;
        ExeSql Sql = new ExeSql();
        String server,user,pass,ruta_local="";
        int puerto =21;
         String rutaimage="";
        try {

//            server= "192.168.0.130";
//            user="voucher";
//            pass="V2369";
            
            
//trae datos ftp
            server="";
            puerto=0;
            user=""; 
            pass="";
            	Rs = Sql.Select("SELECT * from conexiones where tipo='ftp'");
                if (Rs.next())
                {
                    server = Rs.getString("serv");
                    user  = Rs.getString("usu");
                    puerto  = Rs.getInt("port");
                    pass = Rs.getString("pass");
                }
           //trae datos ftp
            
            Rs = Sql.Select("SELECT count(pdf_voucher) as hay from transporte_despachos where transporte="+Transporte+" and voucher='"+Voucher+"'");
            Rs.next();
            if (Rs.getInt("hay")>=1)
            {
                if (Voucher.equals("")){
                    Voucher = Rs.getString("voucher");
                }                    
                Rs = Sql.Select("SELECT pdf_voucher as pdf from transporte_despachos where transporte ="+Transporte+"and voucher = '" + Voucher + "'");
                Rs.next();
                if (Rs.getString("pdf") != null)
                {

                    //Verifica SO
                    String sistema = System.getProperty("os.name").toLowerCase();
                    File folder = new File("");
                    if (sistema.contains("win"))
                    {
                         ruta_local = "c:/fotos2/";
                         folder = new File(ruta_local.substring(0,ruta_local.length()-1));
                    }
                    else{
                          ruta_local = "/fotos2/";
                          folder = new File(ruta_local);
                    }
                    if (!folder.exists())
                    {
                        folder.mkdir();
                    }
                    
                    rutaimage=Rs.getString("pdf");
                    //String archivo = rutaimage.substring(33,rutaimage.length());
                    
                    
                    String archivo = fmMain.GetStringDeFinal('\\', rutaimage);
                    
                    String ruta_transporte = "";
                    if (Transporte==1)
                        {
                             ruta_transporte="/tnt/";
                        }
                    else if (Transporte==7)
                        {
                            ruta_transporte="/blue/";
                        }       
                    else
                    {
                        ruta_transporte="/";
                    }
                    Ftp.baja_archivo_ftp(server, puerto,user, pass,ruta_transporte+archivo,ruta_local + archivo);
                                       
                    File file = new File(archivo);
                    File pathCompleto = new File(ruta_local + file);
                    Desktop.getDesktop().open(pathCompleto); 
                }
               
            }
        }
        catch (Exception e) {
            JOptionPane.showMessageDialog(null, "Error: " + e.getMessage());
        }
        finally{
            Sql.Close();
            
        }
    }
    
    
    private void MnuCopiaTransporteActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_MnuCopiaTransporteActionPerformed
        // TODO add your handling code here:ç
           if((!Grilla.getValueAt(Grilla.getSelectedRow(), 8).toString().trim().isEmpty())){
            StringSelection Transporte = new StringSelection(Grilla.getValueAt(Grilla.getSelectedRow(), 8).toString().trim());
            Clipboard cb = Toolkit.getDefaultToolkit().getSystemClipboard();
            cb.setContents(Transporte, null);
        }
    }//GEN-LAST:event_MnuCopiaTransporteActionPerformed

    private void MnuCopiaOrdenActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_MnuCopiaOrdenActionPerformed
        // TODO add your handling code here:
          if((!Grilla.getValueAt(Grilla.getSelectedRow(), 2).toString().trim().isEmpty())){
            StringSelection OrdenC = new StringSelection(Grilla.getValueAt(Grilla.getSelectedRow(), 2).toString().trim());
            Clipboard cb = Toolkit.getDefaultToolkit().getSystemClipboard();
            cb.setContents(OrdenC, null);
    }//GEN-LAST:event_MnuCopiaOrdenActionPerformed
   }
    private void MnuCopiaNroActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_MnuCopiaNroActionPerformed
        // TODO add your handling code here:
         if((!Grilla.getValueAt(Grilla.getSelectedRow(), 3).toString().trim().isEmpty())){
            StringSelection NroDoc = new StringSelection(Grilla.getValueAt(Grilla.getSelectedRow(), 3).toString().trim());
            Clipboard cb = Toolkit.getDefaultToolkit().getSystemClipboard();
            cb.setContents(NroDoc, null);
    }//GEN-LAST:event_MnuCopiaNroActionPerformed
}
    private void btActualizarActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btActualizarActionPerformed
        // TODO add your handling code here:
         carga();
         
    }//GEN-LAST:event_btActualizarActionPerformed

    private void GrillaKeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_GrillaKeyPressed
        CargaBlog();
    }//GEN-LAST:event_GrillaKeyPressed

    private void GrillaKeyReleased(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_GrillaKeyReleased
    if (evt.getKeyCode() == KeyEvent.VK_F12 )
       {
        String trans= String.valueOf(Grilla.getValueAt(Grilla.getSelectedRow(), 11));
        int transporte = Integer.valueOf(trans);
        String voucher= String.valueOf(Grilla.getValueAt(Grilla.getSelectedRow(), 8)).trim();
        int numero = Integer.valueOf(Grilla.getValueAt(Grilla.getSelectedRow(), 3).toString().trim());
        CargaPdf(transporte, voucher,numero);
       }
    }//GEN-LAST:event_GrillaKeyReleased

    
    private void trae_resumen(){
    double valor = 0.0;
    String  codTran ="";
     ExeSql Sql = new ExeSql();
        ResultSet Rs;
        DefaultTableModel dfTm = (DefaultTableModel) TResumen.getModel();
        
        fmMain.LimpiaGrilla(dfTm);
        
        
        try {
            String Query = " select \n" +
                            " 	td.fdespacho as fecha, \n" +
                            "    pg.nombre , count(*) as Reg, count(td.pdf_voucher) as Vo\n" +
                            "from ctactecli c\n" +
                            "left join cliente cli on cli.rut=c.rut\n" +
                            "left join transporte_despachos td on c.tipdocto=td.tipdocto and c.nrodocto=td.nrodocto \n" +
                            " left join par_general pg on td.transporte=pg.codigo and pg.tipo='TRANSPORTE' \n" +
                            " where c.tipdocto in ('GDC','NVC')\n" +
                            " and  CAST(td.fdespacho as date) \n" +
                            " between '" + getDesde() + "' and '" + getHasta() + "' \n";
                            if (cbTransporte.getSelectedIndex()>0 )
                            {    
                               Combo_CodStr codigo = (Combo_CodStr) cbTransporte.getSelectedItem();
                               codTran = codigo.getId();
                               Query = Query + " and td.transporte = " +  codTran;
                            }
                    
                    
                    
                            Query = Query + " group by td.fdespacho,pg.nombre order by td.fdespacho,pg.nombre ";        
             Rs = Sql.Select(Query);
            while(Rs.next()){
                
                valor =0;
                if (Rs.getDouble("Vo")>0){
                    valor = (Rs.getDouble("Vo")/Rs.getDouble("Reg"))*100;
                }
                else
                {
                    valor =0;
                }
                
                valor = Math.round(valor);
                
                
                dfTm.addRow(new Object[]{Rs.getString("fecha"),Rs.getString("nombre"),Rs.getInt("Reg"),valor});
            }
            TResumen.changeSelection(0, 0 , false, false);
        } catch (Exception e) {
        }    
        
        
        
    }
    
    
    
    
    
    
    private void CargaBlog(){
        ExeSql Sql = new ExeSql();
        ResultSet Rs;
        String Query ="";
        GrillaBlog.setDefaultRenderer(Object.class, new ImgTabla());
        DefaultTableModel tm = (DefaultTableModel) GrillaBlog.getModel();
        SimpleDateFormat sdf = new SimpleDateFormat("dd-MMM-yyyy - hh:mm");
        SimpleDateFormat sdf2 = new SimpleDateFormat("dd-MMM-yyyy");
        
//        while(tm.getRowCount()>0)
//            tm.removeRow(0); 
        fmMain.LimpiaGrilla(tm);
        
        
        TxHistorial.setText("");
        JLabel lbCall = new JLabel();
        JLabel lbMail = new JLabel();
        JLabel lbFin  = new JLabel();
        JLabel lbIni  = new JLabel();
        JLabel lbInfo = new JLabel();
        
        URL urlCall = this.getClass().getResource("/Iconos/Llamada.png");  
        URL urlMail = this.getClass().getResource("/Iconos/email.png");  
        URL urlIni =  this.getClass().getResource("/Iconos22/Go.png");  
        URL urlFin =  this.getClass().getResource("/Iconos/camion.png");  
        URL urlInfo =  this.getClass().getResource("/Iconos/info.png");
         
        ImageIcon IconoCall =  new ImageIcon(urlCall); 
        ImageIcon IconoMail =  new ImageIcon(urlMail); 
        ImageIcon IconoIni  =  new ImageIcon(urlIni); 
        ImageIcon IconoFin  =  new ImageIcon(urlFin); 
        ImageIcon IconoInfo =  new ImageIcon(urlInfo); 
        
        lbCall.setIcon(IconoCall);
        lbMail.setIcon(IconoMail);
        lbIni.setIcon(IconoIni);
        lbFin.setIcon(IconoFin);
        lbInfo.setIcon(IconoInfo);
        
        try {
            
            Query = "SELECT id,fecha,usuario,texto,tipo,compromiso,fcompromiso\n" +
                            "FROM blog_gsf\n" +
                            "where rut=" + Grilla.getValueAt(Grilla.getSelectedRow(), 0).toString() + "\n" +
                            "and tipdocto in ('GDC','NVC') \n" + 
                            "and nrodocto=" + Grilla.getValueAt(Grilla.getSelectedRow(), 3).toString() + " order by fecha desc";
            
            Rs = Sql.Select(Query);
            
            while(Rs.next()){
                 //Tipo 0 = Llamada
                if(Rs.getInt("tipo")==1){
                    tm.addRow(new Object[]{lbCall,sdf.format(Rs.getTimestamp("fecha"))+ "   [" + Rs.getString("usuario").trim().toUpperCase() + "]",Rs.getString("id")});
                    
                }
                //Tipo 1 = Correo
                else if(Rs.getInt("tipo")==2) {
                    tm.addRow(new Object[]{lbMail,sdf.format(Rs.getTimestamp("fecha"))+ "   [" + Rs.getString("usuario").trim().toUpperCase() + "]",Rs.getString("id")});
                }
                // Tipo 2 = Bloque
                else if(Rs.getInt("tipo")==3) {
                    tm.addRow(new Object[]{lbIni,sdf.format(Rs.getTimestamp("fecha"))+ "   [" + Rs.getString("usuario").trim().toUpperCase() + "]",Rs.getString("id")});
                }
                // Tipo 3 = Desbloqueo
                else if(Rs.getInt("tipo")==4) {
                    tm.addRow(new Object[]{lbFin,sdf.format(Rs.getTimestamp("fecha"))+ "   [" + Rs.getString("usuario").trim().toUpperCase() + "]",Rs.getString("id")});
                }
                
                else if(Rs.getInt("tipo")==5) {
                    tm.addRow(new Object[]{lbInfo,sdf.format(Rs.getTimestamp("fecha"))+ "   [" + Rs.getString("usuario").trim().toUpperCase() + "]",Rs.getString("id")});
                }
                
                 //Mensaje
                tm.addRow(new Object[]{" ",Rs.getString("texto"),Rs.getString("id")});
//                if(Rs.getBoolean("compromiso"))
//                    tm.addRow(new Object[]{" ", "Compromiso: " + sdf2.format(Rs.getTimestamp("fcompromiso"))});
                    
            }
            
        } catch (Exception e) {
            fmMain.Mensaje("Ha ocurrido un error");
            LogError.Guardar(this.getClass().getSimpleName(),e.getMessage());
        } finally {
            Sql.Close();
        }
    }
    
    
    
    
    
    private void btAgregarBlogActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btAgregarBlogActionPerformed
        
        
        
        
        jdAgregaBlog_gsf AddBlog = new jdAgregaBlog_gsf(null, true);
        AddBlog.SetDatos(Grilla.getValueAt(Grilla.getSelectedRow(), 0).toString(), "GDC", Grilla.getValueAt(Grilla.getSelectedRow(), 3).toString());
        
        
        //AddBlog.SetDatos(Grilla.getValueAt(Grilla.getSelectedRow(), 0),"GDC",Grilla.getValueAt(Grilla.getSelectedRow(), 3));
        AddBlog.setTitle("Nuevo Registro");
        AddBlog.setLocationRelativeTo(btAgregarBlog);
        AddBlog.setVisible(true);
        if(AddBlog.GetGuardar())
        CargaBlog();
    }//GEN-LAST:event_btAgregarBlogActionPerformed

    private void dtDesdeMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_dtDesdeMouseClicked
        // TODO add your handling code here:
        //CargaDespachos();
    }//GEN-LAST:event_dtDesdeMouseClicked

    private void dtDesdeMousePressed(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_dtDesdeMousePressed
        // TODO add your handling code here:
        //CargaDespachos();
    }//GEN-LAST:event_dtDesdeMousePressed

    private void dtDesdeActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_dtDesdeActionPerformed
        // TODO add your handling code here:
        carga();
    }//GEN-LAST:event_dtDesdeActionPerformed

    private void dtHastaMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_dtHastaMouseClicked
        // TODO add your handling code here:
        
    }//GEN-LAST:event_dtHastaMouseClicked

    private void dtHastaMousePressed(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_dtHastaMousePressed
        // TODO add your handling code here:
    }//GEN-LAST:event_dtHastaMousePressed

    private void dtHastaActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_dtHastaActionPerformed
        // TODO add your handling code here:
        carga();
    }//GEN-LAST:event_dtHastaActionPerformed

    private void cbTransporteMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_cbTransporteMouseClicked
    }//GEN-LAST:event_cbTransporteMouseClicked

    private void cbTransporteActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cbTransporteActionPerformed
        carga();
    }//GEN-LAST:event_cbTransporteActionPerformed

    private void GrillaBlogMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_GrillaBlogMouseClicked
        // TODO add your handling code here:
          TxHistorial.setText(GrillaBlog.getValueAt(GrillaBlog.getSelectedRow(), 1).toString());
    }//GEN-LAST:event_GrillaBlogMouseClicked

    private void txSkuKeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_txSkuKeyPressed
    
        
        if(evt.getKeyCode() == KeyEvent.VK_ENTER){
         TableRowSorter<TableModel>sorter = new TableRowSorter<TableModel>(Grilla.getModel());
        Grilla.setRowSorter(sorter);    
        String sku = txSku.getText().trim();
        if (sku.length()==0)
        {
            sorter.setRowFilter(null);
        }
        else{
            int cant=0;
            int ev=0;
            String precio = "";
            sorter.setRowFilter(RowFilter.regexFilter(sku));
        }
        }
    }//GEN-LAST:event_txSkuKeyPressed

    private void txSkuKeyTyped(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_txSkuKeyTyped
        // TODO add your handling code here:
        if (Character.isLowerCase(evt.getKeyChar()))
            evt.setKeyChar(Character.toUpperCase(evt.getKeyChar()));
    }//GEN-LAST:event_txSkuKeyTyped

    private void TxHistorialKeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_TxHistorialKeyPressed
        // TODO add your handling code here:
        if (Character.isLowerCase(evt.getKeyChar()))
        evt.setKeyChar(Character.toUpperCase(evt.getKeyChar()));
    }//GEN-LAST:event_TxHistorialKeyPressed

    private void TxHistorialKeyReleased(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_TxHistorialKeyReleased
        // TODO add your handling code here:
        TxHistorial.setText(TxHistorial.getText().toUpperCase());
    }//GEN-LAST:event_TxHistorialKeyReleased

    private void carga_facturaActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_carga_facturaActionPerformed
        if(ordenar_fecha.isSelected()){//Se carga método con orden por fecha
            CargaSinFactura("order by c.femision DESC");
        }
        if(ordenar_valor.isSelected()){//Se carga método con orden por valor
            CargaSinFactura("order by c.totaldocto DESC");
        }
        if(GetNivel()>=70){//Si es administrador se carga el total en el label
            CargaTotal();
        }
        DefaultTableModel TableModel = (DefaultTableModel) TResumen.getModel();
        if(TableModel.getRowCount()>0){
            while(TableModel.getRowCount()>0)//Se vacia la tabla TResumen
            TableModel.removeRow(0);
        }
        
    }//GEN-LAST:event_carga_facturaActionPerformed

    private void MnuImagenActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_MnuImagenActionPerformed
        // TODO add your handling code here:
        
            ExeSql Sql = new ExeSql();
            ResultSet Rs;
            try
            {
               Rs = Sql.Select("select p.nombre,t.otro_trans,t.voucher,t.bultos,\n" +
                                "t.peso,t.direccion,t.contacto,t.fono,t.fdespacho, t.transporte\n" +
                                "from transporte_despachos t\n" +
                                " left join par_general p on t.transporte=p.codigo \n"+
                                "where p.tipo='TRANSPORTE' and t.tipdocto='" + Grilla.getValueAt(Grilla.getSelectedRow(), 13).toString().trim() + "' and nrodocto=" + Grilla.getValueAt(Grilla.getSelectedRow(), 3).toString().trim() );
            Rs.next();
            
            String Tipo = Grilla.getValueAt(Grilla.getSelectedRow(), 13).toString().trim();
            String Numero = Grilla.getValueAt(Grilla.getSelectedRow(), 3).toString().trim();
            String Voucher = Grilla.getValueAt(Grilla.getSelectedRow(), 8).toString().trim();
            String Transporte = Rs.getString("nombre");
            
/*----------------------------------------------------------------
Modificacion realizada por Cristian Ramirez
            Motivo: Ocupa demasiada memoria Ram para ejecutar el proceso de pegado de Voucher de transporte
            Solución: Se realizan pruebas de performance 
*/        
        
//            jdVoucher Vouch = new jdVoucher(null, true);
//            Vouch.Tipo= Tipo;
//            Vouch.Numero= Numero;
//            Vouch.Trans= Transporte;
//            Vouch.Voucher= Voucher;
//            Vouch.CargaImagen(Tipo, Numero);
//            Vouch.setTitle("Voucher "+Transporte+" nº"+Voucher+" - "+Tipo+" nº"+Numero);
//            Vouch.setLocationRelativeTo(null);
//            Vouch.setVisible(true);
            
//            if (Vouch.guardo==1)
//            {Recargar();}
             
        voucher vou = new voucher();
        vou.setOpaque(false);
        vou.Tipo= Tipo;
        vou.Numero= Numero;
        vou.Trans= Transporte;
        vou.cod_transp = Rs.getInt("transporte");
        vou.Voucher= Voucher;
    vou.CargaImagen(Tipo, Numero,Voucher);

        pnPestanas.addTab("Voucher "+Transporte+" nº"+Voucher+" - "+Tipo+" nº"+Numero, vou);
        PanelTab btc = new PanelTab(pnPestanas, 0);
        pnPestanas.setTabComponentAt(pnPestanas.indexOfComponent(vou), btc);
        pnPestanas.setSelectedIndex(pnPestanas.getTabCount() - 1);
           if (vou.guardo==1)
            {carga();}
    } catch (Exception e) {
            System.out.println(e.getMessage());
            //fmMain.Mensaje("Esta intentando abrir un voucher sin Imagen asociada");
            }
            finally{
                Sql.Close();
            }
        
    }//GEN-LAST:event_MnuImagenActionPerformed

    private void comprobanteActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_comprobanteActionPerformed
        carga();
    }//GEN-LAST:event_comprobanteActionPerformed

    private void MnuFacturarActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_MnuFacturarActionPerformed
        String rut = Grilla.getValueAt(Grilla.getSelectedRow(), 0).toString();
        String codigo_oc = Grilla.getValueAt(Grilla.getSelectedRow(), 5).toString();
        String orden = Grilla.getValueAt(Grilla.getSelectedRow(), 6).toString();
        pfFACCliente Cli = new pfFACCliente();
            //        Cli.setOpaque(false);
        pnPestanas.addTab("Nueva Factura", Cli);
        PanelTab btc=new PanelTab(pnPestanas,0);
        pnPestanas.setTabComponentAt(pnPestanas.indexOfComponent(Cli), btc);
        pnPestanas.setSelectedIndex(pnPestanas.getTabCount()-1);
        Cli.btNuevo.doClick();
        Cli.txRut.setText(rut);
        Cli.btIr.doClick();
        Cli.cbCodigoOc.setSelectedItem(codigo_oc);
        System.out.println(orden);
        Cli.cbNroOrden.setSelectedItem(orden);
    }//GEN-LAST:event_MnuFacturarActionPerformed
    
    
    private void carga(){
          Runnable miRunnable = new Runnable() {
            public void run() {
                try{
                    Grilla.clearSelection();
                    lbcargando.setVisible(true);
                    btActualizar.setEnabled(false);
                    carga_factura.setEnabled(false);
                    CargaGSF();
                    trae_resumen();
                    lbcargando.setVisible(false);
                    //Grilla.changeSelection(0, 0 , false, false);
                    btActualizar.setEnabled(true);
                    carga_factura.setEnabled(true);
                    
                } catch (Exception e) {
                    e.printStackTrace();
                    
                }
                
            }
        };
        Thread hilo = new Thread(miRunnable);
        hilo.start();
        lbcargando.setText("Cargando.....");
        URL urlInfo =  this.getClass().getResource("/Iconos16/wait.gif");
        ImageIcon IconoInfo =  new ImageIcon(urlInfo); 
        lbcargando.setIcon(IconoInfo);
        lbcargando.setForeground(Color.red);
        
        }
    
    
       public void CargaOCC(){
        pfOCCliente OCC = new pfOCCliente();
        OCC.AbreOCC(Grilla.getValueAt(Grilla.getSelectedRow(),0).toString().trim(),Grilla.getValueAt(Grilla.getSelectedRow(),5).toString().trim(),Grilla.getValueAt(Grilla.getSelectedRow(),6).toString().trim());
        pnPestanas.addTab("OC Cliente", OCC);
        PanelTab btc=new PanelTab(pnPestanas,0);
        pnPestanas.setTabComponentAt(pnPestanas.indexOfComponent(OCC), btc);
        pnPestanas.setSelectedIndex(pnPestanas.getTabCount()-1);
    
}

     public String getDesde() {
         
        SimpleDateFormat sdf = new SimpleDateFormat("yyyy-MM-dd");
        return( sdf.format( (dtDesde.getDate()).getTime() ) );
    }
     
     
      public String getHasta() {
         
        SimpleDateFormat sdf = new SimpleDateFormat("yyyy-MM-dd");
        return( sdf.format( (dtHasta.getDate()).getTime() ) );
    }       
       
 public Date sumarRestarDiasFecha(Date fecha, int dias){
      Calendar calendar = Calendar.getInstance();
      calendar.setTime(fecha); // Configuramos la fecha que se recibe
      calendar.add(Calendar.DAY_OF_YEAR, dias);  // numero de días a añadir, o restar en caso de días<0
      return calendar.getTime(); // Devuelve el objeto Date con los nuevos días añadidos
}       
       
       public void CargaGSF(){
           
        ExeSql Sql = new ExeSql();
        ResultSet Rs;
        int contGuias =0;
        int contGuiasSF =0,dias=0;
        int SumaDias =0;
        double ddias=0.0, dcantGuias=0.0;
        int cuentadocto =0; 
        double promedio  =0.0;
        String  codTran ="";
        Grilla.setDefaultRenderer(Object.class, new ImgTabla());
        DefaultTableModel TableModel = (DefaultTableModel) Grilla.getModel();
        
        //Limpiar Grilla
        fmMain.LimpiaGrilla(TableModel);
        
        try{
            int contador = 0;
//            String Query = "select c.nrodocto, cli.rut,cli.nombre, c.codigo_oc, c.occh,c.codigo_oc || '-' || c.occh as orden, td.fdespacho as fecha, \n "+
//                            " case when pg.nombre is null then 'PENDIENTE' else pg.nombre end as transporte, td.voucher, CASE when td.situacion is null then 'S/D' else td.situacion end as situacion, pg.codigo as codtransporte, \n" +
//                            " case  \n" +
//                            " when td.pdf_voucher is null then 'NO' \n" +
//                            " when td.pdf_voucher = '' then 'NO'\n" +
//                            " else 'SI' end as pdf, \n" +
//                            "CAST (\n" +
//                            "  case (SUBSTRING (td.situacion FROM 1 FOR 9) )\n" +
//                            "  WHEN  'Entregada' THEN\n" +
//                            " 	SUBSTRING (td.situacion FROM 11 FOR 10) \n" +
//                            "  WHEN 'Entregado'THEN\n" +
//                            "    	SUBSTRING (td.situacion FROM 11 FOR 10) \n" +
//                            "  ELSE\n" +
//                            "  	'01/01/1900'\n" +
//                            "  END  as date) - CAST(td.fdespacho as date) dias ,\n" +
//                            "  td.fdespacho,  CAST (\n" +
//                            "  case (SUBSTRING (td.situacion FROM 1 FOR 9) )\n" +
//                            "  WHEN  'Entregada' THEN\n" +
//                            " 	SUBSTRING (td.situacion FROM 11 FOR 10) \n" +
//                            "  WHEN 'Entregado'THEN\n" +
//                            "    	SUBSTRING (td.situacion FROM 11 FOR 10) \n" +
//                            "  ELSE\n" +
//                            "  	'01/01/1900'\n" +
//                            "  END  as date),  td.tipdocto \n" +
//                            "from ctactecli c\n" +
//                            "left join cliente cli on cli.rut=c.rut\n" +
//                            "left join transporte_despachos td on c.tipdocto=td.tipdocto and c.nrodocto=td.nrodocto \n " +
//                            "left join par_general pg on td.transporte=pg.codigo and pg.tipo='TRANSPORTE' \n " +
//                            "where c.tipdocto IN ('GDC','FAT')\n" +
//                            " and  CAST(td.fdespacho as date) between '" + getDesde() + "' and '" + getHasta() + "' \n";
            
            String Query = "select c.nrodocto, cli.rut,cli.nombre, c.codigo_oc, c.occh,c.codigo_oc || '-' || c.occh as orden, td.fdespacho as fecha, \n "+
                            " case when pg.nombre is null then 'PENDIENTE' else pg.nombre end as transporte, td.voucher, " +
                            " CASE when td.situacion is null then 'S/D' else td.situacion end as situacion, pg.codigo as codtransporte, \n" +
                            " case  \n" +
                            " when td.pdf_voucher is null then 'NO' \n" +
                            " when td.pdf_voucher = '' then 'NO'\n" +
                            " else 'SI' end as pdf, \n" +
                            " td.fdespacho, td.tipdocto \n" +
                            "from ctactecli c\n" +
                            "left join cliente cli on cli.rut=c.rut\n" +
                            "left join transporte_despachos td on c.tipdocto=td.tipdocto and c.nrodocto=td.nrodocto \n " +
                            "left join par_general pg on td.transporte=pg.codigo and pg.tipo='TRANSPORTE' \n " +
                            "where c.tipdocto IN ('GDC','FAT','NVC')\n" +
                            " and  CAST(td.fdespacho as date) between '" + getDesde() + "' and '" + getHasta() + "' \n";
            
            
            
            
                            //" and td.situacion like 'Entregad%' ";
                            if(comprobante.isSelected()){
                                Query = Query + "and td.pdf_voucher is null\n";
                            }
                            
                            if (cbTransporte.getSelectedIndex()>0 )
                            {    
                               Combo_CodStr codigo = (Combo_CodStr) cbTransporte.getSelectedItem();
                               codTran = codigo.getId();
                               Query = Query + " and td.transporte = " +  codTran;
                            }
                             
                            
                            
            Rs = Sql.Select(Query);
            System.out.println("Query que trae los registros a Grilla");
            System.out.println(Query);
            while(Rs.next()){
                
                if (Rs.getString("voucher")==null || Rs.getString("voucher")=="" ){
                contGuiasSF++;
                }
                else{
                  contGuias++;      
                }     
              
            Grilla.getColumnModel().getColumn(10).setMinWidth(50);
            Grilla.getColumnModel().getColumn(10).setPreferredWidth(50);
            Grilla.getColumnModel().getColumn(10).setMaxWidth(50);    
            Grilla.getColumnModel().getColumn(12).setMinWidth(50);
            Grilla.getColumnModel().getColumn(12).setPreferredWidth(50);
            Grilla.getColumnModel().getColumn(12).setMaxWidth(50); 
            Grilla.getColumnModel().getColumn(13).setMinWidth(50);
            Grilla.getColumnModel().getColumn(13).setPreferredWidth(50);
            Grilla.getColumnModel().getColumn(13).setMaxWidth(50); 
 
                
            JLabel lb = new JLabel();
            URL si =  this.getClass().getResource("/Iconos16/ok_16.png");  
            URL no =  this.getClass().getResource("/Iconos16/Eliminar.png");
            
            if (Rs.getString("pdf").trim().equals("SI")){
                
                ImageIcon imagen =  new ImageIcon(si); 
                lb.setIcon(imagen);
                contador++;
            }else{
                
                ImageIcon imagen =  new ImageIcon(no);
                lb.setIcon(imagen);
            }
            
            //*************************************** CALCULO DIAS ********************************************//
            
            String situacion = Rs.getString("situacion");
            String [] parte = "".split("");
            
            int losdias = 0;
            
            if (situacion.contains("Entregada") || situacion.contains("Entregado") ){
            
                System.out.println("LA FECHA1 ES : "+Rs.getString("situacion").substring(10));
                String fsituacion = Rs.getString("situacion").substring(10);
                
                if (fsituacion.contains("/")){
                
                    parte = fsituacion.split("/");
                   
                    
                }else if (fsituacion.contains("-")){
                
                    parte = fsituacion.split("-");
                   
                
                }
                
                 System.out.println("Parte 1 : "+parte[0]);
                 System.out.println("Parte 2 : "+parte[1]);
                 System.out.println("Parte 3 : "+parte[2]);
                 
                if (Integer.parseInt(parte[1]) > 12){
                        
                        if (Integer.parseInt(parte[0]) < 10){
                        
                                parte[0] = "0"+parte[0];
                        
                        }
                        
                        efecha = FormatoFecha.parse(parte[1]+"-"+parte[0]+"-"+parte[2]);
                       
                
                }else if (Integer.parseInt(parte[1]) <= 12) {
                
                        
                       if (Integer.parseInt(parte[0]) < 10){
                        
                                parte[0] = "0"+parte[0];
                        
                        }  
                                        
                        efecha = FormatoFecha.parse(parte[0]+"-"+parte[1]+"-"+parte[2]);
                
                }
                
                
                
                 String sfecha = FormatoFecha.format(efecha);
                 String dfecha = FormatoFecha.format( Rs.getDate("fdespacho"));
                      
                 Date fecha = FormatoFecha.parse(sfecha);
                 Date fecha2 = FormatoFecha.parse(dfecha);
                        
                 long fec = calculaDias(fecha);
                 long dfec = calculaDias(fecha2);
                 losdias = (int) ((fec - dfec) / (86400000));
                 
            }
              
               
            if (losdias < 0){
            
                dias=0;
            
            }else{
                
                dias = losdias;
                cuentadocto= cuentadocto + 1;
            }    
                
                
            SumaDias = SumaDias + dias;
            
        //************************************************************************************************************//
       
            
            TableModel.addRow(new Object[]{
                                      Rs.getString("rut"),
                                      Rs.getString("nombre").trim(),
                                      Rs.getString("orden"),
                                      Rs.getString("nrodocto"),
                                      Rs.getString("fecha"),
                                      Rs.getString("codigo_oc"),
                                      Rs.getString("occh"),
                                      Rs.getString("transporte"),
                                      Rs.getString("voucher"),
                                      Rs.getString("situacion"),
                                      lb,
                                      Rs.getInt("codtransporte"),
                                      dias,
                                      Rs.getString("tipdocto")
                                  });   
            }
         //Grilla.repaint();
         // Seteado en la primera  posicion.
         Grilla.changeSelection(0, 0 , false, false);
         
         if (Grilla.getRowCount()>0){
            CargaBlog();
         }  
         
            lbAlbaran.setText(String.valueOf(contador));
            lblGuias.setText(String.valueOf(contGuiasSF));
            lblGuiasRef.setText(String.valueOf(contGuias));
            lblGuiasTotal.setText(String.valueOf(contGuias+contGuiasSF));
            lblSumaDias.setText(String.valueOf(SumaDias));
            
           
            ddias = SumaDias;
            dcantGuias= cuentadocto;
                    //contador+contGuias+contGuiasSF;
            promedio = ddias / dcantGuias;
            lblPromediodias.setText(fmMain.FormatoNumero(promedio));
            lblPromedioAlbaran.setText(fmMain.FormatoNumero(((double) contador/(contGuias+contGuiasSF) )*100) + "%" );
            
            
        } catch (SQLException e) {
            fmMain.Mensaje("Se produjo un error al cargar la tabla: "+e);
             Logger.getLogger(pfGuiasReporteEntrega.class.getName()).log(Level.SEVERE, null, e);
          } catch (ParseException ex) {
            Logger.getLogger(pfGuiasReporteEntrega.class.getName()).log(Level.SEVERE, null, ex);
        }finally{
            Sql.Close();
        }
        
}
       
    private long calculaDias(Date fecha){
    
    
        Calendar fecCal = Calendar.getInstance();
            
        fecCal.setTime(fecha);
            
        int agno =  fecCal.get(Calendar.YEAR);
        int mes =  fecCal.get(Calendar.MONTH)+1;
        int dia =  fecCal.get(Calendar.DAY_OF_MONTH);
            
            
        fecCal.set(agno,mes,dia);
        fecCal.set(Calendar.HOUR, 0);
        fecCal.set(Calendar.HOUR_OF_DAY, 0);
        fecCal.set(Calendar.MINUTE, 0);
        fecCal.set(Calendar.SECOND, 0);
        
        long diasfec = fecCal.getTimeInMillis();
    
        return diasfec;
    
    }       
       
       
    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JTable Grilla;
    private javax.swing.JTable GrillaBlog;
    private javax.swing.JPopupMenu Menu_FActura;
    private javax.swing.JMenuItem MnuCopiaNro;
    private javax.swing.JMenuItem MnuCopiaOrden;
    private javax.swing.JMenuItem MnuCopiaTransporte;
    private javax.swing.JMenuItem MnuFacturar;
    private javax.swing.JMenuItem MnuImagen;
    private javax.swing.JTable TResumen;
    private javax.swing.JTextArea TxHistorial;
    private javax.swing.JButton btActualizar;
    private javax.swing.JButton btAgregarBlog;
    private javax.swing.ButtonGroup buttonGroup1;
    private javax.swing.JButton carga_factura;
    public javax.swing.JComboBox cbTransporte;
    private javax.swing.JToggleButton comprobante;
    private org.jdesktop.swingx.JXDatePicker dtDesde;
    private org.jdesktop.swingx.JXDatePicker dtHasta;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JLabel jLabel10;
    private javax.swing.JLabel jLabel2;
    private javax.swing.JLabel jLabel3;
    private javax.swing.JLabel jLabel4;
    private javax.swing.JLabel jLabel5;
    private javax.swing.JLabel jLabel6;
    private javax.swing.JLabel jLabel7;
    private javax.swing.JLabel jLabel8;
    private javax.swing.JLabel jLabel9;
    private javax.swing.JPanel jPanel2;
    private javax.swing.JScrollPane jScrollPane1;
    private javax.swing.JScrollPane jScrollPane3;
    private javax.swing.JScrollPane jScrollPane4;
    private javax.swing.JScrollPane jScrollPane5;
    private javax.swing.JLabel lbAlbaran;
    private javax.swing.JLabel lbGuiasCon;
    private javax.swing.JLabel lbcargando;
    private javax.swing.JLabel lblFecha;
    private javax.swing.JLabel lblGuias;
    private javax.swing.JLabel lblGuiasRef;
    private javax.swing.JLabel lblGuiasTotal;
    private javax.swing.JLabel lblPromedioAlbaran;
    private javax.swing.JLabel lblPromediodias;
    private javax.swing.JLabel lblSumaDias;
    private javax.swing.JRadioButton ordenar_fecha;
    private javax.swing.JRadioButton ordenar_valor;
    private javax.swing.JLabel total_label;
    private javax.swing.JLabel total_valor;
    private javax.swing.JTextField txSku;
    // End of variables declaration//GEN-END:variables
}
