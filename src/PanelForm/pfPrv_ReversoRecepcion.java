/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package PanelForm;

import Conexion.ExeSql;
import Dialogos.jdBuscarCliPrv;
import Formularios.fmMain;
import Utilidades.LogError;
import java.awt.event.KeyEvent;
import java.sql.ResultSet;
import javax.swing.JOptionPane;
import javax.swing.SwingConstants;
import javax.swing.table.DefaultTableCellRenderer;
import javax.swing.table.DefaultTableModel;

/**
 *
 * @author David Alcaman
 */
public class pfPrv_ReversoRecepcion extends javax.swing.JPanel {
    DefaultTableCellRenderer rightRenderer = new DefaultTableCellRenderer();
    /**
     * Creates new form pfPrv_ReversoRecepcion
     */
    public pfPrv_ReversoRecepcion() {
        initComponents();
        rightRenderer.setHorizontalAlignment(SwingConstants.RIGHT);
        Grilla.getColumnModel().getColumn(3).setCellRenderer(rightRenderer);
        Grilla.getColumnModel().getColumn(4).setCellRenderer(rightRenderer);
        Grilla.getColumnModel().getColumn(5).setCellRenderer(rightRenderer);
        txRut.requestFocus();
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        jPanel2 = new javax.swing.JPanel();
        txDv = new javax.swing.JTextField();
        btIr = new javax.swing.JButton();
        jLabel3 = new javax.swing.JLabel();
        txRut = new javax.swing.JTextField();
        jLabel4 = new javax.swing.JLabel();
        txNombre = new javax.swing.JTextField();
        jLabel1 = new javax.swing.JLabel();
        cbTipo = new javax.swing.JComboBox();
        jLabel2 = new javax.swing.JLabel();
        txNroDocto = new javax.swing.JTextField();
        btIr1 = new javax.swing.JButton();
        jLabel9 = new javax.swing.JLabel();
        txEstado = new javax.swing.JTextField();
        jPanel1 = new javax.swing.JPanel();
        jLabel5 = new javax.swing.JLabel();
        jLabel6 = new javax.swing.JLabel();
        txUsuario = new javax.swing.JTextField();
        txFecha = new javax.swing.JTextField();
        btReversar = new javax.swing.JButton();
        jLabel7 = new javax.swing.JLabel();
        txOCP = new javax.swing.JTextField();
        jScrollPane1 = new javax.swing.JScrollPane();
        Grilla = new javax.swing.JTable();
        jPanel5 = new javax.swing.JPanel();
        jLabel11 = new javax.swing.JLabel();
        txExento = new javax.swing.JTextField();
        txNeto = new javax.swing.JTextField();
        jLabel10 = new javax.swing.JLabel();
        txIva = new javax.swing.JTextField();
        jLabel12 = new javax.swing.JLabel();
        txTotal = new javax.swing.JTextField();
        jLabel13 = new javax.swing.JLabel();
        jLabel8 = new javax.swing.JLabel();
        txImpEspecifico = new javax.swing.JTextField();

        jPanel2.setBorder(javax.swing.BorderFactory.createEtchedBorder());

        txDv.setEditable(false);

        btIr.setIcon(new javax.swing.ImageIcon(getClass().getResource("/Iconos22/Go.png"))); // NOI18N
        btIr.setBorderPainted(false);
        btIr.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btIrActionPerformed(evt);
            }
        });

        jLabel3.setText("Rut");

        txRut.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                txRutKeyPressed(evt);
            }
        });

        jLabel4.setText("Nombre");

        txNombre.setEditable(false);

        jLabel1.setText("Tipo");

        cbTipo.setModel(new javax.swing.DefaultComboBoxModel(new String[] { "Guia de Despacho", "Factura" }));

        jLabel2.setText("Numero");

        txNroDocto.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                txNroDoctoKeyPressed(evt);
            }
        });

        btIr1.setIcon(new javax.swing.ImageIcon(getClass().getResource("/Iconos22/Go.png"))); // NOI18N
        btIr1.setBorderPainted(false);
        btIr1.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btIr1ActionPerformed(evt);
            }
        });

        jLabel9.setText("Estado");

        txEstado.setEditable(false);

        javax.swing.GroupLayout jPanel2Layout = new javax.swing.GroupLayout(jPanel2);
        jPanel2.setLayout(jPanel2Layout);
        jPanel2Layout.setHorizontalGroup(
            jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel2Layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                    .addComponent(jLabel1)
                    .addGroup(jPanel2Layout.createSequentialGroup()
                        .addComponent(jLabel3)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(txRut, javax.swing.GroupLayout.PREFERRED_SIZE, 87, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(txDv, javax.swing.GroupLayout.PREFERRED_SIZE, 27, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(btIr, javax.swing.GroupLayout.PREFERRED_SIZE, 26, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                        .addComponent(jLabel4)))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                    .addComponent(txNombre, javax.swing.GroupLayout.PREFERRED_SIZE, 528, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addGroup(jPanel2Layout.createSequentialGroup()
                        .addComponent(cbTipo, javax.swing.GroupLayout.PREFERRED_SIZE, 150, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                        .addComponent(jLabel2)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(txNroDocto, javax.swing.GroupLayout.PREFERRED_SIZE, 114, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(btIr1, javax.swing.GroupLayout.PREFERRED_SIZE, 26, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addGap(18, 18, 18)
                        .addComponent(jLabel9)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(txEstado)))
                .addGap(239, 239, 239))
        );
        jPanel2Layout.setVerticalGroup(
            jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel2Layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.CENTER)
                    .addComponent(txRut, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(btIr)
                    .addComponent(txDv, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(jLabel3, javax.swing.GroupLayout.PREFERRED_SIZE, 25, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                        .addComponent(txNombre, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addComponent(jLabel4, javax.swing.GroupLayout.PREFERRED_SIZE, 25, javax.swing.GroupLayout.PREFERRED_SIZE)))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                    .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                        .addComponent(jLabel1)
                        .addComponent(cbTipo, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addComponent(jLabel2)
                        .addComponent(txNroDocto, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addComponent(btIr1)
                    .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                        .addComponent(jLabel9)
                        .addComponent(txEstado, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)))
                .addContainerGap(28, Short.MAX_VALUE))
        );

        jPanel1.setBorder(javax.swing.BorderFactory.createEtchedBorder());

        jLabel5.setText("Usuario");

        jLabel6.setText("Fecha Recepción");

        txUsuario.setEditable(false);

        txFecha.setEditable(false);

        btReversar.setFont(new java.awt.Font("Tahoma", 1, 11)); // NOI18N
        btReversar.setText("Reversar");
        btReversar.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btReversarActionPerformed(evt);
            }
        });

        jLabel7.setText("Orden de Compra");

        txOCP.setEditable(false);

        javax.swing.GroupLayout jPanel1Layout = new javax.swing.GroupLayout(jPanel1);
        jPanel1.setLayout(jPanel1Layout);
        jPanel1Layout.setHorizontalGroup(
            jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel1Layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(jLabel7)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(txOCP, javax.swing.GroupLayout.PREFERRED_SIZE, 80, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(36, 36, 36)
                .addComponent(jLabel5)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(txUsuario, javax.swing.GroupLayout.PREFERRED_SIZE, 91, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(18, 18, 18)
                .addComponent(jLabel6)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(txFecha, javax.swing.GroupLayout.PREFERRED_SIZE, 137, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(167, 167, 167)
                .addComponent(btReversar)
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );
        jPanel1Layout.setVerticalGroup(
            jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel1Layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel5)
                    .addComponent(jLabel6)
                    .addComponent(txUsuario, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(txFecha, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(btReversar)
                    .addComponent(jLabel7)
                    .addComponent(txOCP, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );

        Grilla.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {

            },
            new String [] {
                "Código", "Nombre", "Unidad", "Cantidad", "Valor", "Total"
            }
        ) {
            boolean[] canEdit = new boolean [] {
                false, false, false, false, false, false
            };

            public boolean isCellEditable(int rowIndex, int columnIndex) {
                return canEdit [columnIndex];
            }
        });
        jScrollPane1.setViewportView(Grilla);
        if (Grilla.getColumnModel().getColumnCount() > 0) {
            Grilla.getColumnModel().getColumn(0).setMinWidth(90);
            Grilla.getColumnModel().getColumn(0).setPreferredWidth(90);
            Grilla.getColumnModel().getColumn(0).setMaxWidth(90);
            Grilla.getColumnModel().getColumn(1).setMinWidth(320);
            Grilla.getColumnModel().getColumn(1).setPreferredWidth(320);
            Grilla.getColumnModel().getColumn(2).setMinWidth(85);
            Grilla.getColumnModel().getColumn(2).setPreferredWidth(85);
            Grilla.getColumnModel().getColumn(2).setMaxWidth(85);
            Grilla.getColumnModel().getColumn(3).setMinWidth(80);
            Grilla.getColumnModel().getColumn(3).setPreferredWidth(80);
            Grilla.getColumnModel().getColumn(3).setMaxWidth(80);
            Grilla.getColumnModel().getColumn(4).setMinWidth(80);
            Grilla.getColumnModel().getColumn(4).setPreferredWidth(80);
            Grilla.getColumnModel().getColumn(4).setMaxWidth(80);
            Grilla.getColumnModel().getColumn(5).setMinWidth(80);
            Grilla.getColumnModel().getColumn(5).setPreferredWidth(80);
            Grilla.getColumnModel().getColumn(5).setMaxWidth(80);
        }

        jPanel5.setBorder(javax.swing.BorderFactory.createEtchedBorder(javax.swing.border.EtchedBorder.RAISED));

        jLabel11.setText("Exento");

        txExento.setHorizontalAlignment(javax.swing.JTextField.RIGHT);
        txExento.setText("0");

        txNeto.setHorizontalAlignment(javax.swing.JTextField.RIGHT);
        txNeto.setText("0");

        jLabel10.setText("Neto");

        txIva.setHorizontalAlignment(javax.swing.JTextField.RIGHT);
        txIva.setText("0");

        jLabel12.setText("I.V.A.");

        txTotal.setHorizontalAlignment(javax.swing.JTextField.RIGHT);
        txTotal.setText("0");

        jLabel13.setText("TOTAL");

        jLabel8.setText("Imp. específico");

        txImpEspecifico.setEditable(false);
        txImpEspecifico.setHorizontalAlignment(javax.swing.JTextField.RIGHT);
        txImpEspecifico.setText("0");

        javax.swing.GroupLayout jPanel5Layout = new javax.swing.GroupLayout(jPanel5);
        jPanel5.setLayout(jPanel5Layout);
        jPanel5Layout.setHorizontalGroup(
            jPanel5Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel5Layout.createSequentialGroup()
                .addGap(21, 21, 21)
                .addGroup(jPanel5Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                    .addComponent(jLabel8)
                    .addComponent(jLabel11)
                    .addComponent(jLabel10)
                    .addComponent(jLabel12)
                    .addComponent(jLabel13))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(jPanel5Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                    .addComponent(txNeto)
                    .addComponent(txIva)
                    .addComponent(txExento, javax.swing.GroupLayout.DEFAULT_SIZE, 156, Short.MAX_VALUE)
                    .addComponent(txTotal)
                    .addComponent(txImpEspecifico))
                .addContainerGap(41, Short.MAX_VALUE))
        );
        jPanel5Layout.setVerticalGroup(
            jPanel5Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel5Layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(jPanel5Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel11)
                    .addComponent(txExento, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(jPanel5Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel10)
                    .addComponent(txNeto, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(jPanel5Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel12)
                    .addComponent(txIva, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(jPanel5Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel8)
                    .addComponent(txImpEspecifico, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(jPanel5Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel13)
                    .addComponent(txTotal, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addContainerGap())
        );

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(this);
        this.setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                    .addComponent(jPanel5, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING, false)
                        .addComponent(jPanel2, javax.swing.GroupLayout.Alignment.LEADING, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                        .addComponent(jPanel1, javax.swing.GroupLayout.Alignment.LEADING, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                        .addComponent(jScrollPane1, javax.swing.GroupLayout.Alignment.LEADING)))
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(jPanel2, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(jPanel1, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(jScrollPane1, javax.swing.GroupLayout.PREFERRED_SIZE, 221, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(jPanel5, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );
    }// </editor-fold>//GEN-END:initComponents

    private void txRutKeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_txRutKeyPressed
        if(evt.getKeyCode() == KeyEvent.VK_ENTER){
            btIr.doClick();
        }
    }//GEN-LAST:event_txRutKeyPressed
    private void CargaProveedor(String Rut){
        ExeSql Sql = new ExeSql();
        ResultSet Rs;
        
        try {
            Rs = Sql.Select("select rut,dv,nombre\n" +
                            "from proveedor\n" +
                            "where rut=" + Rut);
            if(Sql.GetRowCount()>0){
                Rs.next();
                txRut.setText(Rs.getString("Rut").trim());
                txDv.setText(Rs.getString("Dv").trim());
                txNombre.setText(Rs.getString("nombre").trim());
                cbTipo.requestFocus();
            }
        } catch (Exception e) {
            LogError.Guardar(this.getClass().getSimpleName(),e.getMessage() );
        } finally{
            Sql.Close();
        }
    }
    private void btIrActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btIrActionPerformed
        if (!txRut.getText().isEmpty()) {
            CargaProveedor(txRut.getText());
        } else {
            jdBuscarCliPrv BPC = new jdBuscarCliPrv(null, true);
            BPC.setLocationRelativeTo(null);
            BPC.setTitle("Buscar Proveedor");
            BPC.SetTipo(1);
            BPC.setVisible(true);
            CargaProveedor(BPC.GetRut());
        }
    }//GEN-LAST:event_btIrActionPerformed

    private void btIr1ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btIr1ActionPerformed
        
        ExeSql Sql = new ExeSql();
        ResultSet Rs;
        String Tipo;
        DefaultTableModel TableModel = (DefaultTableModel) Grilla.getModel();
        
        while(TableModel.getRowCount()>0)
              TableModel.removeRow(0);
        
        if(cbTipo.getSelectedIndex()== 0)
            Tipo="GDP";
        else
            Tipo="FAP";
        
        try {
            Rs = Sql.Select("select p.usuario,cast(p.fcreacion as date) as fcreacion, p.totalafecto,p.totalexento,p.totaliva,p.totaldocto,p.totalotroimp,r.ocp,p.autoriza\n" +
                            "from ctacteprv p\n" +
                            "left join recepcionprv r on p.nrodocto=r.nrodocto and p.tipdocto=r.tipdocto\n" +
                            "where p.rut= "+ txRut.getText().trim() +"\n" +
                            "and p.tipdocto='"+ Tipo +"'\n" +
                            "and p.nrodocto=" + txNroDocto.getText().trim());
            if(Sql.GetRowCount()>0){
                //Carga Encabezado
                Rs.next();
                txOCP.setText(Rs.getString("ocp").trim());
                txUsuario.setText(Rs.getString("usuario").trim());
                txFecha.setText(Rs.getString("fcreacion").trim());
                txNeto.setText(fmMain.FormatoTotal(Rs.getDouble("totalafecto")));
                txExento.setText(fmMain.FormatoTotal(Rs.getDouble("totalexento")));
                txIva.setText(fmMain.FormatoTotal(Rs.getDouble("totaliva")));
                txImpEspecifico.setText(fmMain.FormatoTotal(Rs.getDouble("totalotroimp")));
                txTotal.setText(fmMain.FormatoTotal(Rs.getDouble("totaldocto")));
                
                if(Rs.getInt("autoriza")==1)
                    txEstado.setText("Autorizada");
                else
                    txEstado.setText("Sin Autorizar");
                
                //Carga Detalle
                Rs = Sql.Select("select trim(d.sku) as sku ,p.nombre,u.unidad,d.cantidad,d.valorunitario,d.totallinea\n" +
                                "from ctacteprvdet d\n" +
                                "left join producto p on p.sku=d.sku\n" +
                                "left join par_unidad u on p.unidad = u.codigo\n" +
                                "where rut= "+ txRut.getText().trim() +"\n" +
                                "and tipdocto='"+ Tipo +"'\n" +
                                "and nrodocto=" + txNroDocto.getText().trim());
                
                while(Rs.next()){
                
                    TableModel.addRow(new Object[]{ Rs.getString("sku").trim(), 
                                                    Rs.getString("nombre").trim(), 
                                                    Rs.getString("unidad").trim(),
                                                    fmMain.FormatoNumero(Rs.getDouble("cantidad")),
                                                    fmMain.FormatoNumero(Rs.getDouble("valorunitario")),
                                                    fmMain.FormatoNumero(Rs.getDouble("totallinea"))});
                }
            }
        
        }catch (Exception e) {
        
            LogError.Guardar(this.getClass().getSimpleName(),e.getMessage() );
        } finally{
            Sql.Close();
        }
    }//GEN-LAST:event_btIr1ActionPerformed
    private void Limpia(){
        DefaultTableModel TModel = (DefaultTableModel) Grilla.getModel();
        while(TModel.getRowCount()>0)
              TModel.removeRow(0);
        txRut.setText("");
        txNombre.setText("");
        txDv.setText("");
        txNroDocto.setText("");
        txExento.setText("");
        txNeto.setText("");
        txIva.setText("");
        txImpEspecifico.setText("");
        txTotal.setText("");
        txUsuario.setText("");
        txOCP.setText("");
        txFecha.setText("");
        txRut.requestFocus();
    }
    private void btReversarActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btReversarActionPerformed
        
        if(txEstado.getText().trim().equals("Autorizada")){
            fmMain.Mensaje("Primero debe REVERSAR la AUTORIZACION");
            return;
        }
        
        if(fmMain.OkCancel("¿Esta seguro de reversar el ingreso?") == JOptionPane.OK_OPTION){
            ExeSql Sql = new ExeSql();
            ExeSql Sql2 = new ExeSql();
            String Tipo="",qryUpd="", Query="", v_producto="";
            ResultSet Rs, Rs2;
            boolean valido = true;   
            double v_cantidad =0, v_CantMetro =0, v_CantReversa =0;
     
            
            //----- Validar el Ingreso que esten las cantidades en Transito ----
            try {
            for( int i=0; i< Grilla.getRowCount() ; i++){
                Query = " select ubicacion,sku,cant from mt_productos where ubicacion = '" + fmMain.BodegaTransito() + "' "
                        + " and sku = '" +  Grilla.getValueAt(i, 0).toString().trim() + "'";
                
                   Rs2 = Sql2.Select(Query);
                            if (Rs2.next()){
                                v_CantMetro = Rs2.getDouble("cant");
                            }
                            
                       String valorvalor = Grilla.getValueAt(i, 3).toString().trim();
                       v_CantReversa= Double.valueOf( fmMain.SetGuardar(valorvalor));
                       
                       v_producto = Grilla.getValueAt(i, 1).toString().trim();
                       if(v_CantMetro<v_CantReversa){
                           valido = false;
                           break;
                       }
            }
            } catch (Exception e) {
                System.out.println(Sql.GetSql());
                LogError.Guardar(this.getClass().getName(),e.getMessage());
                fmMain.Mensaje("Ha ocurrido un error: " + e);
                return;
            } finally {
                Sql2.Close();
            }
            
            if (!valido){
                fmMain.Mensaje("La cantidad en Transito debe ser Mayor o igual a la Reversada de: \n"  + 
                        " Producto: " + v_producto + "\n" 
                 + "Cant Transito = " +  v_CantMetro + "        Cant a Reversar: " +  v_CantReversa  );
                return;
            }
            
            //------------------------------------------------------------------
            
            
            if(cbTipo.getSelectedIndex()== 0)
                Tipo="GDP";
            else
                Tipo="FAP";
            
            try {
                Sql.ExeSql("delete from recepcionprv where rut=" + txRut.getText() + " and tipdocto='" + Tipo + "' and nrodocto=" + txNroDocto.getText().trim());
                Sql.ExeSql("delete from ctacteprv where rut=" + txRut.getText() + " and tipdocto='" + Tipo + "' and nrodocto=" + txNroDocto.getText().trim());
                Sql.ExeSql("delete from separacion where recepcion=true and rut_proveedor=" + txRut.getText() + " and tipdcto='" + Tipo + "' and nrodcto=" + txNroDocto.getText().trim());
                for(int i=0; i< Grilla.getRowCount() ; i++){
                    Sql.ExeSql("insert into movimientos_stock \n" + 
                               "(sku,rut,tipdocto,nrodocto,cantidad,tipomovimiento)values" +
                               "('" + Grilla.getValueAt(i, 0).toString().trim() + "'," +
                               txRut.getText().trim() + ",'" +
                               Tipo + "'," + 
                               txNroDocto.getText().trim() + ",-" +
                               Grilla.getValueAt(i, 3).toString().trim().replace(",", "") + ",'REVERSO')"
                                );
                    
                    Sql.ExeSql("update inventario \n" + 
                               "set stock=stock - "  + Grilla.getValueAt(i, 3).toString().trim().replace(",", "") + ", ocp=ocp + " + Grilla.getValueAt(i, 3).toString().trim().replace(",", "") + "\n" + 
                               "where sku='" +
                               Grilla.getValueAt(i, 0).toString().trim() + "'" );  
                    
                    Sql.ExeSql("update ctacteprvdet set \n" +
                               "recibido=recibido - " + Grilla.getValueAt(i, 3).toString().trim().replace(",", "") + "\n" + 
                               "where rut=" + txRut.getText().trim() + "\n" +
                               "and tipdocto='OCP' \n" + 
                               "and nrodocto=" + txOCP.getText().trim() + "\n" + 
                               "and sku='" + Grilla.getValueAt(i, 0).toString().trim() + "'");

                    //----------- SE REBAJA LO INGRESADO EN BODEGA TRANSITO ---------------------------

                            qryUpd = " update mt_productos set cant = cant -" +  fmMain.SetGuardar(Grilla.getValueAt(i, 3).toString().trim()) + 
                                 " where ubicacion = '" + fmMain.BodegaTransito()  + "' and sku = '" +  Grilla.getValueAt(i, 0).toString().trim() + "' ";
                            Sql.ExeSql(qryUpd);
                    
                    //---------------------------------------------------------------------------------
                }
                Sql.Commit();
                fmMain.ErrorUsuarioLog(txUsuario.getText().trim(),"REVERSO_RCP");
                fmMain.Mensaje("Documento Reversado");
                Limpia();
            } catch (Exception e) {
                Sql.Rollback();
                System.out.println(Sql.GetSql());
                LogError.Guardar(this.getClass().getName(),e.getMessage());
                fmMain.Mensaje("Ha ocurrido un error: " + e);
            } finally {
                Sql.Close();
            }
        }
    }//GEN-LAST:event_btReversarActionPerformed

    private void txNroDoctoKeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_txNroDoctoKeyPressed
        if(evt.getKeyCode() == KeyEvent.VK_ENTER){
            btIr1.doClick();
        }
    }//GEN-LAST:event_txNroDoctoKeyPressed


    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JTable Grilla;
    private javax.swing.JButton btIr;
    private javax.swing.JButton btIr1;
    private javax.swing.JButton btReversar;
    private javax.swing.JComboBox cbTipo;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JLabel jLabel10;
    private javax.swing.JLabel jLabel11;
    private javax.swing.JLabel jLabel12;
    private javax.swing.JLabel jLabel13;
    private javax.swing.JLabel jLabel2;
    private javax.swing.JLabel jLabel3;
    private javax.swing.JLabel jLabel4;
    private javax.swing.JLabel jLabel5;
    private javax.swing.JLabel jLabel6;
    private javax.swing.JLabel jLabel7;
    private javax.swing.JLabel jLabel8;
    private javax.swing.JLabel jLabel9;
    private javax.swing.JPanel jPanel1;
    private javax.swing.JPanel jPanel2;
    private javax.swing.JPanel jPanel5;
    private javax.swing.JScrollPane jScrollPane1;
    private javax.swing.JTextField txDv;
    private javax.swing.JTextField txEstado;
    private javax.swing.JTextField txExento;
    private javax.swing.JTextField txFecha;
    private javax.swing.JTextField txImpEspecifico;
    private javax.swing.JTextField txIva;
    private javax.swing.JTextField txNeto;
    private javax.swing.JTextField txNombre;
    private javax.swing.JTextField txNroDocto;
    private javax.swing.JTextField txOCP;
    private javax.swing.JTextField txRut;
    private javax.swing.JTextField txTotal;
    private javax.swing.JTextField txUsuario;
    // End of variables declaration//GEN-END:variables
}
