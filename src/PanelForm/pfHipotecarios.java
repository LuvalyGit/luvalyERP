package PanelForm;

import Conexion.ExeSql;
import Formularios.fmMain;
import java.awt.Color;
import java.awt.Component;
import java.awt.Desktop;
import java.awt.HeadlessException;
import java.awt.event.KeyEvent;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.text.DecimalFormat;
import java.text.SimpleDateFormat;
import java.util.Calendar;
import java.util.Date;
import java.util.logging.Level;
import java.util.logging.Logger;
import javax.swing.JOptionPane;
import javax.swing.ListCellRenderer;
import javax.swing.RowFilter;
import javax.swing.table.DefaultTableModel;
import javax.swing.table.TableModel;
import javax.swing.table.TableRowSorter;

/**
 *
 * @author Roberto Lopez
 */
public class pfHipotecarios extends javax.swing.JPanel {
    
    Date hoy = new Date(); 
    int nuevo = 0;
    int indice = 0;
    double total = 0;
    
    String TipDocto = "";
   
        
    public static int intNivelUsuario = 0; 
    SimpleDateFormat dateFormat = new SimpleDateFormat("dd-MM-yyyy");
    DecimalFormat formateador = new DecimalFormat("###,###");
    DecimalFormat formateador2 = new DecimalFormat("###,###.####");
    Calendar cal = Calendar.getInstance();
         
    public pfHipotecarios() { 
        
        initComponents();
      
        SetEstados(1);
       
        btNuevo.setVisible(false);
        btAbrir.setVisible(false);
        txId.setVisible(false);
        txTipo.setVisible(false);
      
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        jPanel5 = new javax.swing.JPanel();
        jLabel8 = new javax.swing.JLabel();
        txNroCuota = new javax.swing.JTextField();
        jLabel2 = new javax.swing.JLabel();
        dtFecha = new org.jdesktop.swingx.JXDatePicker();
        jLabel5 = new javax.swing.JLabel();
        txRut = new javax.swing.JTextField();
        jLabel12 = new javax.swing.JLabel();
        txAmort = new javax.swing.JTextField();
        jLabel13 = new javax.swing.JLabel();
        txInteres = new javax.swing.JTextField();
        jLabel15 = new javax.swing.JLabel();
        txUf = new javax.swing.JTextField();
        jLabel16 = new javax.swing.JLabel();
        txCuotaUF = new javax.swing.JTextField();
        jLabel17 = new javax.swing.JLabel();
        txTotalUF = new javax.swing.JTextField();
        jLabel18 = new javax.swing.JLabel();
        txSeguroUF = new javax.swing.JTextField();
        jLabel19 = new javax.swing.JLabel();
        txTotalPesos = new javax.swing.JTextField();
        jLabel20 = new javax.swing.JLabel();
        txObs = new javax.swing.JTextField();
        txId = new javax.swing.JTextField();
        txTipo = new javax.swing.JTextField();
        pnMenu = new javax.swing.JPanel();
        btNuevo = new javax.swing.JButton();
        btGuardar = new javax.swing.JButton();
        btCancelar = new javax.swing.JButton();
        btAbrir = new javax.swing.JButton();
        jLabel1 = new javax.swing.JLabel();
        btEditar = new javax.swing.JButton();
        btAutorizar = new javax.swing.JButton();
        jPanel4 = new javax.swing.JPanel();
        jScrollPane3 = new javax.swing.JScrollPane();
        Grilla = new javax.swing.JTable();
        jLabel9 = new javax.swing.JLabel();
        cbCredito = new javax.swing.JComboBox();
        lbFiltro = new javax.swing.JLabel();
        txFiltro = new javax.swing.JTextField();

        setMaximumSize(new java.awt.Dimension(1475, 32767));
        setMinimumSize(new java.awt.Dimension(1475, 0));

        jPanel5.setBorder(javax.swing.BorderFactory.createTitledBorder(javax.swing.BorderFactory.createEtchedBorder(), "Documento", javax.swing.border.TitledBorder.DEFAULT_JUSTIFICATION, javax.swing.border.TitledBorder.DEFAULT_POSITION, new java.awt.Font("Tahoma", 1, 11))); // NOI18N
        jPanel5.setPreferredSize(new java.awt.Dimension(664, 123));

        jLabel8.setText("Número Cuota");

        txNroCuota.setEnabled(false);
        txNroCuota.setPreferredSize(new java.awt.Dimension(115, 20));

        jLabel2.setText("Fecha ");

        dtFecha.setEnabled(false);
        dtFecha.setPreferredSize(new java.awt.Dimension(115, 22));

        jLabel5.setText("RUT");

        txRut.setEnabled(false);
        txRut.setMaximumSize(new java.awt.Dimension(100, 2147483647));
        txRut.setMinimumSize(new java.awt.Dimension(100, 20));
        txRut.setName(""); // NOI18N
        txRut.setPreferredSize(new java.awt.Dimension(100, 20));
        txRut.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                txRutKeyPressed(evt);
            }
        });

        jLabel12.setHorizontalAlignment(javax.swing.SwingConstants.LEFT);
        jLabel12.setText("Amortización (U.F.) ");

        txAmort.setHorizontalAlignment(javax.swing.JTextField.RIGHT);
        txAmort.setEnabled(false);
        txAmort.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyReleased(java.awt.event.KeyEvent evt) {
                txAmortKeyReleased(evt);
            }
        });

        jLabel13.setHorizontalAlignment(javax.swing.SwingConstants.LEFT);
        jLabel13.setText("Intereses (U.F.) ");

        txInteres.setHorizontalAlignment(javax.swing.JTextField.RIGHT);
        txInteres.setEnabled(false);
        txInteres.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyReleased(java.awt.event.KeyEvent evt) {
                txInteresKeyReleased(evt);
            }
        });

        jLabel15.setHorizontalAlignment(javax.swing.SwingConstants.LEFT);
        jLabel15.setText("Valor UF");

        txUf.setHorizontalAlignment(javax.swing.JTextField.RIGHT);
        txUf.setEnabled(false);
        txUf.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                txUfActionPerformed(evt);
            }
        });
        txUf.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                txUfKeyPressed(evt);
            }
            public void keyReleased(java.awt.event.KeyEvent evt) {
                txUfKeyReleased(evt);
            }
        });

        jLabel16.setHorizontalAlignment(javax.swing.SwingConstants.LEFT);
        jLabel16.setText("Valor Cuota ( U.F.)");

        txCuotaUF.setHorizontalAlignment(javax.swing.JTextField.RIGHT);
        txCuotaUF.setEnabled(false);
        txCuotaUF.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                txCuotaUFActionPerformed(evt);
            }
        });
        txCuotaUF.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyReleased(java.awt.event.KeyEvent evt) {
                txCuotaUFKeyReleased(evt);
            }
        });

        jLabel17.setHorizontalAlignment(javax.swing.SwingConstants.LEFT);
        jLabel17.setText("Total Cuota ( U.F.)");

        txTotalUF.setHorizontalAlignment(javax.swing.JTextField.RIGHT);
        txTotalUF.setEnabled(false);
        txTotalUF.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                txTotalUFActionPerformed(evt);
            }
        });
        txTotalUF.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyReleased(java.awt.event.KeyEvent evt) {
                txTotalUFKeyReleased(evt);
            }
        });

        jLabel18.setHorizontalAlignment(javax.swing.SwingConstants.LEFT);
        jLabel18.setText("Valor Seguro ( U.F.)");

        txSeguroUF.setHorizontalAlignment(javax.swing.JTextField.RIGHT);
        txSeguroUF.setEnabled(false);
        txSeguroUF.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                txSeguroUFActionPerformed(evt);
            }
        });
        txSeguroUF.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyReleased(java.awt.event.KeyEvent evt) {
                txSeguroUFKeyReleased(evt);
            }
        });

        jLabel19.setHorizontalAlignment(javax.swing.SwingConstants.LEFT);
        jLabel19.setText("Total Cuota ( Pesos)");

        txTotalPesos.setHorizontalAlignment(javax.swing.JTextField.RIGHT);
        txTotalPesos.setEnabled(false);
        txTotalPesos.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                txTotalPesosActionPerformed(evt);
            }
        });
        txTotalPesos.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyReleased(java.awt.event.KeyEvent evt) {
                txTotalPesosKeyReleased(evt);
            }
        });

        jLabel20.setHorizontalAlignment(javax.swing.SwingConstants.LEFT);
        jLabel20.setText("Observaciones");

        txObs.setHorizontalAlignment(javax.swing.JTextField.LEFT);
        txObs.setEnabled(false);
        txObs.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                txObsActionPerformed(evt);
            }
        });
        txObs.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyReleased(java.awt.event.KeyEvent evt) {
                txObsKeyReleased(evt);
            }
        });

        txId.setHorizontalAlignment(javax.swing.JTextField.RIGHT);
        txId.setEnabled(false);
        txId.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                txIdActionPerformed(evt);
            }
        });
        txId.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyReleased(java.awt.event.KeyEvent evt) {
                txIdKeyReleased(evt);
            }
        });

        txTipo.setHorizontalAlignment(javax.swing.JTextField.RIGHT);
        txTipo.setEnabled(false);
        txTipo.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                txTipoActionPerformed(evt);
            }
        });
        txTipo.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyReleased(java.awt.event.KeyEvent evt) {
                txTipoKeyReleased(evt);
            }
        });

        javax.swing.GroupLayout jPanel5Layout = new javax.swing.GroupLayout(jPanel5);
        jPanel5.setLayout(jPanel5Layout);
        jPanel5Layout.setHorizontalGroup(
            jPanel5Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel5Layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(jPanel5Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(jPanel5Layout.createSequentialGroup()
                        .addComponent(jLabel8)
                        .addGap(18, 18, 18)
                        .addComponent(txNroCuota, javax.swing.GroupLayout.PREFERRED_SIZE, 45, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addGroup(jPanel5Layout.createSequentialGroup()
                        .addComponent(jLabel5)
                        .addGap(18, 18, 18)
                        .addComponent(txRut, javax.swing.GroupLayout.PREFERRED_SIZE, 100, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addGroup(jPanel5Layout.createSequentialGroup()
                        .addComponent(jLabel2, javax.swing.GroupLayout.PREFERRED_SIZE, 49, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addGap(18, 18, 18)
                        .addComponent(dtFecha, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addGroup(jPanel5Layout.createSequentialGroup()
                        .addComponent(jLabel20, javax.swing.GroupLayout.PREFERRED_SIZE, 83, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(txObs, javax.swing.GroupLayout.PREFERRED_SIZE, 364, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addGroup(jPanel5Layout.createSequentialGroup()
                        .addGroup(jPanel5Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, jPanel5Layout.createSequentialGroup()
                                .addComponent(jLabel15, javax.swing.GroupLayout.PREFERRED_SIZE, 104, javax.swing.GroupLayout.PREFERRED_SIZE)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                                .addComponent(txUf, javax.swing.GroupLayout.PREFERRED_SIZE, 93, javax.swing.GroupLayout.PREFERRED_SIZE))
                            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, jPanel5Layout.createSequentialGroup()
                                .addGroup(jPanel5Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                                    .addComponent(jLabel12, javax.swing.GroupLayout.PREFERRED_SIZE, 104, javax.swing.GroupLayout.PREFERRED_SIZE)
                                    .addComponent(jLabel13, javax.swing.GroupLayout.Alignment.TRAILING, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                                    .addComponent(jLabel16, javax.swing.GroupLayout.Alignment.TRAILING, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                                    .addComponent(jLabel18, javax.swing.GroupLayout.Alignment.TRAILING, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                                    .addComponent(jLabel17, javax.swing.GroupLayout.Alignment.TRAILING, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
                                .addGap(29, 29, 29)
                                .addGroup(jPanel5Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                                    .addComponent(txTotalUF, javax.swing.GroupLayout.PREFERRED_SIZE, 93, javax.swing.GroupLayout.PREFERRED_SIZE)
                                    .addGroup(jPanel5Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                                        .addComponent(txAmort, javax.swing.GroupLayout.PREFERRED_SIZE, 93, javax.swing.GroupLayout.PREFERRED_SIZE)
                                        .addComponent(txInteres, javax.swing.GroupLayout.Alignment.LEADING, javax.swing.GroupLayout.PREFERRED_SIZE, 93, javax.swing.GroupLayout.PREFERRED_SIZE)
                                        .addComponent(txCuotaUF, javax.swing.GroupLayout.PREFERRED_SIZE, 93, javax.swing.GroupLayout.PREFERRED_SIZE)
                                        .addComponent(txSeguroUF, javax.swing.GroupLayout.PREFERRED_SIZE, 93, javax.swing.GroupLayout.PREFERRED_SIZE))))
                            .addGroup(jPanel5Layout.createSequentialGroup()
                                .addComponent(jLabel19, javax.swing.GroupLayout.PREFERRED_SIZE, 104, javax.swing.GroupLayout.PREFERRED_SIZE)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                                .addComponent(txTotalPesos, javax.swing.GroupLayout.PREFERRED_SIZE, 93, javax.swing.GroupLayout.PREFERRED_SIZE)))
                        .addGap(18, 18, 18)
                        .addComponent(txId, javax.swing.GroupLayout.PREFERRED_SIZE, 42, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addGap(29, 29, 29)
                        .addComponent(txTipo, javax.swing.GroupLayout.PREFERRED_SIZE, 42, javax.swing.GroupLayout.PREFERRED_SIZE)))
                .addGap(64, 64, 64))
        );
        jPanel5Layout.setVerticalGroup(
            jPanel5Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel5Layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(jPanel5Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel5)
                    .addComponent(txRut, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addGap(14, 14, 14)
                .addGroup(jPanel5Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel8)
                    .addComponent(txNroCuota, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addGap(18, 18, 18)
                .addGroup(jPanel5Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel2)
                    .addComponent(dtFecha, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addGap(30, 30, 30)
                .addGroup(jPanel5Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel12)
                    .addComponent(txAmort, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addGroup(jPanel5Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel13)
                    .addComponent(txInteres, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addGroup(jPanel5Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel16)
                    .addComponent(txCuotaUF, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addGroup(jPanel5Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel18)
                    .addComponent(txSeguroUF, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addGroup(jPanel5Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel17)
                    .addComponent(txTotalUF, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addGroup(jPanel5Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel15)
                    .addComponent(txUf, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addGroup(jPanel5Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel19)
                    .addComponent(txTotalPesos, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(txId, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(txTipo, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addGap(39, 39, 39)
                .addGroup(jPanel5Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel20)
                    .addComponent(txObs, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addGap(45, 45, 45))
        );

        pnMenu.setBorder(javax.swing.BorderFactory.createEtchedBorder());
        pnMenu.setPreferredSize(new java.awt.Dimension(1455, 103));

        btNuevo.setFont(new java.awt.Font("Arial", 0, 11)); // NOI18N
        btNuevo.setIcon(new javax.swing.ImageIcon(getClass().getResource("/Iconos16/add16.png"))); // NOI18N
        btNuevo.setText("Nuevo");
        btNuevo.setBorder(javax.swing.BorderFactory.createBevelBorder(javax.swing.border.BevelBorder.RAISED));
        btNuevo.setBorderPainted(false);
        btNuevo.setFocusPainted(false);
        btNuevo.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btNuevoActionPerformed(evt);
            }
        });

        btGuardar.setFont(new java.awt.Font("Arial", 0, 11)); // NOI18N
        btGuardar.setIcon(new javax.swing.ImageIcon(getClass().getResource("/Iconos16/save16.png"))); // NOI18N
        btGuardar.setText("Guardar");
        btGuardar.setBorder(javax.swing.BorderFactory.createBevelBorder(javax.swing.border.BevelBorder.RAISED));
        btGuardar.setBorderPainted(false);
        btGuardar.setEnabled(false);
        btGuardar.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btGuardarActionPerformed(evt);
            }
        });

        btCancelar.setFont(new java.awt.Font("Arial", 0, 11)); // NOI18N
        btCancelar.setIcon(new javax.swing.ImageIcon(getClass().getResource("/Iconos16/Cancel16.png"))); // NOI18N
        btCancelar.setText("Cancelar");
        btCancelar.setBorder(javax.swing.BorderFactory.createBevelBorder(javax.swing.border.BevelBorder.RAISED));
        btCancelar.setBorderPainted(false);
        btCancelar.setEnabled(false);
        btCancelar.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btCancelarActionPerformed(evt);
            }
        });

        btAbrir.setFont(new java.awt.Font("Arial", 0, 11)); // NOI18N
        btAbrir.setIcon(new javax.swing.ImageIcon(getClass().getResource("/Iconos16/open16.png"))); // NOI18N
        btAbrir.setText("Abrir");
        btAbrir.setBorder(javax.swing.BorderFactory.createBevelBorder(javax.swing.border.BevelBorder.RAISED));
        btAbrir.setBorderPainted(false);
        btAbrir.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btAbrirActionPerformed(evt);
            }
        });

        jLabel1.setFont(new java.awt.Font("Arial", 1, 12)); // NOI18N
        jLabel1.setText("CREDITOS HIPOTECARIOS");

        btEditar.setFont(new java.awt.Font("Arial", 0, 11)); // NOI18N
        btEditar.setIcon(new javax.swing.ImageIcon(getClass().getResource("/Iconos16/Pencil16.png"))); // NOI18N
        btEditar.setText("Editar");
        btEditar.setBorder(javax.swing.BorderFactory.createBevelBorder(javax.swing.border.BevelBorder.RAISED));
        btEditar.setBorderPainted(false);
        btEditar.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btEditarActionPerformed(evt);
            }
        });

        btAutorizar.setFont(new java.awt.Font("Arial", 0, 11)); // NOI18N
        btAutorizar.setIcon(new javax.swing.ImageIcon(getClass().getResource("/Iconos16/ok_16.png"))); // NOI18N
        btAutorizar.setText("Autorizar");
        btAutorizar.setBorder(javax.swing.BorderFactory.createBevelBorder(javax.swing.border.BevelBorder.RAISED));
        btAutorizar.setBorderPainted(false);
        btAutorizar.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btAutorizarActionPerformed(evt);
            }
        });

        javax.swing.GroupLayout pnMenuLayout = new javax.swing.GroupLayout(pnMenu);
        pnMenu.setLayout(pnMenuLayout);
        pnMenuLayout.setHorizontalGroup(
            pnMenuLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(pnMenuLayout.createSequentialGroup()
                .addGroup(pnMenuLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(pnMenuLayout.createSequentialGroup()
                        .addGap(18, 18, 18)
                        .addComponent(jLabel1))
                    .addGroup(pnMenuLayout.createSequentialGroup()
                        .addGap(85, 85, 85)
                        .addComponent(btGuardar, javax.swing.GroupLayout.PREFERRED_SIZE, 100, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(btCancelar, javax.swing.GroupLayout.PREFERRED_SIZE, 100, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(btNuevo, javax.swing.GroupLayout.PREFERRED_SIZE, 100, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(btEditar, javax.swing.GroupLayout.PREFERRED_SIZE, 100, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(btAbrir, javax.swing.GroupLayout.PREFERRED_SIZE, 100, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addGap(84, 84, 84)
                        .addComponent(btAutorizar, javax.swing.GroupLayout.PREFERRED_SIZE, 115, javax.swing.GroupLayout.PREFERRED_SIZE)))
                .addContainerGap(307, Short.MAX_VALUE))
        );
        pnMenuLayout.setVerticalGroup(
            pnMenuLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(pnMenuLayout.createSequentialGroup()
                .addContainerGap()
                .addComponent(jLabel1)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addGroup(pnMenuLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                    .addGroup(pnMenuLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                        .addComponent(btNuevo, javax.swing.GroupLayout.PREFERRED_SIZE, 51, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addComponent(btEditar, javax.swing.GroupLayout.PREFERRED_SIZE, 51, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addComponent(btAbrir, javax.swing.GroupLayout.PREFERRED_SIZE, 51, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addComponent(btAutorizar, javax.swing.GroupLayout.PREFERRED_SIZE, 51, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addComponent(btGuardar, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                    .addComponent(btCancelar, javax.swing.GroupLayout.PREFERRED_SIZE, 51, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );

        jPanel4.setBorder(javax.swing.BorderFactory.createEtchedBorder());
        jPanel4.setMaximumSize(new java.awt.Dimension(780, 32767));
        jPanel4.setMinimumSize(new java.awt.Dimension(780, 0));
        jPanel4.setName(""); // NOI18N
        jPanel4.setPreferredSize(new java.awt.Dimension(780, 770));

        Grilla.setAutoCreateRowSorter(true);
        Grilla.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {

            },
            new String [] {
                "N° Cuota", "Fecha", "Cuota (U.F)", "Cuota (Pesos)", "Autorizado", "Id"
            }
        ) {
            Class[] types = new Class [] {
                java.lang.Object.class, java.lang.Object.class, java.lang.Object.class, java.lang.Object.class, java.lang.Boolean.class, java.lang.Object.class
            };
            boolean[] canEdit = new boolean [] {
                false, false, false, false, false, false
            };

            public Class getColumnClass(int columnIndex) {
                return types [columnIndex];
            }

            public boolean isCellEditable(int rowIndex, int columnIndex) {
                return canEdit [columnIndex];
            }
        });
        Grilla.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                GrillaMouseClicked(evt);
            }
        });
        jScrollPane3.setViewportView(Grilla);
        if (Grilla.getColumnModel().getColumnCount() > 0) {
            Grilla.getColumnModel().getColumn(0).setMinWidth(100);
            Grilla.getColumnModel().getColumn(0).setPreferredWidth(100);
            Grilla.getColumnModel().getColumn(0).setMaxWidth(100);
            Grilla.getColumnModel().getColumn(1).setMinWidth(100);
            Grilla.getColumnModel().getColumn(1).setPreferredWidth(100);
            Grilla.getColumnModel().getColumn(1).setMaxWidth(100);
            Grilla.getColumnModel().getColumn(2).setMinWidth(95);
            Grilla.getColumnModel().getColumn(2).setPreferredWidth(95);
            Grilla.getColumnModel().getColumn(2).setMaxWidth(95);
            Grilla.getColumnModel().getColumn(3).setMinWidth(105);
            Grilla.getColumnModel().getColumn(3).setPreferredWidth(105);
            Grilla.getColumnModel().getColumn(3).setMaxWidth(105);
            Grilla.getColumnModel().getColumn(5).setMinWidth(0);
            Grilla.getColumnModel().getColumn(5).setPreferredWidth(0);
            Grilla.getColumnModel().getColumn(5).setMaxWidth(0);
        }

        javax.swing.GroupLayout jPanel4Layout = new javax.swing.GroupLayout(jPanel4);
        jPanel4.setLayout(jPanel4Layout);
        jPanel4Layout.setHorizontalGroup(
            jPanel4Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel4Layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(jScrollPane3, javax.swing.GroupLayout.PREFERRED_SIZE, 487, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addContainerGap())
        );
        jPanel4Layout.setVerticalGroup(
            jPanel4Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel4Layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(jScrollPane3, javax.swing.GroupLayout.DEFAULT_SIZE, 434, Short.MAX_VALUE)
                .addContainerGap())
        );

        jLabel9.setHorizontalAlignment(javax.swing.SwingConstants.CENTER);
        jLabel9.setText("Credito");

        cbCredito.setModel(new javax.swing.DefaultComboBoxModel(new String[] { "Eliga una Opcion", "Hipotecario Miraflores", "Hipotecario Gral. Mackenna", "Covid Banco BCI", "Covid Banco Security", "Covid Banco Chile" }));
        cbCredito.setPreferredSize(new java.awt.Dimension(247, 20));
        cbCredito.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                cbCreditoActionPerformed(evt);
            }
        });

        lbFiltro.setText("FILTRO:");

        txFiltro.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                txFiltroActionPerformed(evt);
            }
        });
        txFiltro.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                txFiltroKeyPressed(evt);
            }
            public void keyReleased(java.awt.event.KeyEvent evt) {
                txFiltroKeyReleased(evt);
            }
            public void keyTyped(java.awt.event.KeyEvent evt) {
                txFiltroKeyTyped(evt);
            }
        });

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(this);
        this.setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(pnMenu, javax.swing.GroupLayout.PREFERRED_SIZE, 1119, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addGroup(layout.createSequentialGroup()
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(jPanel5, javax.swing.GroupLayout.PREFERRED_SIZE, 537, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addGroup(layout.createSequentialGroup()
                                .addGap(8, 8, 8)
                                .addComponent(jLabel9, javax.swing.GroupLayout.PREFERRED_SIZE, 62, javax.swing.GroupLayout.PREFERRED_SIZE)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                .addComponent(cbCredito, javax.swing.GroupLayout.PREFERRED_SIZE, 247, javax.swing.GroupLayout.PREFERRED_SIZE)))
                        .addGap(68, 68, 68)
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(jPanel4, javax.swing.GroupLayout.PREFERRED_SIZE, 511, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addGroup(layout.createSequentialGroup()
                                .addComponent(lbFiltro)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                                .addComponent(txFiltro, javax.swing.GroupLayout.PREFERRED_SIZE, 271, javax.swing.GroupLayout.PREFERRED_SIZE)))))
                .addGap(10, 10, 10))
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(pnMenu, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(18, 18, 18)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel9)
                    .addComponent(cbCredito, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(txFiltro, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(lbFiltro))
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(layout.createSequentialGroup()
                        .addGap(18, 18, 18)
                        .addComponent(jPanel5, javax.swing.GroupLayout.PREFERRED_SIZE, 467, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, layout.createSequentialGroup()
                        .addGap(25, 25, 25)
                        .addComponent(jPanel4, javax.swing.GroupLayout.PREFERRED_SIZE, 460, javax.swing.GroupLayout.PREFERRED_SIZE)))
                .addGap(17, 17, 17))
        );
    }// </editor-fold>//GEN-END:initComponents
    
    private void SetEstados(int Estado){
        //Cancelar
        if(Estado==1){
          
            Habilita(false);
            btCancelar.setEnabled(false);
            btGuardar.setEnabled(false);
            btAbrir.setEnabled(true);
            btNuevo.setEnabled(true);
            btEditar.setEnabled(false);
            btAutorizar.setEnabled(false);
           
        }
        //Nuevo
        if(Estado==2){
                       
            Limpia();
            Habilita(true);
           
            btCancelar.setEnabled(true);
            btGuardar.setEnabled(true);
            btAbrir.setEnabled(false);
            btNuevo.setEnabled(false);
                  
            
        }
        
        if(Estado==3){      //Guardar - Cancelar
           
            Habilita(false);
            btCancelar.setEnabled(false);
            btGuardar.setEnabled(false);
            btAbrir.setEnabled(true);
            btNuevo.setEnabled(true);
            btEditar.setEnabled(false);
            btAutorizar.setEnabled(false);
           
        }
        
        if(Estado==4){
                     
            btNuevo.setEnabled(true);
            btGuardar.setEnabled(false);
            btCancelar.setEnabled(false);
            btAbrir.setEnabled(true);
        }
        
        if(Estado==5){
           
            Habilita(true);
            btNuevo.setEnabled(false);
            btGuardar.setEnabled(true);
            btCancelar.setEnabled(true);
            btEditar.setEnabled(false);
            btAbrir.setEnabled(false);
            btAutorizar.setEnabled(false);
            
        }
        
    }
    private void Habilita(boolean Estado){
       
        dtFecha.setEnabled(Estado);
       
        txSeguroUF.setEnabled(Estado);
        txTotalUF.setEnabled(Estado);
        txUf.setEnabled(Estado);
        txTotalPesos.setEnabled(Estado);
        
        txObs.setEnabled(Estado);
        
       
    }
    
    private void Limpia(){
        
        txRut.setText("");
        
        txNroCuota.setText("");
        dtFecha.setDate(null);
      
        txTotalPesos.setText("");
       
    }
    
    
    
    private void btCancelarActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btCancelarActionPerformed
        SetEstados(1);
        nuevo = 0;
    }//GEN-LAST:event_btCancelarActionPerformed

    private void btNuevoActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btNuevoActionPerformed
        SetEstados(2);
        nuevo = 1;
    }//GEN-LAST:event_btNuevoActionPerformed
    
    public String getFechaEAsString() {
        SimpleDateFormat sdf = new SimpleDateFormat("yyyy-MM-dd");
        return( sdf.format( (dtFecha.getDate()).getTime() ) );
    }
   
    
    private void btGuardarActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btGuardarActionPerformed
    
      //  String Rut;
        
        if (txRut.getText().toString().isEmpty()){
                
            JOptionPane.showMessageDialog(null, "Ingrese el Cliente");
            return;
        }
        
      
        if (txNroCuota.getText().toString().isEmpty()){
                
            JOptionPane.showMessageDialog(null, "Ingrese Número de la Cuota");
            return;
        }
        
        if (dtFecha.getDate() == null){
                
            JOptionPane.showMessageDialog(null, "Ingrese Fecha de la Cuota");
            return;
        }
   
        
        if (txTotalPesos.getText().toString().isEmpty()){
                
            JOptionPane.showMessageDialog(null, "Ingrese el Total de la Cuota");
            return;
        }
       
        
       String sTotal = txTotalPesos.getText().replaceAll("\\.","");
       double Total = Double.valueOf(sTotal);
      
        
        ExeSql Sql = new ExeSql();
        ExeSql Sql2 = new ExeSql();
        
       
        //TipDocto="BGA";
               
        try {
            
                if(nuevo == 1){    //Nuevo Registro
                    
                    Sql.ExeSql("INSERT INTO boletas_garantia \n" +
                               "(rut,nrodocto,femision,fvenc,monto,banco) \n" +
                               "VALUES (" +
                                    txRut.getText().trim() + "," +
                                    txNroCuota.getText() + ",'" +
                                    getFechaEAsString()+ "','" +
                                    fmMain.SetGuardar(txTotalPesos.getText()) + "," +
                                    cbCredito.getSelectedIndex() + ")"
                    );
                    
                    Sql.Commit();
                    
                    fmMain.Mensaje("Nuevo Documento Ingresado");
               
                }else if(nuevo == 0){    //Registro existente
                 
                    Sql.ExeSql("UPDATE creditos set \n" +
                               "fecha='"+ getFechaEAsString() +"',\n" +
                               "vsegurouf="+ txSeguroUF.getText().trim() +",\n" +
                               "tcuotauf="+ txTotalUF.getText().trim() +",\n" +
                               "uf="+ txUf.getText().trim() +",\n" +
                               "obs='"+ txObs.getText().trim() +"',\n" +
                               "tcuotap="+ Total +" \n" +
                               "where id ="+ txId.getText().trim() +"\n" +
                               "and ncuota=" + txNroCuota.getText());
                    
                    
                    Sql.Commit();
                    
                    
                    fmMain.Mensaje("Cambios guardados");
                }
            
                btCancelar.setEnabled(false);
                btGuardar.setEnabled(false);
                btAbrir.setEnabled(true);
                btNuevo.setEnabled(true);
                btEditar.setEnabled(false);
                btAutorizar.setEnabled(true);
                    
                CargaCuotas();
        
                nuevo = 0;
                    
        }catch (SQLException e) {
         
            fmMain.Mensaje(e.getMessage());
            System.out.println(e.getMessage());
            Logger.getLogger(pfHipotecarios.class.getName()).log(Level.SEVERE, null, e);
        
        }finally{
            
            Sql.Close();
            SetEstados(3);
        }
    }//GEN-LAST:event_btGuardarActionPerformed
   
    private void btAbrirActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btAbrirActionPerformed
        
        Limpia();
        
        txRut.setEnabled(true);
        txRut.setEditable(true);
        txRut.requestFocus();
        btAbrir.setEnabled(false);
        btNuevo.setEnabled(false);
        btCancelar.setEnabled(true);
        nuevo = 0;
        
    }//GEN-LAST:event_btAbrirActionPerformed

    private void btEditarActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btEditarActionPerformed
        
        SetEstados(5);
        nuevo = 0;
    }//GEN-LAST:event_btEditarActionPerformed

    private void btAutorizarActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btAutorizarActionPerformed

        if(fmMain.OkCancel("¿Autorizar Cuota?")== JOptionPane.OK_OPTION){
            
            ExeSql Sql = new ExeSql();
            ExeSql Sql2 = new ExeSql();
               
            String sTotal = txTotalPesos.getText().replaceAll("\\.","");
            double Total = Double.valueOf(sTotal);
                
            try{
                    
                Sql.ExeSql("UPDATE creditos SET \n"
                         + "autoriza = 1 \n"
                         + "WHERE id=" + txId.getText().trim() + "\n"
                         + "AND ncuota=" + txNroCuota.getText().trim());
                       
                Sql.Commit();
                        
                Sql2.ExeSql("INSERT INTO prv_cuentasxpagar\n"
                          + "(rut,tipdocto,nrodocto,fpago,monto,tipo,nrocuota,tipopago) \n"
                          + "VALUES ("
                          + txRut.getText().toString().trim() + ","
                          + "'"+txTipo.getText().trim()+"',"
                          + txNroCuota.getText().trim() + ",'"
                          + dateFormat.format(hoy) + "',"
                          + Total + ","
                          + 0 + ","
                          + 1 + ","
                          + 2 + ")");
                        
                Sql2.Commit();
                        
                JOptionPane.showMessageDialog(null,"Cuota Crédito Autorizada");
                    
                btAutorizar.setEnabled(false);
                btEditar.setEnabled(false);
                    
            }catch (SQLException | HeadlessException e) {
            
                fmMain.Mensaje(e.getMessage());
                Sql.Rollback();
                Sql2.Rollback();
                    
            }finally{
            
                Sql.Close();
                CargaCuotas();
            }
                
        }
    }//GEN-LAST:event_btAutorizarActionPerformed
    
    private void txFiltroActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_txFiltroActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_txFiltroActionPerformed

    private void txFiltroKeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_txFiltroKeyPressed

    }//GEN-LAST:event_txFiltroKeyPressed

    private void txFiltroKeyReleased(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_txFiltroKeyReleased
       
        TableRowSorter<TableModel>sorter = new TableRowSorter<>(Grilla.getModel());
        Grilla.setRowSorter(sorter);
        String filtro = txFiltro.getText().trim();
       
        if (filtro.length()==0){
            
            sorter.setRowFilter(null);
        }else{

            sorter.setRowFilter(RowFilter.regexFilter(filtro));
        }
        
        
    }//GEN-LAST:event_txFiltroKeyReleased

    private void txFiltroKeyTyped(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_txFiltroKeyTyped
       
        if (Character.isLowerCase(evt.getKeyChar())){
         
            evt.setKeyChar(Character.toUpperCase(evt.getKeyChar()));
        }    
    }//GEN-LAST:event_txFiltroKeyTyped

    private void cbCreditoActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cbCreditoActionPerformed
       
        if (nuevo == 0){
        
            indice = cbCredito.getSelectedIndex();
               
            CargaCuotas();
        
        }
        
    }//GEN-LAST:event_cbCreditoActionPerformed

    private void GrillaMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_GrillaMouseClicked
        
        ExeSql Sql = new ExeSql();
        ResultSet Rs;
        int autorizado = 0;
        
        if(evt.getClickCount()==2){
        
            try {
            
                    Rs = Sql.Select("SELECT * from creditos \n"+
                                    "WHERE id ="+Grilla.getValueAt(Grilla.getSelectedRow(),5) + "\n"+
                                    "AND ncuota = "+ Grilla.getValueAt(Grilla.getSelectedRow(),0) + "\n"+
                                    "ORDER by ncuota ASC");
            
                    if (Sql.GetRowCount() > 0){
            
                        Rs.next();
                
                        autorizado = Rs.getInt("autoriza");    
                
                        if (autorizado == 0){
                
                            btAutorizar.setEnabled(true);
                
                        }else if (autorizado == 1) {
                
                            btAutorizar.setEnabled(false);
                
                        }
                      
                        txRut.setText(Rs.getString("rut"));
                        txNroCuota.setText(Grilla.getValueAt(Grilla.getSelectedRow(),0).toString());
                        dtFecha.setDate(Rs.getDate("fecha"));
                            
                        txAmort.setText(""+formateador2.format(Rs.getDouble("amortizacion")));
                        txInteres.setText(""+formateador2.format(Rs.getDouble("intereses")));
                        txCuotaUF.setText(""+Rs.getDouble("vcuotauf"));
                        txSeguroUF.setText(""+Rs.getDouble("vsegurouf"));
                                                      
                        txUf.setText(""+Rs.getDouble("uf"));
                            
                        txTotalUF.setText(Grilla.getValueAt(Grilla.getSelectedRow(),2).toString().trim());
                        txTotalPesos.setText(""+formateador.format(Rs.getDouble("tcuotap")));
                            
                        txObs.setText(Rs.getString("obs"));
                            
                        txId.setText(""+Rs.getInt("id"));
                        txTipo.setText(Rs.getString("tipdocto"));
                                                       
                        btEditar.setEnabled(true);
                        nuevo = 0;
                    }
            
            }catch (Exception e) {
    
                fmMain.Mensaje(e.getMessage());
            
            }finally{
                
                Sql.Close();
            }
            
            
        }
        
        
    }//GEN-LAST:event_GrillaMouseClicked

    private void txRutKeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_txRutKeyPressed
        
    }//GEN-LAST:event_txRutKeyPressed

    private void txAmortKeyReleased(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_txAmortKeyReleased
        // TODO add your handling code here:
    }//GEN-LAST:event_txAmortKeyReleased

    private void txInteresKeyReleased(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_txInteresKeyReleased
        // TODO add your handling code here:
    }//GEN-LAST:event_txInteresKeyReleased

    private void txUfActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_txUfActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_txUfActionPerformed

    private void txUfKeyReleased(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_txUfKeyReleased
        // TODO add your handling code here:
    }//GEN-LAST:event_txUfKeyReleased

    private void txCuotaUFActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_txCuotaUFActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_txCuotaUFActionPerformed

    private void txCuotaUFKeyReleased(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_txCuotaUFKeyReleased
        // TODO add your handling code here:
    }//GEN-LAST:event_txCuotaUFKeyReleased

    private void txTotalUFActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_txTotalUFActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_txTotalUFActionPerformed

    private void txTotalUFKeyReleased(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_txTotalUFKeyReleased
        // TODO add your handling code here:
    }//GEN-LAST:event_txTotalUFKeyReleased

    private void txSeguroUFActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_txSeguroUFActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_txSeguroUFActionPerformed

    private void txSeguroUFKeyReleased(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_txSeguroUFKeyReleased
        // TODO add your handling code here:
    }//GEN-LAST:event_txSeguroUFKeyReleased

    private void txTotalPesosActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_txTotalPesosActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_txTotalPesosActionPerformed

    private void txTotalPesosKeyReleased(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_txTotalPesosKeyReleased
        // TODO add your handling code here:
    }//GEN-LAST:event_txTotalPesosKeyReleased

    private void txObsActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_txObsActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_txObsActionPerformed

    private void txObsKeyReleased(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_txObsKeyReleased
        // TODO add your handling code here:
    }//GEN-LAST:event_txObsKeyReleased

    private void txIdActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_txIdActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_txIdActionPerformed

    private void txIdKeyReleased(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_txIdKeyReleased
        // TODO add your handling code here:
    }//GEN-LAST:event_txIdKeyReleased

    private void txTipoActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_txTipoActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_txTipoActionPerformed

    private void txTipoKeyReleased(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_txTipoKeyReleased
        // TODO add your handling code here:
    }//GEN-LAST:event_txTipoKeyReleased

    private void txUfKeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_txUfKeyPressed
        
        double uf = 0;
        double cuotauf = 0;
        double tcuota = 0;
        
        if(evt.getKeyCode()==KeyEvent.VK_ENTER){
         
            cuotauf = Double.parseDouble(txTotalUF.getText().toString().trim());
            uf = Double.parseDouble(txUf.getText().toString().trim());
            
            tcuota = Math.round(uf*cuotauf);
            txTotalPesos.setText(""+Math.round(tcuota));
            
        }
        
        
    }//GEN-LAST:event_txUfKeyPressed
     
    
    private void CargaCuotas(){
        
        ExeSql Sql = new ExeSql();
        ResultSet Rs;

        int autorizado = 0;
        boolean estado = false;
        
        DefaultTableModel TableModel = (DefaultTableModel) Grilla.getModel();

        
        if (indice != 0){
        
        
            while(TableModel.getRowCount()>0)
                    TableModel.removeRow(0);        
        
        
            try {
            
                Rs = Sql.Select("select * from creditos WHERE id = "+indice+" order by ncuota ASC");
            
                if (Sql.GetRowCount() > 0){
            
                    while(Rs.next()){
                
                        autorizado = Rs.getInt("autoriza");
                
                        if (autorizado == 0){
                
                            estado = false;
                
                        }else if (autorizado == 1) {
                
                            estado = true;
                
                        }
                
                        TableModel.addRow(new Object[]{
                                                Rs.getString("ncuota").trim(),
                                                Rs.getDate("fecha"), 
                                                Rs.getDouble("tcuotauf"),
                                                formateador.format(Rs.getDouble("tcuotap")),
                                                estado,
                                                Rs.getString("id")
                        });
                
                               
                    }
                
                }
            
            }catch (Exception e) {
                
                fmMain.Mensaje(e.getMessage());
            }finally{
            
                Sql.Close();
            }
        
        
        } 
    }
    
    
    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JTable Grilla;
    private javax.swing.JButton btAbrir;
    private javax.swing.JButton btAutorizar;
    private javax.swing.JButton btCancelar;
    private javax.swing.JButton btEditar;
    private javax.swing.JButton btGuardar;
    private javax.swing.JButton btNuevo;
    private javax.swing.JComboBox cbCredito;
    private org.jdesktop.swingx.JXDatePicker dtFecha;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JLabel jLabel12;
    private javax.swing.JLabel jLabel13;
    private javax.swing.JLabel jLabel15;
    private javax.swing.JLabel jLabel16;
    private javax.swing.JLabel jLabel17;
    private javax.swing.JLabel jLabel18;
    private javax.swing.JLabel jLabel19;
    private javax.swing.JLabel jLabel2;
    private javax.swing.JLabel jLabel20;
    private javax.swing.JLabel jLabel5;
    private javax.swing.JLabel jLabel8;
    private javax.swing.JLabel jLabel9;
    private javax.swing.JPanel jPanel4;
    private javax.swing.JPanel jPanel5;
    private javax.swing.JScrollPane jScrollPane3;
    private javax.swing.JLabel lbFiltro;
    private javax.swing.JPanel pnMenu;
    private javax.swing.JTextField txAmort;
    private javax.swing.JTextField txCuotaUF;
    private javax.swing.JTextField txFiltro;
    private javax.swing.JTextField txId;
    private javax.swing.JTextField txInteres;
    private javax.swing.JTextField txNroCuota;
    private javax.swing.JTextField txObs;
    private javax.swing.JTextField txRut;
    private javax.swing.JTextField txSeguroUF;
    private javax.swing.JTextField txTipo;
    private javax.swing.JTextField txTotalPesos;
    private javax.swing.JTextField txTotalUF;
    private javax.swing.JTextField txUf;
    // End of variables declaration//GEN-END:variables
}
