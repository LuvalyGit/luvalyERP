/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package PanelForm;

import Conexion.ExeSql;
import Dialogos.*;
import Dialogos.jdBuscarCliPrv;
import Formularios.fmMain;
import java.awt.HeadlessException;
import java.awt.event.KeyEvent;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.text.SimpleDateFormat;
import javax.swing.JOptionPane;

/**
 *
 * @author David Alcaman
 */
public class pfActivos extends javax.swing.JPanel {
    int EstadoGeneral;
    boolean Cargando;
    boolean Nuevo;
    String OpenRut;
    String OpenNroDocto;
    String OpenTipDocto;
    boolean PosElectronica;
    int Autorizado;
    
    int PosCCosto;
    int PosTrabajador;
    int PosCategoria;
    int PosSubCategoria;
    int PosTipDocto;
    int PosPago;
    int PosPagoTrabajador;
         
    /**
     * Creates new form pfGastos
     */
    public pfActivos() {
        initComponents();
        Cargando=true;
        CargaTipoPago();
        CargaPersonal();
        //--
        
        cbCCostoId.setVisible(false);
        cbTrabajadorId.setVisible(false);
        cbCategoriaId.setVisible(false);
        cbSubCategoriaId.setVisible(false);
        
        
        //Limpia Combobox
        cbCCosto.removeAllItems();
        cbCCostoId.removeAllItems();
        cbTrabajador.removeAllItems();
        cbTrabajadorId.removeAllItems();
        cbCategoria.removeAllItems();
        cbCategoriaId.removeAllItems();
        cbSubCategoria.removeAllItems();
        cbSubCategoriaId.removeAllItems();
        SetEstados(1);
        cbTipoPagoId.setVisible(false);
        cbPersonal.setVisible(false);
        cbPersonalId.setVisible(false);
        Cargando=false;
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        jPanel2 = new javax.swing.JPanel();
        cbCategoria = new javax.swing.JComboBox<>();
        jLabel3 = new javax.swing.JLabel();
        jLabel4 = new javax.swing.JLabel();
        cbSubCategoria = new javax.swing.JComboBox<>();
        jLabel12 = new javax.swing.JLabel();
        cbCCosto = new javax.swing.JComboBox<>();
        cbTrabajador = new javax.swing.JComboBox<>();
        jLabel13 = new javax.swing.JLabel();
        jPanel3 = new javax.swing.JPanel();
        jLabel5 = new javax.swing.JLabel();
        jLabel6 = new javax.swing.JLabel();
        txRut = new javax.swing.JTextField();
        btIr = new javax.swing.JButton();
        txNombre = new javax.swing.JTextField();
        jPanel5 = new javax.swing.JPanel();
        cbTipDocto = new javax.swing.JComboBox<>();
        jLabel7 = new javax.swing.JLabel();
        jLabel8 = new javax.swing.JLabel();
        txNroDocto = new javax.swing.JTextField();
        jLabel2 = new javax.swing.JLabel();
        dtEmision = new org.jdesktop.swingx.JXDatePicker();
        lbNeto = new javax.swing.JLabel();
        lbIva = new javax.swing.JLabel();
        jLabel11 = new javax.swing.JLabel();
        txNeto = new javax.swing.JTextField();
        txIva = new javax.swing.JTextField();
        txTotal = new javax.swing.JTextField();
        chkElectronica = new javax.swing.JCheckBox();
        pnMenu = new javax.swing.JPanel();
        btNuevo = new javax.swing.JButton();
        btGuardar = new javax.swing.JButton();
        btCancelar = new javax.swing.JButton();
        btAbrir = new javax.swing.JButton();
        jLabel1 = new javax.swing.JLabel();
        btEditar = new javax.swing.JButton();
        btAutorizar = new javax.swing.JButton();
        cbCCostoId = new javax.swing.JComboBox<>();
        cbTrabajadorId = new javax.swing.JComboBox<>();
        cbCategoriaId = new javax.swing.JComboBox<>();
        cbSubCategoriaId = new javax.swing.JComboBox<>();
        jPanel1 = new javax.swing.JPanel();
        txCuotas = new javax.swing.JTextField();
        jLabel17 = new javax.swing.JLabel();
        jLabel18 = new javax.swing.JLabel();
        txDias = new javax.swing.JTextField();
        cbTipoPagoId = new javax.swing.JComboBox();
        cbTipoPago = new javax.swing.JComboBox();
        jLabel15 = new javax.swing.JLabel();
        cbPersonal = new javax.swing.JComboBox<>();
        chkPersonal = new javax.swing.JCheckBox();
        cbPersonalId = new javax.swing.JComboBox<>();

        jPanel2.setBorder(javax.swing.BorderFactory.createTitledBorder(javax.swing.BorderFactory.createEtchedBorder(), "Categoria", javax.swing.border.TitledBorder.DEFAULT_JUSTIFICATION, javax.swing.border.TitledBorder.DEFAULT_POSITION, new java.awt.Font("Tahoma", 1, 11))); // NOI18N

        cbCategoria.setModel(new javax.swing.DefaultComboBoxModel<>(new String[] { "Item 1", "Item 2", "Item 3", "Item 4" }));
        cbCategoria.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                cbCategoriaActionPerformed(evt);
            }
        });

        jLabel3.setText("Categoria");

        jLabel4.setText("Sub Categoria");

        cbSubCategoria.setModel(new javax.swing.DefaultComboBoxModel<>(new String[] { "Item 1", "Item 2", "Item 3", "Item 4" }));
        cbSubCategoria.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                cbSubCategoriaActionPerformed(evt);
            }
        });

        jLabel12.setText("Centro de Costos");

        cbCCosto.setModel(new javax.swing.DefaultComboBoxModel<>(new String[] { "Item 1", "Item 2", "Item 3", "Item 4" }));
        cbCCosto.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                cbCCostoActionPerformed(evt);
            }
        });

        cbTrabajador.setModel(new javax.swing.DefaultComboBoxModel<>(new String[] { "Item 1", "Item 2", "Item 3", "Item 4" }));
        cbTrabajador.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                cbTrabajadorActionPerformed(evt);
            }
        });

        jLabel13.setText("Trabajador");

        javax.swing.GroupLayout jPanel2Layout = new javax.swing.GroupLayout(jPanel2);
        jPanel2.setLayout(jPanel2Layout);
        jPanel2Layout.setHorizontalGroup(
            jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, jPanel2Layout.createSequentialGroup()
                .addGap(40, 40, 40)
                .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                    .addComponent(jLabel12)
                    .addComponent(jLabel13))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                    .addComponent(cbCCosto, 0, 213, Short.MAX_VALUE)
                    .addComponent(cbTrabajador, 0, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(jLabel3, javax.swing.GroupLayout.Alignment.TRAILING)
                    .addComponent(jLabel4, javax.swing.GroupLayout.Alignment.TRAILING))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                    .addComponent(cbSubCategoria, 0, 232, Short.MAX_VALUE)
                    .addComponent(cbCategoria, 0, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
                .addContainerGap())
        );
        jPanel2Layout.setVerticalGroup(
            jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, jPanel2Layout.createSequentialGroup()
                .addGap(12, 12, 12)
                .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.CENTER)
                    .addComponent(cbCategoria, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(jLabel3)
                    .addComponent(jLabel12)
                    .addComponent(cbCCosto, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addGap(18, 18, 18)
                .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.CENTER)
                    .addComponent(cbTrabajador, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(jLabel13)
                    .addComponent(jLabel4)
                    .addComponent(cbSubCategoria, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addContainerGap(22, Short.MAX_VALUE))
        );

        jPanel3.setBorder(javax.swing.BorderFactory.createTitledBorder(javax.swing.BorderFactory.createEtchedBorder(), "Proveedor", javax.swing.border.TitledBorder.DEFAULT_JUSTIFICATION, javax.swing.border.TitledBorder.DEFAULT_POSITION, new java.awt.Font("Tahoma", 1, 11))); // NOI18N

        jLabel5.setText("Rut");

        jLabel6.setText("Nombre");

        txRut.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                txRutKeyPressed(evt);
            }
        });

        btIr.setIcon(new javax.swing.ImageIcon(getClass().getResource("/Iconos22/Go.png"))); // NOI18N
        btIr.setToolTipText("");
        btIr.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btIrActionPerformed(evt);
            }
        });

        txNombre.setEditable(false);

        javax.swing.GroupLayout jPanel3Layout = new javax.swing.GroupLayout(jPanel3);
        jPanel3.setLayout(jPanel3Layout);
        jPanel3Layout.setHorizontalGroup(
            jPanel3Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel3Layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(jLabel5)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(txRut, javax.swing.GroupLayout.PREFERRED_SIZE, 100, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(btIr, javax.swing.GroupLayout.PREFERRED_SIZE, 29, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(18, 18, 18)
                .addComponent(jLabel6)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(txNombre)
                .addContainerGap())
        );
        jPanel3Layout.setVerticalGroup(
            jPanel3Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel3Layout.createSequentialGroup()
                .addGap(16, 16, 16)
                .addGroup(jPanel3Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(jPanel3Layout.createSequentialGroup()
                        .addGap(2, 2, 2)
                        .addGroup(jPanel3Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                            .addComponent(jLabel6)
                            .addComponent(txNombre, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)))
                    .addGroup(jPanel3Layout.createSequentialGroup()
                        .addGroup(jPanel3Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                            .addComponent(jLabel5)
                            .addComponent(txRut, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(btIr, javax.swing.GroupLayout.PREFERRED_SIZE, 0, Short.MAX_VALUE))
                        .addGap(2, 2, 2)))
                .addGap(38, 38, 38))
        );

        jPanel5.setBorder(javax.swing.BorderFactory.createTitledBorder(javax.swing.BorderFactory.createEtchedBorder(), "Documento", javax.swing.border.TitledBorder.DEFAULT_JUSTIFICATION, javax.swing.border.TitledBorder.DEFAULT_POSITION, new java.awt.Font("Tahoma", 1, 11))); // NOI18N

        cbTipDocto.setModel(new javax.swing.DefaultComboBoxModel<>(new String[] { "Boleta", "Factura" }));
        cbTipDocto.setSelectedIndex(1);
        cbTipDocto.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                cbTipDoctoActionPerformed(evt);
            }
        });

        jLabel7.setText("Documento");

        jLabel8.setText("Número");

        jLabel2.setText("Fecha");

        lbNeto.setText("Neto");

        lbIva.setText("Iva");

        jLabel11.setText("Total");

        txNeto.setHorizontalAlignment(javax.swing.JTextField.RIGHT);
        txNeto.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                txNetoKeyPressed(evt);
            }
            public void keyTyped(java.awt.event.KeyEvent evt) {
                txNetoKeyTyped(evt);
            }
        });

        txIva.setHorizontalAlignment(javax.swing.JTextField.RIGHT);
        txIva.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                txIvaKeyPressed(evt);
            }
            public void keyTyped(java.awt.event.KeyEvent evt) {
                txIvaKeyTyped(evt);
            }
        });

        txTotal.setHorizontalAlignment(javax.swing.JTextField.RIGHT);
        txTotal.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyReleased(java.awt.event.KeyEvent evt) {
                txTotalKeyReleased(evt);
            }
        });

        chkElectronica.setSelected(true);
        chkElectronica.setText("Electrónica");
        chkElectronica.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                chkElectronicaActionPerformed(evt);
            }
        });

        javax.swing.GroupLayout jPanel5Layout = new javax.swing.GroupLayout(jPanel5);
        jPanel5.setLayout(jPanel5Layout);
        jPanel5Layout.setHorizontalGroup(
            jPanel5Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel5Layout.createSequentialGroup()
                .addGap(64, 64, 64)
                .addGroup(jPanel5Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                    .addComponent(jLabel2)
                    .addComponent(jLabel8)
                    .addComponent(jLabel7))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addGroup(jPanel5Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                    .addComponent(cbTipDocto, 0, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                    .addComponent(txNroDocto)
                    .addComponent(dtEmision, javax.swing.GroupLayout.DEFAULT_SIZE, 134, Short.MAX_VALUE))
                .addGap(6, 6, 6)
                .addGroup(jPanel5Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                    .addGroup(jPanel5Layout.createSequentialGroup()
                        .addComponent(chkElectronica)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                        .addComponent(lbNeto))
                    .addComponent(lbIva)
                    .addComponent(jLabel11))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addGroup(jPanel5Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(txNeto, javax.swing.GroupLayout.PREFERRED_SIZE, 128, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(txIva, javax.swing.GroupLayout.PREFERRED_SIZE, 128, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(txTotal, javax.swing.GroupLayout.PREFERRED_SIZE, 128, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addGap(34, 34, 34))
        );
        jPanel5Layout.setVerticalGroup(
            jPanel5Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel5Layout.createSequentialGroup()
                .addGap(15, 15, 15)
                .addGroup(jPanel5Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.CENTER)
                    .addComponent(lbNeto)
                    .addComponent(cbTipDocto, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(txNeto, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(jLabel7)
                    .addComponent(chkElectronica))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(jPanel5Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(jPanel5Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                        .addComponent(lbIva)
                        .addComponent(txIva, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addGroup(jPanel5Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                        .addComponent(jLabel8)
                        .addComponent(txNroDocto, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(jPanel5Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.CENTER)
                    .addComponent(txTotal, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(jLabel2)
                    .addComponent(dtEmision, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(jLabel11))
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );

        pnMenu.setBorder(javax.swing.BorderFactory.createEtchedBorder());

        btNuevo.setFont(new java.awt.Font("Arial", 0, 11)); // NOI18N
        btNuevo.setIcon(new javax.swing.ImageIcon(getClass().getResource("/Iconos16/add16.png"))); // NOI18N
        btNuevo.setText("Nuevo");
        btNuevo.setBorder(javax.swing.BorderFactory.createBevelBorder(javax.swing.border.BevelBorder.RAISED));
        btNuevo.setBorderPainted(false);
        btNuevo.setFocusPainted(false);
        btNuevo.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btNuevoActionPerformed(evt);
            }
        });

        btGuardar.setFont(new java.awt.Font("Arial", 0, 11)); // NOI18N
        btGuardar.setIcon(new javax.swing.ImageIcon(getClass().getResource("/Iconos16/save16.png"))); // NOI18N
        btGuardar.setText("Guardar");
        btGuardar.setBorder(javax.swing.BorderFactory.createBevelBorder(javax.swing.border.BevelBorder.RAISED));
        btGuardar.setBorderPainted(false);
        btGuardar.setEnabled(false);
        btGuardar.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btGuardarActionPerformed(evt);
            }
        });

        btCancelar.setFont(new java.awt.Font("Arial", 0, 11)); // NOI18N
        btCancelar.setIcon(new javax.swing.ImageIcon(getClass().getResource("/Iconos16/Cancel16.png"))); // NOI18N
        btCancelar.setText("Cancelar");
        btCancelar.setBorder(javax.swing.BorderFactory.createBevelBorder(javax.swing.border.BevelBorder.RAISED));
        btCancelar.setBorderPainted(false);
        btCancelar.setEnabled(false);
        btCancelar.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btCancelarActionPerformed(evt);
            }
        });

        btAbrir.setFont(new java.awt.Font("Arial", 0, 11)); // NOI18N
        btAbrir.setIcon(new javax.swing.ImageIcon(getClass().getResource("/Iconos16/open16.png"))); // NOI18N
        btAbrir.setText("Abrir");
        btAbrir.setBorder(javax.swing.BorderFactory.createBevelBorder(javax.swing.border.BevelBorder.RAISED));
        btAbrir.setBorderPainted(false);
        btAbrir.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btAbrirActionPerformed(evt);
            }
        });

        jLabel1.setFont(new java.awt.Font("Arial", 1, 12)); // NOI18N
        jLabel1.setForeground(new java.awt.Color(3, 102, 0));
        jLabel1.setText("INGRESO DE ACTIVOS");

        btEditar.setFont(new java.awt.Font("Arial", 0, 11)); // NOI18N
        btEditar.setIcon(new javax.swing.ImageIcon(getClass().getResource("/Iconos16/Pencil16.png"))); // NOI18N
        btEditar.setText("Editar");
        btEditar.setBorder(javax.swing.BorderFactory.createBevelBorder(javax.swing.border.BevelBorder.RAISED));
        btEditar.setBorderPainted(false);
        btEditar.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btEditarActionPerformed(evt);
            }
        });

        btAutorizar.setFont(new java.awt.Font("Arial", 0, 11)); // NOI18N
        btAutorizar.setIcon(new javax.swing.ImageIcon(getClass().getResource("/Iconos16/ok_16.png"))); // NOI18N
        btAutorizar.setText("Autorizar");
        btAutorizar.setBorder(javax.swing.BorderFactory.createBevelBorder(javax.swing.border.BevelBorder.RAISED));
        btAutorizar.setBorderPainted(false);
        btAutorizar.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btAutorizarActionPerformed(evt);
            }
        });

        javax.swing.GroupLayout pnMenuLayout = new javax.swing.GroupLayout(pnMenu);
        pnMenu.setLayout(pnMenuLayout);
        pnMenuLayout.setHorizontalGroup(
            pnMenuLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(pnMenuLayout.createSequentialGroup()
                .addContainerGap()
                .addComponent(jLabel1)
                .addGap(18, 18, 18)
                .addComponent(btGuardar, javax.swing.GroupLayout.PREFERRED_SIZE, 100, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(btCancelar, javax.swing.GroupLayout.PREFERRED_SIZE, 100, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(btNuevo, javax.swing.GroupLayout.PREFERRED_SIZE, 100, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(btAbrir, javax.swing.GroupLayout.PREFERRED_SIZE, 100, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(btEditar, javax.swing.GroupLayout.PREFERRED_SIZE, 100, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, 441, Short.MAX_VALUE)
                .addComponent(btAutorizar, javax.swing.GroupLayout.PREFERRED_SIZE, 100, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(40, 40, 40))
        );
        pnMenuLayout.setVerticalGroup(
            pnMenuLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(pnMenuLayout.createSequentialGroup()
                .addContainerGap()
                .addGroup(pnMenuLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(btCancelar, javax.swing.GroupLayout.PREFERRED_SIZE, 30, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addGroup(pnMenuLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                        .addComponent(btEditar, javax.swing.GroupLayout.PREFERRED_SIZE, 30, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addComponent(btAutorizar, javax.swing.GroupLayout.PREFERRED_SIZE, 30, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addComponent(btAbrir, javax.swing.GroupLayout.PREFERRED_SIZE, 30, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(jLabel1)
                    .addComponent(btNuevo, javax.swing.GroupLayout.PREFERRED_SIZE, 30, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(btGuardar, javax.swing.GroupLayout.PREFERRED_SIZE, 30, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addContainerGap())
        );

        cbCCostoId.setModel(new javax.swing.DefaultComboBoxModel<>(new String[] { "Item 1", "Item 2", "Item 3", "Item 4" }));

        cbTrabajadorId.setModel(new javax.swing.DefaultComboBoxModel<>(new String[] { "Item 1", "Item 2", "Item 3", "Item 4" }));

        cbCategoriaId.setModel(new javax.swing.DefaultComboBoxModel<>(new String[] { "Item 1", "Item 2", "Item 3", "Item 4" }));

        cbSubCategoriaId.setModel(new javax.swing.DefaultComboBoxModel<>(new String[] { "Item 1", "Item 2", "Item 3", "Item 4" }));

        jPanel1.setBorder(javax.swing.BorderFactory.createTitledBorder(javax.swing.BorderFactory.createEtchedBorder(), "Pagos", javax.swing.border.TitledBorder.DEFAULT_JUSTIFICATION, javax.swing.border.TitledBorder.DEFAULT_POSITION, new java.awt.Font("Tahoma", 1, 11))); // NOI18N

        txCuotas.setText("1");
        txCuotas.setEnabled(false);
        txCuotas.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyTyped(java.awt.event.KeyEvent evt) {
                txCuotasKeyTyped(evt);
            }
        });

        jLabel17.setText("Cuotas");

        jLabel18.setText("Días");

        txDias.setEditable(false);
        txDias.setText("0");
        txDias.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                txDiasMouseClicked(evt);
            }
        });
        txDias.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                txDiasActionPerformed(evt);
            }
        });

        cbTipoPago.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                cbTipoPagoActionPerformed(evt);
            }
        });

        jLabel15.setText("Forma de Pago");

        cbPersonal.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                cbPersonalActionPerformed(evt);
            }
        });

        chkPersonal.setText("Pagado por personal");
        chkPersonal.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                chkPersonalActionPerformed(evt);
            }
        });

        javax.swing.GroupLayout jPanel1Layout = new javax.swing.GroupLayout(jPanel1);
        jPanel1.setLayout(jPanel1Layout);
        jPanel1Layout.setHorizontalGroup(
            jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel1Layout.createSequentialGroup()
                .addGap(19, 19, 19)
                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                    .addGroup(jPanel1Layout.createSequentialGroup()
                        .addComponent(jLabel15)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(cbTipoPago, javax.swing.GroupLayout.PREFERRED_SIZE, 247, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addComponent(chkPersonal))
                .addGap(11, 11, 11)
                .addComponent(jLabel17)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                    .addGroup(jPanel1Layout.createSequentialGroup()
                        .addComponent(txCuotas, javax.swing.GroupLayout.PREFERRED_SIZE, 43, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(jLabel18)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(txDias, javax.swing.GroupLayout.PREFERRED_SIZE, 174, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addComponent(cbPersonal, 0, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(cbTipoPagoId, javax.swing.GroupLayout.PREFERRED_SIZE, 61, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );
        jPanel1Layout.setVerticalGroup(
            jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel1Layout.createSequentialGroup()
                .addGap(18, 18, 18)
                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel17)
                    .addComponent(jLabel18)
                    .addComponent(txDias, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(txCuotas, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(jLabel15)
                    .addComponent(cbTipoPago, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(cbTipoPagoId, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(cbPersonal, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(chkPersonal))
                .addContainerGap(11, Short.MAX_VALUE))
        );

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(this);
        this.setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(layout.createSequentialGroup()
                        .addComponent(pnMenu, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                        .addContainerGap())
                    .addGroup(layout.createSequentialGroup()
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING, false)
                            .addComponent(jPanel1, javax.swing.GroupLayout.Alignment.LEADING, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                            .addComponent(jPanel5, javax.swing.GroupLayout.Alignment.LEADING, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                            .addComponent(jPanel3, javax.swing.GroupLayout.Alignment.LEADING, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                            .addComponent(jPanel2, javax.swing.GroupLayout.Alignment.LEADING, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                            .addComponent(cbSubCategoriaId, 0, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                            .addComponent(cbCategoriaId, 0, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                            .addComponent(cbTrabajadorId, 0, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                            .addComponent(cbCCostoId, 0, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                            .addComponent(cbPersonalId, 0, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
                        .addGap(31, 31, 31))))
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(layout.createSequentialGroup()
                        .addContainerGap()
                        .addComponent(pnMenu, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                        .addComponent(jPanel2, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                        .addComponent(jPanel3, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(jPanel5, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addGroup(layout.createSequentialGroup()
                        .addGap(194, 194, 194)
                        .addComponent(cbSubCategoriaId, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addGap(22, 22, 22)
                        .addComponent(cbCategoriaId, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addGap(17, 17, 17)
                        .addComponent(cbTrabajadorId, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addGap(16, 16, 16)
                        .addComponent(cbCCostoId, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(cbPersonalId, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(jPanel1, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addContainerGap(57, Short.MAX_VALUE))
        );
    }// </editor-fold>//GEN-END:initComponents
    
    private void SetEstados(int Estado){
        //Nada
        if(Estado==1){
            Limpia();
            Habilita(false);
            btCancelar.setEnabled(false);
            btGuardar.setEnabled(false);
            btAbrir.setEnabled(true);
            btNuevo.setEnabled(true);
            btEditar.setEnabled(false);
            btAutorizar.setEnabled(false);
            cbPersonal.setVisible(false);
            EstadoGeneral=1;
        }
        //Nuevo
        if(Estado==2){
            EstadoGeneral=2;
            Limpia();
            Habilita(true);
            CargaCCostos();
            btCancelar.setEnabled(true);
            btGuardar.setEnabled(true);
            btAbrir.setEnabled(false);
            btNuevo.setEnabled(false);
            Editar(true);
            EstadoGeneral=2;
            Nuevo=true;
        }
        if(Estado==4){
            PosCCosto       = cbCCosto.getSelectedIndex();
            PosTrabajador   = cbTrabajador.getSelectedIndex();
            PosCategoria    = cbCategoria.getSelectedIndex();
            PosSubCategoria = cbSubCategoria.getSelectedIndex();
            PosPago         = cbTipoPago.getSelectedIndex();
            PosTipDocto     = cbTipDocto.getSelectedIndex();
            PosPagoTrabajador = cbPersonal.getSelectedIndex();
            PosElectronica  = chkElectronica.isSelected();
            EstadoGeneral   =4;
            Editar(false);
            btNuevo.setEnabled(true);
            btGuardar.setEnabled(false);
            btCancelar.setEnabled(false);
            btAbrir.setEnabled(true);
        }
        if(Estado==5){
            btNuevo.setEnabled(false);
            btGuardar.setEnabled(true);
            btCancelar.setEnabled(true);
            btEditar.setEnabled(false);
            btAbrir.setEnabled(false);
            btAutorizar.setEnabled(false);
            Editar(true);
            EstadoGeneral = 5;
        }
        
    }
    private void Habilita(boolean Estado){
        cbCCosto.setEnabled(Estado);
        cbCategoria.setEnabled(Estado);
        cbSubCategoria.setEnabled(Estado);
        cbTrabajador.setEnabled(Estado);
        cbTipDocto.setEnabled(Estado);
        cbTipoPago.setEnabled(Estado);
        
        txRut.setEnabled(Estado);
        txNombre.setEnabled(Estado);
        txNroDocto.setEnabled(Estado);
        txNeto.setEnabled(Estado);
        txIva.setEnabled(Estado);
        txTotal.setEnabled(Estado);
        txCuotas.setEnabled(Estado);
        txDias.setEnabled(Estado);
        
        btIr.setEnabled(Estado);
        
        dtEmision.setEnabled(Estado);
        chkElectronica.setEnabled(Estado);
    }
    private void Limpia(){
        cbCCosto.setSelectedIndex(-1);
        cbCategoria.setSelectedIndex(-1);
        cbTrabajador.setSelectedIndex(-1);
        cbSubCategoria.setSelectedIndex(-1);
        
        txRut.setText("");
        txNombre.setText("");
        
        cbTipDocto.setSelectedIndex(-1);
        txNroDocto.setText("");
        dtEmision.setDate(null);
        txTotal.setText("");
        txIva.setText("");
        txNeto.setText("");
    }
    
    private void CargaCCostos(){
        ExeSql Sql = new ExeSql();
        ResultSet Rs;
        
        cbCCosto.removeAllItems();
        cbCCostoId.removeAllItems();
        
        try {
            Rs = Sql.Select("select ID,NOMBRE\n" +
                            "from pccostos order by nombre");
            while(Rs.next()){
                cbCCostoId.addItem(Rs.getString("id"));
                cbCCosto.addItem(Rs.getString("nombre").trim());
            }
        } catch (Exception e) {
            System.out.println(e.getMessage());
        } finally{
            Sql.Close();
        }
                
    }
    private void CargaTrabajadores(){
        ExeSql Sql= new ExeSql();
        ResultSet Rs;
        
        cbTrabajador.removeAllItems();
        cbTrabajadorId.removeAllItems();
        
        try {
            Rs = Sql.Select("select p.rut,p.nombre\n" +
                            "from personal_ccostos pc\n" +
                            "left join personal p on pc.rut=p.rut\n" +
                            "where pc.ccosto=" + cbCCostoId.getSelectedItem().toString().trim());
            while(Rs.next()){
                cbTrabajadorId.addItem(Rs.getString("Rut"));
                cbTrabajador.addItem(Rs.getString("nombre"));
            }
        } catch (Exception e) {
        }finally{
            Sql.Close();
        }
    }
    private void CargaActivosGrales(){
        ExeSql Sql = new ExeSql();
        ResultSet Rs;
        
        cbCategoria.removeAllItems();
        cbCategoriaId.removeAllItems();
        
        try {
            Rs = Sql.Select("SELECT max(p.codigo) as id,p.nombre\n" +
                            "FROM activos_link l\n" +
                            "left join activos_det d on l.gastosdet=d.id\n" +
                            "left join PAR_GENERAL p on p.CODIGO=d.plan and p.tipo='TIPO_ACTIVOS'\n" +
                            "where l.ccosto=" + cbCCostoId.getSelectedItem().toString().trim() + "\n" +
                            "group by p.nombre \n" +
                            "order by p.nombre ");
            while(Rs.next()){
                cbCategoriaId.addItem(Rs.getString("id").trim());
                cbCategoria.addItem(Rs.getString("nombre").trim());
            }
        } catch (Exception e) {
            System.out.println(e.getMessage());
        }finally{
            Sql.Close();
        }
    }
    private void CargaSubCategoria(){
        ExeSql Sql=new ExeSql();
        ResultSet Rs;
        
        cbSubCategoria.removeAllItems();
        cbSubCategoriaId.removeAllItems();
        
        try {
            Rs = Sql.Select("SELECT d.id,d.nombre\n" +
                            "FROM activos_link l\n" +
                            "left join activos_det d on l.gastosdet=d.id\n" +
                            "where l.ccosto=" + cbCCostoId.getSelectedItem().toString().trim() + "\n" +
                            "and d.plan=" + cbCategoriaId.getSelectedItem().toString().trim());
            while(Rs.next()){
                cbSubCategoriaId.addItem(Rs.getString("id").trim());
                cbSubCategoria.addItem(Rs.getString("nombre").trim());
            }
        } catch (Exception e) {
            System.out.println(e.getMessage());
        }finally{
            Sql.Close();
        }
    }
    private void btCancelarActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btCancelarActionPerformed
            SetEstados(1);
    }//GEN-LAST:event_btCancelarActionPerformed

    private void cbCCostoActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cbCCostoActionPerformed
        if(EstadoGeneral==4)
            cbCCosto.setSelectedIndex(PosCCosto);
        else if(!Cargando){
            cbCCostoId.setSelectedIndex(cbCCosto.getSelectedIndex());
            CargaTrabajadores();
            CargaActivosGrales();
        }
    }//GEN-LAST:event_cbCCostoActionPerformed

    private void cbCategoriaActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cbCategoriaActionPerformed
        if(EstadoGeneral==4)
            cbCategoria.setSelectedIndex(PosCategoria);
        else if(!Cargando){
            cbCategoriaId.setSelectedIndex(cbCategoria.getSelectedIndex());
            CargaSubCategoria();
        }
        
    }//GEN-LAST:event_cbCategoriaActionPerformed

    private void btNuevoActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btNuevoActionPerformed
        SetEstados(2);
    }//GEN-LAST:event_btNuevoActionPerformed

    private void btIrActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btIrActionPerformed
        if(txRut.getText().isEmpty()){
            jdBuscarCliPrv BPC = new jdBuscarCliPrv(null, true);
            BPC.setLocationRelativeTo(null);
            BPC.setTitle("Buscar Proveedor");
            BPC.SetTipo(1);
            BPC.setVisible(true);
            CargaProveedor(BPC.GetRut());
        }
        else{
            CargaProveedor(txRut.getText().trim());
        }
    }//GEN-LAST:event_btIrActionPerformed
    public String getFechaAsString() {
        SimpleDateFormat sdf = new SimpleDateFormat("yyyy-MM-dd HH:mm:ss");
        return( sdf.format( (dtEmision.getDate()).getTime() ) );
}
    private void btGuardarActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btGuardarActionPerformed
        String TipDocto="";
        String Rut;
        
        if (txCuotas.getText().isEmpty()
                || txDias.getText().isEmpty()
                || getFechaAsString().isEmpty()) {
            JOptionPane.showMessageDialog(null, "Faltan Datos");
            return;
        }
        
        double Neto = Double.valueOf(fmMain.SetGuardar(txNeto.getText()));
        double Iva = Double.valueOf(fmMain.SetGuardar(txIva.getText()));
        double Total = Double.valueOf(fmMain.SetGuardar(txTotal.getText()));
        
        if(Total != Iva + Neto){
            if(fmMain.OkCancel("Montos no cuadran \n\n ¿Desea guardar de todas formas?")== JOptionPane.CANCEL_OPTION)
                return;
        }
        
        ExeSql Sql = new ExeSql();
        if(cbTipDocto.getSelectedIndex()==0)
            TipDocto="BOG";
        else
            TipDocto="FAG";
        
        if(cbTipoPagoId.getSelectedItem().toString().trim().equals("1"))
            Rut=cbPersonalId.getSelectedItem().toString();
        else
            Rut="0";
        
        String NewRut = txRut.getText().trim();
        String NewNroDocto = txNroDocto.getText().trim();
        String NewTipDocto;
        
        if(cbTipDocto.getSelectedIndex()==0)
            NewTipDocto = "BOG";
        else
            NewTipDocto = "FAG";
        
        try {
            if(Nuevo){
                Sql.ExeSql("INSERT INTO public.ctacteprv\n"
                        + "(rut,tipdocto,nrodocto,femision,frecepcion,totalafecto,totalexento,totaliva,totalotroimp,totaldocto,electronica,recepcion,cuotas,dias,tipdocorigen,nrodocorigen,ccosto,trabajador,activo,tipopago,contacto) \n"
                        + "VALUES ("
                        + txRut.getText().trim() + ","
                        + "'"+ TipDocto +"',"
                        + txNroDocto.getText() + ",'"
                        + getFechaAsString()+ "','"
                        + getFechaAsString() + "',"
                        + fmMain.SetGuardar(txNeto.getText()) + ","
                        + "0" + ","
                        + fmMain.SetGuardar(txIva.getText()) + ","
                        + "0" + ","
                        + fmMain.SetGuardar(txTotal.getText()) + ","
                        + GetElectronica() + ",0," 
                        + txCuotas.getText().trim() + ",'" + txDias.getText().trim() + "','GAS'," + "0" + ","+ cbCCostoId.getSelectedItem().toString().trim() +",\n" 
                        + cbTrabajadorId.getSelectedItem().toString().trim() + ",\n" 
                        + cbSubCategoriaId.getSelectedItem().toString().trim() + ",\n"
                        + cbTipoPagoId.getSelectedItem().toString().trim() +"," + Rut + ")");
                Sql.Commit();
                fmMain.Mensaje("Nuevo Documento Ingresado");
            }
            else{
                Sql.ExeSql("update ctacteprv set \n" +
                            "femision='"+ getFechaAsString() +"',\n" +
                            "frecepcion='"+ getFechaAsString() +"',\n" +
                            "totalafecto="+ fmMain.SetGuardar(txNeto.getText()) +",\n" +
                            "totaliva="+ fmMain.SetGuardar(txIva.getText()) +",\n" +
                            "totaldocto="+ fmMain.SetGuardar(txTotal.getText()) +",\n" +
                            "electronica="+ GetElectronica() +",\n" +
                            "cuotas="+ txCuotas.getText().trim() +",\n" +
                            "dias='" + txDias.getText().trim() + "',\n" +
                            "ccosto="+ cbCCostoId.getSelectedItem().toString().trim() +",\n" +
                            "trabajador="+ cbTrabajadorId.getSelectedItem().toString().trim() + ",\n" +
                            "tipopago="+ cbTipoPagoId.getSelectedItem().toString().trim() +",\n" +
                            "contacto=" + cbPersonalId.getSelectedItem().toString().trim() + "\n" +
                            "where rut="+ OpenRut +"\n" +
                            "and tipdocto='"+ OpenTipDocto +"'\n" +
                            "and nrodocto=" + OpenNroDocto);
                Sql.Commit();
                fmMain.Mensaje("Cambios guardados");
            }
            btAbrir.doClick();
            txRut.setText(NewRut);
            btIr.doClick();
            AbrirDocumento(NewRut,NewNroDocto, NewTipDocto);
        } catch (Exception e) {
            System.out.println("Error Guardar Activo " + e.getMessage());
        } finally{
            Sql.Close();
        }
    }//GEN-LAST:event_btGuardarActionPerformed

    private void cbSubCategoriaActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cbSubCategoriaActionPerformed
        if(EstadoGeneral==4){
            cbSubCategoria.setSelectedIndex(PosSubCategoria);
            return;
        }
        
        
        cbSubCategoriaId.setSelectedIndex(cbSubCategoria.getSelectedIndex());
        ExeSql Sql = new ExeSql();
        ResultSet Rs;
        try {
            Rs = Sql.Select("select sinrut\n" +
                            "from gastos_det\n" +
                            "where id=" + cbSubCategoriaId.getSelectedItem().toString().trim());
            Rs.next();
            if(Rs.getBoolean("sinrut")==true){
                txRut.setText("11111111");
                btIr.doClick();
                txRut.setEditable(false);
                btIr.setEnabled(false);
            }
            else{
                txRut.setText("");
                txNombre.setText("");
                txRut.requestFocus();
                btIr.setEnabled(true);
            }
        } catch (Exception e) {
            System.out.println(e.getMessage());
        }finally{
            Sql.Close();
        }
    }//GEN-LAST:event_cbSubCategoriaActionPerformed

    private void txCuotasKeyTyped(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_txCuotasKeyTyped
        if(!Character.isDigit(evt.getKeyChar()))
        evt.consume();
    }//GEN-LAST:event_txCuotasKeyTyped

    private void txDiasMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_txDiasMouseClicked
        try {
            jdDiasOCP Dias = new jdDiasOCP(null, true);
            Dias.setTitle("Dias");
            Dias.setLocationRelativeTo(txDias);
            Dias.SetFilas(Integer.valueOf(txCuotas.getText()));
            Dias.setVisible(true);
            //        Dias.SetFoco();
            txDias.setText(Dias.GetFilas());
        } catch (Exception e) {
            System.out.println(e.getMessage());
        }
            
    }//GEN-LAST:event_txDiasMouseClicked

    private void txDiasActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_txDiasActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_txDiasActionPerformed

    private void cbTipoPagoActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cbTipoPagoActionPerformed
        if(!Cargando){
            if(EstadoGeneral==4){
                cbTipoPago.setSelectedIndex(PosPago);
                return;
            }
           cbTipoPagoId.setSelectedIndex(cbTipoPago.getSelectedIndex());
           if(cbTipoPagoId.getSelectedItem().toString().trim().equals("1")){
               CargaPersonal();
               cbPersonal.setVisible(true);
           }
            else
                cbPersonal.setVisible(false);
       }

    }//GEN-LAST:event_cbTipoPagoActionPerformed
    private void CargaPersonal(){
        ExeSql Sql = new ExeSql();
        ResultSet Rs;
        
        cbPersonalId.removeAllItems();
        cbPersonal.removeAllItems();
        
        try {
            Rs = Sql.Select("select rut,nombre\n" +
                            "from personal\n" +
                            "where rut>1000");
            while(Rs.next()){
                cbPersonalId.addItem(Rs.getString("rut").trim());
                cbPersonal.addItem(Rs.getString("nombre").trim());
            }
        } catch (Exception e) {
            System.out.println(e.getMessage());
        }finally{
            Sql.Close();
        }
    }
    private void txRutKeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_txRutKeyPressed
        if(evt.getKeyCode()== KeyEvent.VK_ENTER){
            btIr.doClick();
        }
    }//GEN-LAST:event_txRutKeyPressed

    private void btAbrirActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btAbrirActionPerformed
        txRut.setEnabled(true);
        btIr.setEnabled(true);
        txNombre.setEnabled(true);
        txRut.requestFocus();
        btAbrir.setEnabled(false);
        btNuevo.setEnabled(false);
        btCancelar.setEnabled(true);
        EstadoGeneral=3;
    }//GEN-LAST:event_btAbrirActionPerformed

    private void txNetoKeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_txNetoKeyPressed
        if(evt.getKeyCode()==KeyEvent.VK_ENTER){
            txIva.requestFocus();
        }
    }//GEN-LAST:event_txNetoKeyPressed

    private void txIvaKeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_txIvaKeyPressed
        if(evt.getKeyCode()==KeyEvent.VK_ENTER){
            txTotal.requestFocus();
        }
    }//GEN-LAST:event_txIvaKeyPressed

    private void txNetoKeyTyped(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_txNetoKeyTyped
        if(evt.getKeyCode()==KeyEvent.VK_ENTER){
            txIva.requestFocus();
        }
    }//GEN-LAST:event_txNetoKeyTyped

    private void txIvaKeyTyped(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_txIvaKeyTyped
        if(evt.getKeyCode()==KeyEvent.VK_ENTER){
            txTotal.requestFocus();
        }
    }//GEN-LAST:event_txIvaKeyTyped

    private void cbTipDoctoActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cbTipDoctoActionPerformed
        if(EstadoGeneral==4){
            cbTipDocto.setSelectedIndex(PosTipDocto);
            return;
        }
        
        if(cbTipDocto.getSelectedIndex()==0){
            txNeto.setEnabled(false);
            txIva.setEnabled(false);
            lbNeto.setEnabled(false);
            lbIva.setEnabled(false);
        }
        else{
            txNeto.setEnabled(true);
            txIva.setEnabled(true);
            lbNeto.setEnabled(true);
            lbIva.setEnabled(true);
        }
        txNroDocto.requestFocus();
    }//GEN-LAST:event_cbTipDoctoActionPerformed

    private void txTotalKeyReleased(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_txTotalKeyReleased
        if(!txTotal.getText().isEmpty() && cbTipDocto.getSelectedIndex()==0){
            double Total = Double.valueOf(txTotal.getText());
            double Neto = Math.round(Total / 1.19);
            txNeto.setText(String.valueOf(Math.round(Neto)));
            txIva.setText(String.valueOf(Math.round(Total-Neto)));
        }
    }//GEN-LAST:event_txTotalKeyReleased

    private void cbPersonalActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cbPersonalActionPerformed
        if(!Cargando){
            cbPersonalId.setSelectedIndex(cbPersonal.getSelectedIndex());
        }
    }//GEN-LAST:event_cbPersonalActionPerformed

    private void cbTrabajadorActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cbTrabajadorActionPerformed
        if(EstadoGeneral==4)
            cbTrabajador.setSelectedIndex(PosTrabajador);
    }//GEN-LAST:event_cbTrabajadorActionPerformed

    private void btEditarActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btEditarActionPerformed
        SetEstados(5);
    }//GEN-LAST:event_btEditarActionPerformed

    private void btAutorizarActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btAutorizarActionPerformed
        if(fmMain.OkCancel("¿Autorizar Compra de Activos?")== JOptionPane.OK_OPTION){
            ExeSql Sql = new ExeSql();
            try {
                Sql.ExeSql("update ctacteprv set\n"
                    + "cuotas=" + txCuotas.getText().trim() + ",\n"
                    + "tipopago=" + cbTipoPagoId.getSelectedItem().toString() + ",\n"
                    + "dias='" + txDias.getText().trim() + "',\n"
                    + "autoriza=1 \n"
                    + "where rut=" + OpenRut + "\n"
                    + "and tipdocto='"+ OpenTipDocto +"'\n"
                    + "and nrodocto=" + OpenNroDocto);
                Sql.Commit();
                JOptionPane.showMessageDialog(null,"Compra de Activos Autorizado");
                btAutorizar.setEnabled(false);
                btEditar.setEnabled(false);
            } catch (SQLException | HeadlessException e) {
                fmMain.Mensaje(e.getMessage());
                Sql.Rollback();

            }finally{
                Sql.Close();
            }

        }
    }//GEN-LAST:event_btAutorizarActionPerformed

    private void chkElectronicaActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_chkElectronicaActionPerformed
        if(EstadoGeneral==4)
        chkElectronica.setSelected(PosElectronica);
    }//GEN-LAST:event_chkElectronicaActionPerformed

    private void chkPersonalActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_chkPersonalActionPerformed
        if(chkPersonal.isSelected())
        cbPersonal.setVisible(true);
        else
        cbPersonal.setVisible(false);
    }//GEN-LAST:event_chkPersonalActionPerformed
    private void CargaTipoPago(){
    ExeSql Sql = new ExeSql();
    ResultSet Rs;
    
    cbTipoPago.removeAllItems();
    cbTipoPagoId.removeAllItems();
    
    try {
        Rs = Sql.Select("select codigo,nombre\n" +
                        "from par_general \n" +
                        "where tipo='TIPOPAGOPRV'\n" +
                        "and vigente=1\n" +
                        "order by codigo");
        while(Rs.next()){
            cbTipoPagoId.addItem(Rs.getString("codigo"));
            cbTipoPago.addItem(Rs.getString("nombre"));
        }
    } catch (Exception e) {
        fmMain.Mensaje(e.getMessage());
    } finally{
        Sql.Close();
    }
}
    private void CargaProveedor(String Rut){
        ExeSql Sql = new ExeSql();
        ResultSet Rs;
        
        try {
            Rs = Sql.Select("select Rut,Nombre \n" +
                            "from proveedor\n" +
                            "where rut=" + Rut);
            if(Sql.GetRowCount()>0){
                Rs.next();
                txRut.setText(Rs.getString("Rut"));
                txNombre.setText(Rs.getString("Nombre"));
                if(EstadoGeneral==3){
                    jdAbrirDocumento ADoc = new jdAbrirDocumento(null, true);
                    if (ADoc.ShowModal("FAG','BOG", txRut.getText().trim() + " and activo > 0") == JOptionPane.YES_OPTION) {
                        AbrirDocumento(Rut,ADoc.GetNumero(),ADoc.GetTipo());
                    }
                    
                }
            }
            
        } catch (Exception e) {
            System.out.println(e.getMessage());
        } finally{
            Sql.Close();
        }
    }
    private void Editar(boolean Estado){
        txNroDocto.setEditable(Estado);
        dtEmision.setEditable(Estado);
        txNeto.setEditable(Estado);
        txIva.setEditable(Estado);
        txTotal.setEditable(Estado);
        txCuotas.setEditable(Estado);
        txDias.setEditable(Estado);
        txRut.setEditable(Estado);
    }
    private void AbrirDocumento(String Rut, String Numero, String Tipo){
        ExeSql Sql = new ExeSql();
        ResultSet Rs;
        
        try {
            Rs = Sql.Select("select p.ccosto,p.trabajador,g.plan,p.activo,p.rut,p.tipdocto,p.nrodocto,p.femision,p.totalafecto,p.totaliva,p.totaldocto,\n" +
                            "p.tipopago,p.cuotas,p.dias,prv.nombre,p.electronica, p.autoriza,p.contacto\n" +
                            "from ctacteprv p\n" +
                            "left join activos_det g on p.activo=g.id\n" +
                            "left join proveedor prv on prv.rut=p.rut\n" +
                            "where p.tipdocto='"+ Tipo +"'\n" +
                            "and p.rut="+ Rut +"\n" +
                            "and p.nrodocto=" + Numero);
            if(Sql.GetRowCount()>0){
                OpenRut      = Rut;
                OpenNroDocto = Numero;
                OpenTipDocto = Tipo;
                
                Rs.next();
                Habilita(true);
                CargaCCostos();
                cbCCostoId.setSelectedItem(Rs.getString("ccosto").trim());          cbCCosto.setSelectedIndex(cbCCostoId.getSelectedIndex());
                cbTrabajadorId.setSelectedItem(Rs.getString("trabajador").trim());  cbTrabajador.setSelectedIndex(cbTrabajadorId.getSelectedIndex());
                cbCategoriaId.setSelectedItem(Rs.getString("plan").trim());         cbCategoria.setSelectedIndex(cbCategoriaId.getSelectedIndex());
                cbSubCategoriaId.setSelectedItem(Rs.getString("activo").trim());     cbSubCategoria.setSelectedIndex(cbSubCategoriaId.getSelectedIndex());
                txRut.setText(Rut);
                txNombre.setText(Rs.getString("nombre").trim());
                if(Rs.getString("tipdocto").equals("FAG"))
                    cbTipDocto.setSelectedIndex(1);
                else
                    cbTipDocto.setSelectedIndex(0);
                txNroDocto.setText(Numero);
                dtEmision.setDate(Rs.getDate("femision"));
                txNeto.setText(fmMain.FormatoTotal(Rs.getDouble("totalafecto")));
                txIva.setText(fmMain.FormatoTotal(Rs.getDouble("totaliva")));
                txTotal.setText(fmMain.FormatoTotal(Rs.getDouble("totaldocto")));
                cbTipoPagoId.setSelectedItem(Rs.getString("tipopago"));             cbTipoPago.setSelectedIndex(cbTipoPagoId.getSelectedIndex());
                cbPersonalId.setSelectedItem(Rs.getString("contacto").trim());     cbPersonal.setSelectedIndex(cbPersonalId.getSelectedIndex());
                txCuotas.setText(Rs.getString("cuotas").trim());
                txDias.setText(Rs.getString("Dias"));
                SetElectronica(Rs.getInt("electronica"));
                Autorizado = Rs.getInt("Autoriza");
                if(Rs.getInt("Autoriza")>0){
                    btAutorizar.setEnabled(false);
                    btEditar.setEnabled(false);
                }
                else{
                    btAutorizar.setEnabled(true);
                    btEditar.setEnabled(true);
                }
                    
                SetEstados(4);
            }
            else{
                fmMain.Mensaje("Documento no encontrado");
            }
        } catch (Exception e) {
            System.out.println(e.getMessage());
        }finally{
            Sql.Close();
        }
    }
     private int GetElectronica(){
        if(chkElectronica.isSelected())
            return 1;
        else
            return 0;
    }   
    private void SetElectronica(int Electronica){
        if(Electronica==0)
            chkElectronica.setSelected(false);
        else
            chkElectronica.setSelected(true);
    }

    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton btAbrir;
    private javax.swing.JButton btAutorizar;
    private javax.swing.JButton btCancelar;
    private javax.swing.JButton btEditar;
    private javax.swing.JButton btGuardar;
    private javax.swing.JButton btIr;
    private javax.swing.JButton btNuevo;
    private javax.swing.JComboBox<String> cbCCosto;
    private javax.swing.JComboBox<String> cbCCostoId;
    private javax.swing.JComboBox<String> cbCategoria;
    private javax.swing.JComboBox<String> cbCategoriaId;
    private javax.swing.JComboBox<String> cbPersonal;
    private javax.swing.JComboBox<String> cbPersonalId;
    private javax.swing.JComboBox<String> cbSubCategoria;
    private javax.swing.JComboBox<String> cbSubCategoriaId;
    private javax.swing.JComboBox<String> cbTipDocto;
    private javax.swing.JComboBox cbTipoPago;
    private javax.swing.JComboBox cbTipoPagoId;
    private javax.swing.JComboBox<String> cbTrabajador;
    private javax.swing.JComboBox<String> cbTrabajadorId;
    private javax.swing.JCheckBox chkElectronica;
    private javax.swing.JCheckBox chkPersonal;
    private org.jdesktop.swingx.JXDatePicker dtEmision;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JLabel jLabel11;
    private javax.swing.JLabel jLabel12;
    private javax.swing.JLabel jLabel13;
    private javax.swing.JLabel jLabel15;
    private javax.swing.JLabel jLabel17;
    private javax.swing.JLabel jLabel18;
    private javax.swing.JLabel jLabel2;
    private javax.swing.JLabel jLabel3;
    private javax.swing.JLabel jLabel4;
    private javax.swing.JLabel jLabel5;
    private javax.swing.JLabel jLabel6;
    private javax.swing.JLabel jLabel7;
    private javax.swing.JLabel jLabel8;
    private javax.swing.JPanel jPanel1;
    private javax.swing.JPanel jPanel2;
    private javax.swing.JPanel jPanel3;
    private javax.swing.JPanel jPanel5;
    private javax.swing.JLabel lbIva;
    private javax.swing.JLabel lbNeto;
    private javax.swing.JPanel pnMenu;
    private javax.swing.JTextField txCuotas;
    private javax.swing.JTextField txDias;
    private javax.swing.JTextField txIva;
    private javax.swing.JTextField txNeto;
    private javax.swing.JTextField txNombre;
    private javax.swing.JTextField txNroDocto;
    private javax.swing.JTextField txRut;
    private javax.swing.JTextField txTotal;
    // End of variables declaration//GEN-END:variables
}
