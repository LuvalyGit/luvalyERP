/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package PanelForm;

import Conexion.ExeSql;
import Formularios.fmMain;
import Dialogos.jdBuscarCliPrv;
import Dialogos.jdEvalAgrupados;
import java.awt.Color;
import java.awt.Component;
import java.awt.Font;
import java.awt.Toolkit;
import java.awt.datatransfer.StringSelection;
import java.awt.event.ActionEvent;
import java.awt.event.KeyEvent;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.text.SimpleDateFormat;
import java.util.ArrayList;
import java.util.Calendar;
import java.util.logging.Level;
import java.util.logging.Logger;
import javax.swing.AbstractAction;
import javax.swing.JTable;
import javax.swing.RowFilter;
import javax.swing.SwingConstants;
import javax.swing.table.DefaultTableCellRenderer;
import javax.swing.table.DefaultTableModel;
import javax.swing.table.TableModel;
import javax.swing.table.TableRowSorter;

/**
 *
 * @author Roberto Lopez
 */
public class pfEvaluacionesConvenios extends javax.swing.JPanel {
    
    int id_proveedor;
    int inicio = 0;
    int elige = 0;
    String Tabla = "";
    
    
    public static Color DARK_GREEN = new Color(0,153,0);
    public static Color BLACK_GRAY = new Color(102,102,102);
    public static Color DARK_ORANGE = new Color(255,102,0);
    
        
    Calendar cal = Calendar.getInstance();
    int mesant = cal.get(Calendar.MONTH)+1;         // El Mes actual
    int anant = cal.get(Calendar.YEAR);             // El Año actual
        
    private String mes = String.valueOf(mesant);       
    private String agno = String.valueOf(anant);     
    
    SimpleDateFormat formatofecha =  new SimpleDateFormat("dd-MM-yyyy HH:mm");
   
    DefaultTableCellRenderer rightRenderer = new DefaultTableCellRenderer();
    DefaultTableCellRenderer leftRenderer = new DefaultTableCellRenderer();
    
    
    
    public pfEvaluacionesConvenios() {
        
        initComponents();
        
        CargaConvenios();
        
        cbConvenioId.setVisible(false);
        
        
        rightRenderer.setHorizontalAlignment(SwingConstants.RIGHT);
        leftRenderer.setHorizontalAlignment(SwingConstants.LEFT);
      
        Grilla.getColumnModel().getColumn(7).setCellRenderer(rightRenderer);  //Columna Presupuesto
        
        
        
        Grilla.getActionMap().put("copy", new AbstractAction(){  //Para copiar al portapapeles
      
          @Override
          public void actionPerformed(ActionEvent e) {
              
            String cellValue = Grilla.getModel().getValueAt(Grilla.getSelectedRow(), Grilla.getSelectedColumn()).toString();
            StringSelection stringSelection = new StringSelection(cellValue);
            Toolkit.getDefaultToolkit().getSystemClipboard().setContents(stringSelection, stringSelection);
           }
        
        });
        
        
        btAgrupar.setVisible(false);
        
       
    }
    
    

   
    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        jPanel2 = new javax.swing.JPanel();
        cbRegion = new javax.swing.JComboBox();
        jLabel1 = new javax.swing.JLabel();
        cbConvenio = new javax.swing.JComboBox<String>();
        jLabel5 = new javax.swing.JLabel();
        cbConvenioId = new javax.swing.JComboBox();
        jLabel12 = new javax.swing.JLabel();
        txFiltro = new javax.swing.JTextField();
        jScrollPane2 = new javax.swing.JScrollPane();
        Grilla = new javax.swing.JTable();
        lbTotal = new javax.swing.JLabel();
        btCargar = new javax.swing.JButton();
        jPanel1 = new javax.swing.JPanel();
        jLabel2 = new javax.swing.JLabel();
        txRut = new javax.swing.JTextField();
        btIr = new javax.swing.JButton();
        jLabel3 = new javax.swing.JLabel();
        txNombre = new javax.swing.JTextField();
        btAgrupar = new javax.swing.JButton();
        jLabel13 = new javax.swing.JLabel();
        txModelo = new javax.swing.JTextField();

        jPanel2.setBorder(javax.swing.BorderFactory.createEtchedBorder());

        cbRegion.setModel(new javax.swing.DefaultComboBoxModel(new String[] { "SELECCIONE REGIÓN", "TARAPACÁ", "ARICA Y PARINACOTA", "ANTOFAGASTA", "ATACAMA", "COQUIMBO", "VALPARAÍSO", "METROPOLITANA", "LIBERTADOR GRAL. BERNARDO OHIGGINS", "MAULE", "ÑUBLE", "BIOBÍO", "ARAUCANÍA", "LOS RÍOS", "LOS LAGOS", "AISÉN", "MAGALLANES Y DE LA ANTÁRTICA CHILENA" }));
        cbRegion.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                cbRegionActionPerformed(evt);
            }
        });

        jLabel1.setFont(new java.awt.Font("Tahoma", 1, 12)); // NOI18N
        jLabel1.setText("CONVENIO");
        jLabel1.setToolTipText("");

        cbConvenio.setModel(new javax.swing.DefaultComboBoxModel(new String[] { "SELECCIONE CONVENIO PARA FILTRAR" }));
        cbConvenio.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                cbConvenioActionPerformed(evt);
            }
        });

        jLabel5.setFont(new java.awt.Font("Tahoma", 1, 12)); // NOI18N
        jLabel5.setText("REGION");
        jLabel5.setToolTipText("");

        cbConvenioId.setModel(new javax.swing.DefaultComboBoxModel(new String[] { "0" }));

        javax.swing.GroupLayout jPanel2Layout = new javax.swing.GroupLayout(jPanel2);
        jPanel2.setLayout(jPanel2Layout);
        jPanel2Layout.setHorizontalGroup(
            jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel2Layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(jPanel2Layout.createSequentialGroup()
                        .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(cbRegion, javax.swing.GroupLayout.PREFERRED_SIZE, 292, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(cbConvenio, javax.swing.GroupLayout.PREFERRED_SIZE, 513, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(jLabel5, javax.swing.GroupLayout.PREFERRED_SIZE, 84, javax.swing.GroupLayout.PREFERRED_SIZE))
                        .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
                    .addGroup(jPanel2Layout.createSequentialGroup()
                        .addComponent(jLabel1, javax.swing.GroupLayout.PREFERRED_SIZE, 84, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                        .addComponent(cbConvenioId, javax.swing.GroupLayout.PREFERRED_SIZE, 54, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addGap(91, 91, 91))))
        );
        jPanel2Layout.setVerticalGroup(
            jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, jPanel2Layout.createSequentialGroup()
                .addGap(7, 7, 7)
                .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel1)
                    .addComponent(cbConvenioId, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(cbConvenio, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(26, 26, 26)
                .addComponent(jLabel5)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(cbRegion, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addContainerGap(26, Short.MAX_VALUE))
        );

        jLabel12.setText("FILTRO:");

        txFiltro.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                txFiltroKeyPressed(evt);
            }
            public void keyReleased(java.awt.event.KeyEvent evt) {
                txFiltroKeyReleased(evt);
            }
            public void keyTyped(java.awt.event.KeyEvent evt) {
                txFiltroKeyTyped(evt);
            }
        });

        Grilla.setAutoCreateRowSorter(true);
        Grilla.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {
                {null, null, null, null, null, null, null, null, null, null, null, null},
                {null, null, null, null, null, null, null, null, null, null, null, null},
                {null, null, null, null, null, null, null, null, null, null, null, null},
                {null, null, null, null, null, null, null, null, null, null, null, null}
            },
            new String [] {
                "convenio", "Rut", "Proveedor", "Producto", "Marca", "Modelo", "Región", "Precio", "atributo1", "valor1", "atributo2", "valor2"
            }
        ) {
            boolean[] canEdit = new boolean [] {
                false, false, false, false, false, false, false, false, false, false, false, false
            };

            public boolean isCellEditable(int rowIndex, int columnIndex) {
                return canEdit [columnIndex];
            }
        });
        Grilla.setDragEnabled(true);
        Grilla.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                GrillaMouseClicked(evt);
            }
        });
        Grilla.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyTyped(java.awt.event.KeyEvent evt) {
                GrillaKeyTyped(evt);
            }
        });
        jScrollPane2.setViewportView(Grilla);
        if (Grilla.getColumnModel().getColumnCount() > 0) {
            Grilla.getColumnModel().getColumn(0).setMinWidth(0);
            Grilla.getColumnModel().getColumn(0).setPreferredWidth(0);
            Grilla.getColumnModel().getColumn(0).setMaxWidth(0);
            Grilla.getColumnModel().getColumn(1).setMinWidth(100);
            Grilla.getColumnModel().getColumn(1).setPreferredWidth(100);
            Grilla.getColumnModel().getColumn(1).setMaxWidth(100);
            Grilla.getColumnModel().getColumn(2).setPreferredWidth(400);
            Grilla.getColumnModel().getColumn(3).setPreferredWidth(250);
            Grilla.getColumnModel().getColumn(4).setPreferredWidth(80);
            Grilla.getColumnModel().getColumn(5).setPreferredWidth(120);
            Grilla.getColumnModel().getColumn(6).setPreferredWidth(50);
            Grilla.getColumnModel().getColumn(7).setPreferredWidth(50);
            Grilla.getColumnModel().getColumn(8).setMinWidth(0);
            Grilla.getColumnModel().getColumn(8).setPreferredWidth(0);
            Grilla.getColumnModel().getColumn(8).setMaxWidth(0);
            Grilla.getColumnModel().getColumn(9).setMinWidth(0);
            Grilla.getColumnModel().getColumn(9).setPreferredWidth(0);
            Grilla.getColumnModel().getColumn(9).setMaxWidth(0);
            Grilla.getColumnModel().getColumn(10).setMinWidth(0);
            Grilla.getColumnModel().getColumn(10).setPreferredWidth(0);
            Grilla.getColumnModel().getColumn(10).setMaxWidth(0);
            Grilla.getColumnModel().getColumn(11).setMinWidth(0);
            Grilla.getColumnModel().getColumn(11).setPreferredWidth(0);
            Grilla.getColumnModel().getColumn(11).setMaxWidth(0);
        }

        lbTotal.setText("Total Registros  :");
        lbTotal.setToolTipText("");

        btCargar.setText("Cargar");
        btCargar.setToolTipText("");
        btCargar.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btCargarActionPerformed(evt);
            }
        });

        jPanel1.setBorder(javax.swing.BorderFactory.createEtchedBorder());

        jLabel2.setText("Rut");

        txRut.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                txRutActionPerformed(evt);
            }
        });
        txRut.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                txRutKeyPressed(evt);
            }
            public void keyTyped(java.awt.event.KeyEvent evt) {
                txRutKeyTyped(evt);
            }
        });

        btIr.setText("Ir");
        btIr.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btIrActionPerformed(evt);
            }
        });

        jLabel3.setText("Nombre ");

        txNombre.setDisabledTextColor(new java.awt.Color(102, 102, 102));
        txNombre.setEnabled(false);

        javax.swing.GroupLayout jPanel1Layout = new javax.swing.GroupLayout(jPanel1);
        jPanel1.setLayout(jPanel1Layout);
        jPanel1Layout.setHorizontalGroup(
            jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, jPanel1Layout.createSequentialGroup()
                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(jPanel1Layout.createSequentialGroup()
                        .addContainerGap(29, Short.MAX_VALUE)
                        .addComponent(jLabel3)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED))
                    .addGroup(jPanel1Layout.createSequentialGroup()
                        .addGap(28, 28, 28)
                        .addComponent(jLabel2, javax.swing.GroupLayout.PREFERRED_SIZE, 29, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)))
                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(jPanel1Layout.createSequentialGroup()
                        .addComponent(txRut, javax.swing.GroupLayout.PREFERRED_SIZE, 103, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(btIr, javax.swing.GroupLayout.PREFERRED_SIZE, 41, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addComponent(txNombre, javax.swing.GroupLayout.PREFERRED_SIZE, 447, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addGap(30, 30, 30))
        );
        jPanel1Layout.setVerticalGroup(
            jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel1Layout.createSequentialGroup()
                .addGap(26, 26, 26)
                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(txRut, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(btIr)
                    .addComponent(jLabel2, javax.swing.GroupLayout.PREFERRED_SIZE, 23, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addGap(18, 18, 18)
                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel3)
                    .addComponent(txNombre, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );

        btAgrupar.setText("Agrupar");
        btAgrupar.setToolTipText("");
        btAgrupar.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btAgruparActionPerformed(evt);
            }
        });

        jLabel13.setText("MODELO :");
        jLabel13.setToolTipText("");

        txModelo.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                txModeloKeyPressed(evt);
            }
            public void keyReleased(java.awt.event.KeyEvent evt) {
                txModeloKeyReleased(evt);
            }
            public void keyTyped(java.awt.event.KeyEvent evt) {
                txModeloKeyTyped(evt);
            }
        });

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(this);
        this.setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addComponent(jScrollPane2, javax.swing.GroupLayout.DEFAULT_SIZE, 1535, Short.MAX_VALUE)
                .addContainerGap())
            .addGroup(layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(lbTotal, javax.swing.GroupLayout.PREFERRED_SIZE, 176, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addGroup(layout.createSequentialGroup()
                        .addComponent(jPanel2, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                        .addComponent(jPanel1, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(layout.createSequentialGroup()
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(jLabel13)
                            .addComponent(jLabel12))
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(txFiltro, javax.swing.GroupLayout.PREFERRED_SIZE, 325, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                                .addComponent(btAgrupar)
                                .addComponent(txModelo, javax.swing.GroupLayout.PREFERRED_SIZE, 202, javax.swing.GroupLayout.PREFERRED_SIZE))))
                    .addComponent(btCargar, javax.swing.GroupLayout.PREFERRED_SIZE, 123, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addGap(17, 17, 17)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                    .addComponent(jPanel2, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                    .addComponent(jPanel1, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                    .addGroup(layout.createSequentialGroup()
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                            .addComponent(txFiltro, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(jLabel12))
                        .addGap(18, 18, 18)
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                            .addComponent(jLabel13)
                            .addComponent(txModelo, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(btCargar, javax.swing.GroupLayout.Alignment.TRAILING, javax.swing.GroupLayout.PREFERRED_SIZE, 48, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(btAgrupar, javax.swing.GroupLayout.Alignment.TRAILING, javax.swing.GroupLayout.PREFERRED_SIZE, 35, javax.swing.GroupLayout.PREFERRED_SIZE))))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(lbTotal)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addComponent(jScrollPane2, javax.swing.GroupLayout.PREFERRED_SIZE, 515, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );
    }// </editor-fold>//GEN-END:initComponents
    
    
    private void txFiltroKeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_txFiltroKeyPressed


    }//GEN-LAST:event_txFiltroKeyPressed

    private void txFiltroKeyReleased(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_txFiltroKeyReleased

        int row = 0;

        String filtraRegion =EligeRegion();
        String filtro = txFiltro.getText().trim();
        
        String Rut = txRut.getText().trim();
        
        String filtromodelo = txModelo.getText().trim();
        
        
        DefaultTableModel TableModel = (DefaultTableModel) Grilla.getModel();
        TableRowSorter<TableModel> sorter = new TableRowSorter<TableModel>(TableModel);  
        ArrayList<RowFilter<TableModel,Object>> lista = new ArrayList<RowFilter<TableModel,Object>>();  
    
            
            
        if(filtraRegion.trim().length() > 0){
            
            lista.add(RowFilter.regexFilter(filtraRegion,6));
               
            
        }
        
        if (Rut.trim().length() > 0){
           
            String filtraRut = "^"+Rut+"$";   //Filtra la cadena exacta
            lista.add(RowFilter.regexFilter(filtraRut.trim(),1));
        
        }
        
        
        if(filtromodelo.trim().length() > 0){
            
            lista.add(RowFilter.regexFilter(filtromodelo,5));
               
            
        }
        
        
        lista.add(RowFilter.regexFilter(filtro));
        
        RowFilter filtroAnd = RowFilter.andFilter(lista); // and de todos los filtros
        sorter.setRowFilter(filtroAnd);
         
        
        Grilla.setRowSorter(sorter);
        
        
        row = Grilla.getRowCount();
        System.out.println(row);
       
        Suma_filtro(row); //76744548
        
          
    }//GEN-LAST:event_txFiltroKeyReleased

    
    
    private void txFiltroKeyTyped(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_txFiltroKeyTyped
        
        if (Character.isLowerCase(evt.getKeyChar())){
            
            evt.setKeyChar(Character.toUpperCase(evt.getKeyChar()));
        }
    }//GEN-LAST:event_txFiltroKeyTyped

    private void GrillaMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_GrillaMouseClicked
       

    }//GEN-LAST:event_GrillaMouseClicked

    private void GrillaKeyTyped(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_GrillaKeyTyped
        
        
    }//GEN-LAST:event_GrillaKeyTyped

    private void cbRegionActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cbRegionActionPerformed
       
        String filtraRegion =EligeRegion();
        String filtro = txFiltro.getText().trim();
        String Rut = txRut.getText().trim();
        String filtromodelo = txModelo.getText().trim();
        
        DefaultTableModel TableModel = (DefaultTableModel) Grilla.getModel();
        TableRowSorter<TableModel> sorter = new TableRowSorter<TableModel>(TableModel);  
        ArrayList<RowFilter<TableModel,Object>> lista = new ArrayList<RowFilter<TableModel,Object>>();  
        

        if (filtro.length() > 0){
        
            lista.add(RowFilter.regexFilter(filtro));
            
        }
        
        if (Rut.trim().length() > 0){
            
            String filtraRut = "^"+Rut+"$";   //Filtra la cadena exacta
            lista.add(RowFilter.regexFilter(filtraRut.trim(),1));
        
        }
        
        
        if (filtromodelo.length() > 0){
        
            lista.add(RowFilter.regexFilter(filtromodelo,5));
            
        }
        
        
           
        lista.add(RowFilter.regexFilter(filtraRegion,6));
        
        
        
        RowFilter filtroAnd = RowFilter.andFilter(lista); // and de todos los filtros
                                                       
        sorter.setRowFilter(filtroAnd);
        
        
        Grilla.setRowSorter(sorter);
       
        int row = Grilla.getRowCount();
       
        Suma_filtro(row); 
        

        
    }//GEN-LAST:event_cbRegionActionPerformed

    
    
    private String EligeRegion(){
    
         String filtraRegion ="";
        
        
        if (cbRegion.getSelectedIndex() == 1){
                  
                filtraRegion = "^I Región$";   //Filtra la cadena exacta
            
        
        }else if (cbRegion.getSelectedIndex() == 2){
        
                        
                filtraRegion = "^XV Región$";
            
            
        }else if (cbRegion.getSelectedIndex() == 3){
        
           
                        
                filtraRegion = "^II Región$";
            
            
        
        }else if (cbRegion.getSelectedIndex() == 4){
        
           
                        
                filtraRegion = "^III Región$";
            
            
        
        }else if (cbRegion.getSelectedIndex() == 5){
        
           
            
                filtraRegion = "^IV Región$";
            
           
        
        
        }else if (cbRegion.getSelectedIndex() == 6){
        
           
                        
                filtraRegion = "^V Región$";
            
            
        
        }else if (cbRegion.getSelectedIndex() == 7){
        
           
            
                filtraRegion = "^Región MP$";
                        
            
        
        }else if (cbRegion.getSelectedIndex() == 8){
        
            
                        
                filtraRegion = "^VI Región$";
            
            
        
        
        }else if (cbRegion.getSelectedIndex() == 9){
        
            
                       
                filtraRegion = "^VII Región$";
            
           
        
        }else if (cbRegion.getSelectedIndex() == 10){
        
            
                        
                filtraRegion = "^XVI Región$";
            
            
        
        
        }else if (cbRegion.getSelectedIndex() == 11){
        
           
            
                filtraRegion = "^VIII Región$";
            
            
        
            
        }else if (cbRegion.getSelectedIndex() == 12){
        
            
            
                filtraRegion = "^IX Región$";
            
            
            
            
        }else if (cbRegion.getSelectedIndex() == 13){
        
           
                        
                filtraRegion = "^XIV Región$";
            
            
        
        }else if (cbRegion.getSelectedIndex() == 14){
        
           
                        
                filtraRegion = "^X Región$";
            
           
            
        
        }else if (cbRegion.getSelectedIndex() == 15){
        
           
            
                filtraRegion = "^XI Región$";
            
           
        
        }else if (cbRegion.getSelectedIndex() == 16){
            
                filtraRegion = "^XII Región$";
            
        
        }
    
        return filtraRegion;
        
        
    }
    
    
    
    
    private void btCargarActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btCargarActionPerformed
                
        LEER();
        
    }//GEN-LAST:event_btCargarActionPerformed

    private void txRutKeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_txRutKeyPressed

       if(evt.getKeyCode() == KeyEvent.VK_ENTER){
            btIr.doClick();
        }
    }//GEN-LAST:event_txRutKeyPressed

    private void txRutKeyTyped(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_txRutKeyTyped

        if(txRut.getText().length() > 7) {  //0 a 7 = 8 caracteres máximo
            evt.consume();
        }
        
        if(evt.getKeyChar() < '0' || evt.getKeyChar() > '9' ){  //se permite solo números
            evt.consume();
        }

    }//GEN-LAST:event_txRutKeyTyped

    private void btIrActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btIrActionPerformed

        if(!txRut.getText().isEmpty()){
        
            busca_nombre(txRut.getText().trim());
            filtro_rut(txRut.getText().trim());
        
        }else{ 
           
            jdBuscarCliPrv BPC = new jdBuscarCliPrv(null, true);
            BPC.setLocationRelativeTo(null);
            BPC.setTitle("Buscar Proveedor");
            BPC.SetTipo(1);
            BPC.setVisible(true);
            
            txRut.setText(BPC.GetRut());
            txNombre.setText(BPC.GetNom());
             
            filtro_rut(txRut.getText().trim());
            
            
        }
    }//GEN-LAST:event_btIrActionPerformed

    private void txRutActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_txRutActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_txRutActionPerformed

    private void cbConvenioActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cbConvenioActionPerformed

        if (elige == 0){

            elige = 1;

        }else{

            cbConvenioId.setSelectedIndex(cbConvenio.getSelectedIndex());

            INICIAR();

        }
    }//GEN-LAST:event_cbConvenioActionPerformed

    private void btAgruparActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btAgruparActionPerformed
       
        jdEvalAgrupados Agrupados = new jdEvalAgrupados(null,true);
        Agrupados.setLocationRelativeTo(null);
        Agrupados.setTitle("Productos Agrupados");
        Agrupados.CargaAgrupados(Tabla, txFiltro.getText().trim());
        Agrupados.setVisible(true);
       
        
    }//GEN-LAST:event_btAgruparActionPerformed

    private void txModeloKeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_txModeloKeyPressed
        // TODO add your handling code here:
    }//GEN-LAST:event_txModeloKeyPressed

    private void txModeloKeyReleased(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_txModeloKeyReleased
        
        int row = 0;

        String filtraRegion =EligeRegion();
        String filtro = txFiltro.getText().trim();
        
        String Rut = txRut.getText().trim();
        
        String filtromodelo = txModelo.getText().trim();
        
        
        DefaultTableModel TableModel = (DefaultTableModel) Grilla.getModel();
        TableRowSorter<TableModel> sorter = new TableRowSorter<TableModel>(TableModel);  
        ArrayList<RowFilter<TableModel,Object>> lista = new ArrayList<RowFilter<TableModel,Object>>();  
    
            
            
        if(filtraRegion.trim().length() > 0){
            
            lista.add(RowFilter.regexFilter(filtraRegion,6));
               
            
        }
        
        if (Rut.trim().length() > 0){
           
            String filtraRut = "^"+Rut+"$";   //Filtra la cadena exacta
            lista.add(RowFilter.regexFilter(filtraRut.trim(),1));
        
        }
        
        
        if (filtro.trim().length() > 0){
           
            lista.add(RowFilter.regexFilter(filtro));
        
        }
        
        
        
        lista.add(RowFilter.regexFilter(filtromodelo,5));
        
        RowFilter filtroAnd = RowFilter.andFilter(lista); // and de todos los filtros
        sorter.setRowFilter(filtroAnd);
         
        
        Grilla.setRowSorter(sorter);
        
        
        row = Grilla.getRowCount();
        System.out.println(row);
       
        Suma_filtro(row); //76744548
        
        
        
    }//GEN-LAST:event_txModeloKeyReleased

    private void txModeloKeyTyped(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_txModeloKeyTyped
        
        if (Character.isLowerCase(evt.getKeyChar())){
            
            evt.setKeyChar(Character.toUpperCase(evt.getKeyChar()));
        }
        
    }//GEN-LAST:event_txModeloKeyTyped
    
    
    
    private void busca_nombre(String Rut){
    
        ExeSql Sql = new ExeSql();
        ResultSet Rs;
        
    
        try {
            
            String Query =  "select nombre from proveedor where rut =" + Rut.trim();
            
            Rs = Sql.Select(Query);
            
            if (Sql.GetRowCount() > 0){
            
                Rs.next();
                
                txNombre.setText(Rs.getString("nombre").toString().trim());
            }
            
        } catch (SQLException ex) {
            Logger.getLogger(pfEvaluacionesConvenios.class.getName()).log(Level.SEVERE, null, ex);
        }
    
    
    }
    
    
    private void filtro_rut(String Rut){
    
        String filtraRegion =EligeRegion();
        String filtraRut = "^"+Rut+"$";   //Filtra la cadena exacta
        
        String filtro = txFiltro.getText().trim();
        String filtromodelo = txModelo.getText().trim();
        
        
        DefaultTableModel TableModel = (DefaultTableModel) Grilla.getModel();
        TableRowSorter<TableModel> sorter = new TableRowSorter<TableModel>(TableModel);  
        ArrayList<RowFilter<TableModel,Object>> lista = new ArrayList<RowFilter<TableModel,Object>>();  
        
        
        if (filtraRut.trim().length() > 0){
            
            if(filtraRegion.trim().length() > 0){
            
                lista.add(RowFilter.regexFilter(filtraRegion,6));
            
            }
            
            
            if (filtro.length() > 0){
        
                lista.add(RowFilter.regexFilter(filtro));
            
            }
        
            if (filtromodelo.length() > 0){
        
                lista.add(RowFilter.regexFilter(filtromodelo,5));
            
            }
            
            
            lista.add(RowFilter.regexFilter(filtraRut.trim(),1));
            
            RowFilter filtroAnd = RowFilter.andFilter(lista); // and de todos los filtros
                                                        
            sorter.setRowFilter(filtroAnd);
            
            Grilla.setRowSorter(sorter);
       
       
            int row = Grilla.getRowCount();
       
            Suma_filtro(row); 
            
            
            
        }
        
    }
    
    
    
    
    private void INICIAR () {
        
        Tabla = "";
        
        if (cbConvenioId.getSelectedItem().equals("2") ){  //FERRETERIA
                
                    Tabla = "evaluacion_ferreteria";
                   
                    
        }else if (cbConvenioId.getSelectedItem().equals("3") ){  //ASEO
                
                    Tabla = "evaluacion_aseo";
                   
                    
        }else if (cbConvenioId.getSelectedItem().equals("4") ){  //ALIMENTOS
                
                    Tabla = "evaluacion_alimentos";
                  
                    
        }else if (cbConvenioId.getSelectedItem().equals("11") ){  //EMERGENCIA
                
                    Tabla = "evaluacion_emergencia";
                   
                    
        }else if (cbConvenioId.getSelectedItem().equals("7") ){  //ESCRITORIO
                
                    Tabla = "evaluacion_escritorio";
                  
                    
        }
        
        
        
        
        
        if (!cbConvenioId.getSelectedItem().equals("0") ){ 
        
        
            ExeSql Sql = new ExeSql();
            ResultSet Rs;
        
        
            DefaultTableModel model = (DefaultTableModel) Grilla.getModel(); 

            while(model.getRowCount()>0)
                model.removeRow(0);
        
            int cont = 0;
        
            try {
            
                Rs = Sql.Select("select * from "+Tabla+" \n"+
                                "where region IN ('IV Región','V Región','VI Región','VII Región','VIII Región',\n"+
                                "'IX Región','X Región','Región MP','XIV Región','XVI Región')  ");
            
                if (Sql.GetRowCount() > 0){
             
                    while(Rs.next()){
                    
                        model.addRow(new Object[]{Rs.getInt("convenio"),
                                                  Rs.getInt("rut"),
                                                  Rs.getString("proveedor"),
                                                  Rs.getString("producto"),
                                                  Rs.getString("marca"),
                                                  Rs.getString("modelo"),
                                                  Rs.getString("region"),
                                                  "$ "+fmMain.FormatoNumeroSinDecimal(Rs.getDouble("precio")),
                                                  Rs.getString("atributo1"),
                                                  Rs.getString("valor_atributo1"),
                                                  Rs.getString("atributo2"),
                                                  Rs.getString("valor_atributo2")
                                               
                        });
                
                
                        cont++;
                
                    }
                
                
                }
            
            
                DefaultTableModel TableModel = (DefaultTableModel) Grilla.getModel();
                TableRowSorter<TableModel> sorter = new TableRowSorter<TableModel>(TableModel);  
        
                sorter.setRowFilter(RowFilter.regexFilter(""));  
                Grilla.setRowSorter(sorter);
            
                lbTotal.setText("Total Cotizaciones : "+cont); 
                
                if(cont > 0){
                
                    btAgrupar.setEnabled(true);
                
                }else{
                
                    btAgrupar.setEnabled(false);
                
                }
                
            
                Grilla.setDefaultRenderer(Object.class, new Elrender());
            
            
        
            } catch (SQLException ex) {
                Logger.getLogger(pfEvaluacionesConvenios.class.getName()).log(Level.SEVERE, null, ex);
            }
        
        
        } 
        
    
    }
    
    
    
    private void LEER () {
        
        int filtrado = 0;
        
        
        String Rut = txRut.getText().trim();
        String filtraRegion = EligeRegion();
        
        String filtro = txFiltro.getText().trim();
        String filtromodelo = txModelo.getText().trim();
        
        
        DefaultTableModel TableModel = (DefaultTableModel) Grilla.getModel();
        TableRowSorter<TableModel> sorter = new TableRowSorter<TableModel>(TableModel);
        ArrayList<RowFilter<TableModel,Object>> lista = new ArrayList<RowFilter<TableModel,Object>>();  
       
        
        if (Rut.trim().length() > 0){
            
            filtrado = 1;
            
            String filtraRut = "^"+Rut+"$";   //Filtra la cadena exacta
            lista.add(RowFilter.regexFilter(filtraRut.trim(),1));
        
        }
        
        
        if(filtraRegion.trim().length() > 0){
            
            
            filtrado = 1;
            lista.add(RowFilter.regexFilter(filtraRegion.trim(),6));
            
            
        }
       
        
        if (filtro.length() > 0){
            
            filtrado = 1;
            lista.add(RowFilter.regexFilter(filtro));
            
        }
        
        
        if (filtromodelo.length() > 0){
        
            lista.add(RowFilter.regexFilter(filtromodelo,5));
            
        }
        
        
        System.out.println("filtrado ES "+filtrado);
        
        
        if (filtrado == 0){
                                                       
            lista.add(RowFilter.regexFilter(""));
         
        } 
         
        RowFilter filtroAnd = RowFilter.andFilter(lista); // and de todos los filtros
        sorter.setRowFilter(filtroAnd);
        
        Grilla.setRowSorter(sorter);
       
        int row = Grilla.getRowCount();
       
        Suma_filtro(row); 
        
       
    }
    
    
    
    private void Suma_filtro(int fila){
        
        int cont = 0;
        
        for (int i = 0; i < fila; i++) {
        
            cont++;
        
        }
        
        lbTotal.setText("Total Registros  : "+cont); 
        
        if(cont > 0){
                
           btAgrupar.setEnabled(true);
                
        }else{
                
            btAgrupar.setEnabled(false);
                
        }
        
        
       
    }
    
    
     
     private void CargaConvenios(){
        
        ResultSet Rs;
        ExeSql Sql = new ExeSql();
        try{
            
            
            cbConvenio.setModel(new javax.swing.DefaultComboBoxModel(new String[] {}));
            cbConvenioId.setModel(new javax.swing.DefaultComboBoxModel(new String[] {}));
            
            cbConvenio.addItem("SELECCIONE CONVENIO PARA FILTRAR");
            cbConvenioId.addItem("0");
            
            Rs = Sql.Select("select codigo,convenio\n" +
                            "from par_convenio where codigo in ('2','3','4','11','7') order by codigo");
                    
            while(Rs.next()){
            
                cbConvenio.addItem(Rs.getString("convenio"));
                cbConvenioId.addItem(String.valueOf(Rs.getInt("codigo")));
            }
        
            cbConvenio.setSelectedIndex(0);
        }catch(Exception e){
            
            fmMain.Mensaje("Error al cargar los convenios "+e);
        
        }finally{
            Sql.Close(); 
        }
    }
     
     
     
    
    class Elrender extends DefaultTableCellRenderer {
         
        @Override
        public Component getTableCellRendererComponent(JTable tabla, Object valor, boolean isSelected, boolean hasFocus, int fila, int columna) {
            
            super.getTableCellRendererComponent(tabla,valor,isSelected, hasFocus, fila, columna);
            
            
            if( tabla.getValueAt(fila,10).toString().trim().equals("0") ){
            
            
                 if(isSelected==true){
                
                    this.setForeground(Color.white);
                    this.setBackground(Color.red);    
                    this.setFont(new Font("Tahoma", Font.BOLD, 11));
                 
                 }else{
                  
                    this.setForeground(Color.red); 
                    this.setBackground(Color.white);   
                    
                    this.setFont(new Font("Tahoma", Font.BOLD, 11));
                 }
            
            }else { 
                
                
                 if(isSelected==true){
                    
                    this.setForeground(Color.white);
                    this.setBackground(Color.blue);   
                     this.setFont(new Font("Tahoma", Font.BOLD, 11));
                    
                
                }else {
                
                    this.setForeground(Color.black);    
                    this.setBackground(Color.white);   
                   
                }
            
            }            
              
            
            return this;
        }
    } 
    
    
    
    
    
    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JTable Grilla;
    private javax.swing.JButton btAgrupar;
    private javax.swing.JButton btCargar;
    public static javax.swing.JButton btIr;
    private javax.swing.JComboBox<String> cbConvenio;
    private javax.swing.JComboBox cbConvenioId;
    private javax.swing.JComboBox cbRegion;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JLabel jLabel12;
    private javax.swing.JLabel jLabel13;
    private javax.swing.JLabel jLabel2;
    private javax.swing.JLabel jLabel3;
    private javax.swing.JLabel jLabel5;
    private javax.swing.JPanel jPanel1;
    private javax.swing.JPanel jPanel2;
    private javax.swing.JScrollPane jScrollPane2;
    private javax.swing.JLabel lbTotal;
    private javax.swing.JTextField txFiltro;
    private javax.swing.JTextField txModelo;
    private javax.swing.JTextField txNombre;
    public static javax.swing.JTextField txRut;
    // End of variables declaration//GEN-END:variables
}
