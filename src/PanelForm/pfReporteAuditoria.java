/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package PanelForm;

import Conexion.ExeSql;
import Dialogos.jdBuscarCliPrv;
import Dialogos.jdOC_PendientesFac;
import static Dialogos.jdOC_PendientesFac.pano;
import static Dialogos.jdOC_PendientesFac.pmes;
import static Dialogos.jdOC_PendientesFac.pmes_oc;
import Dialogos.jdPagadoPrvCli;
import Dialogos.jdPagarPrv;
import Formularios.fmMain;
import static Formularios.fmMain.pnPestanas;
import Utilidades.Exporter;
import Utilidades.PanelTab;
import java.awt.event.KeyEvent;
import java.io.File;
import java.math.BigInteger;
import java.sql.ResultSet;
import java.text.SimpleDateFormat;
import java.util.ArrayList;
import java.util.List;
import javax.swing.JFileChooser;
import javax.swing.JTable;
import javax.swing.SwingConstants;
import javax.swing.filechooser.FileNameExtensionFilter;
import javax.swing.table.DefaultTableCellRenderer;
import javax.swing.table.DefaultTableModel;
import java.util.*;
import javax.swing.DefaultComboBoxModel;
import Utilidades.ComboCodigos;
import java.io.IOException;
import java.util.logging.Level;
import java.util.logging.Logger;


/**
 *
 * @author David Alcaman
 */
public class pfReporteAuditoria extends javax.swing.JPanel {
    DefaultTableCellRenderer rightRenderer = new DefaultTableCellRenderer();
    /**
     * Creates new form pfReportePagosPrv
     */
    int id_usuario, id_tabla, id_cambio;
    public pfReporteAuditoria() {
        initComponents();
        CargaTabla();
      
        
        
//         Calendar fecha = new GregorianCalendar();
//        //Obtenemos el valor del año, mes, día,
//        //hora, minuto y segundo del sistema
//        //usando el método get y el parámetro correspondiente
//        int año = fecha.get(Calendar.YEAR);
//        int mes = fecha.get(Calendar.MONTH);
//       /* int dia = fecha.get(Calendar.DAY_OF_MONTH);
//        int hora = fecha.get(Calendar.HOUR_OF_DAY);
//        int minuto = fecha.get(Calendar.MINUTE);
//        int segundo = fecha.get(Calendar.SECOND);*/
//        
//        String anox ="x";
//        String mesx ="x";
//        
//        anox = String.valueOf(año);
//        mesx = String.valueOf(mes+1);


      //  btExcel.setVisible(true);
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        jXDatePicker1 = new org.jdesktop.swingx.JXDatePicker();
        buttonGroup1 = new javax.swing.ButtonGroup();
        jPanel13 = new javax.swing.JPanel();
        CboUsuario4 = new javax.swing.JComboBox<String>();
        lblVendedor12 = new javax.swing.JLabel();
        lblVendedor13 = new javax.swing.JLabel();
        CboTabla4 = new javax.swing.JComboBox<String>();
        lblVendedor14 = new javax.swing.JLabel();
        CboCambio4 = new javax.swing.JComboBox<String>();
        jPanel14 = new javax.swing.JPanel();
        dtDesde4 = new org.jdesktop.swingx.JXDatePicker();
        dtHasta4 = new org.jdesktop.swingx.JXDatePicker();
        jLabel9 = new javax.swing.JLabel();
        rbDesde4 = new javax.swing.JRadioButton();
        rbPeriodoTodos4 = new javax.swing.JRadioButton();
        jPanel15 = new javax.swing.JPanel();
        jScrollPane5 = new javax.swing.JScrollPane();
        Grilla4 = new javax.swing.JTable();
        jLabel10 = new javax.swing.JLabel();
        lblReg4 = new javax.swing.JLabel();
        btBuscar4 = new javax.swing.JButton();
        btExcel4 = new javax.swing.JButton();
        jPanel3 = new javax.swing.JPanel();
        CboUsuario = new javax.swing.JComboBox<String>();
        lblVendedor = new javax.swing.JLabel();
        lblVendedor1 = new javax.swing.JLabel();
        CboTabla = new javax.swing.JComboBox<String>();
        lblVendedor2 = new javax.swing.JLabel();
        CboCambio = new javax.swing.JComboBox<String>();
        jPanel1 = new javax.swing.JPanel();
        dtDesde = new org.jdesktop.swingx.JXDatePicker();
        dtHasta = new org.jdesktop.swingx.JXDatePicker();
        jLabel2 = new javax.swing.JLabel();
        rbDesde = new javax.swing.JRadioButton();
        rbPeriodoTodos = new javax.swing.JRadioButton();
        jPanel4 = new javax.swing.JPanel();
        jScrollPane1 = new javax.swing.JScrollPane();
        Grilla = new javax.swing.JTable();
        jLabel1 = new javax.swing.JLabel();
        lblReg = new javax.swing.JLabel();
        btBuscar = new javax.swing.JButton();
        btExcel = new javax.swing.JButton();

        jPanel13.setBorder(javax.swing.BorderFactory.createTitledBorder(javax.swing.BorderFactory.createEtchedBorder(), "PROVEEDOR", javax.swing.border.TitledBorder.DEFAULT_JUSTIFICATION, javax.swing.border.TitledBorder.DEFAULT_POSITION, new java.awt.Font("Tahoma", 1, 11))); // NOI18N

        CboUsuario4.setModel(new javax.swing.DefaultComboBoxModel(new String[] { "<Todos>" }));
        CboUsuario4.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                CboUsuario4ActionPerformed(evt);
            }
        });

        lblVendedor12.setText("USUARIO");

        lblVendedor13.setText("TABLA");

        CboTabla4.setModel(new javax.swing.DefaultComboBoxModel(new String[] { "<Todos>" }));
        CboTabla4.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                CboTabla4ActionPerformed(evt);
            }
        });

        lblVendedor14.setText("TIPO DE CAMBIO");

        CboCambio4.setModel(new javax.swing.DefaultComboBoxModel(new String[] { "<Todos>" }));
        CboCambio4.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                CboCambio4ActionPerformed(evt);
            }
        });

        jPanel14.setBorder(javax.swing.BorderFactory.createTitledBorder(javax.swing.BorderFactory.createEtchedBorder(), "PERIODO VENCIMIENTO", javax.swing.border.TitledBorder.DEFAULT_JUSTIFICATION, javax.swing.border.TitledBorder.DEFAULT_POSITION, new java.awt.Font("Tahoma", 1, 11))); // NOI18N

        dtDesde4.setEnabled(false);

        dtHasta4.setEnabled(false);
        dtHasta4.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                dtHasta4ActionPerformed(evt);
            }
        });

        jLabel9.setText("Hasta");

        buttonGroup1.add(rbDesde4);
        rbDesde4.setText("Desde");
        rbDesde4.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                rbDesde4ActionPerformed(evt);
            }
        });

        buttonGroup1.add(rbPeriodoTodos4);
        rbPeriodoTodos4.setText("Todos");
        rbPeriodoTodos4.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                rbPeriodoTodos4ActionPerformed(evt);
            }
        });

        javax.swing.GroupLayout jPanel14Layout = new javax.swing.GroupLayout(jPanel14);
        jPanel14.setLayout(jPanel14Layout);
        jPanel14Layout.setHorizontalGroup(
            jPanel14Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel14Layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(jPanel14Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(jPanel14Layout.createSequentialGroup()
                        .addComponent(rbDesde4)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(dtDesde4, javax.swing.GroupLayout.PREFERRED_SIZE, 104, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(jLabel9)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(dtHasta4, javax.swing.GroupLayout.PREFERRED_SIZE, 104, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addComponent(rbPeriodoTodos4))
                .addContainerGap(76, Short.MAX_VALUE))
        );
        jPanel14Layout.setVerticalGroup(
            jPanel14Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel14Layout.createSequentialGroup()
                .addGap(11, 11, 11)
                .addGroup(jPanel14Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(dtHasta4, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addGroup(jPanel14Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                        .addComponent(dtDesde4, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addComponent(jLabel9)
                        .addComponent(rbDesde4)))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addComponent(rbPeriodoTodos4)
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );

        jPanel15.setBorder(javax.swing.BorderFactory.createEtchedBorder());

        Grilla4.setAutoCreateRowSorter(true);
        Grilla4.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {
                {null, null, null, null, null, null, null, null, null, null},
                {null, null, null, null, null, null, null, null, null, null},
                {null, null, null, null, null, null, null, null, null, null},
                {null, null, null, null, null, null, null, null, null, null}
            },
            new String [] {
                "Usuario", "Fecha", "Tipo Cambio", "Tabla", "CAMPO1", "CAMPO2", "CAMPO3", "CAMPO4", "CAMPO5", "CAMPO6"
            }
        ) {
            boolean[] canEdit = new boolean [] {
                false, false, false, false, false, false, false, false, false, false
            };

            public boolean isCellEditable(int rowIndex, int columnIndex) {
                return canEdit [columnIndex];
            }
        });
        Grilla4.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                Grilla4MouseClicked(evt);
            }
        });
        jScrollPane5.setViewportView(Grilla4);
        if (Grilla4.getColumnModel().getColumnCount() > 0) {
            Grilla4.getColumnModel().getColumn(0).setPreferredWidth(150);
            Grilla4.getColumnModel().getColumn(4).setResizable(false);
            Grilla4.getColumnModel().getColumn(5).setResizable(false);
            Grilla4.getColumnModel().getColumn(5).setPreferredWidth(75);
            Grilla4.getColumnModel().getColumn(6).setResizable(false);
            Grilla4.getColumnModel().getColumn(7).setResizable(false);
            Grilla4.getColumnModel().getColumn(7).setPreferredWidth(63);
            Grilla4.getColumnModel().getColumn(8).setResizable(false);
            Grilla4.getColumnModel().getColumn(8).setPreferredWidth(40);
            Grilla4.getColumnModel().getColumn(9).setResizable(false);
        }

        jLabel10.setFont(new java.awt.Font("Tahoma", 1, 14)); // NOI18N
        jLabel10.setText("Registros");

        lblReg4.setFont(new java.awt.Font("Tahoma", 1, 14)); // NOI18N
        lblReg4.setText("0");

        javax.swing.GroupLayout jPanel15Layout = new javax.swing.GroupLayout(jPanel15);
        jPanel15.setLayout(jPanel15Layout);
        jPanel15Layout.setHorizontalGroup(
            jPanel15Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel15Layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(jPanel15Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(jScrollPane5, javax.swing.GroupLayout.DEFAULT_SIZE, 968, Short.MAX_VALUE)
                    .addGroup(jPanel15Layout.createSequentialGroup()
                        .addComponent(jLabel10)
                        .addGap(33, 33, 33)
                        .addComponent(lblReg4, javax.swing.GroupLayout.PREFERRED_SIZE, 43, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addGap(0, 0, Short.MAX_VALUE)))
                .addContainerGap())
        );
        jPanel15Layout.setVerticalGroup(
            jPanel15Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel15Layout.createSequentialGroup()
                .addGroup(jPanel15Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel10)
                    .addComponent(lblReg4))
                .addGap(18, 18, 18)
                .addComponent(jScrollPane5, javax.swing.GroupLayout.PREFERRED_SIZE, 317, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );

        btBuscar4.setIcon(new javax.swing.ImageIcon(getClass().getResource("/Iconos16/search16.png"))); // NOI18N
        btBuscar4.setText("Buscar");
        btBuscar4.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btBuscar4ActionPerformed(evt);
            }
        });

        btExcel4.setIcon(new javax.swing.ImageIcon(getClass().getResource("/Iconos22/Order22.png"))); // NOI18N
        btExcel4.setText("Excel");
        btExcel4.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btExcel4ActionPerformed(evt);
            }
        });

        javax.swing.GroupLayout jPanel13Layout = new javax.swing.GroupLayout(jPanel13);
        jPanel13.setLayout(jPanel13Layout);
        jPanel13Layout.setHorizontalGroup(
            jPanel13Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel13Layout.createSequentialGroup()
                .addComponent(jPanel15, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(0, 10, Short.MAX_VALUE))
            .addGroup(jPanel13Layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(jPanel13Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(jPanel14, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addGroup(jPanel13Layout.createSequentialGroup()
                        .addGroup(jPanel13Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(lblVendedor12)
                            .addComponent(CboUsuario4, javax.swing.GroupLayout.PREFERRED_SIZE, 228, javax.swing.GroupLayout.PREFERRED_SIZE))
                        .addGap(18, 18, 18)
                        .addGroup(jPanel13Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(lblVendedor13)
                            .addComponent(CboTabla4, javax.swing.GroupLayout.PREFERRED_SIZE, 241, javax.swing.GroupLayout.PREFERRED_SIZE))
                        .addGap(30, 30, 30)
                        .addGroup(jPanel13Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(lblVendedor14)
                            .addComponent(CboCambio4, javax.swing.GroupLayout.PREFERRED_SIZE, 241, javax.swing.GroupLayout.PREFERRED_SIZE))))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addGroup(jPanel13Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(btExcel4, javax.swing.GroupLayout.PREFERRED_SIZE, 85, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(btBuscar4))
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );
        jPanel13Layout.setVerticalGroup(
            jPanel13Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel13Layout.createSequentialGroup()
                .addGroup(jPanel13Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(jPanel13Layout.createSequentialGroup()
                        .addGroup(jPanel13Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                            .addComponent(lblVendedor13)
                            .addComponent(lblVendedor12))
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addGroup(jPanel13Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                            .addComponent(CboTabla4, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(CboUsuario4, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(CboCambio4, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                        .addGap(18, 18, 18)
                        .addComponent(jPanel14, javax.swing.GroupLayout.PREFERRED_SIZE, 87, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addGroup(jPanel13Layout.createSequentialGroup()
                        .addComponent(lblVendedor14)
                        .addGap(11, 11, 11)
                        .addComponent(btBuscar4, javax.swing.GroupLayout.PREFERRED_SIZE, 34, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addGap(18, 18, 18)
                        .addComponent(btExcel4, javax.swing.GroupLayout.PREFERRED_SIZE, 32, javax.swing.GroupLayout.PREFERRED_SIZE)))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                .addComponent(jPanel15, javax.swing.GroupLayout.PREFERRED_SIZE, 362, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(146, 146, 146))
        );

        jPanel3.setBorder(javax.swing.BorderFactory.createTitledBorder(javax.swing.BorderFactory.createEtchedBorder(), "PROVEEDOR", javax.swing.border.TitledBorder.DEFAULT_JUSTIFICATION, javax.swing.border.TitledBorder.DEFAULT_POSITION, new java.awt.Font("Tahoma", 1, 11))); // NOI18N
        jPanel3.setLayout(new org.netbeans.lib.awtextra.AbsoluteLayout());

        CboUsuario.setModel(new javax.swing.DefaultComboBoxModel(new String[] { "<Todos>" }));
        CboUsuario.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                CboUsuarioActionPerformed(evt);
            }
        });
        jPanel3.add(CboUsuario, new org.netbeans.lib.awtextra.AbsoluteConstraints(584, 47, 228, -1));

        lblVendedor.setText("USUARIO");
        jPanel3.add(lblVendedor, new org.netbeans.lib.awtextra.AbsoluteConstraints(584, 27, -1, -1));

        lblVendedor1.setText("TABLA");
        jPanel3.add(lblVendedor1, new org.netbeans.lib.awtextra.AbsoluteConstraints(16, 27, -1, -1));

        CboTabla.setModel(new javax.swing.DefaultComboBoxModel(new String[] { "<Todos>" }));
        CboTabla.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                CboTablaActionPerformed(evt);
            }
        });
        jPanel3.add(CboTabla, new org.netbeans.lib.awtextra.AbsoluteConstraints(16, 47, 241, -1));

        lblVendedor2.setText("TIPO DE CAMBIO");
        jPanel3.add(lblVendedor2, new org.netbeans.lib.awtextra.AbsoluteConstraints(297, 27, -1, -1));

        CboCambio.setModel(new javax.swing.DefaultComboBoxModel(new String[] { "<Todos>" }));
        CboCambio.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                CboCambioActionPerformed(evt);
            }
        });
        jPanel3.add(CboCambio, new org.netbeans.lib.awtextra.AbsoluteConstraints(297, 47, 241, -1));

        jPanel1.setBorder(javax.swing.BorderFactory.createTitledBorder(javax.swing.BorderFactory.createEtchedBorder(), "PERIODO VENCIMIENTO", javax.swing.border.TitledBorder.DEFAULT_JUSTIFICATION, javax.swing.border.TitledBorder.DEFAULT_POSITION, new java.awt.Font("Tahoma", 1, 11))); // NOI18N

        dtDesde.setEnabled(false);

        dtHasta.setEnabled(false);
        dtHasta.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                dtHastaActionPerformed(evt);
            }
        });

        jLabel2.setText("Hasta");

        buttonGroup1.add(rbDesde);
        rbDesde.setText("Desde");
        rbDesde.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                rbDesdeActionPerformed(evt);
            }
        });

        buttonGroup1.add(rbPeriodoTodos);
        rbPeriodoTodos.setText("Todos");
        rbPeriodoTodos.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                rbPeriodoTodosActionPerformed(evt);
            }
        });

        javax.swing.GroupLayout jPanel1Layout = new javax.swing.GroupLayout(jPanel1);
        jPanel1.setLayout(jPanel1Layout);
        jPanel1Layout.setHorizontalGroup(
            jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel1Layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(jPanel1Layout.createSequentialGroup()
                        .addComponent(rbDesde)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(dtDesde, javax.swing.GroupLayout.PREFERRED_SIZE, 104, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(jLabel2)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(dtHasta, javax.swing.GroupLayout.PREFERRED_SIZE, 104, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addComponent(rbPeriodoTodos))
                .addContainerGap(76, Short.MAX_VALUE))
        );
        jPanel1Layout.setVerticalGroup(
            jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel1Layout.createSequentialGroup()
                .addGap(11, 11, 11)
                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(dtHasta, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                        .addComponent(dtDesde, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addComponent(jLabel2)
                        .addComponent(rbDesde)))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addComponent(rbPeriodoTodos)
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );

        jPanel3.add(jPanel1, new org.netbeans.lib.awtextra.AbsoluteConstraints(16, 85, -1, -1));

        jPanel4.setBorder(javax.swing.BorderFactory.createEtchedBorder());

        Grilla.setAutoCreateRowSorter(true);
        Grilla.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {
                {null, null, null, null, null, null, null, null, null, null},
                {null, null, null, null, null, null, null, null, null, null},
                {null, null, null, null, null, null, null, null, null, null},
                {null, null, null, null, null, null, null, null, null, null}
            },
            new String [] {
                "Usuario", "Fecha", "Tipo Cambio", "Tabla", "CAMPO1", "CAMPO2", "CAMPO3", "CAMPO4", "CAMPO5", "CAMPO6"
            }
        ) {
            boolean[] canEdit = new boolean [] {
                false, false, false, false, false, false, false, false, false, false
            };

            public boolean isCellEditable(int rowIndex, int columnIndex) {
                return canEdit [columnIndex];
            }
        });
        Grilla.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                GrillaMouseClicked(evt);
            }
        });
        jScrollPane1.setViewportView(Grilla);
        if (Grilla.getColumnModel().getColumnCount() > 0) {
            Grilla.getColumnModel().getColumn(0).setPreferredWidth(150);
        }

        jLabel1.setFont(new java.awt.Font("Tahoma", 1, 14)); // NOI18N
        jLabel1.setText("Registros");

        lblReg.setFont(new java.awt.Font("Tahoma", 1, 14)); // NOI18N
        lblReg.setText("0");

        javax.swing.GroupLayout jPanel4Layout = new javax.swing.GroupLayout(jPanel4);
        jPanel4.setLayout(jPanel4Layout);
        jPanel4Layout.setHorizontalGroup(
            jPanel4Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel4Layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(jPanel4Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(jScrollPane1, javax.swing.GroupLayout.DEFAULT_SIZE, 1439, Short.MAX_VALUE)
                    .addGroup(jPanel4Layout.createSequentialGroup()
                        .addComponent(jLabel1)
                        .addGap(33, 33, 33)
                        .addComponent(lblReg, javax.swing.GroupLayout.PREFERRED_SIZE, 43, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addGap(0, 0, Short.MAX_VALUE)))
                .addContainerGap())
        );
        jPanel4Layout.setVerticalGroup(
            jPanel4Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel4Layout.createSequentialGroup()
                .addGroup(jPanel4Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel1)
                    .addComponent(lblReg))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addComponent(jScrollPane1, javax.swing.GroupLayout.PREFERRED_SIZE, 503, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );

        jPanel3.add(jPanel4, new org.netbeans.lib.awtextra.AbsoluteConstraints(16, 203, -1, 540));

        btBuscar.setIcon(new javax.swing.ImageIcon(getClass().getResource("/Iconos16/search16.png"))); // NOI18N
        btBuscar.setText("Buscar");
        btBuscar.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btBuscarActionPerformed(evt);
            }
        });
        jPanel3.add(btBuscar, new org.netbeans.lib.awtextra.AbsoluteConstraints(913, 33, -1, 34));

        btExcel.setIcon(new javax.swing.ImageIcon(getClass().getResource("/Iconos22/Order22.png"))); // NOI18N
        btExcel.setText("Excel");
        btExcel.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btExcelActionPerformed(evt);
            }
        });
        jPanel3.add(btExcel, new org.netbeans.lib.awtextra.AbsoluteConstraints(913, 85, 85, 32));

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(this);
        this.setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(jPanel3, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addContainerGap(52, Short.MAX_VALUE))
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addComponent(jPanel3, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(0, 8, Short.MAX_VALUE))
        );

        jPanel3.getAccessibleContext().setAccessibleName("AUDITORIA");
        jPanel3.getAccessibleContext().setAccessibleDescription("AUDITORIA");
    }// </editor-fold>//GEN-END:initComponents

    
    
    private void CargaUsuario(){
        DefaultComboBoxModel value;
        ExeSql Sql = new ExeSql();
        ResultSet Rs;
        String Query="";
        CboUsuario.removeAllItems();
        
//        CboProveedor.addItem("<Todos>");  
//        CboProveedor.setSelectedIndex(0);
        value =new DefaultComboBoxModel();
       
        
        
        try {
            Query="select max(id) id, usuario from auditoria_bd\n" +
                   " where tabla  = '" + CboTabla.getSelectedItem().toString() + "'" +
                    " and tipo_cambio = '" + CboCambio.getSelectedItem().toString() + "'" + 
                    " group by usuario \n" +
                    " order by usuario asc;";
            Rs = Sql.Select(Query);
            if(Sql.GetRowCount()==0) return;
           value.addElement(new ComboCodigos("Seleccione",0));     
           while(Rs.next()){
            value.addElement(new ComboCodigos(Rs.getString("usuario").trim(),Rs.getInt("id")));
            System.out.println(Rs.getString("usuario").trim());
           } 
           CboUsuario.setModel(value);
           CboUsuario.setSelectedIndex(0);

           
           
        } catch (Exception e) {
            System.out.println(e);
        }
        finally{
            Sql.Close();
        }
    }
    
    
   private void CargaTabla(){
        DefaultComboBoxModel value;
        ExeSql Sql = new ExeSql();
        ResultSet Rs;
        String Query="";
        value =new DefaultComboBoxModel();
      
        CboTabla.removeAllItems();
        
        try {
            Query="select max(id) id, tabla from auditoria_bd\n" +
                    "group by tabla ";
            Rs = Sql.Select(Query);
            
            if(Sql.GetRowCount()==0) return;
             value.addElement(new ComboCodigos("Seleccione",0));
             
           while(Rs.next()){
            value.addElement(new ComboCodigos(Rs.getString("tabla").trim(),Rs.getInt("id")));
           } 
           CboTabla.setModel(value);
           CboTabla.setSelectedIndex(0);

        } catch (Exception e) {
            System.out.println(e);
        }
        finally{
            Sql.Close();
        }
    }
    
   
    private void CargaCambio(){
        DefaultComboBoxModel value;
        ExeSql Sql = new ExeSql();
        ResultSet Rs;
        String Query="";
        value =new DefaultComboBoxModel();
      
        CboCambio.removeAllItems();
        
        try {
            Query=" select max(id) id, tipo_cambio from auditoria_bd\n" +
                    " WHERE \n" +
                    " tabla = '" + CboTabla.getSelectedItem().toString() + "'" +
                    " group by tipo_cambio ";
            Rs = Sql.Select(Query);
            if(Sql.GetRowCount()==0) return;
             value.addElement(new ComboCodigos("Seleccione",0));
             
           while(Rs.next()){
            value.addElement(new ComboCodigos(Rs.getString("tipo_cambio").trim(),Rs.getInt("id")));
           } 
           CboCambio.setModel(value);
           CboCambio.setSelectedIndex(0);

        } catch (Exception e) {
            System.out.println(e);
        }
        finally{
            Sql.Close();
        }
    }
    
    private void btBuscarActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btBuscarActionPerformed
        ExeSql Sql = new ExeSql();
        ResultSet Rs;
        String Query="";
        String NombrePersonal;
        String nproveedor = "";
        DefaultTableModel TableModel = (DefaultTableModel) Grilla.getModel();
        Boolean QryOK = false;
        int ContReg=0;
        
            
        while(TableModel.getRowCount()>0)
           TableModel.removeRow(0);        
try {
                      


Query= "select id,\n" +
"       usuario,\n" +
"       fecha,\n" +
"       tabla,\n" +
"       tipo_cambio,\n" +
"       campo1,\n" +
"       campo2,\n" +
"       campo3,\n" +
"       campo4,\n" +
"       old_valor,\n" +
"       new_valor\n" +
"from auditoria_bd";
   
 if(CboUsuario.getSelectedIndex() >0 || CboTabla.getSelectedIndex() >0 || CboCambio.getSelectedIndex() >0  ){
    Query = Query +   " where fecha is not null";
 }  
 
     if(rbDesde.isSelected()){
                Query = Query + " and  CAST(fecha AS VARCHAR(10)) between  '" + getDesde() + "' and '" + getHasta() + "'\n"; 
         }            
 
 
 if(CboUsuario.getSelectedIndex() >0) {
     Query = Query +   " and usuario = '" + CboUsuario.getSelectedItem().toString() + "' \n";  
 }
 
 if(CboTabla.getSelectedIndex() >0 ) {
    Query = Query +   "  and tabla  = '" +  CboTabla.getSelectedItem().toString() + "' \n";  
 }
 
 if(CboCambio.getSelectedIndex() >0)
 {
     Query = Query +   " and tipo_cambio = '" + CboCambio.getSelectedItem().toString()  + "' \n";  
    
 }  
  
 
  // EJECUTA CONSULTA
            Rs = Sql.Select(Query);
            
            while(Rs.next()){
                ContReg++;
              TableModel.addRow(new Object[]{  Rs.getString("usuario").trim(), 
                                               Rs.getString("fecha").trim(), 
                                               Rs.getString("tabla").trim(), 
                                               Rs.getString("tipo_cambio"),
                                               Rs.getString("campo1"),
                                               Rs.getString("campo2"),
                                               Rs.getString("campo3"),
                                               Rs.getString("campo4"),
                                               Rs.getString("old_valor"),
                                               Rs.getString("new_valor")});
       }
         lblReg.setText(String.valueOf(ContReg));
    }
catch (Exception e) {
            fmMain.Mensaje("Existe una inconsistencia en la información.");
        }finally{
            Sql.Close();
        }
            
        
    }//GEN-LAST:event_btBuscarActionPerformed

        public void abrir(String file ){
        
       try {
           String url = file;
           ProcessBuilder p = new ProcessBuilder();
           p.command("cmd.exe", "/c",url);
           p.start();
       } catch (IOException ex) {
           Logger.getLogger(jdOC_PendientesFac.class.getName()).log(Level.SEVERE, null, ex);
       }
        
    }
    
    
    private void CboUsuarioActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_CboUsuarioActionPerformed
       
    try{    
        ComboCodigos usuario = (ComboCodigos) CboUsuario.getSelectedItem() ;
         
        if (CboUsuario.getSelectedItem()!= null){
            id_usuario = usuario.getId();
        }
        //CboTabla.removeAllItems();
        //CboCambio.removeAllItems();
          //CargaTabla();
          
    } catch (Exception e) {
                fmMain.Mensaje(e.getMessage());
            }
    }//GEN-LAST:event_CboUsuarioActionPerformed

    private void CboTablaActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_CboTablaActionPerformed
        // TODO add your handling code here:
//          ComboCodigos tabla = (ComboCodigos) CboTabla.getSelectedItem() ;
//          if (CboTabla.getSelectedItem()!= null){   
//                    id_tabla = tabla.getId();
//          }         
         
        CargaCambio();
    }//GEN-LAST:event_CboTablaActionPerformed

    private void CboCambioActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_CboCambioActionPerformed
        // TODO add your handling code here:
        
        
            CargaUsuario();
//          ComboCodigos cambio = (ComboCodigos) CboCambio.getSelectedItem() ;
//          if (CboCambio.getSelectedItem()!= null){   
//                    id_cambio = cambio.getId();
//          }         
    }//GEN-LAST:event_CboCambioActionPerformed

    private void GrillaMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_GrillaMouseClicked

    }//GEN-LAST:event_GrillaMouseClicked

    private void btExcelActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btExcelActionPerformed

        if(Grilla.getRowCount()==0){
            fmMain.Mensaje("Nada que exportar");
            return;
        }

        List<JTable> tb=new ArrayList<>();
        List<String> nom=new ArrayList<>();
        tb.add(Grilla);
        String str_convenio="conv";
        String str_proveedor="prov";

        ComboCodigos convenio = (ComboCodigos) CboTabla.getSelectedItem() ;
        ComboCodigos proveedor = (ComboCodigos) CboUsuario.getSelectedItem() ;
        if (convenio.getId()>0){
            str_convenio = convenio.toString();
        }
        if (proveedor.getId()>0){
            str_proveedor = proveedor.toString();
        }

        nom.add(str_convenio + '_' + str_proveedor);

        File folder = new File("c:/temp");
        if (!folder.exists())
        {
            folder.mkdir();
        }

        String file = "C:/temp/convenio_" + str_convenio + '_' + str_proveedor + ".xls";

        try {
            Exporter e = new Exporter(new File(file), tb, nom);

            if(e.export())
            //fmMain.Mensaje("Datos Exportados");
            abrir(file);

        } catch (Exception e) {
            fmMain.Mensaje(e.getMessage());
        }
    }//GEN-LAST:event_btExcelActionPerformed

    private void dtHastaActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_dtHastaActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_dtHastaActionPerformed

    private void rbDesdeActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_rbDesdeActionPerformed
        // TODO add your handling code here:
        if(rbDesde.isSelected()){
            dtDesde.setEnabled(true);
            dtHasta.setEnabled(true);
        }
    }//GEN-LAST:event_rbDesdeActionPerformed

    private void rbPeriodoTodosActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_rbPeriodoTodosActionPerformed
        // TODO add your handling code here:
        if(rbPeriodoTodos.isSelected()){
            dtDesde.setEnabled(false);
            dtHasta.setEnabled(false);
        }
    }//GEN-LAST:event_rbPeriodoTodosActionPerformed

    private void CboUsuario4ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_CboUsuario4ActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_CboUsuario4ActionPerformed

    private void CboTabla4ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_CboTabla4ActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_CboTabla4ActionPerformed

    private void CboCambio4ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_CboCambio4ActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_CboCambio4ActionPerformed

    private void dtHasta4ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_dtHasta4ActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_dtHasta4ActionPerformed

    private void rbDesde4ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_rbDesde4ActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_rbDesde4ActionPerformed

    private void rbPeriodoTodos4ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_rbPeriodoTodos4ActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_rbPeriodoTodos4ActionPerformed

    private void Grilla4MouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_Grilla4MouseClicked
        // TODO add your handling code here:
    }//GEN-LAST:event_Grilla4MouseClicked

    private void btBuscar4ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btBuscar4ActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_btBuscar4ActionPerformed

    private void btExcel4ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btExcel4ActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_btExcel4ActionPerformed


 public String getDesde() {
        SimpleDateFormat sdf = new SimpleDateFormat("yyyy-MM-dd");
        return( sdf.format( (dtDesde.getDate()).getTime() ) );
    }
    public String getHasta() {
        SimpleDateFormat sdf = new SimpleDateFormat("yyyy-MM-dd");
        return( sdf.format( (dtHasta.getDate()).getTime() ) );
    }



//6700

    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JComboBox<String> CboCambio;
    private javax.swing.JComboBox<String> CboCambio4;
    private javax.swing.JComboBox<String> CboTabla;
    private javax.swing.JComboBox<String> CboTabla4;
    private javax.swing.JComboBox<String> CboUsuario;
    private javax.swing.JComboBox<String> CboUsuario4;
    private javax.swing.JTable Grilla;
    private javax.swing.JTable Grilla4;
    private javax.swing.JButton btBuscar;
    private javax.swing.JButton btBuscar4;
    private javax.swing.JButton btExcel;
    private javax.swing.JButton btExcel4;
    private javax.swing.ButtonGroup buttonGroup1;
    private org.jdesktop.swingx.JXDatePicker dtDesde;
    private org.jdesktop.swingx.JXDatePicker dtDesde4;
    private org.jdesktop.swingx.JXDatePicker dtHasta;
    private org.jdesktop.swingx.JXDatePicker dtHasta4;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JLabel jLabel10;
    private javax.swing.JLabel jLabel2;
    private javax.swing.JLabel jLabel9;
    private javax.swing.JPanel jPanel1;
    private javax.swing.JPanel jPanel13;
    private javax.swing.JPanel jPanel14;
    private javax.swing.JPanel jPanel15;
    private javax.swing.JPanel jPanel3;
    private javax.swing.JPanel jPanel4;
    private javax.swing.JScrollPane jScrollPane1;
    private javax.swing.JScrollPane jScrollPane5;
    private org.jdesktop.swingx.JXDatePicker jXDatePicker1;
    private javax.swing.JLabel lblReg;
    private javax.swing.JLabel lblReg4;
    private javax.swing.JLabel lblVendedor;
    private javax.swing.JLabel lblVendedor1;
    private javax.swing.JLabel lblVendedor12;
    private javax.swing.JLabel lblVendedor13;
    private javax.swing.JLabel lblVendedor14;
    private javax.swing.JLabel lblVendedor2;
    private javax.swing.JRadioButton rbDesde;
    private javax.swing.JRadioButton rbDesde4;
    private javax.swing.JRadioButton rbPeriodoTodos;
    private javax.swing.JRadioButton rbPeriodoTodos4;
    // End of variables declaration//GEN-END:variables
}
