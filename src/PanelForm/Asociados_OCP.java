/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package PanelForm;

import Conexion.ExeSql;
import Dialogos.jdBuscarCliPrv;
import Dialogos.jdBuscarCliPrv2;
import Formularios.fmMain;
import static Formularios.fmMain.pnPestanas;
import static PanelForm.pfIndicadoresInventario.DARK_GREEN;
import Utilidades.PanelTab;
import java.awt.Color;
import java.awt.Component;
import java.awt.event.KeyEvent;
import java.net.URL;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.text.NumberFormat;
import javax.swing.JOptionPane;
import javax.swing.JTable;
import javax.swing.SwingConstants;
import javax.swing.event.ListSelectionEvent;
import javax.swing.event.ListSelectionListener;
import javax.swing.table.DefaultTableCellRenderer;
import javax.swing.table.DefaultTableModel;
import java.util.logging.Level;
import java.util.logging.Logger;
import javax.swing.ImageIcon;

/**
 *
 * @author David Alcaman
 */
public class Asociados_OCP extends javax.swing.JPanel {
    DefaultTableCellRenderer rightRenderer = new DefaultTableCellRenderer();
    DefaultTableCellRenderer centerRenderer = new DefaultTableCellRenderer();
    static boolean sobre_stock = false; 
    boolean autoriza = false;
    
    
       /**
     * Creates new form OC_Clientes
     */
    public Asociados_OCP() {
        initComponents();
       
        //System.out.println("EL USUARIO  ES : "+ fmMain.GetUsuario().toLowerCase());        
        
        
//        btAutorizar.setVisible(false);
//        btRechazar.setVisible(false);
        rightRenderer.setHorizontalAlignment(SwingConstants.RIGHT);
        centerRenderer.setHorizontalAlignment(SwingConstants.CENTER);
        
        GrillaProductos.getColumnModel().getColumn(2).setCellRenderer(centerRenderer);
        GrillaProductos.getColumnModel().getColumn(3).setCellRenderer(centerRenderer);
        GrillaProductos.getColumnModel().getColumn(4).setCellRenderer(centerRenderer);
        GrillaProductos.getColumnModel().getColumn(5).setCellRenderer(centerRenderer);
        GrillaProductos.getColumnModel().getColumn(6).setCellRenderer(centerRenderer);
        GrillaProductos.getColumnModel().getColumn(7).setCellRenderer(centerRenderer);
        GrillaProductos.getColumnModel().getColumn(8).setCellRenderer(centerRenderer);
                
       
        GrillaProductos.getSelectionModel().addListSelectionListener(new ListSelectionListener() {
            //Se ejecuta automáticamente cada vez que se hace una nueva selección. 
            @Override
            public void valueChanged(ListSelectionEvent e) {
//                    if(GrillaProductos.getRowCount()>0 && GrillaDatos.getRowCount()>0){
//                       
//                        GrillaDatos.getSelectionModel().setSelectionInterval(GrillaProductos.getSelectedRow(),GrillaProductos.getSelectedRow());
//                        GrillaDatos.repaint();
//                    }
            }

        });
       
        lbcargando.setVisible(false);
        
        //btActualizar.doClick();
                //MOSTRAR BOTÓN AUTORIZAR
        int pruebaUusario = 85;
        int intNivelUsuario = 0;
        intNivelUsuario = fmMain.trae_nivel(fmMain.GetUsuario());
        
//        if( intNivelUsuario >= pruebaUusario){
//            btAutorizar.setVisible(true);
//            btRechazar.setVisible(true);
//        }else{
//        }
                
                
       
        
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        jPopupMenu1 = new javax.swing.JPopupMenu();
        jMenuItem1 = new javax.swing.JMenuItem();
        jPopupMenu2 = new javax.swing.JPopupMenu();
        jMenuItem2 = new javax.swing.JMenuItem();
        jLabel1 = new javax.swing.JLabel();
        jScrollPane2 = new javax.swing.JScrollPane();
        GrillaProductos = new javax.swing.JTable();
        btCargar = new javax.swing.JButton();
        lbcargando = new javax.swing.JLabel();
        lbTotal = new javax.swing.JLabel();
        lbCont = new javax.swing.JLabel();
        lbTotal2 = new javax.swing.JLabel();
        txRut = new javax.swing.JTextField();
        txNombre = new javax.swing.JTextField();
        btIr = new javax.swing.JButton();

        jMenuItem1.setText("Ver Producto");
        jMenuItem1.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jMenuItem1ActionPerformed(evt);
            }
        });
        jPopupMenu1.add(jMenuItem1);

        jMenuItem2.setText("Ver Productos");
        jMenuItem2.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jMenuItem2ActionPerformed(evt);
            }
        });
        jPopupMenu2.add(jMenuItem2);

        setToolTipText("");

        jLabel1.setFont(new java.awt.Font("Tahoma", 1, 11)); // NOI18N
        jLabel1.setText("PRODUCTOS ASOCIADOS A PROVEEDOR");

        GrillaProductos.setAutoCreateRowSorter(true);
        GrillaProductos.setFont(new java.awt.Font("Tahoma", 0, 10)); // NOI18N
        GrillaProductos.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {
                {null, null, null, null, null, null, null, null, null},
                {null, null, null, null, null, null, null, null, null},
                {null, null, null, null, null, null, null, null, null},
                {null, null, null, null, null, null, null, null, null}
            },
            new String [] {
                "Codigo", "Nombre", "Cant*Embalaje", "Stock", "OCC", "OCP", "Total", "Vta. en 3 Meses", "Vta. en 12 Meses"
            }
        ) {
            Class[] types = new Class [] {
                java.lang.Object.class, java.lang.Object.class, java.lang.Object.class, java.lang.Object.class, java.lang.Object.class, java.lang.Object.class, java.lang.Object.class, java.lang.Integer.class, java.lang.Integer.class
            };
            boolean[] canEdit = new boolean [] {
                false, false, true, false, false, false, false, false, false
            };

            public Class getColumnClass(int columnIndex) {
                return types [columnIndex];
            }

            public boolean isCellEditable(int rowIndex, int columnIndex) {
                return canEdit [columnIndex];
            }
        });
        GrillaProductos.setComponentPopupMenu(jPopupMenu1);
        jScrollPane2.setViewportView(GrillaProductos);
        if (GrillaProductos.getColumnModel().getColumnCount() > 0) {
            GrillaProductos.getColumnModel().getColumn(0).setMinWidth(70);
            GrillaProductos.getColumnModel().getColumn(0).setPreferredWidth(70);
            GrillaProductos.getColumnModel().getColumn(0).setMaxWidth(70);
            GrillaProductos.getColumnModel().getColumn(1).setMinWidth(350);
            GrillaProductos.getColumnModel().getColumn(1).setPreferredWidth(350);
            GrillaProductos.getColumnModel().getColumn(2).setMinWidth(90);
            GrillaProductos.getColumnModel().getColumn(2).setPreferredWidth(90);
            GrillaProductos.getColumnModel().getColumn(2).setMaxWidth(90);
            GrillaProductos.getColumnModel().getColumn(3).setMinWidth(50);
            GrillaProductos.getColumnModel().getColumn(3).setPreferredWidth(50);
            GrillaProductos.getColumnModel().getColumn(3).setMaxWidth(50);
            GrillaProductos.getColumnModel().getColumn(4).setMinWidth(50);
            GrillaProductos.getColumnModel().getColumn(4).setPreferredWidth(50);
            GrillaProductos.getColumnModel().getColumn(4).setMaxWidth(50);
            GrillaProductos.getColumnModel().getColumn(5).setMinWidth(50);
            GrillaProductos.getColumnModel().getColumn(5).setPreferredWidth(50);
            GrillaProductos.getColumnModel().getColumn(5).setMaxWidth(50);
            GrillaProductos.getColumnModel().getColumn(6).setMinWidth(55);
            GrillaProductos.getColumnModel().getColumn(6).setPreferredWidth(55);
            GrillaProductos.getColumnModel().getColumn(6).setMaxWidth(55);
        }

        btCargar.setIcon(new javax.swing.ImageIcon(getClass().getResource("/Iconos/Ok.png"))); // NOI18N
        btCargar.setText("Cargar");
        btCargar.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btCargarActionPerformed(evt);
            }
        });

        lbcargando.setText("Cargando");
        lbcargando.setEnabled(false);

        lbTotal.setFont(new java.awt.Font("Tahoma", 1, 12)); // NOI18N
        lbTotal.setHorizontalAlignment(javax.swing.SwingConstants.CENTER);
        lbTotal.setText("0");
        lbTotal.setToolTipText("");

        lbCont.setFont(new java.awt.Font("Tahoma", 1, 12)); // NOI18N
        lbCont.setHorizontalAlignment(javax.swing.SwingConstants.CENTER);
        lbCont.setText("0");
        lbCont.setToolTipText("");

        lbTotal2.setFont(new java.awt.Font("Tahoma", 1, 12)); // NOI18N
        lbTotal2.setHorizontalAlignment(javax.swing.SwingConstants.CENTER);
        lbTotal2.setText("de");
        lbTotal2.setToolTipText("");

        txRut.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                txRutActionPerformed(evt);
            }
        });
        txRut.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                txRutKeyPressed(evt);
            }
            public void keyReleased(java.awt.event.KeyEvent evt) {
                txRutKeyReleased(evt);
            }
        });

        txNombre.setEnabled(false);
        txNombre.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                txNombreActionPerformed(evt);
            }
        });
        txNombre.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                txNombreKeyPressed(evt);
            }
            public void keyReleased(java.awt.event.KeyEvent evt) {
                txNombreKeyReleased(evt);
            }
        });

        btIr.setIcon(new javax.swing.ImageIcon(getClass().getResource("/Iconos16/search16.png"))); // NOI18N
        btIr.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btIrActionPerformed(evt);
            }
        });

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(this);
        this.setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(jLabel1, javax.swing.GroupLayout.PREFERRED_SIZE, 257, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(jScrollPane2, javax.swing.GroupLayout.PREFERRED_SIZE, 1000, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addGroup(layout.createSequentialGroup()
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(txNombre, javax.swing.GroupLayout.PREFERRED_SIZE, 493, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addGroup(layout.createSequentialGroup()
                                .addComponent(txRut, javax.swing.GroupLayout.PREFERRED_SIZE, 201, javax.swing.GroupLayout.PREFERRED_SIZE)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                .addComponent(btIr, javax.swing.GroupLayout.PREFERRED_SIZE, 38, javax.swing.GroupLayout.PREFERRED_SIZE)))
                        .addGap(67, 67, 67)
                        .addComponent(btCargar, javax.swing.GroupLayout.PREFERRED_SIZE, 100, javax.swing.GroupLayout.PREFERRED_SIZE)))
                .addGap(10, 10, 10))
            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, layout.createSequentialGroup()
                .addGap(818, 818, 818)
                .addComponent(lbcargando)
                .addGap(50, 50, 50)
                .addComponent(lbCont, javax.swing.GroupLayout.PREFERRED_SIZE, 25, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addComponent(lbTotal2, javax.swing.GroupLayout.PREFERRED_SIZE, 25, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addComponent(lbTotal, javax.swing.GroupLayout.PREFERRED_SIZE, 25, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addGap(10, 10, 10)
                .addComponent(jLabel1)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(layout.createSequentialGroup()
                        .addGap(24, 24, 24)
                        .addComponent(btCargar, javax.swing.GroupLayout.PREFERRED_SIZE, 49, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addGroup(layout.createSequentialGroup()
                        .addGap(19, 19, 19)
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                            .addComponent(btIr, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                            .addComponent(txRut))
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(txNombre, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(lbcargando)
                    .addComponent(lbTotal2)
                    .addComponent(lbCont)
                    .addComponent(lbTotal))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addComponent(jScrollPane2, javax.swing.GroupLayout.PREFERRED_SIZE, 401, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addContainerGap(12, Short.MAX_VALUE))
        );
    }// </editor-fold>//GEN-END:initComponents

     private void eliminar(int fila){
    
        DefaultTableModel TableModel4 = (DefaultTableModel) GrillaProductos.getModel();
     
        while(TableModel4.getRowCount()>0)
            TableModel4.removeRow(0);
        
      
        autoriza = false;
    }
     
     
    
    
    private void jMenuItem1ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jMenuItem1ActionPerformed
        pfProductos Pro = new pfProductos();
        Pro.setOpaque(false);
        pnPestanas.addTab("Producto", Pro);
        PanelTab btc = new PanelTab(pnPestanas, 0);
        pnPestanas.setTabComponentAt(pnPestanas.indexOfComponent(Pro), btc);
        pnPestanas.setSelectedIndex(pnPestanas.getTabCount() - 1);
        Pro.txSku.requestFocus();
        Pro.CargaProducto(GrillaProductos.getValueAt(GrillaProductos.getSelectedRow(), 0).toString().trim());
    }//GEN-LAST:event_jMenuItem1ActionPerformed

    private void jMenuItem2ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jMenuItem2ActionPerformed
        pfProductos Pro = new pfProductos();
        Pro.setOpaque(false);
        pnPestanas.addTab("Producto", Pro);
        PanelTab btc = new PanelTab(pnPestanas, 0);
        pnPestanas.setTabComponentAt(pnPestanas.indexOfComponent(Pro), btc);
        pnPestanas.setSelectedIndex(pnPestanas.getTabCount() - 1);
        Pro.txSku.requestFocus();
        
    }//GEN-LAST:event_jMenuItem2ActionPerformed

    private void btCargarActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btCargarActionPerformed
        
      //   CargaProductos(cbProveedorId.getSelectedItem().toString().trim());
         
         
         Runnable miRunnable = new Runnable() {
            public void run() {
                try{
                    
                    lbcargando.setEnabled(true);
                    lbcargando.setVisible(true);

                   // CargaProductos(cbProveedorId.getSelectedItem().toString().trim());
                   
                    CargaProductos(txRut.getText()); 

                    lbcargando.setVisible(false);
                    lbcargando.setEnabled(false);
                    //Grilla.changeSelection(0, 0 , false, false);


                    
                } catch (Exception e) {
                    e.printStackTrace();
                }
            }
        };
        Thread hilo = new Thread(miRunnable);
        hilo.start();
        
            
        lbcargando.setText("Cargando.....");
        URL urlInfo =  this.getClass().getResource("/Iconos16/wait.gif");
        ImageIcon IconoInfo =  new ImageIcon(urlInfo); 
        lbcargando.setIcon(IconoInfo);
        lbcargando.setForeground(Color.red);
         
         
         
         
         
         
         
         
         
         
        
    }//GEN-LAST:event_btCargarActionPerformed

    private void txRutActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_txRutActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_txRutActionPerformed

    private void txRutKeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_txRutKeyPressed
        
        if(evt.getKeyCode()== KeyEvent.VK_ENTER){    
        
            btCargar.doClick();
        }   
        
    }//GEN-LAST:event_txRutKeyPressed

    private void txRutKeyReleased(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_txRutKeyReleased
        //        txBuscar.setText(txBuscar.getText().toUpperCase());
        //        if(evt.getKeyCode()== KeyEvent.VK_ENTER)
        //        btBuscar.doClick();
        //        if(evt.getKeyCode()== KeyEvent.VK_DOWN)
        //        Grilla.requestFocus();
    }//GEN-LAST:event_txRutKeyReleased

    private void txNombreActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_txNombreActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_txNombreActionPerformed

    private void txNombreKeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_txNombreKeyPressed
        // TODO add your handling code here:
    }//GEN-LAST:event_txNombreKeyPressed

    private void txNombreKeyReleased(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_txNombreKeyReleased
        // TODO add your handling code here:
    }//GEN-LAST:event_txNombreKeyReleased

    private void btIrActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btIrActionPerformed
        if(!txRut.getText().isEmpty()){
            
            BuscaNomProveedor();
            btCargar.doClick();
            
        }else{
            jdBuscarCliPrv2 BPC = new jdBuscarCliPrv2(null, true);
            BPC.setLocationRelativeTo(null);
            BPC.setTitle("Buscar Proveedor");
            BPC.SetTipo(1);
            BPC.setVisible(true);
            txRut.setText(BPC.GetRut());
            txNombre.setText(BPC.GetNom());
            btCargar.doClick();
            
        }
    }//GEN-LAST:event_btIrActionPerformed
    
    private void BuscaNomProveedor(){
    
        try {
            ExeSql Sql = new ExeSql();
            ResultSet Rs = null;
            
            Rs = Sql.Select("select rut, nombre from proveedor \n" +
                    "where rut=" + txRut.getText().trim());
            
            if (Sql.GetRowCount() > 0){
            
                Rs.next();
                txNombre.setText(Rs.getString("nombre"));
            }
            
        } catch (SQLException ex) {
            Logger.getLogger(Asociados_OCP.class.getName()).log(Level.SEVERE, null, ex);
        }
        
    
    
    
    }
    
    
    private void CargaProductos(String Rut){
        ExeSql Sql = new ExeSql();
        ExeSql Sql2 = new ExeSql();
        ExeSql Sql3 = new ExeSql();
        ResultSet Rs = null;
        ResultSet Rs2 = null;
        ResultSet Rs3 = null;
        DefaultTableModel TableModel  = (DefaultTableModel) GrillaProductos.getModel();
       
        int cont = 0;
        
        while(TableModel.getRowCount()>0)
              TableModel.removeRow(0);
        
        
        
        try {
            
            
            Rs = Sql.Select("select DISTINCT d.sku,p.nombre, i.stock, i.ocp,i.occ,\n" +
                            "case when p.display is null then 0 else p.display end \n" +
                            "from ctacteprvdet d\n" +
                            "left join producto p on p.sku=d.sku\n" +
                            "left join inventario i on i.sku=d.sku \n" +
                            "where d.tipdocto='OCP'\n" +
                            "and d.rut=" + Rut);
            
            
            
              int TotalReg = Sql.GetRowCount();
              lbTotal.setText(""+TotalReg);
            
            while(Rs.next()){
                
                int total = (Rs.getInt("stock") + Rs.getInt("ocp") + Rs.getInt("occ") );
                String Sku = Rs.getString("sku").trim();
                int vendido3 = 0;
                int vendido12 = 0;
                
                Rs2 = Sql2.Select("SELECT case when sum(cli.cantidad) is null then 0 else sum(cli.cantidad) end as vendido from ctacteclidet cli\n" +
                                  "LEFT JOIN ctactecli cl ON cli.rut = cl.rut AND cli.tipdocto = cl.tipdocto AND cli.nrodocto = cl.nrodocto\n" +
                                  "WHERE cli.tipdocto IN ('BOC','FAC') \n"+
                                  "AND (cl.femision BETWEEN current_date-90 AND current_date-1) AND cli.sku = '"+Sku+"'");
                
                
                Rs3 = Sql3.Select("SELECT case when sum(cli.cantidad) is null then 0 else sum(cli.cantidad) end as vendido from ctacteclidet cli\n" +
                                  "LEFT JOIN ctactecli cl ON cli.rut = cl.rut AND cli.tipdocto = cl.tipdocto AND cli.nrodocto = cl.nrodocto\n" +
                                  "WHERE cli.tipdocto IN ('BOC','FAC') \n"+
                                  "AND (cl.femision BETWEEN current_date-365 AND current_date-1) AND cli.sku = '"+Sku+"'");
                
                
                if (Sql2.GetRowCount() > 0){
                    
                    Rs2.next();
                    
                    vendido3 = Rs2.getInt("vendido");
                    
                     if (Sql3.GetRowCount() > 0){
                         
                        Rs3.next();
                        vendido12 = Rs3.getInt("vendido");
                     
                     }else {
                     
                        vendido12 = 0;    
                     
                     }
                 
                }else {
                
                    vendido3 = 0;    
                    
                    if (Sql3.GetRowCount() > 0){
                         
                        Rs3.next();
                        vendido12 = Rs3.getInt("vendido");
                     
                     }else {
                     
                        vendido12 = 0;    
                     
                     }
                    
                    
                }
                
                
                TableModel.addRow(new Object[]{   Rs.getString("sku").trim(),  
                                                  Rs.getString("nombre").trim(), 
                                                  Rs.getString("display").trim(), 
                                                  Rs.getString("stock").trim(),
                                                  Rs.getString("occ").trim(),
                                                  Rs.getInt("ocp"),
                                                  total,
                                                  vendido3,
                                                  vendido12
                                                  
                                             });
                cont++;
                lbCont.setText(""+cont);
                 
            }
            
//            GrillaProductos.setDefaultRenderer(Object.class, new Elrender()); 
//            GrillaProductos.repaint();
//           
            
        } catch (Exception e) {
            System.out.println(e);
        }finally{
            Sql.Close();
        }
        
    }
    
    
    
    private String TextoBusqueda(){
        String Texto="upper(p.nombre) like '%";
        String Palabras[] = txRut.getText().split(" ");
        
        if(Palabras.length>0){
            Texto = Texto + Palabras[0] + "%' ";
            for(int i=1; i< Palabras.length; i++){
                Texto = Texto + "or upper(p.nombre) like '%" + Palabras[i] + "%' ";
            }
        }
        else{
            Texto = Texto + txRut.getText() + "%' ";         
        }
        return Texto;
    }
    
    
    
//    class Elrender extends DefaultTableCellRenderer {
//         
//        @Override
//        public Component getTableCellRendererComponent(JTable tabla, Object valor, boolean isSelected, boolean hasFocus, int fila, int columna) {
//        
//            Component componente = super.getTableCellRendererComponent(tabla,valor,isSelected, hasFocus, fila, columna);
//         
//        
//          
//            double stock_dif = (Double.parseDouble(tabla.getValueAt(fila,3).toString()) + Double.parseDouble(GrillaDatos.getValueAt(fila, 0).toString()))
//                                + Double.parseDouble(GrillaDatos.getValueAt(fila, 2).toString());
//                       
//            double porcentaje = (stock_dif / Double.parseDouble(GrillaDatos.getValueAt(fila, 2).toString()))*100;
//           
//            if (porcentaje == 0 || porcentaje > 0 ){
//            
//                porcentaje = porcentaje * 1;
//            
//            }else if (porcentaje < 0){
//             
//                porcentaje = porcentaje * -1;
//            }
//            
//            if(porcentaje >= 40){
//                 
//                sobre_stock = true;
//                componente.setForeground(Color.white);
//                componente.setBackground(Color.red);  
//            
//            }else{
//            
//                if (!sobre_stock){
//                
//                    sobre_stock = false;
//                }
//                
//                componente.setForeground(Color.black);
//                componente.setBackground(Color.white); 
//            }     
//             
//            return componente;
//        }
//        
//    } 
    

    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JTable GrillaProductos;
    private javax.swing.JButton btCargar;
    private javax.swing.JButton btIr;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JMenuItem jMenuItem1;
    private javax.swing.JMenuItem jMenuItem2;
    private javax.swing.JPopupMenu jPopupMenu1;
    private javax.swing.JPopupMenu jPopupMenu2;
    private javax.swing.JScrollPane jScrollPane2;
    private javax.swing.JLabel lbCont;
    private javax.swing.JLabel lbTotal;
    private javax.swing.JLabel lbTotal2;
    private javax.swing.JLabel lbcargando;
    private javax.swing.JTextField txNombre;
    private javax.swing.JTextField txRut;
    // End of variables declaration//GEN-END:variables
}
