/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package PanelForm;

import Conexion.ExeSql;
import Dialogos.jdAgregaDato;
import Dialogos.jdPersonalPerfil;
import Formularios.fmMain;
import java.awt.Color;
import java.awt.event.KeyEvent;
import java.sql.ResultSet;
import javax.swing.JOptionPane;
import javax.swing.SwingConstants;
import javax.swing.event.TableModelEvent;
import javax.swing.event.TableModelListener;
import javax.swing.table.DefaultTableCellRenderer;
import javax.swing.table.DefaultTableModel;

/**
 *
 * @author David Alcaman
 */
public class pfGastosSueldos extends javax.swing.JPanel {
    int EstadoGeneral;
    int nuevo=0;
    
    
    /**
     * Creates new form pfGastosSueldos
     */
    public pfGastosSueldos() {
        initComponents();
        cbDetalleId.setVisible(false);
        SetEstados(1);
        DefaultTableCellRenderer rightRenderer = new DefaultTableCellRenderer();
        rightRenderer.setHorizontalAlignment(SwingConstants.RIGHT);
        GrillaHaberes.getColumnModel().getColumn(1).setCellRenderer(rightRenderer);
        GrillaDescuentos.getColumnModel().getColumn(1).setCellRenderer(rightRenderer);
        GrillaHaberes.getModel().addTableModelListener(new TableModelListener() {
            public void tableChanged(TableModelEvent e) {
                if(EstadoGeneral==2 || EstadoGeneral==4)
                    Sumador();
            }
        });
        GrillaDescuentos.getModel().addTableModelListener(new TableModelListener() {
            public void tableChanged(TableModelEvent e) {
                if(EstadoGeneral==2 || EstadoGeneral==4)
                    Sumador();
            }
        });
   
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        pnMenu = new javax.swing.JPanel();
        btNuevo = new javax.swing.JButton();
        btGuardar = new javax.swing.JButton();
        btCancelar = new javax.swing.JButton();
        btAbrir = new javax.swing.JButton();
        jLabel1 = new javax.swing.JLabel();
        btEditar = new javax.swing.JButton();
        jPanel1 = new javax.swing.JPanel();
        jLabel2 = new javax.swing.JLabel();
        txRut = new javax.swing.JTextField();
        btIr = new javax.swing.JButton();
        txNombre = new javax.swing.JTextField();
        cbAgno = new javax.swing.JComboBox<>();
        cbMes = new javax.swing.JComboBox<>();
        lbEstado = new javax.swing.JLabel();
        jPanel2 = new javax.swing.JPanel();
        cbTipo = new javax.swing.JComboBox<>();
        jLabel3 = new javax.swing.JLabel();
        cbDetalle = new javax.swing.JComboBox<>();
        jLabel8 = new javax.swing.JLabel();
        txMonto = new javax.swing.JTextField();
        btAgregar = new javax.swing.JButton();
        jScrollPane1 = new javax.swing.JScrollPane();
        GrillaHaberes = new javax.swing.JTable();
        jScrollPane2 = new javax.swing.JScrollPane();
        GrillaDescuentos = new javax.swing.JTable();
        jLabel4 = new javax.swing.JLabel();
        jLabel5 = new javax.swing.JLabel();
        jLabel6 = new javax.swing.JLabel();
        txMutual = new javax.swing.JTextField();
        txCesantia = new javax.swing.JTextField();
        txSis = new javax.swing.JTextField();
        jLabel7 = new javax.swing.JLabel();
        txTotal = new javax.swing.JTextField();
        cbDetalleId = new javax.swing.JComboBox<>();
        btEliminaHaber = new javax.swing.JButton();
        btEliminaDescuento = new javax.swing.JButton();

        pnMenu.setBorder(javax.swing.BorderFactory.createEtchedBorder());

        btNuevo.setFont(new java.awt.Font("Arial", 0, 11)); // NOI18N
        btNuevo.setIcon(new javax.swing.ImageIcon(getClass().getResource("/Iconos16/add16.png"))); // NOI18N
        btNuevo.setText("Nuevo");
        btNuevo.setBorder(javax.swing.BorderFactory.createBevelBorder(javax.swing.border.BevelBorder.RAISED));
        btNuevo.setBorderPainted(false);
        btNuevo.setFocusPainted(false);
        btNuevo.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btNuevoActionPerformed(evt);
            }
        });

        btGuardar.setFont(new java.awt.Font("Arial", 0, 11)); // NOI18N
        btGuardar.setIcon(new javax.swing.ImageIcon(getClass().getResource("/Iconos16/save16.png"))); // NOI18N
        btGuardar.setText("Guardar");
        btGuardar.setBorder(javax.swing.BorderFactory.createBevelBorder(javax.swing.border.BevelBorder.RAISED));
        btGuardar.setBorderPainted(false);
        btGuardar.setEnabled(false);
        btGuardar.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btGuardarActionPerformed(evt);
            }
        });

        btCancelar.setFont(new java.awt.Font("Arial", 0, 11)); // NOI18N
        btCancelar.setIcon(new javax.swing.ImageIcon(getClass().getResource("/Iconos16/Cancel16.png"))); // NOI18N
        btCancelar.setText("Cancelar");
        btCancelar.setBorder(javax.swing.BorderFactory.createBevelBorder(javax.swing.border.BevelBorder.RAISED));
        btCancelar.setBorderPainted(false);
        btCancelar.setEnabled(false);
        btCancelar.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btCancelarActionPerformed(evt);
            }
        });

        btAbrir.setFont(new java.awt.Font("Arial", 0, 11)); // NOI18N
        btAbrir.setIcon(new javax.swing.ImageIcon(getClass().getResource("/Iconos16/open16.png"))); // NOI18N
        btAbrir.setText("Abrir");
        btAbrir.setBorder(javax.swing.BorderFactory.createBevelBorder(javax.swing.border.BevelBorder.RAISED));
        btAbrir.setBorderPainted(false);
        btAbrir.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btAbrirActionPerformed(evt);
            }
        });

        jLabel1.setFont(new java.awt.Font("Arial", 1, 12)); // NOI18N
        jLabel1.setText("INGRESO PAGO DE REMUNERACIONES");

        btEditar.setFont(new java.awt.Font("Arial", 0, 11)); // NOI18N
        btEditar.setIcon(new javax.swing.ImageIcon(getClass().getResource("/Iconos16/Pencil16.png"))); // NOI18N
        btEditar.setText("Editar");
        btEditar.setBorder(javax.swing.BorderFactory.createBevelBorder(javax.swing.border.BevelBorder.RAISED));
        btEditar.setBorderPainted(false);
        btEditar.setEnabled(false);
        btEditar.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btEditarActionPerformed(evt);
            }
        });

        javax.swing.GroupLayout pnMenuLayout = new javax.swing.GroupLayout(pnMenu);
        pnMenu.setLayout(pnMenuLayout);
        pnMenuLayout.setHorizontalGroup(
            pnMenuLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(pnMenuLayout.createSequentialGroup()
                .addContainerGap()
                .addComponent(jLabel1)
                .addGap(76, 76, 76)
                .addComponent(btGuardar, javax.swing.GroupLayout.PREFERRED_SIZE, 100, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(btCancelar, javax.swing.GroupLayout.PREFERRED_SIZE, 100, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(btEditar, javax.swing.GroupLayout.PREFERRED_SIZE, 100, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(btNuevo, javax.swing.GroupLayout.PREFERRED_SIZE, 100, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(btAbrir, javax.swing.GroupLayout.PREFERRED_SIZE, 100, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );
        pnMenuLayout.setVerticalGroup(
            pnMenuLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(pnMenuLayout.createSequentialGroup()
                .addContainerGap()
                .addGroup(pnMenuLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.CENTER)
                    .addComponent(btNuevo, javax.swing.GroupLayout.PREFERRED_SIZE, 30, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(btGuardar, javax.swing.GroupLayout.PREFERRED_SIZE, 30, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(btCancelar, javax.swing.GroupLayout.PREFERRED_SIZE, 30, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(btAbrir, javax.swing.GroupLayout.PREFERRED_SIZE, 30, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(jLabel1)
                    .addComponent(btEditar, javax.swing.GroupLayout.PREFERRED_SIZE, 30, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addContainerGap())
        );

        jPanel1.setBorder(javax.swing.BorderFactory.createEtchedBorder());

        jLabel2.setText("Rut");

        txRut.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                txRutKeyPressed(evt);
            }
        });

        btIr.setIcon(new javax.swing.ImageIcon(getClass().getResource("/Iconos22/Go.png"))); // NOI18N
        btIr.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btIrActionPerformed(evt);
            }
        });

        txNombre.setEditable(false);

        cbAgno.setModel(new javax.swing.DefaultComboBoxModel<>(new String[] { "AÑO", "2014", "2015", "2016", "2017", "2018", "2019", "2020", "2021", "2022", "2023", "2024", "2025", "2026", "2027", "2028" }));
        cbAgno.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                cbAgnoActionPerformed(evt);
            }
        });

        cbMes.setModel(new javax.swing.DefaultComboBoxModel<>(new String[] { "MES", "ENERO", "FEBRERO", "MARZO", "ABRIL", "MAYO", "JUNIO", "JULIO", "AGOSTO", "SEPTIEMBRE", "OCTUBRE", "NOVIEMBRE", "DICIEMBRE" }));
        cbMes.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                cbMesActionPerformed(evt);
            }
        });

        lbEstado.setFont(new java.awt.Font("Tahoma", 1, 11)); // NOI18N
        lbEstado.setForeground(new java.awt.Color(51, 102, 0));
        lbEstado.setText("ABIERTO");

        javax.swing.GroupLayout jPanel1Layout = new javax.swing.GroupLayout(jPanel1);
        jPanel1.setLayout(jPanel1Layout);
        jPanel1Layout.setHorizontalGroup(
            jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel1Layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(jLabel2)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(txRut, javax.swing.GroupLayout.PREFERRED_SIZE, 88, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(btIr, javax.swing.GroupLayout.PREFERRED_SIZE, 28, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(txNombre, javax.swing.GroupLayout.PREFERRED_SIZE, 387, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(18, 18, 18)
                .addComponent(cbAgno, javax.swing.GroupLayout.PREFERRED_SIZE, 107, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(cbMes, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addComponent(lbEstado)
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );
        jPanel1Layout.setVerticalGroup(
            jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel1Layout.createSequentialGroup()
                .addGap(18, 18, 18)
                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.CENTER)
                    .addComponent(btIr, javax.swing.GroupLayout.PREFERRED_SIZE, 22, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(txNombre, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(jLabel2)
                    .addComponent(txRut, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(cbAgno, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(cbMes, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(lbEstado))
                .addContainerGap(26, Short.MAX_VALUE))
        );

        jPanel2.setBorder(javax.swing.BorderFactory.createEtchedBorder());

        cbTipo.setModel(new javax.swing.DefaultComboBoxModel<>(new String[] { "Seleccione Tipo", "Haberes", "Descuentos" }));
        cbTipo.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                cbTipoActionPerformed(evt);
            }
        });

        jLabel3.setText("Tipo");

        cbDetalle.setModel(new javax.swing.DefaultComboBoxModel<>(new String[] { "Seleccione Detalle" }));
        cbDetalle.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                cbDetalleMouseClicked(evt);
            }
        });
        cbDetalle.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                cbDetalleActionPerformed(evt);
            }
        });

        jLabel8.setText("Monto");

        txMonto.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                txMontoKeyPressed(evt);
            }
            public void keyReleased(java.awt.event.KeyEvent evt) {
                txMontoKeyReleased(evt);
            }
            public void keyTyped(java.awt.event.KeyEvent evt) {
                txMontoKeyTyped(evt);
            }
        });

        btAgregar.setIcon(new javax.swing.ImageIcon(getClass().getResource("/Iconos16/Agregar.png"))); // NOI18N
        btAgregar.setText("Agregar");
        btAgregar.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btAgregarActionPerformed(evt);
            }
        });

        javax.swing.GroupLayout jPanel2Layout = new javax.swing.GroupLayout(jPanel2);
        jPanel2.setLayout(jPanel2Layout);
        jPanel2Layout.setHorizontalGroup(
            jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel2Layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(jLabel3)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(cbTipo, javax.swing.GroupLayout.PREFERRED_SIZE, 167, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(50, 50, 50)
                .addComponent(cbDetalle, javax.swing.GroupLayout.PREFERRED_SIZE, 326, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(50, 50, 50)
                .addComponent(jLabel8)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(txMonto, javax.swing.GroupLayout.PREFERRED_SIZE, 107, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(btAgregar)
                .addContainerGap(111, Short.MAX_VALUE))
        );
        jPanel2Layout.setVerticalGroup(
            jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel2Layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel3)
                    .addComponent(cbTipo, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(cbDetalle, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(jLabel8)
                    .addComponent(txMonto, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(btAgregar))
                .addContainerGap())
        );

        GrillaHaberes.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {
                {null, null, null},
                {null, null, null},
                {null, null, null},
                {null, null, null}
            },
            new String [] {
                "HABERES", "", "codigo"
            }
        ) {
            Class[] types = new Class [] {
                java.lang.Object.class, java.lang.Integer.class, java.lang.Object.class
            };
            boolean[] canEdit = new boolean [] {
                false, true, false
            };

            public Class getColumnClass(int columnIndex) {
                return types [columnIndex];
            }

            public boolean isCellEditable(int rowIndex, int columnIndex) {
                return canEdit [columnIndex];
            }
        });
        GrillaHaberes.setEnabled(false);
        jScrollPane1.setViewportView(GrillaHaberes);
        if (GrillaHaberes.getColumnModel().getColumnCount() > 0) {
            GrillaHaberes.getColumnModel().getColumn(1).setMinWidth(85);
            GrillaHaberes.getColumnModel().getColumn(1).setPreferredWidth(85);
            GrillaHaberes.getColumnModel().getColumn(1).setMaxWidth(85);
            GrillaHaberes.getColumnModel().getColumn(2).setMinWidth(0);
            GrillaHaberes.getColumnModel().getColumn(2).setPreferredWidth(0);
            GrillaHaberes.getColumnModel().getColumn(2).setMaxWidth(0);
        }

        GrillaDescuentos.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {
                {null, null, null},
                {null, null, null},
                {null, null, null},
                {null, null, null}
            },
            new String [] {
                "DESCUENTOS", "", "codigo"
            }
        ) {
            boolean[] canEdit = new boolean [] {
                false, true, false
            };

            public boolean isCellEditable(int rowIndex, int columnIndex) {
                return canEdit [columnIndex];
            }
        });
        GrillaDescuentos.setEnabled(false);
        jScrollPane2.setViewportView(GrillaDescuentos);
        if (GrillaDescuentos.getColumnModel().getColumnCount() > 0) {
            GrillaDescuentos.getColumnModel().getColumn(1).setMinWidth(85);
            GrillaDescuentos.getColumnModel().getColumn(1).setPreferredWidth(85);
            GrillaDescuentos.getColumnModel().getColumn(1).setMaxWidth(85);
            GrillaDescuentos.getColumnModel().getColumn(2).setMinWidth(0);
            GrillaDescuentos.getColumnModel().getColumn(2).setPreferredWidth(0);
            GrillaDescuentos.getColumnModel().getColumn(2).setMaxWidth(0);
        }

        jLabel4.setFont(new java.awt.Font("Tahoma", 1, 11)); // NOI18N
        jLabel4.setForeground(new java.awt.Color(84, 57, 31));
        jLabel4.setText("Mutual");

        jLabel5.setFont(new java.awt.Font("Tahoma", 1, 11)); // NOI18N
        jLabel5.setForeground(new java.awt.Color(84, 57, 31));
        jLabel5.setText("Cesantia");

        jLabel6.setFont(new java.awt.Font("Tahoma", 1, 11)); // NOI18N
        jLabel6.setForeground(new java.awt.Color(84, 57, 31));
        jLabel6.setText("S.I.S");

        txMutual.setText("0");

        txCesantia.setText("0");

        txSis.setText("0");

        jLabel7.setFont(new java.awt.Font("Tahoma", 1, 11)); // NOI18N
        jLabel7.setForeground(new java.awt.Color(0, 0, 102));
        jLabel7.setText("TOTAL A PAGAR");

        txTotal.setEditable(false);
        txTotal.setHorizontalAlignment(javax.swing.JTextField.RIGHT);

        cbDetalleId.setModel(new javax.swing.DefaultComboBoxModel<>(new String[] { "Seleccione" }));
        cbDetalleId.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                cbDetalleIdActionPerformed(evt);
            }
        });

        btEliminaHaber.setIcon(new javax.swing.ImageIcon(getClass().getResource("/Iconos16/Cancel16.png"))); // NOI18N
        btEliminaHaber.setEnabled(false);
        btEliminaHaber.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btEliminaHaberActionPerformed(evt);
            }
        });

        btEliminaDescuento.setIcon(new javax.swing.ImageIcon(getClass().getResource("/Iconos16/Cancel16.png"))); // NOI18N
        btEliminaDescuento.setEnabled(false);
        btEliminaDescuento.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btEliminaDescuentoActionPerformed(evt);
            }
        });

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(this);
        this.setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addGap(20, 20, 20)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                    .addComponent(pnMenu, javax.swing.GroupLayout.Alignment.TRAILING, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                    .addGroup(layout.createSequentialGroup()
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                            .addComponent(jLabel4, javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(txMutual, javax.swing.GroupLayout.Alignment.LEADING, javax.swing.GroupLayout.PREFERRED_SIZE, 122, javax.swing.GroupLayout.PREFERRED_SIZE))
                        .addGap(18, 18, 18)
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(txCesantia, javax.swing.GroupLayout.PREFERRED_SIZE, 122, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(jLabel5))
                        .addGap(18, 18, 18)
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addGroup(layout.createSequentialGroup()
                                .addComponent(jLabel6)
                                .addGap(185, 678, Short.MAX_VALUE))
                            .addGroup(layout.createSequentialGroup()
                                .addComponent(txSis, javax.swing.GroupLayout.PREFERRED_SIZE, 122, javax.swing.GroupLayout.PREFERRED_SIZE)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                                .addComponent(jLabel7)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                .addComponent(txTotal, javax.swing.GroupLayout.PREFERRED_SIZE, 153, javax.swing.GroupLayout.PREFERRED_SIZE))))
                    .addComponent(jPanel1, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                    .addComponent(jPanel2, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                    .addGroup(layout.createSequentialGroup()
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(btEliminaHaber, javax.swing.GroupLayout.PREFERRED_SIZE, 22, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(jScrollPane1, javax.swing.GroupLayout.PREFERRED_SIZE, 481, javax.swing.GroupLayout.PREFERRED_SIZE))
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addGroup(layout.createSequentialGroup()
                                .addComponent(btEliminaDescuento, javax.swing.GroupLayout.PREFERRED_SIZE, 27, javax.swing.GroupLayout.PREFERRED_SIZE)
                                .addGap(443, 465, Short.MAX_VALUE))
                            .addComponent(jScrollPane2))))
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, layout.createSequentialGroup()
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                .addComponent(cbDetalleId, javax.swing.GroupLayout.PREFERRED_SIZE, 153, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addContainerGap())
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(pnMenu, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addComponent(jPanel1, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(jPanel2, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(jScrollPane1, javax.swing.GroupLayout.PREFERRED_SIZE, 249, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(jScrollPane2, javax.swing.GroupLayout.PREFERRED_SIZE, 249, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(btEliminaDescuento)
                    .addComponent(btEliminaHaber))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel4)
                    .addComponent(jLabel5)
                    .addComponent(jLabel6))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(txMutual, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(txCesantia, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(txSis, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(jLabel7)
                    .addComponent(txTotal, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(cbDetalleId, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addContainerGap(31, Short.MAX_VALUE))
        );
    }// </editor-fold>//GEN-END:initComponents
    

    private void SetEstados(int Estado){
        /*-- Nada --*/
        if(Estado==1){
            //Botones
            btGuardar.setEnabled(false);
            btCancelar.setEnabled(false);
            btEditar.setEnabled(false);
            btAbrir.setEnabled(true);
            btNuevo.setEnabled(true);
            
            Limpiar();
            Habilitar(false);
            Editar(false);
            
            EstadoGeneral=1;
        }
        /*-- Nuevo --*/
        else if(Estado==2){
            //Botones
            btGuardar.setEnabled(true);
            btCancelar.setEnabled(true);
            btAbrir.setEnabled(false);
            btNuevo.setEnabled(false);
            btEditar.setEnabled(false);
            
            txRut.setEnabled(true);
            btIr.setEnabled(true);
            txRut.requestFocus();
            Habilitar(true);
            Editar(true);
            EstadoGeneral = 2;
        }
        /*-- Abrir --*/
        else if(Estado==3){
            //Botones
            btGuardar.setEnabled(false);
            btCancelar.setEnabled(false);
            btAbrir.setEnabled(true);
            btNuevo.setEnabled(true);
            btEditar.setEnabled(true);
            
            txRut.setEnabled(true);
            btIr.setEnabled(true);
            txRut.requestFocus();
            Habilitar(true);
            Editar(false);
            EstadoGeneral = 3;
        }
        /*-- Abrir --*/
        else if(Estado==4){
             //Botones
            btGuardar.setEnabled(true);
            btCancelar.setEnabled(true);
            btAbrir.setEnabled(false);
            btNuevo.setEnabled(false);
            btEditar.setEnabled(false);
            
            Editar(true);
            EstadoGeneral=4;
            
        }
        
    }
    private void Limpiar(){
        txRut.setText("");
        txNombre.setText("");
        txMutual.setText("");
        txCesantia.setText("");
        txSis.setText("");
        txMonto.setText("");
        txTotal.setText("");
        cbAgno.setSelectedIndex(0);
        cbMes.setSelectedIndex(0);
        cbTipo.setSelectedIndex(0);
        cbDetalle.setSelectedIndex(0);
        cbDetalleId.setSelectedIndex(0);
        fmMain.LimpiaGrilla((DefaultTableModel) GrillaHaberes.getModel());
        fmMain.LimpiaGrilla((DefaultTableModel) GrillaDescuentos.getModel());
    }
    private void Editar(boolean Estado){
        txMutual.setEditable(Estado);
        txCesantia.setEditable(Estado);
        txSis.setEditable(Estado);
        btEliminaHaber.setEnabled(Estado);
        btEliminaDescuento.setEnabled(Estado);
        cbTipo.setEnabled(Estado);
        cbDetalle.setEnabled(Estado);
        txMonto.setEnabled(Estado);
        btAgregar.setEnabled(Estado);
        GrillaHaberes.setEnabled(Estado);
        GrillaDescuentos.setEnabled(Estado);
    }
    private void Habilitar(boolean Estado){
        txRut.setEnabled(Estado);
        txNombre.setEnabled(Estado);
        txMutual.setEnabled(Estado);
        txCesantia.setEnabled(Estado);
        txSis.setEnabled(Estado);
        txTotal.setEnabled(Estado);
        txMonto.setEnabled(Estado);
        btIr.setEnabled(Estado);
        btAgregar.setEnabled(Estado);
        cbDetalle.setEnabled(Estado);
        cbTipo.setEnabled(Estado);
        cbAgno.setEnabled(Estado);
        cbMes.setEnabled(Estado);
        btEliminaDescuento.setEnabled(Estado);
        btEliminaHaber.setEnabled(Estado);
    }
    private void btNuevoActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btNuevoActionPerformed
        SetEstados(1);
        txRut.setEnabled(true);
        btIr.setEnabled(true);
        txRut.requestFocus();
        SetEstados(2);
        nuevo = 1;
    }//GEN-LAST:event_btNuevoActionPerformed

    private void btCancelarActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btCancelarActionPerformed
        SetEstados(1);
        nuevo = 0;
    }//GEN-LAST:event_btCancelarActionPerformed

    private void btIrActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btIrActionPerformed
        
        
        if (!txRut.getText().isEmpty()) {
            CargaPersonal(txRut.getText().trim());
        } else {
            jdAgregaDato Dato = new jdAgregaDato(null, true);
            Dato.setLocationRelativeTo(null);
            Dato.setTitle("Trabajador");
            Dato.CargaDatos("select rut as codigo,nombre\n"
                    + "from personal \n"
                    + "where rut>1000\n"
                    + "order by nombre ");
            Dato.setVisible(true);
            if (!Dato.GetCodigo().isEmpty()) {
                CargaPersonal(Dato.GetCodigo());
            }
            else{
                SetEstados(1);
            }
        }
                
    }//GEN-LAST:event_btIrActionPerformed

    public void CargaPersonal(String Rut)
    {
        ExeSql Sql = new ExeSql();
        ResultSet Rs;
        try {
            Rs = Sql.Select("select rut,nombre\n" +
                            "from personal\n" +
                            "where rut=" + Rut);
            if(Sql.GetRowCount()>0){
                Rs.next();
                txRut.setText(Rs.getString("rut").trim());
                txNombre.setText(Rs.getString("nombre").trim());
                CargaAbonosDescuentos(Rut);
            }
            else 
            {
                 if(fmMain.OkCancel("¿El Rut no existe, desea crear un nuevo perfil?")== JOptionPane.OK_OPTION){
                    jdPersonalPerfil Perfil = new jdPersonalPerfil(null, true);
                    Perfil.setLocationRelativeTo(null);
                    Perfil.setTitle("Perfil Trabajador");
                    Perfil.setVisible(true);  
                 }
            }
           
        } catch (Exception e) {
            System.out.println(e.getMessage());
        }finally{
            Sql.Close();
        }
    }
    private void CargaAbonosDescuentos(String Rut){
        DefaultTableModel ModeloH = (DefaultTableModel) GrillaHaberes.getModel();
        DefaultTableModel ModeloD = (DefaultTableModel) GrillaDescuentos.getModel();
        
        fmMain.LimpiaGrilla(ModeloH);
        fmMain.LimpiaGrilla(ModeloD);
        
        ExeSql Sql = new ExeSql();
        ResultSet Rs;
        try {
            Rs = Sql.Select("select pg.tipo,pg.codigo,pg.nombre\n" +
                            "from personalhd hd \n" +
                            "left join par_general pg on pg.tipo=hd.tipo and pg.codigo=hd.codigo\n" +
                            "where hd.rut="+ Rut +"\n" +
                            "order by pg.tipo");
            while(Rs.next()){
                if(Rs.getString("tipo").trim().equals("REM_HABERES"))
                    ModeloH.addRow(new Object[]{Rs.getString("nombre").trim(),"0",Rs.getInt("codigo")});
                else
                   ModeloD.addRow(new Object[]{Rs.getString("nombre").trim(),"0",Rs.getInt("codigo")});
            }
        } catch (Exception e) {
            fmMain.Mensaje(e.getMessage());
        }finally{
            Sql.Close();
        }
    };
    private void txRutKeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_txRutKeyPressed
        if(evt.getKeyCode()==KeyEvent.VK_ENTER){
            btIr.doClick();
        }
    }//GEN-LAST:event_txRutKeyPressed

    private void cbTipoActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cbTipoActionPerformed
        cbDetalle.setModel(new javax.swing.DefaultComboBoxModel(new String[] {}));
        cbDetalle.addItem("Seleccione Detalle");
        cbDetalleId.setModel(new javax.swing.DefaultComboBoxModel(new String[] {}));
        cbDetalleId.addItem("Seleccione");
        if (cbTipo.getSelectedIndex()!=0) 
                {
                String tipo;
                
                if (cbTipo.getSelectedItem().equals("Haberes"))
                    {tipo = "REM_HABERES";}
                else
                    {tipo = "REM_DESCUENTOS";}
                
                ExeSql Sql = new ExeSql();
                ResultSet Rs;
        try {

                    Rs = Sql.Select("select codigo, nombre\n" +
                                    "from par_general\n" +
                                    "where tipo='" + tipo + "' and vigente=1");
                    while(Rs.next())
                        {
                        cbDetalle.addItem(Rs.getString("nombre"));
                        cbDetalleId.addItem(Rs.getString("codigo"));
                        }
                    
        }
        catch (Exception e) {
            System.out.println(e.getMessage());
        }finally{
            Sql.Close();
        }
        }
    }//GEN-LAST:event_cbTipoActionPerformed


    
    private void cbDetalleActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cbDetalleActionPerformed
        cbDetalleId.setSelectedIndex(cbDetalle.getSelectedIndex());
        txMonto.requestFocus();
    }//GEN-LAST:event_cbDetalleActionPerformed

    private void cbDetalleIdActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cbDetalleIdActionPerformed
                   
    }//GEN-LAST:event_cbDetalleIdActionPerformed

    private void cbDetalleMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_cbDetalleMouseClicked
        
    }//GEN-LAST:event_cbDetalleMouseClicked

    private void btAgregarActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btAgregarActionPerformed
        if(txMonto.getText().equals(""))
            {
            {fmMain.Mensaje("Debe ingresar un monto"); return;}
            }
    
        if(txTotal.getText().equals(""))
            {
            txTotal.setText("0");
            }
        if(cbTipo.getSelectedItem().equals("Haberes"))
            {
            for(int i=0; i< GrillaHaberes.getRowCount();i++)
                {
                if (cbDetalle.getSelectedItem().toString().equals(GrillaHaberes.getValueAt(i,0).toString().trim()))
                    {
                      fmMain.Mensaje("Usted ya ingreso un item: "+cbDetalle.getSelectedItem().toString()); return; 
                    }            
                }
                
            DefaultTableModel Model = (DefaultTableModel) GrillaHaberes.getModel();
            Model.addRow(new Object[]{
                cbDetalle.getSelectedItem().toString().trim(),
                txMonto.getText().trim(),
                cbDetalleId.getSelectedItem().toString().trim()
            });
            txTotal.setText(String.valueOf(Double.valueOf(txTotal.getText().trim())+Double.valueOf(txMonto.getText().trim())));
            }
        else if(cbTipo.getSelectedItem().equals("Descuentos"))
                        {
            for(int i=0; i< GrillaDescuentos.getRowCount();i++)
                {
                if (cbDetalle.getSelectedItem().toString().equals(GrillaDescuentos.getValueAt(i,0).toString().trim()))
                    {
                      fmMain.Mensaje("Usted ya ingreso un item: "+cbDetalle.getSelectedItem().toString()); return; 
                    }            
                }
            DefaultTableModel Model = (DefaultTableModel) GrillaDescuentos.getModel();
            Model.addRow(new Object[]{
                cbDetalle.getSelectedItem().toString().trim(),
                txMonto.getText().trim(),
                cbDetalleId.getSelectedItem().toString().trim()
            });
            txTotal.setText(String.valueOf(Double.valueOf(txTotal.getText().trim())- Double.valueOf(txMonto.getText().trim())));
            }
        else if(cbTipo.getSelectedItem().equals("Seleccione Tipo"))
        {
            fmMain.Mensaje("Debe seleccionar Tipo"); return;
           
        }
        else if(cbDetalle.getSelectedItem().equals("Seleccione Detalle"))
        {fmMain.Mensaje("Debe seleccionar un detalle"); return;}
        
        txMonto.setText("");
        
    }//GEN-LAST:event_btAgregarActionPerformed
    private void Sumador(){
        double TotalH=0;
        double TotalD=0;
        double Total=0;
        System.out.println("sumado");
        for(int i=0; i<GrillaHaberes.getRowCount();i++)
            TotalH = TotalH + Double.valueOf(GrillaHaberes.getValueAt(i,1).toString());
        for(int i=0; i<GrillaDescuentos.getRowCount();i++)
            TotalD = TotalD + Double.valueOf(GrillaDescuentos.getValueAt(i,1).toString());
        Total = TotalH - TotalD;
        txTotal.setText(fmMain.FormatoTotal(Total));
    }
    private void btGuardarActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btGuardarActionPerformed
        
        //Validaciones
        if(cbAgno.getSelectedIndex()<=0 || cbMes.getSelectedIndex()<=0){
            fmMain.Mensaje("Debe seleccionar MES y AÑO");
            return;
        }
        if(txSis.getText().isEmpty() || txMutual.getText().isEmpty() || txCesantia.getText().isEmpty()){
            fmMain.Mensaje("Falta información");
            return;
        }
            
        
        ExeSql Sql = new ExeSql();
        ResultSet Rs;
        double Haberes = 0;
        double Descuentos = 0;
        try{
        Rs = Sql.Select("SELECT count(rut) as existe from psueldos where rut="+ txRut.getText().trim() +" and agno="+
                 cbAgno.getSelectedItem().toString().trim() + " and mes="+cbMes.getSelectedIndex());
        Rs.next();
        if (Integer.valueOf(Rs.getString("existe").trim()) > 0)
            
            {
                if(fmMain.OkCancel("¿El ingreso ya existe, desea reemplazarlo?")== JOptionPane.OK_OPTION){
                    /****** ELIMINA ENC *********/
                    Sql.ExeSql("DELETE from psueldos where rut="+ txRut.getText().trim() +" and agno="+
                    cbAgno.getSelectedItem().toString().trim() + " and mes="+cbMes.getSelectedIndex());
                    /****** ELIMINA DET *********/
                    Sql.ExeSql("DELETE from psueldosdet where rut="+ txRut.getText().trim() +" and agno="+
                    cbAgno.getSelectedItem().toString().trim() + " and mes="+cbMes.getSelectedIndex());
                    Sql.Commit();
                }
            }
        
        for(int i=0; i< GrillaHaberes.getRowCount();i++){
            Sql.ExeSql("insert into psueldosdet (rut, agno, mes, codigo, monto) values(\n" +
                    txRut.getText().trim() + ",\n" +
                    cbAgno.getSelectedItem().toString().trim() + ",\n" +
                    cbMes.getSelectedIndex()+ ",\n" +
                    GrillaHaberes.getValueAt(i,2).toString().trim()+ ",\n" +
                    GrillaHaberes.getValueAt(i,1).toString().trim()+ "\n" +")");
            
            Haberes = Haberes + Double.parseDouble(GrillaHaberes.getValueAt(i,1).toString().trim());
           
        }
        for(int i=0; i< GrillaDescuentos.getRowCount();i++){
            Sql.ExeSql("insert into psueldosdet (rut, agno, mes, codigo, monto) values(\n" +
                    txRut.getText().trim() + ",\n" +
                    cbAgno.getSelectedItem().toString().trim() + ",\n" +
                    cbMes.getSelectedIndex()+ ",\n" +
                    GrillaDescuentos.getValueAt(i,2).toString().trim()+ ",\n" +
                    GrillaDescuentos.getValueAt(i,1).toString().trim()+ "\n" +")");
            
           Descuentos = Descuentos + Double.parseDouble(GrillaDescuentos.getValueAt(i,1).toString().trim()); 
        }
        
                Sql.ExeSql("insert into psueldos \n" +
                           "(rut,agno,mes,totalhaberes,totaldescuentos, totalmutual, totalcesantia, totalsis, totalapagar)values(\n" +
                            txRut.getText().trim() + ",\n" +
                            cbAgno.getSelectedItem().toString().trim() + ",\n" +
                            cbMes.getSelectedIndex()+ ",\n" +
                            Haberes + ",\n" +
                            Descuentos + ",\n" +
                            txMutual.getText().trim() + ",\n" +
                            txCesantia.getText().trim() + ",\n" +
                            txSis.getText().trim() + ",\n" +
                            (Haberes-Descuentos) +")");
             Sql.Commit();
            fmMain.Mensaje("Remuneracion guardada");
            SetEstados(1);
            
            
        } catch (Exception e) {
            System.out.println(e.getMessage());
            Sql.Rollback();
        } finally{
            Sql.Close();
            nuevo=0;
        }
    }//GEN-LAST:event_btGuardarActionPerformed

    private void btAbrirActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btAbrirActionPerformed
        
        Limpiar();
        Habilitar(false);
        txRut.setEnabled(true);
        btIr.setEnabled(true);
        txNombre.setEnabled(true);
        SetEstados(3);
        
        
        /*jdBuscaRemuneracion AddBuscaRemunera = new jdBuscaRemuneracion(null, true);
        AddBuscaRemunera.setTitle("Buscar registro");
        AddBuscaRemunera.setLocationRelativeTo(null);
        AddBuscaRemunera.setVisible(true);

        if (!AddBuscaRemunera.Ok) {
            return;
        }

        txMutual.setText(AddBuscaRemunera.totalmutual);
        txCesantia.setText(AddBuscaRemunera.totalcesantia);
        txSis.setText(AddBuscaRemunera.totalsis);
        txTotal.setText(AddBuscaRemunera.totalapagar);
        txRut.setText(AddBuscaRemunera.rut);
        Habilitar(true);
        btIr.doClick();
        btIr.setEnabled(false);

        cbAgno.setSelectedItem(AddBuscaRemunera.agno);
        cbMes.setSelectedItem(AddBuscaRemunera.mes);

        DefaultTableModel ModelH = (DefaultTableModel) GrillaHaberes.getModel();
        int i = 0;
        while (i < AddBuscaRemunera.hastaH) {
            ModelH.addRow(new Object[]{AddBuscaRemunera.detH[i], AddBuscaRemunera.detH[i + 1], AddBuscaRemunera.detH[i + 2]});
            i = i + 3;
        }

        int j = 0;
        DefaultTableModel ModelD = (DefaultTableModel) GrillaDescuentos.getModel();
        while (j < AddBuscaRemunera.hastaD) {
            ModelD.addRow(new Object[]{AddBuscaRemunera.detD[j], AddBuscaRemunera.detD[j + 1], AddBuscaRemunera.detD[j + 2]});
            j = j + 3;
        }
        SetEstados(2);*/
    }//GEN-LAST:event_btAbrirActionPerformed

    private void txMontoKeyTyped(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_txMontoKeyTyped
char car = evt.getKeyChar();
        
        if (car=='.')
            {   
            char x;
            int conta=0;
            for (int y=0; y < txMonto.getText().length(); y++ )
                        {
                        x = txMonto.getText().charAt(y);
                 
                        if (x=='.')
                            {
                             conta++;
                            }
                        if (conta==1)
                            {
                            evt.consume(); 
                            }
                        }
                }
            
            if(((car<'0') || (car>'9')) && ((car<'.') || (car>'.')))
                {

                  evt.consume(); 
                }        
 
    }//GEN-LAST:event_txMontoKeyTyped

    private void txMontoKeyReleased(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_txMontoKeyReleased
        char car = evt.getKeyChar();
        
        if (car=='.')
            {   
            char x;
            for (int y=0; y < txMonto.getText().length(); y++ )
                        {
                            x = txMonto.getText().charAt(y);
                        if (y==0 && x=='.')
                        {
                            txMonto.setText("0.");
                        }
                        
                        }
                }
            
    }//GEN-LAST:event_txMontoKeyReleased

    private void btEliminaHaberActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btEliminaHaberActionPerformed
        if(fmMain.OkCancel("Eliminar Haber " + GrillaHaberes.getValueAt(GrillaHaberes.getSelectedRow(),0).toString().trim()) == JOptionPane.OK_OPTION){
            txTotal.setText(String.valueOf(Double.valueOf(txTotal.getText().trim())- Double.valueOf(GrillaHaberes.getValueAt(GrillaHaberes.getSelectedRow(),1).toString())));
            DefaultTableModel tbMd = (DefaultTableModel) GrillaHaberes.getModel();
            tbMd.removeRow(GrillaHaberes.getSelectedRow());
        }
    }//GEN-LAST:event_btEliminaHaberActionPerformed

    private void btEliminaDescuentoActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btEliminaDescuentoActionPerformed
        if(fmMain.OkCancel("Eliminar Descuento " + GrillaDescuentos.getValueAt(GrillaDescuentos.getSelectedRow(),0).toString().trim()) == JOptionPane.OK_OPTION){
            double Total = Double.valueOf(txTotal.getText().trim());
            double Descuento = Double.valueOf(GrillaDescuentos.getValueAt(GrillaDescuentos.getSelectedRow(),1).toString());
            txTotal.setText(String.valueOf(Double.valueOf(txTotal.getText().trim())+ Double.valueOf(GrillaDescuentos.getValueAt(GrillaDescuentos.getSelectedRow(),1).toString())));
            DefaultTableModel tbMd = (DefaultTableModel) GrillaDescuentos.getModel();
            tbMd.removeRow(GrillaDescuentos.getSelectedRow());
        }
    }//GEN-LAST:event_btEliminaDescuentoActionPerformed

    private void btEditarActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btEditarActionPerformed
        SetEstados(4);
    }//GEN-LAST:event_btEditarActionPerformed

    private void cbAgnoActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cbAgnoActionPerformed
        if(EstadoGeneral==3 || nuevo==0){
            AbrirRemuneracion();
        }
    }//GEN-LAST:event_cbAgnoActionPerformed

    private void cbMesActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cbMesActionPerformed
        if(EstadoGeneral==3 || nuevo==0){
            AbrirRemuneracion();
        }
        
    }//GEN-LAST:event_cbMesActionPerformed

    private void txMontoKeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_txMontoKeyPressed
        if(evt.getKeyCode()==KeyEvent.VK_ENTER){
            btAgregar.doClick();
        }
    }//GEN-LAST:event_txMontoKeyPressed
    private void AbrirRemuneracion(){
        String rut = txRut.getText().trim();
        String agno = cbAgno.getSelectedItem().toString().trim();
        String mes = cbMes.getSelectedItem().toString().trim();
        String elmes= String.valueOf(cbMes.getSelectedIndex());
        
        DefaultTableModel ModelH = (DefaultTableModel) GrillaHaberes.getModel();
        DefaultTableModel ModelD = (DefaultTableModel) GrillaDescuentos.getModel();
        
        fmMain.LimpiaGrilla(ModelD);
        fmMain.LimpiaGrilla(ModelH);
        lbEstado.setText("");
        
        if (rut.equals("") || agno.equals("AÑO") || mes.equals("MES"))
        {
            return;
        }
        ExeSql Sql = new ExeSql();
        ResultSet Rs;


        
        try {
        if (nuevo ==1)
            {
                //ULTIMO MES-AGNO INGRESADO
                Rs = Sql.Select("select max(agno) as ultagno, max(mes) as ultmes from psueldosdet where rut=" + rut);
                Rs.next();
                agno = Rs.getString("ultagno");
                elmes = Rs.getString("ultmes");
            }

            //HABERES
            Rs = Sql.Select("select p.nombre, det.monto, det.codigo\n" +
                        "from psueldosdet det\n" +
                        "left join par_general p on det.codigo=p.codigo\n" +
                        " where det.rut="+ rut + " and det.agno="+ agno +" and det.mes="+elmes+
                        " and p.tipo in ('REM_HABERES')");
            while(Rs.next()){
                ModelH.addRow(new Object[]{Rs.getString("nombre").trim(),Rs.getString("monto").trim(),Rs.getString("codigo").trim()});
            }
            
            //DESUENTOS
            Rs = Sql.Select("select p.nombre, det.monto, det.codigo\n" +
                        "from psueldosdet det\n" +
                        "left join par_general p on det.codigo=p.codigo\n" +
                        " where det.rut="+ rut + " and det.agno="+ agno +" and det.mes="+elmes+
                        " and p.tipo in ('REM_DESCUENTOS')");
            while(Rs.next()){
                ModelD.addRow(new Object[]{Rs.getString("nombre").trim(),Rs.getString("monto").trim(),Rs.getString("codigo").trim()});
            }
            
            //OTROS
            Rs = Sql.Select("select s.totalmutual, s.totalcesantia, s.totalsis, s.totalapagar,count(c.*) as Estado\n" +
                            "from psueldos s\n" +
                            "left join psueldosconta c on s.agno=c.agno and s.mes=c.mes\n" +
                            "where s.rut="+ rut +" and s.agno="+ agno + " and s.mes="+elmes + "\n" +
                            "group by s.totalmutual, s.totalcesantia, s.totalsis, s.totalapagar");
            
            if(Sql.GetRowCount()>0){
                Rs.next();
                txMutual.setText(Rs.getString("totalmutual").trim());
                txCesantia.setText(Rs.getString("totalcesantia").trim());
                txSis.setText(Rs.getString("totalsis").trim());
                txTotal.setText(Rs.getString("totalapagar").trim());
                if (nuevo==1)
                {
                    return;
                }
                if(Rs.getInt("Estado")==0){
                    lbEstado.setText("ABIERTO");
                    lbEstado.setForeground(new Color(51,102,0));
                    btEditar.setEnabled(true);
                }
                else{
                    lbEstado.setText("CERRADO");
                    lbEstado.setForeground(Color.red);
                    btEditar.setEnabled(false);
                }
            }
        } catch (Exception e) {
            System.out.println(e.getMessage());
        }finally{
            Sql.Close();
        }
        
    }

    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JTable GrillaDescuentos;
    private javax.swing.JTable GrillaHaberes;
    private javax.swing.JButton btAbrir;
    private javax.swing.JButton btAgregar;
    private javax.swing.JButton btCancelar;
    private javax.swing.JButton btEditar;
    private javax.swing.JButton btEliminaDescuento;
    private javax.swing.JButton btEliminaHaber;
    private javax.swing.JButton btGuardar;
    private javax.swing.JButton btIr;
    private javax.swing.JButton btNuevo;
    private javax.swing.JComboBox<String> cbAgno;
    private javax.swing.JComboBox<String> cbDetalle;
    private javax.swing.JComboBox<String> cbDetalleId;
    private javax.swing.JComboBox<String> cbMes;
    private javax.swing.JComboBox<String> cbTipo;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JLabel jLabel2;
    private javax.swing.JLabel jLabel3;
    private javax.swing.JLabel jLabel4;
    private javax.swing.JLabel jLabel5;
    private javax.swing.JLabel jLabel6;
    private javax.swing.JLabel jLabel7;
    private javax.swing.JLabel jLabel8;
    private javax.swing.JPanel jPanel1;
    private javax.swing.JPanel jPanel2;
    private javax.swing.JScrollPane jScrollPane1;
    private javax.swing.JScrollPane jScrollPane2;
    private javax.swing.JLabel lbEstado;
    private javax.swing.JPanel pnMenu;
    public javax.swing.JTextField txCesantia;
    private javax.swing.JTextField txMonto;
    public javax.swing.JTextField txMutual;
    private javax.swing.JTextField txNombre;
    private javax.swing.JTextField txRut;
    public javax.swing.JTextField txSis;
    public javax.swing.JTextField txTotal;
    // End of variables declaration//GEN-END:variables
}
