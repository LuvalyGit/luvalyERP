/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package Dialogos;

import Conexion.ExeSql;
import Formularios.fmMain;
import Utilidades.StockReloadWorker;
import java.awt.Toolkit;
import java.awt.datatransfer.Clipboard;
import java.awt.datatransfer.StringSelection;
import java.awt.event.KeyEvent;
import java.io.IOException;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.text.SimpleDateFormat;
import java.util.Date;
import java.util.logging.Level;
import java.util.logging.Logger;
import javax.swing.JOptionPane;
import javax.swing.SwingConstants;
import javax.swing.table.DefaultTableCellRenderer;
import javax.swing.table.DefaultTableModel;

/**
 *
 * @author DavidAlcaman
 */
public class jd_UbicacionProductos extends javax.swing.JDialog {

    DefaultTableCellRenderer rightRenderer = new DefaultTableCellRenderer();
    private Object GrillaOCS;
    public boolean Ingresa = false;

    public static int pano;
    public static int pmes;
    public static int pmes_oc;
    public static int convenio = 0;
    public static int Id = 0;
    public static String Fecha = "";
    public static int esFecha = 0;
    public static int pistoleados = 0;
    public static int NoEncontrado = 0;

    Date hoy = new Date();

    int id_trans = -1;
    String Ubicacion_sel = "", UbicaCodigo_Sel = "";
    private Object btIngresar;

    int ExisteNCP = 0;   //Si hay Facturas o Guias de Proveedor sin Autorizar de un determinado SKU

    /**
     * Creates new form jdTrasnporte
     */
    public jd_UbicacionProductos(java.awt.Frame parent, boolean modal) {
        super(parent, modal);
        initComponents();
        txCant.addKeyListener(new java.awt.event.KeyAdapter() {
            @Override
            public void keyReleased(java.awt.event.KeyEvent evt) {
                // Sincroniza el contador 'pistoleados' con lo que esté en 'txCant'
                try {
                    String currentText = txCant.getText().trim();
                    if (currentText.isEmpty()) {
                        pistoleados = 0; // Si lo borra, el contador se resetea a 0
                    } else {
                        // Si escribe un número, el contador se actualiza a ese número
                        pistoleados = Integer.parseInt(currentText);
                    }
                } catch (NumberFormatException e) {
                    // Si escribe "abc" o algo inválido (aunque keyTyped lo previene)
                    pistoleados = 0;
                }
            }
        });
        //Setea fecha inicial Desde y Hasta
        Date date = new Date();

        rightRenderer.setHorizontalAlignment(SwingConstants.RIGHT);
        Grilla.getColumnModel().getColumn(0).setCellRenderer(rightRenderer);
        Grilla.getColumnModel().getColumn(2).setCellRenderer(rightRenderer);
        Grilla.getColumnModel().getColumn(4).setCellRenderer(rightRenderer);

        if (fmMain.GetUsuarioEligeUbicacion()) {

            btUbc.setEnabled(true);

        } else {

            btUbc.setEnabled(false);

        }

        lblCodOrigen.setVisible(false);

        pnAnticipada.setVisible(false);

        jLabel4.setVisible(false);
        lbStock.setVisible(false);

        jLabel8.setVisible(false);
        lbTotal.setVisible(false);
        txCant.setEditable(false);

    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        jPopupMenu2 = new javax.swing.JPopupMenu();
        mnuCopiarOrden = new javax.swing.JMenuItem();
        jScrollPane1 = new javax.swing.JScrollPane();
        Grilla = new javax.swing.JTable();
        btAceptar = new javax.swing.JButton();
        lblTotalDesp = new javax.swing.JLabel();
        jLabel1 = new javax.swing.JLabel();
        jLabel4 = new javax.swing.JLabel();
        lbStock = new javax.swing.JLabel();
        jPanel1 = new javax.swing.JPanel();
        txtUbicacion = new javax.swing.JTextField();
        txNombreUbica = new javax.swing.JTextField();
        jLabel3 = new javax.swing.JLabel();
        jLabel5 = new javax.swing.JLabel();
        txCant = new javax.swing.JTextField();
        jLabel6 = new javax.swing.JLabel();
        btUbc = new javax.swing.JButton();
        jLabel11 = new javax.swing.JLabel();
        txCodigo = new javax.swing.JTextField();
        btOk = new javax.swing.JButton();
        pnAnticipada = new javax.swing.JPanel();
        jScrollPane4 = new javax.swing.JScrollPane();
        Grilla_Ant = new javax.swing.JTable();
        chkAnticipada_ant = new javax.swing.JCheckBox();
        btAuth = new javax.swing.JButton();
        jLabel8 = new javax.swing.JLabel();
        lbTotal = new javax.swing.JLabel();
        jPanel2 = new javax.swing.JPanel();
        jLabel2 = new javax.swing.JLabel();
        lbSku = new javax.swing.JLabel();
        lbSkuDesc = new javax.swing.JLabel();
        jLabel7 = new javax.swing.JLabel();
        lblDescOrigen = new javax.swing.JLabel();
        lblCodOrigen = new javax.swing.JLabel();
        lblUnidad = new javax.swing.JLabel();
        jLabel9 = new javax.swing.JLabel();
        lblPendiente = new javax.swing.JLabel();
        jLabel10 = new javax.swing.JLabel();
        lblAnticipada = new javax.swing.JLabel();
        jScrollPane2 = new javax.swing.JScrollPane();
        Grilla_detalle = new javax.swing.JTable();
        jPanel3 = new javax.swing.JPanel();
        jScrollPane3 = new javax.swing.JScrollPane();
        Grilla_detalle_posibles = new javax.swing.JTable();
        jLabel12 = new javax.swing.JLabel();
        lblAnticipada_Sala_H = new javax.swing.JLabel();
        jLabel13 = new javax.swing.JLabel();
        lblAnticipada_Sala_P = new javax.swing.JLabel();

        mnuCopiarOrden.setText("Copiar Orden");
        mnuCopiarOrden.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                mnuCopiarOrdenActionPerformed(evt);
            }
        });
        jPopupMenu2.add(mnuCopiarOrden);

        setDefaultCloseOperation(javax.swing.WindowConstants.DISPOSE_ON_CLOSE);

        Grilla.setAutoCreateRowSorter(true);
        Grilla.setBorder(javax.swing.BorderFactory.createLineBorder(new java.awt.Color(0, 0, 0)));
        Grilla.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {

            },
            new String [] {
                "Sku", "Nombre", "Unidad", "cod_ubica", "Ubicacion", "Cantidad"
            }
        ) {
            boolean[] canEdit = new boolean [] {
                false, false, false, true, false, false
            };

            public boolean isCellEditable(int rowIndex, int columnIndex) {
                return canEdit [columnIndex];
            }
        });
        Grilla.setColumnSelectionAllowed(true);
        Grilla.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                GrillaMouseClicked(evt);
            }
        });
        jScrollPane1.setViewportView(Grilla);
        Grilla.getColumnModel().getSelectionModel().setSelectionMode(javax.swing.ListSelectionModel.SINGLE_SELECTION);
        if (Grilla.getColumnModel().getColumnCount() > 0) {
            Grilla.getColumnModel().getColumn(0).setPreferredWidth(80);
            Grilla.getColumnModel().getColumn(1).setMinWidth(300);
            Grilla.getColumnModel().getColumn(1).setPreferredWidth(300);
            Grilla.getColumnModel().getColumn(1).setMaxWidth(400);
            Grilla.getColumnModel().getColumn(2).setMinWidth(130);
            Grilla.getColumnModel().getColumn(2).setPreferredWidth(130);
            Grilla.getColumnModel().getColumn(2).setMaxWidth(180);
            Grilla.getColumnModel().getColumn(3).setMinWidth(0);
            Grilla.getColumnModel().getColumn(3).setPreferredWidth(0);
            Grilla.getColumnModel().getColumn(3).setMaxWidth(0);
            Grilla.getColumnModel().getColumn(4).setMinWidth(200);
            Grilla.getColumnModel().getColumn(4).setPreferredWidth(200);
            Grilla.getColumnModel().getColumn(5).setMinWidth(70);
            Grilla.getColumnModel().getColumn(5).setPreferredWidth(70);
            Grilla.getColumnModel().getColumn(5).setMaxWidth(80);
        }

        btAceptar.setText("Cerrar");
        btAceptar.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btAceptarActionPerformed(evt);
            }
        });

        lblTotalDesp.setFont(new java.awt.Font("Tahoma", 1, 14)); // NOI18N
        lblTotalDesp.setHorizontalAlignment(javax.swing.SwingConstants.RIGHT);
        lblTotalDesp.setText("0");

        jLabel1.setFont(new java.awt.Font("Tahoma", 1, 14)); // NOI18N
        jLabel1.setForeground(new java.awt.Color(204, 0, 0));
        jLabel1.setText("Pendiente         :");

        jLabel4.setFont(new java.awt.Font("Tahoma", 1, 14)); // NOI18N
        jLabel4.setText("Stock                 :");

        lbStock.setFont(new java.awt.Font("Tahoma", 1, 14)); // NOI18N
        lbStock.setHorizontalAlignment(javax.swing.SwingConstants.RIGHT);
        lbStock.setText("0");

        jPanel1.setToolTipText("Otra Ubicación");

        txtUbicacion.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                txtUbicacionKeyPressed(evt);
            }
            public void keyTyped(java.awt.event.KeyEvent evt) {
                txtUbicacionKeyTyped(evt);
            }
        });

        txNombreUbica.setEditable(false);
        txNombreUbica.setEnabled(false);

        jLabel3.setText("Codigo Ubicación");

        jLabel5.setText("Descripción Ubicación");

        txCant.setText("0");
        txCant.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                txCantActionPerformed(evt);
            }
        });
        txCant.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                txCantKeyPressed(evt);
            }
            public void keyTyped(java.awt.event.KeyEvent evt) {
                txCantKeyTyped(evt);
            }
        });

        jLabel6.setText("Cant");

        btUbc.setText("UBIC");
        btUbc.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btUbcActionPerformed(evt);
            }
        });

        jLabel11.setText("Código Producto :");

        txCodigo.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                txCodigoKeyPressed(evt);
            }
        });

        btOk.setText("GRABAR METRO");
        btOk.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btOkActionPerformed(evt);
            }
        });

        pnAnticipada.setBorder(javax.swing.BorderFactory.createEtchedBorder());

        Grilla_Ant.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {
                {null, null, null, null, null, null, null, null},
                {null, null, null, null, null, null, null, null},
                {null, null, null, null, null, null, null, null},
                {null, null, null, null, null, null, null, null}
            },
            new String [] {
                "Tipo", "Nro. Doc", "Codigo OC", "Orden", "Cantidad", "Sku", "ubc", "rut"
            }
        ) {
            boolean[] canEdit = new boolean [] {
                false, false, false, false, false, false, false, false
            };

            public boolean isCellEditable(int rowIndex, int columnIndex) {
                return canEdit [columnIndex];
            }
        });
        Grilla_Ant.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                Grilla_AntMouseClicked(evt);
            }
        });
        jScrollPane4.setViewportView(Grilla_Ant);
        if (Grilla_Ant.getColumnModel().getColumnCount() > 0) {
            Grilla_Ant.getColumnModel().getColumn(0).setMinWidth(45);
            Grilla_Ant.getColumnModel().getColumn(0).setPreferredWidth(45);
            Grilla_Ant.getColumnModel().getColumn(0).setMaxWidth(45);
            Grilla_Ant.getColumnModel().getColumn(1).setPreferredWidth(55);
            Grilla_Ant.getColumnModel().getColumn(2).setPreferredWidth(55);
            Grilla_Ant.getColumnModel().getColumn(3).setPreferredWidth(55);
            Grilla_Ant.getColumnModel().getColumn(4).setPreferredWidth(35);
            Grilla_Ant.getColumnModel().getColumn(5).setMinWidth(0);
            Grilla_Ant.getColumnModel().getColumn(5).setPreferredWidth(0);
            Grilla_Ant.getColumnModel().getColumn(5).setMaxWidth(0);
            Grilla_Ant.getColumnModel().getColumn(6).setMinWidth(0);
            Grilla_Ant.getColumnModel().getColumn(6).setPreferredWidth(0);
            Grilla_Ant.getColumnModel().getColumn(6).setMaxWidth(0);
            Grilla_Ant.getColumnModel().getColumn(7).setMinWidth(0);
            Grilla_Ant.getColumnModel().getColumn(7).setPreferredWidth(0);
            Grilla_Ant.getColumnModel().getColumn(7).setMaxWidth(0);
        }

        javax.swing.GroupLayout pnAnticipadaLayout = new javax.swing.GroupLayout(pnAnticipada);
        pnAnticipada.setLayout(pnAnticipadaLayout);
        pnAnticipadaLayout.setHorizontalGroup(
            pnAnticipadaLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(pnAnticipadaLayout.createSequentialGroup()
                .addContainerGap()
                .addComponent(jScrollPane4, javax.swing.GroupLayout.PREFERRED_SIZE, 341, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );
        pnAnticipadaLayout.setVerticalGroup(
            pnAnticipadaLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(pnAnticipadaLayout.createSequentialGroup()
                .addContainerGap()
                .addComponent(jScrollPane4, javax.swing.GroupLayout.PREFERRED_SIZE, 121, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );

        chkAnticipada_ant.setText("Anticipada Anterior");
        chkAnticipada_ant.setToolTipText("");

        btAuth.setText("HABILITAR CANTIDAD");
        btAuth.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btAuthActionPerformed(evt);
            }
        });

        javax.swing.GroupLayout jPanel1Layout = new javax.swing.GroupLayout(jPanel1);
        jPanel1.setLayout(jPanel1Layout);
        jPanel1Layout.setHorizontalGroup(
            jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel1Layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(jPanel1Layout.createSequentialGroup()
                        .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addGroup(jPanel1Layout.createSequentialGroup()
                                .addComponent(jLabel3)
                                .addGap(0, 0, Short.MAX_VALUE))
                            .addGroup(jPanel1Layout.createSequentialGroup()
                                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING, false)
                                    .addComponent(chkAnticipada_ant, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                                    .addComponent(txtUbicacion, javax.swing.GroupLayout.DEFAULT_SIZE, 132, Short.MAX_VALUE))
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                                .addComponent(btUbc)))
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                            .addGroup(jPanel1Layout.createSequentialGroup()
                                .addComponent(jLabel11, javax.swing.GroupLayout.PREFERRED_SIZE, 96, javax.swing.GroupLayout.PREFERRED_SIZE)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                                .addComponent(txCodigo))
                            .addComponent(txNombreUbica, javax.swing.GroupLayout.PREFERRED_SIZE, 293, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(jLabel5)))
                    .addGroup(jPanel1Layout.createSequentialGroup()
                        .addComponent(pnAnticipada, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addGap(158, 158, 158)))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                    .addGroup(jPanel1Layout.createSequentialGroup()
                        .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(jLabel6)
                            .addComponent(txCant, javax.swing.GroupLayout.PREFERRED_SIZE, 64, javax.swing.GroupLayout.PREFERRED_SIZE))
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(btOk, javax.swing.GroupLayout.PREFERRED_SIZE, 145, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addComponent(btAuth, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
                .addContainerGap())
        );
        jPanel1Layout.setVerticalGroup(
            jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel1Layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(jPanel1Layout.createSequentialGroup()
                        .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                            .addComponent(jLabel3)
                            .addComponent(jLabel5)
                            .addComponent(jLabel6))
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                            .addComponent(txtUbicacion, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(txNombreUbica, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(txCant, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(btUbc)))
                    .addComponent(btOk, javax.swing.GroupLayout.Alignment.TRAILING, javax.swing.GroupLayout.PREFERRED_SIZE, 44, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                        .addComponent(jLabel11, javax.swing.GroupLayout.PREFERRED_SIZE, 24, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addComponent(txCodigo, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addComponent(chkAnticipada_ant))
                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(jPanel1Layout.createSequentialGroup()
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                        .addComponent(pnAnticipada, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addGroup(jPanel1Layout.createSequentialGroup()
                        .addGap(26, 26, 26)
                        .addComponent(btAuth, javax.swing.GroupLayout.PREFERRED_SIZE, 55, javax.swing.GroupLayout.PREFERRED_SIZE)))
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );

        jLabel8.setFont(new java.awt.Font("Tahoma", 1, 14)); // NOI18N
        jLabel8.setText("Total                  :");

        lbTotal.setFont(new java.awt.Font("Tahoma", 1, 14)); // NOI18N
        lbTotal.setText("Tot");

        jLabel2.setFont(new java.awt.Font("Tahoma", 1, 18)); // NOI18N
        jLabel2.setText("Sku Consultado: ");

        lbSku.setFont(new java.awt.Font("Tahoma", 1, 18)); // NOI18N
        lbSku.setText("sku");
        lbSku.setBorder(javax.swing.BorderFactory.createLineBorder(new java.awt.Color(0, 0, 0)));

        lbSkuDesc.setFont(new java.awt.Font("Tahoma", 1, 18)); // NOI18N
        lbSkuDesc.setText("DescSku");
        lbSkuDesc.setBorder(javax.swing.BorderFactory.createLineBorder(new java.awt.Color(0, 0, 0)));

        jLabel7.setFont(new java.awt.Font("Tahoma", 1, 18)); // NOI18N
        jLabel7.setText("Ubicacion Origen");

        lblDescOrigen.setBackground(new java.awt.Color(0, 51, 204));
        lblDescOrigen.setFont(new java.awt.Font("Tahoma", 1, 18)); // NOI18N
        lblDescOrigen.setText("Descripcion-Origen");
        lblDescOrigen.setBorder(javax.swing.BorderFactory.createLineBorder(new java.awt.Color(0, 0, 0)));

        lblCodOrigen.setFont(new java.awt.Font("Tahoma", 1, 18)); // NOI18N
        lblCodOrigen.setText("Codigo-Origen");
        lblCodOrigen.setBorder(javax.swing.BorderFactory.createLineBorder(new java.awt.Color(0, 0, 0)));

        lblUnidad.setFont(new java.awt.Font("Tahoma", 1, 18)); // NOI18N
        lblUnidad.setHorizontalAlignment(javax.swing.SwingConstants.LEFT);
        lblUnidad.setText("unidad");
        lblUnidad.setBorder(javax.swing.BorderFactory.createLineBorder(new java.awt.Color(0, 0, 0)));

        javax.swing.GroupLayout jPanel2Layout = new javax.swing.GroupLayout(jPanel2);
        jPanel2.setLayout(jPanel2Layout);
        jPanel2Layout.setHorizontalGroup(
            jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel2Layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(jPanel2Layout.createSequentialGroup()
                        .addComponent(jLabel7)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                        .addComponent(lblCodOrigen, javax.swing.GroupLayout.PREFERRED_SIZE, 154, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addGap(32, 32, 32)
                        .addComponent(lblDescOrigen, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
                    .addGroup(jPanel2Layout.createSequentialGroup()
                        .addComponent(jLabel2)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                        .addComponent(lbSku, javax.swing.GroupLayout.PREFERRED_SIZE, 178, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addGap(10, 10, 10)
                        .addComponent(lbSkuDesc, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(lblUnidad, javax.swing.GroupLayout.PREFERRED_SIZE, 216, javax.swing.GroupLayout.PREFERRED_SIZE)))
                .addContainerGap())
        );
        jPanel2Layout.setVerticalGroup(
            jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel2Layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(lbSkuDesc)
                    .addComponent(jLabel2)
                    .addComponent(lbSku)
                    .addComponent(lblUnidad))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, 11, Short.MAX_VALUE)
                .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel7)
                    .addComponent(lblDescOrigen)
                    .addComponent(lblCodOrigen))
                .addContainerGap())
        );

        jLabel9.setFont(new java.awt.Font("Tahoma", 1, 14)); // NOI18N
        jLabel9.setText("Ubicados           :");

        lblPendiente.setFont(new java.awt.Font("Tahoma", 1, 14)); // NOI18N
        lblPendiente.setForeground(new java.awt.Color(204, 0, 0));
        lblPendiente.setHorizontalAlignment(javax.swing.SwingConstants.RIGHT);
        lblPendiente.setText("0");

        jLabel10.setFont(new java.awt.Font("Tahoma", 1, 14)); // NOI18N
        jLabel10.setForeground(new java.awt.Color(204, 0, 0));
        jLabel10.setText("Vta Anticipada :");

        lblAnticipada.setFont(new java.awt.Font("Tahoma", 1, 14)); // NOI18N
        lblAnticipada.setForeground(new java.awt.Color(204, 0, 0));
        lblAnticipada.setHorizontalAlignment(javax.swing.SwingConstants.RIGHT);
        lblAnticipada.setText("0");
        lblAnticipada.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                lblAnticipadaMouseClicked(evt);
            }
        });

        Grilla_detalle.setBorder(javax.swing.BorderFactory.createLineBorder(new java.awt.Color(0, 0, 0)));
        Grilla_detalle.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {

            },
            new String [] {
                "Orden", "Pendiente"
            }
        ) {
            boolean[] canEdit = new boolean [] {
                false, false
            };

            public boolean isCellEditable(int rowIndex, int columnIndex) {
                return canEdit [columnIndex];
            }
        });
        Grilla_detalle.setComponentPopupMenu(jPopupMenu2);
        Grilla_detalle.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                Grilla_detalleMouseClicked(evt);
            }
        });
        jScrollPane2.setViewportView(Grilla_detalle);

        Grilla_detalle_posibles.setBorder(javax.swing.BorderFactory.createLineBorder(new java.awt.Color(0, 0, 0)));
        Grilla_detalle_posibles.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {

            },
            new String [] {
                "SKU", "Producto", "Cantidad", "Separado", "Despachado"
            }
        ) {
            boolean[] canEdit = new boolean [] {
                false, false, false, false, false
            };

            public boolean isCellEditable(int rowIndex, int columnIndex) {
                return canEdit [columnIndex];
            }
        });
        jScrollPane3.setViewportView(Grilla_detalle_posibles);
        if (Grilla_detalle_posibles.getColumnModel().getColumnCount() > 0) {
            Grilla_detalle_posibles.getColumnModel().getColumn(0).setMinWidth(50);
            Grilla_detalle_posibles.getColumnModel().getColumn(0).setPreferredWidth(100);
            Grilla_detalle_posibles.getColumnModel().getColumn(0).setMaxWidth(200);
            Grilla_detalle_posibles.getColumnModel().getColumn(1).setMinWidth(100);
            Grilla_detalle_posibles.getColumnModel().getColumn(1).setPreferredWidth(200);
            Grilla_detalle_posibles.getColumnModel().getColumn(1).setMaxWidth(400);
            Grilla_detalle_posibles.getColumnModel().getColumn(2).setMinWidth(30);
            Grilla_detalle_posibles.getColumnModel().getColumn(2).setPreferredWidth(50);
            Grilla_detalle_posibles.getColumnModel().getColumn(2).setMaxWidth(150);
            Grilla_detalle_posibles.getColumnModel().getColumn(3).setMinWidth(30);
            Grilla_detalle_posibles.getColumnModel().getColumn(3).setPreferredWidth(50);
            Grilla_detalle_posibles.getColumnModel().getColumn(3).setMaxWidth(150);
            Grilla_detalle_posibles.getColumnModel().getColumn(4).setMinWidth(30);
            Grilla_detalle_posibles.getColumnModel().getColumn(4).setPreferredWidth(50);
            Grilla_detalle_posibles.getColumnModel().getColumn(4).setMaxWidth(100);
        }

        javax.swing.GroupLayout jPanel3Layout = new javax.swing.GroupLayout(jPanel3);
        jPanel3.setLayout(jPanel3Layout);
        jPanel3Layout.setHorizontalGroup(
            jPanel3Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGap(0, 466, Short.MAX_VALUE)
            .addGroup(jPanel3Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                .addGroup(jPanel3Layout.createSequentialGroup()
                    .addContainerGap()
                    .addComponent(jScrollPane3)
                    .addContainerGap()))
        );
        jPanel3Layout.setVerticalGroup(
            jPanel3Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGap(0, 224, Short.MAX_VALUE)
            .addGroup(jPanel3Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                .addGroup(jPanel3Layout.createSequentialGroup()
                    .addContainerGap()
                    .addComponent(jScrollPane3, javax.swing.GroupLayout.PREFERRED_SIZE, 202, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)))
        );

        jLabel12.setFont(new java.awt.Font("Tahoma", 1, 14)); // NOI18N
        jLabel12.setForeground(new java.awt.Color(204, 0, 0));
        jLabel12.setText("Vta Anticipada Sala Huerf.  :");

        lblAnticipada_Sala_H.setFont(new java.awt.Font("Tahoma", 1, 14)); // NOI18N
        lblAnticipada_Sala_H.setForeground(new java.awt.Color(204, 0, 0));
        lblAnticipada_Sala_H.setHorizontalAlignment(javax.swing.SwingConstants.RIGHT);
        lblAnticipada_Sala_H.setText("0");
        lblAnticipada_Sala_H.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                lblAnticipada_Sala_HMouseClicked(evt);
            }
        });

        jLabel13.setFont(new java.awt.Font("Tahoma", 1, 14)); // NOI18N
        jLabel13.setForeground(new java.awt.Color(204, 0, 0));
        jLabel13.setText("Vta Anticipada Sala PLC  :");

        lblAnticipada_Sala_P.setFont(new java.awt.Font("Tahoma", 1, 14)); // NOI18N
        lblAnticipada_Sala_P.setForeground(new java.awt.Color(204, 0, 0));
        lblAnticipada_Sala_P.setHorizontalAlignment(javax.swing.SwingConstants.RIGHT);
        lblAnticipada_Sala_P.setText("0");
        lblAnticipada_Sala_P.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                lblAnticipada_Sala_PMouseClicked(evt);
            }
        });

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(getContentPane());
        getContentPane().setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(layout.createSequentialGroup()
                        .addComponent(jPanel2, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(btAceptar, javax.swing.GroupLayout.PREFERRED_SIZE, 109, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addGroup(layout.createSequentialGroup()
                        .addComponent(jPanel1, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                            .addGroup(layout.createSequentialGroup()
                                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                                    .addComponent(jLabel4)
                                    .addComponent(jLabel8)
                                    .addComponent(jLabel9)
                                    .addComponent(jLabel1)
                                    .addComponent(jLabel10))
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                                    .addComponent(lblAnticipada, javax.swing.GroupLayout.Alignment.TRAILING, javax.swing.GroupLayout.DEFAULT_SIZE, 78, Short.MAX_VALUE)
                                    .addComponent(lblPendiente, javax.swing.GroupLayout.Alignment.TRAILING, javax.swing.GroupLayout.DEFAULT_SIZE, 78, Short.MAX_VALUE)
                                    .addComponent(lblTotalDesp, javax.swing.GroupLayout.Alignment.TRAILING, javax.swing.GroupLayout.DEFAULT_SIZE, 78, Short.MAX_VALUE)
                                    .addComponent(lbStock, javax.swing.GroupLayout.Alignment.TRAILING, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                                    .addComponent(lbTotal, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)))
                            .addGroup(layout.createSequentialGroup()
                                .addComponent(jLabel12)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                                .addComponent(lblAnticipada_Sala_H, javax.swing.GroupLayout.PREFERRED_SIZE, 78, javax.swing.GroupLayout.PREFERRED_SIZE))
                            .addGroup(layout.createSequentialGroup()
                                .addComponent(jLabel13)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                                .addComponent(lblAnticipada_Sala_P, javax.swing.GroupLayout.PREFERRED_SIZE, 78, javax.swing.GroupLayout.PREFERRED_SIZE)))
                        .addGap(18, 18, 18)
                        .addComponent(jPanel3, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
                    .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, layout.createSequentialGroup()
                        .addComponent(jScrollPane1, javax.swing.GroupLayout.PREFERRED_SIZE, 857, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                        .addComponent(jScrollPane2)))
                .addContainerGap())
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(layout.createSequentialGroup()
                        .addGap(10, 10, 10)
                        .addComponent(btAceptar, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
                    .addComponent(jPanel2, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                    .addComponent(jScrollPane1, javax.swing.GroupLayout.DEFAULT_SIZE, 200, Short.MAX_VALUE)
                    .addComponent(jScrollPane2, javax.swing.GroupLayout.PREFERRED_SIZE, 0, Short.MAX_VALUE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(jPanel3, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addGroup(layout.createSequentialGroup()
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                            .addComponent(lblAnticipada)
                            .addComponent(jLabel10))
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                            .addComponent(jLabel13)
                            .addComponent(lblAnticipada_Sala_P))
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                            .addComponent(jLabel12)
                            .addComponent(lblAnticipada_Sala_H))
                        .addGap(21, 21, 21)
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                            .addComponent(jLabel1)
                            .addComponent(lblPendiente))
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                            .addComponent(jLabel9)
                            .addComponent(lblTotalDesp))
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                            .addComponent(jLabel4)
                            .addComponent(lbStock))
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                            .addComponent(jLabel8)
                            .addComponent(lbTotal)))
                    .addComponent(jPanel1, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addContainerGap())
        );

        pack();
    }// </editor-fold>//GEN-END:initComponents

    private String Get_Ubicacion(String Ubica) {
        ExeSql Sql = new ExeSql();
        ResultSet Rs, Rs1;
        String Query2;
        String strUbicacion = "";

        try {
            //lblCodOrigen.setVisible(true);
            strUbicacion = Ubica.trim();
            String ubicaArray[] = strUbicacion.split("\\.");

//            Query2 = "SELECT (b.bodega ||' - '|| r.rack ||' - '|| m.metro) as ubc\n" +
//            " from mt_bodega b, mt_rack r, mt_metro m\n" +
//            " where b.codigo='" + ubicaArray[0] + "' and r.codigo= " + ubicaArray[1] +  " and m.codigo= " + ubicaArray[2] + "  and m.rack=" + ubicaArray[1];
            Query2 = "SELECT nombre AS ubc FROM mt_codmetro WHERE codmetro = '" + strUbicacion + "'";

            Rs1 = Sql.Select(Query2);
            if (Rs1.next()) {
                strUbicacion = Rs1.getString("ubc").trim();
                return strUbicacion;
            } else {
                return null;
            }
        } catch (Exception e) {
            System.out.println(e.getMessage());
        } finally {
            Sql.Close();
        }
        return null;
    }

    public void CargaMetroDestino(String sku, String nomSku, double cant, String StOrigen) {

        ExeSql Sql = new ExeSql();
        ExeSql Sql_1 = new ExeSql();
        ResultSet Rs, Rs1;
        DefaultTableModel TableModel = (DefaultTableModel) Grilla.getModel();
        double SumaDespachos = 0, SumaPendiente = 0, totAnticipada = 0, totAnticipada_Sala = 0;
        double SumaBultos = 0;

        String Query = "", QryPend = "", QryUnid = "";
        double total = 0;
        // lblCodOrigen.setVisible(true);
        lblTotalDesp.setText(fmMain.FormatoTotal(SumaDespachos));
        lbStock.setText(fmMain.FormatoTotal(cant));
        //txCant.setText(lbStock.getText().trim());
        lblCodOrigen.setText(StOrigen);

        //lblDescOrigen.setText(Get_Ubicacion(StOrigen));
        if (StOrigen.equals(fmMain.BodegaTransito())) {

            lblDescOrigen.setText("TRANSITO");

        } else {

            lblDescOrigen.setText(Get_Ubicacion(StOrigen));

        }

        lbSkuDesc.setText(nomSku);
        total = SumaDespachos + cant;
        lbTotal.setText(fmMain.FormatoTotal(total));

        int ContReg = 0;
        lbSku.setText(sku);
        while (TableModel.getRowCount() > 0) {
            TableModel.removeRow(0);
        }

        try {
            Query = "select mp.sku, p.nombre,mp.ubicacion,u.unidad,sum(mp.cant) cantidad, p.convenio \n"
                    + "from mt_productos mp\n"
                    + "left join  producto p\n"
                    + "on mp.sku = p.sku\n"
                    + "left join par_unidad u on  u.codigo = p.unidad\n"
                    + "where mp.ubicacion = '" + StOrigen.trim() + "' \n"
                    + // ------------------------------------
                    "group by mp.sku, p.nombre,mp.ubicacion,u.unidad, p.convenio\n"
                    + "having sum(mp.cant) >0 and mp.sku = '" + sku + "'";

            Rs = Sql.Select(Query);

            while (Rs.next()) {

                ContReg++;

                TableModel.addRow(new Object[]{
                    Rs.getString("sku").trim(),
                    Rs.getString("nombre").trim(),
                    Rs.getString("unidad"),
                    Rs.getString("ubicacion"),
                    Get_Ubicacion(Rs.getString("ubicacion")),
                    Rs.getInt("cantidad")
                });

                SumaDespachos = SumaDespachos + Rs.getInt("cantidad");
                convenio = Rs.getInt("convenio");
                lblTotalDesp.setText(fmMain.FormatoTotal(SumaDespachos));
                total = cant + SumaDespachos;
                lbTotal.setText(fmMain.FormatoTotal(total));
                txtUbicacion.requestFocus();
            }

            // Trae lo pendiente
            QryPend = "select \n"
                    + "p.sku,p.nombre,p.unidad,i.stock,i.ocp,i.occ,i.gdc, (select sum(separado) from occhdet where sku=p.sku) as separado\n"
                    + "from producto p\n"
                    + "left join inventario i\n"
                    + "on p.sku=i.sku\n"
                    + "where p.sku = '" + sku + "'";

            Rs1 = Sql_1.Select(QryPend);

            if (Rs1.next()) {

                SumaPendiente = SumaPendiente + Math.abs(Rs1.getInt("occ") + Rs1.getInt("separado"));
            }

            ExeSql exe = new ExeSql();
            ResultSet rss = exe.Select("select distinct on (o.codigo_oc, o.orden) CAST(o.codigo_oc as varchar) || '-' || o.orden as orden,\n"
                    + "case when o.separado >= 0 \n"
                    + "then (o.cantidad - (o.separado+o.despachado))\n"
                    + "else o.separado\n"
                    + "end as diferencia\n"
                    + "from occhdet o\n"
                    + "left join mt_productos mt on  mt.sku = o.sku\n"
                    + "where o.sku = '" + sku + "'\n"
                    + "and (o.separado + o.despachado) < o.cantidad");

            int sumados = 0;
            for (int u = 0; rss.next(); u++) {
                sumados = sumados + rss.getInt("diferencia");
            }
            rss.beforeFirst();
            DefaultTableModel model = (DefaultTableModel) Grilla_detalle.getModel();
            while (model.getRowCount() > 0) {
                model.removeRow(0);
            }
            for (int o = 0; rss.next(); o++) {
                model.addRow(new Object[]{
                    rss.getString("orden"),
                    rss.getString("diferencia")
                });
            }

//                
            lblPendiente.setText(fmMain.FormatoTotal(sumados));

            // Trae lo anticipado
            QryPend = "select sku,cant from mt_productos mt \n"
                    + "where mt.sku = '" + sku + "' and mt.ubicacion = '" + fmMain.BodegaAnticipada() + "';";

            Rs1 = Sql_1.Select(QryPend);

            if (Rs1.next()) {

                totAnticipada = Rs1.getDouble("cant");
            }

            lblAnticipada.setText(fmMain.FormatoTotal(totAnticipada));

            // Trae lo anticipado Sala PLC
            QryPend = "select sku,cant from mt_productos mt \n"
                    + "where mt.sku = '" + sku + "' and mt.ubicacion = 'TRAN.1007.2';";

            Rs1 = Sql_1.Select(QryPend);

            if (Rs1.next()) {

                totAnticipada_Sala = Rs1.getDouble("cant");
            }

            lblAnticipada_Sala_H.setText(fmMain.FormatoTotal(totAnticipada_Sala));

            // Trae lo anticipado Sala HUERFANOS
//                QryPend = "select sku,cant from mt_productos mt \n" +
//                          "where mt.sku = '" + sku + "' and mt.ubicacion = 'TRAN.1007.3';";
//                
//                Rs1 = Sql_1.Select(QryPend);
//                
//                if (Rs1.next()){
//                
//                    totAnticipada_Sala_H= Rs1.getDouble("cant");
//                }
//                
//                lblAnticipada_Sala_H.setText( fmMain.FormatoTotal(totAnticipada_Sala_H));
            // Trae la unidad
            QryUnid = "select p.sku, p.nombre,u.unidad\n"
                    + "from producto p\n"
                    + "left join par_unidad u on  u.codigo = p.unidad\n"
                    + "where p.sku = '" + sku + "'";

            Rs1 = Sql_1.Select(QryUnid);

            if (Rs1.next()) {

                lblUnidad.setText(Rs1.getString("unidad").trim());

            } else {

                lblUnidad.setText("S/U");

            }

        } catch (Exception e) {

        } finally {
            Sql.Close();

        }
    }

    public void abrir(String file) {

        try {
            String url = file;
            ProcessBuilder p = new ProcessBuilder();
            p.command("cmd.exe", "/c", url);
            p.start();
        } catch (IOException ex) {
            Logger.getLogger(jd_UbicacionProductos.class.getName()).log(Level.SEVERE, null, ex);
        }

    }


    private void btAceptarActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btAceptarActionPerformed
        dispose();
    }//GEN-LAST:event_btAceptarActionPerformed

    public String GetUbicacion() {

        if (Ubicacion_sel.equals("")) {

            Ubicacion_sel = Grilla.getValueAt(Grilla.getSelectedRow(), 4).toString();
            UbicaCodigo_Sel = Grilla.getValueAt(Grilla.getSelectedRow(), 3).toString();

        }

        return Ubicacion_sel;
    }

    public String GetUbicacionCod() {

        if (UbicaCodigo_Sel.equals("")) {

            Ubicacion_sel = Grilla.getValueAt(Grilla.getSelectedRow(), 4).toString();
            UbicaCodigo_Sel = Grilla.getValueAt(Grilla.getSelectedRow(), 3).toString();
        }

        return UbicaCodigo_Sel;
    }

    public void ubica_cursor_inicio() {
        txtUbicacion.requestFocus();
    }

    private boolean valida_ubicacion(String Ubica) {

        ExeSql Sql = new ExeSql();
        ResultSet Rs, Rs1;
        String Query2;
        boolean esta = false;

        try {
            Query2 = "select *  from mt_codmetro where codmetro = '" + Ubica + "';";
            Rs1 = Sql.Select(Query2);

            if (Rs1.next()) {

                esta = true;

            } else {

                esta = false;
            }

        } catch (Exception e) {

            System.out.println(e.getMessage());
            Sql.Rollback();

        } finally {

            Sql.Close();
        }

        return esta;
    }

    public void graba() {

        ExeSql Sql2 = new ExeSql();
        ResultSet Rs1, Rs2;

        //********************************* 
        ExeSql Sql = new ExeSql();
        ExeSql Sql4 = new ExeSql();
        ExeSql Sql5 = new ExeSql();

        ResultSet Rs3 = null;
        ResultSet Rs4 = null;
        ResultSet Rs5 = null;
        //********************************   

        String Sku, Ubicacion = "", StUsuario, QryIns, qryUpd, Query2;
        String inv_positivo = "INV.1011.1", inv_negativo = "INV.1011.2";

        double cantidad_insertada;
        int Stock = 0;

        Ubicacion_sel = "";
        UbicaCodigo_Sel = "";

        try {
            Sku = lbSku.getText().trim();
            Ubicacion = txtUbicacion.getText().trim();
            StUsuario = fmMain.GetUsuario();

            if ((Ubicacion.equals("TRAN.1009.1") || Ubicacion.equals("TRAN.1009.2") || Ubicacion.equals("TRAN.10009.1"))
                    && (!StUsuario.equals("LRUBILAR") && !StUsuario.equals("LEORUBILAR"))) {    //Si es Merma

                fmMain.Mensaje("El " + StUsuario + " No está Autorizado!!");
                return;

            } else if ((Ubicacion.equals("TRAN.1009.1") || Ubicacion.equals("TRAN.1009.2") || Ubicacion.equals("TRAN.10009.1"))
                    && (StUsuario.equals("LRUBILAR") || StUsuario.equals("LEORUBILAR"))) {

                System.out.println("El " + StUsuario + " Está Autorizado!!");

            }

            if (Ubicacion.contains("TRAN.1002.")) {    //NOTA CREDITO PROVEEDOR

                fmMain.Mensaje("No se pueden mover productos a esta Ubicacion...!");
                return;

            }

            if (Ubicacion.contains("TRAN.1004.")) {    //NOTA CREDITO CLIENTE

                fmMain.Mensaje("No se puden mover productos a Nota Crédito Cliente en forma manual..!");
                return;

            }

            if (Ubicacion.contains("LVLB1.1011.") || Ubicacion.contains("BOD.SEP")) {     //UBICACIONES DE SEPARACION

                fmMain.Mensaje("No se pueden mover productos a esta Ubicacion...!");
                return;

            }

            if (Ubicacion.contains("TRAN.1001.")) {     //TRANSITO INGRESO

                fmMain.Mensaje("No se pueden mover productos a Tránsito Ingreso...!");
                return;

            }

            cantidad_insertada = Double.valueOf(fmMain.SetGuardar(txCant.getText().trim()));

            System.out.println("Stock :" + Double.valueOf(fmMain.SetGuardar(lbStock.getText().trim())));
            System.out.println("Cantidad Ingresada :" + cantidad_insertada);

            if (Double.valueOf(fmMain.SetGuardar(lbStock.getText().trim())) < cantidad_insertada) {
                fmMain.Mensaje("Cantidad ingresada: " + txCant.getText().trim() + " es mayor a la que existe en el metro " + lblDescOrigen.getText().trim() + " que es :" + fmMain.SetGuardar(lbStock.getText().trim()));
                return;
            }

            if (txtUbicacion.getText().trim().equals("")) {
                fmMain.Mensaje("Debe ingresar la Ubicacion del Metro.");
                txtUbicacion.requestFocus();
                return;
            }

            if (txCant.getText().trim().equals("")) {
                fmMain.Mensaje("Debe ingresar cantidad en la Ubicación.");
                txCant.requestFocus();
                return;
            } else if (Double.valueOf(txCant.getText().trim()) == 0) {
                fmMain.Mensaje("La cantidad debe ser mayor que 0." + " y no mayor a " + fmMain.SetGuardar(lbStock.getText().trim()));
                txCant.requestFocus();
                return;
            }

            //if (Ubicacion.trim().equals("TRAN.1007.1") || Ubicacion.trim().equals("TRAN.1003.1")  ){    //Si es Venta Anticipada Metro 1 o Directa
            if (Ubicacion.trim().equals("TRAN.1007.1")) {    //Si es Venta Anticipada Metro 1 o Directa    

                double anticipada = 0;
                String v_anticipada = "0";

                try {

                    anticipada = Double.parseDouble(Grilla_Ant.getValueAt(Grilla_Ant.getSelectedRow(), 4).toString().trim());

                } catch (Exception e) {

                    anticipada = 0;

                }

                if (anticipada == 0 && (fmMain.GetUsuario().toLowerCase().trim().equals("admin1") || fmMain.GetUsuario().toLowerCase().trim().equals("lrubilar")
                        || fmMain.GetUsuario().toLowerCase().trim().equals("leorubilar") || fmMain.GetUsuario().toLowerCase().trim().equals("alopez"))) {

                    v_anticipada = lblAnticipada.getText().replaceAll("\\,", "");
                    anticipada = (Double.parseDouble(v_anticipada.trim()) * -1);

                } else if (anticipada != 0 && (fmMain.GetUsuario().toLowerCase().trim().equals("admin1") || fmMain.GetUsuario().toLowerCase().trim().equals("lrubilar")
                        || fmMain.GetUsuario().toLowerCase().trim().equals("leorubilar") || fmMain.GetUsuario().toLowerCase().trim().equals("alopez"))) {

                    if (chkAnticipada_ant.isSelected()) {

                        v_anticipada = lblAnticipada.getText().replaceAll("\\,", "");
                        anticipada = (Double.parseDouble(v_anticipada.trim()) * -1);

                    }

                }

                if (anticipada < cantidad_insertada) {

                    fmMain.Mensaje("Cantidad ingresada: " + txCant.getText().trim() + " es mayor a la que existe en el metro VENTA ANTICIPADA METRO 1 que es :" + anticipada);
                    return;
                }

            }

            if (Ubicacion.trim().equals("TRAN.1007.2")) {    //Si es Venta Anticipada Sala PLC

                double anticipada_sala = 0;
                String v_anticipada_sala = "0";

                try {

                    anticipada_sala = Double.parseDouble(Grilla_Ant.getValueAt(Grilla_Ant.getSelectedRow(), 4).toString().trim());

                } catch (Exception e) {

                    anticipada_sala = 0;
                }

                if (anticipada_sala == 0 && (fmMain.GetUsuario().toLowerCase().trim().equals("leorubilar") || fmMain.GetUsuario().toLowerCase().trim().equals("alopez"))) {

                    v_anticipada_sala = lblAnticipada_Sala_H.getText().replaceAll("\\,", "");
                    anticipada_sala = (Double.parseDouble(v_anticipada_sala.trim()) * -1);

                }

                if (anticipada_sala < cantidad_insertada) {

                    fmMain.Mensaje("Cantidad ingresada: " + txCant.getText().trim() + " es mayor a la que existe en el metro VENTA ANTICIPADA SALA PLC que es :" + anticipada_sala);
                    return;
                }

            }

//               if (Ubicacion.trim().equals("TRAN.1007.3") ){    //Si es Venta Anticipada Sala HUERFANOS
//                   
//                    double anticipada_sala_H = 0; 
//                    String v_anticipada_sala_H = "0";
//                   
//                   
//                    try {  
//                    
//                        anticipada_sala_H = Double.parseDouble(Grilla_Ant.getValueAt(Grilla_Ant.getSelectedRow(), 4).toString().trim());
//                        
//                    }catch (Exception e){
//                    
//                        anticipada_sala_H = 0; 
//                    }    
//                      
//                    
//                    
//                    if (anticipada_sala_H == 0 && fmMain.GetUsuario().toLowerCase().trim().equals("leorubilar")){  
//                    
//                        v_anticipada_sala_H = lblAnticipada_Sala.getText().replaceAll("\\,", "");
//                        anticipada_sala_H = (Double.parseDouble(v_anticipada_sala.trim())*-1);
//                    
//                        
//                    }  
//                    
//                    
//                    if (anticipada_sala_H < cantidad_insertada){
//                        
//                        fmMain.Mensaje("Cantidad ingresada: " + txCant.getText().trim() + " es mayor a la que existe en el metro VENTA ANTICIPADA SALA HUERFANOS que es :" + anticipada_sala_H);
//                        return;
//                    }
//                    
//                    
//               }  
            //********************************************************************************************************************************************************************//            
            //---------------------------------------------------------------------------------------           
            // UBICA PRODUCTOS EN METRO DESTINO 
            Query2 = "select *  from mt_productos where ubicacion = '" + Ubicacion + "' and sku = '" + Sku + "';";
            Rs1 = Sql.Select(Query2);

            if (Rs1.next()) {
                // Realiza un Update

                System.out.println("ENTRA A UPDATE!!!");

                String QryUpd = "  update  mt_productos set cant = cant + " + cantidad_insertada + ",\n"
                        + "  usuario_mod ='" + fmMain.GetUsuario() + "', fecha_mod = now(), ubica_origen = '" + lblCodOrigen.getText().trim() + "',\n"
                        + "  ubica_origen2 = '" + lblCodOrigen.getText().trim() + "'\n"
                        + "  where ubicacion = '" + Ubicacion + "' and sku = '" + Sku + "' ";
                Sql.ExeSql(QryUpd);

            } else {
                // Inserta el producto
                QryIns = "insert into mt_productos (ubicacion,ubica_origen2,sku,usuario,cant, rut, tipdocto, nrodocto)\n"
                        + " values ('" + Ubicacion + "','" + lblCodOrigen.getText().trim() + "','" + Sku + "','" + fmMain.GetUsuario() + "', " + cantidad_insertada
                        + "," + "null" + ",'" + "" + "'," + "null" + ");";
                Sql.ExeSql(QryIns);
            }
            //-------------------------------------------------------------------------------------

            //  SI UBICACION ORIGEN ES POSITIVO       
            if (lblCodOrigen.getText().trim().equals(inv_positivo)) {

                System.out.println("ENTRA A POSITIVO!!!");

                // Saca los productos del metro de origen 
                qryUpd = "update mt_productos set cant = cant -" + cantidad_insertada + ", ubica_origen2 = '" + lblCodOrigen.getText().trim() + "'\n"
                        + " where ubicacion = '" + lblCodOrigen.getText().trim() + "' and sku = '" + Sku + "' ";
                Sql.ExeSql(qryUpd);
                Sql.Commit();
                fmMain.Mensaje("Grabacion realizada con Exito.");

                //---------------------------------------------------------------------------------------------------------------------              
                // Ahora descontare del metro negativo los productos ya que se ubicaran EN UN METRO
                double canti = 0;
                Query2 = "select *  from mt_productos where ubicacion = '" + inv_negativo + "' and sku = '" + Sku + "';";
                Rs2 = Sql2.Select(Query2);

                if (Rs2.next()) {

                    canti = canti + Rs2.getDouble("cant") + cantidad_insertada;
                }

                if (canti > 0) {

                    canti = 0;
                }

                qryUpd = "update mt_productos set cant = " + canti
                        + " where ubicacion = '" + inv_negativo + "' and sku = '" + Sku + "' ";
                Sql2.ExeSql(qryUpd);
                Sql2.Commit();
                Sql2.Close();
                fmMain.Mensaje("Grabacion realizada con Exito.");

            } else {

                System.out.println("ENTRA A NEGATIVO!!!");

                qryUpd = "update mt_productos set cant = cant -" + cantidad_insertada + ", ubica_origen2 = '" + lblCodOrigen.getText().trim() + "'\n"
                        + " where ubicacion = '" + lblCodOrigen.getText().trim() + "' and sku = '" + Sku + "' ";
                Sql.ExeSql(qryUpd);
                Sql.Commit();
                fmMain.Mensaje("Grabacion realizada con Exito.");

            }

            if (Ubicacion.trim().contains("TRAN.1007") || Ubicacion.trim().contains("TRAN.1003")) {    //Si es Venta Anticipada Metro 1 y SalaPLC o Huerfanos o Directa

                ActualizaAnticipadas();

            }

            //*******************************************************************************************************************************************************************//          
        } catch (Exception e) {

            System.out.println(e.getMessage());
            Logger.getLogger(jd_UbicacionProductos.class.getName()).log(Level.SEVERE, null, e);
            Sql.Rollback();

        } finally {

            Sql.Close();
        }
        // --- INICIO: Actualización de Stock en Segundo Plano (OPTIMIZADO - SIN BD LOOKUP) ---
        try {
            // Define la lista fija de sucursales a actualizar SIEMPRE
            // Asegúrate de importar java.util.List y java.util.Arrays al inicio del archivo
            java.util.List<Integer> sucursalesParaActualizar = java.util.Arrays.asList(1, 3, 11);

            System.out.println("Disparando actualización de stock en segundo plano para sucursales FIJAS: " + sucursalesParaActualizar);

            // Llama al worker con la lista fija
            // Asegúrate de importar Utilidades.StockReloadWorker al inicio del archivo
            Utilidades.StockReloadWorker worker = new Utilidades.StockReloadWorker(sucursalesParaActualizar);
            worker.execute(); // Inicia la actualización en segundo plano

        } catch (Exception e) {
            // Captura cualquier error inesperado al preparar/llamar al worker
            System.err.println("Error crítico al intentar preparar/ejecutar el StockReloadWorker:");
            e.printStackTrace();
            JOptionPane.showMessageDialog(null, "Error al iniciar la actualización de stock: " + e.getMessage(), "Error Worker", JOptionPane.ERROR_MESSAGE);
        }
        dispose();

    }


    private void btOkActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btOkActionPerformed

        if (txNombreUbica.getText().trim().isEmpty()) {

            fmMain.Mensaje("Debe cargar Ubicación!!");
            return;

        }

        if (txCant.getText().trim().isEmpty() || Integer.parseInt(txCant.getText().trim()) <= 0) {

            fmMain.Mensaje("Cantidad no válida!!");
            return;

        }

        graba();
        //Verifica_NCP(lbSku.getText().trim());


    }//GEN-LAST:event_btOkActionPerformed

    private void Verifica_NCP(String Sku) {

        ExeSql Sql = new ExeSql();
        ResultSet Rs = null;

        try {

            Rs = Sql.Select("SELECT cd.tipdocto, cd.nrodocto, cd.cantidad,c.femision FROM ctacteprvdet cd \n"
                    + "LEFT JOIN ctacteprv c ON cd.rut = c.rut AND cd.tipdocto IN ('GDP','FAP') and cd.nrodocto = c.nrodocto\n"
                    + "WHERE cd.sku IN ('" + Sku.trim() + "') AND c.autoriza = 0 AND (c.tipdocorigen IN ('OCP') OR c.tipdocorigen is NULL)\n"
                    + "GROUP BY cd.tipdocto, cd.nrodocto,cd.cantidad, c.femision");

            if (Sql.GetRowCount() > 0) {//010304035

                ExisteNCP = 1;

            } else {

                ExisteNCP = 0;

            }

        } catch (SQLException ex) {
            Logger.getLogger(jd_UbicacionProductos.class.getName()).log(Level.SEVERE, null, ex);
        }

    }


    private void txtUbicacionKeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_txtUbicacionKeyPressed
        // TODO add your handling code here:
        // TODO add your handling code here:
        ExeSql Sql = new ExeSql();
        ResultSet Rs, Rs1;
        String Query2;
        String strUbicacion = txtUbicacion.getText().trim().toUpperCase();

        //Ubicacion = txtUbicacion.getText().trim();
        String StUsuario = fmMain.GetUsuario();

        try {
            if (evt.getKeyCode() == KeyEvent.VK_ENTER) {
                if (strUbicacion.isEmpty()) {
                    return; // No hacer nada, es un Enter fantasma
                }

                //*************************************************************************************************************************************************************//
                if ((strUbicacion.equals("TRAN.1009.1") || strUbicacion.equals("TRAN.1009.2") || strUbicacion.equals("TRAN.10009.1"))
                        && (!StUsuario.equals("LRUBILAR") && !StUsuario.equals("LEORUBILAR"))) {    //Si es Merma

                    fmMain.Mensaje("El " + StUsuario + " No está Autorizado!!");

                    txNombreUbica.setText("");
                    txtUbicacion.setText("");

                    return;

                } else if ((strUbicacion.equals("TRAN.1009.1") || strUbicacion.equals("TRAN.1009.2") || strUbicacion.equals("TRAN.10009.1"))
                        && (StUsuario.equals("LRUBILAR") || StUsuario.equals("LEORUBILAR"))) {

                    System.out.println("El " + StUsuario + " Está Autorizado!!");

                }

                if (strUbicacion.contains("TRAN.1002.")) {    //NOTA CREDITO PROVEEDOR

                    fmMain.Mensaje("No se pueden mover productos a esta Ubicacion...!");

                    txNombreUbica.setText("");
                    txtUbicacion.setText("");

                    return;

                }

                if (strUbicacion.contains("TRAN.1004.")) {    //NOTA CREDITO CLIENTE

                    fmMain.Mensaje("No se puden mover productos a Nota Crédito Cliente en forma manual..!");

                    txNombreUbica.setText("");
                    txtUbicacion.setText("");

                    return;

                }

                if (strUbicacion.contains("LVLB1.1011.") || strUbicacion.contains("BOD.SEP")) {     //UBICACIONES DE SEPARACION

                    fmMain.Mensaje("No se pueden mover productos a esta Ubicacion...!");

                    txNombreUbica.setText("");
                    txtUbicacion.setText("");

                    return;

                }

                if (strUbicacion.contains("TRAN.1001.")) {     //TRANSITO INGRESO

                    fmMain.Mensaje("No se pueden mover productos a Tránsito Ingreso...!");

                    txNombreUbica.setText("");
                    txtUbicacion.setText("");

                    return;

                }

                //*************************************************************************************************************************************************************//            
                Query2 = "SELECT nombre AS ubc FROM mt_codmetro WHERE codmetro = '" + strUbicacion + "'";

                Rs1 = Sql.Select(Query2);
                if (Rs1.next()) {
                    strUbicacion = Rs1.getString("ubc").trim();
                    txNombreUbica.setText(strUbicacion);
                    txtUbicacion.requestFocus();
                    txCant.setText("");
                    //txCant.requestFocus();
                    pistoleados = 0;
                    txCodigo.requestFocus();

                    if (txtUbicacion.getText().trim().contains("TRAN.1007.") || txtUbicacion.getText().trim().contains("TRAN.1003.")) {     //TRANSITO ANTICIPADA o DIRECTA

                        CargaAnticipadas();

                    } else {

                        pnAnticipada.setVisible(false);

                    }

                } else {
                    fmMain.Mensaje("Ubicacion no encontrada o no disponible, favor revise la ubicación");
                    //limpia_all();
                    txNombreUbica.setText("");
                    txtUbicacion.setText("");
                    pistoleados = 0;
                }
            }
        } catch (Exception e) {
            System.out.println(e.getMessage());
        } finally {
            Sql.Close();
        }
    }//GEN-LAST:event_txtUbicacionKeyPressed

    private void CargaAnticipadas() {

        DefaultTableModel tbMd = (DefaultTableModel) Grilla_Ant.getModel();

        while (tbMd.getRowCount() > 0) {
            tbMd.removeRow(0);
        }

        ExeSql Sql = new ExeSql();
        ResultSet Rs;

        try {

            Rs = Sql.Select("select case when va.tipdocto is null then ' ' else va.tipdocto end as tipdocto, \n"
                    + "va.nrodocto, va.codigo_oc, va.orden, va.cant, va.sku, va.ubicacion, va.rut \n"
                    + "from venta_anticipada va \n"
                    + "where va.sku IN ('" + lbSku.getText().trim() + "') and va.ubicacion IN ('" + txNombreUbica.getText().trim() + "') and va.estado = 0");

            if (Sql.GetRowCount() > 0) {

                pnAnticipada.setVisible(true);

                while (Rs.next()) {

                    tbMd.addRow(new Object[]{
                        Rs.getString("tipdocto").trim(),
                        Rs.getString("nrodocto").trim(),
                        Rs.getString("codigo_oc").trim(),
                        Rs.getString("orden").trim(),
                        fmMain.FormatoNumeroSinDecimalSinMiles(Rs.getDouble("cant")),
                        Rs.getString("sku").trim(),
                        Rs.getString("ubicacion").trim(),
                        Rs.getString("rut").trim(),});

                }

            } else {

                pnAnticipada.setVisible(false);

            }

        } catch (SQLException ex) {
            Logger.getLogger(jd_UbicacionProductos.class.getName()).log(Level.SEVERE, null, ex);
        }

    }

    private void ActualizaAnticipadas() {

        ExeSql Sql = new ExeSql();
        ResultSet Rs;

        SimpleDateFormat dateFormat2 = new SimpleDateFormat("dd-MM-yyyy hh:mm:ss");

        try {

            String Tipdoc = Grilla_Ant.getValueAt(Grilla_Ant.getSelectedRow(), 0).toString().trim();
            String Nrodoc = Grilla_Ant.getValueAt(Grilla_Ant.getSelectedRow(), 1).toString().trim();

            String Codigo_OC = Grilla_Ant.getValueAt(Grilla_Ant.getSelectedRow(), 2).toString().trim();
            String Orden = Grilla_Ant.getValueAt(Grilla_Ant.getSelectedRow(), 3).toString().trim();

            String Rut = Grilla_Ant.getValueAt(Grilla_Ant.getSelectedRow(), 7).toString().trim();

            if (txNombreUbica.getText().trim().equals("TRANSITO-V_ANTICIPADA-METRO 1") || txNombreUbica.getText().trim().equals("TRANSITO-VDIRECTA-METRO 1")) {

                Sql.ExeSql("UPDATE venta_anticipada SET \n"
                        + "estado = 1, \n"
                        + "ffinalizacion = '" + dateFormat2.format(hoy) + "', \n"
                        + "usuario_mod = '" + fmMain.GetUsuario().trim().toLowerCase() + "' \n"
                        + "where sku IN ('" + lbSku.getText().trim() + "') \n"
                        + "and codigo_oc = " + Codigo_OC.trim() + " \n"
                        + "and orden IN ('" + Orden.trim() + "') \n"
                        + "and ubicacion IN ('" + txNombreUbica.getText().trim() + "') \n"
                        + "and rut =" + Rut.trim() + " \n"
                        + "and estado = 0");

            } else if (txNombreUbica.getText().trim().equals("TRANSITO-V_ANTICIPADA-SALATP") || txNombreUbica.getText().trim().equals("TRANSITO-V_ANTICIPADA-SALATH")
                    || txNombreUbica.getText().trim().equals("TRANSITO-V_ANTICIPADA-SALA")) {
//            }else if (txNombreUbica.getText().trim().equals("TRANSITO-V_ANTICIPADA-SALA") ){

                Sql.ExeSql("UPDATE venta_anticipada SET \n"
                        + "estado = 1, \n"
                        + "ffinalizacion = '" + dateFormat2.format(hoy) + "', \n"
                        + "usuario_mod = '" + fmMain.GetUsuario().trim().toLowerCase() + "' \n"
                        + "where sku IN ('" + lbSku.getText().trim() + "') \n"
                        + "and tipdocto IN ('" + Tipdoc.trim() + "') \n"
                        + "and nrodocto =" + Nrodoc.trim() + " \n"
                        + "and ubicacion IN ('" + txNombreUbica.getText().trim() + "') \n"
                        + "and rut =" + Rut.trim() + " \n"
                        + "and estado = 0");

            }

            Sql.Commit();

        } catch (SQLException ex) {

            Sql.Rollback();
            Logger.getLogger(jd_UbicacionProductos.class.getName()).log(Level.SEVERE, null, ex);

        } finally {

            Sql.Close();

        }

    }


    private void GrillaMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_GrillaMouseClicked
        // TODO add your handling code here:
        if (evt.getClickCount() == 2) {
            txtUbicacion.setText(Grilla.getValueAt(Grilla.getSelectedRow(), 3).toString().trim());
            txNombreUbica.setText(Grilla.getValueAt(Grilla.getSelectedRow(), 4).toString().trim());
        }
    }//GEN-LAST:event_GrillaMouseClicked

    private void btUbcActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btUbcActionPerformed

        jdBuscaUbicacion Ubicacion = new jdBuscaUbicacion(null, true);
        Ubicacion.CargaBodegaOR(0);
        Ubicacion.setVisible(true);
        txtUbicacion.setText(Ubicacion.GetUbicacion());
        txNombreUbica.setText(Ubicacion.GetNombreUbicacion());
        txCodigo.requestFocus();
        txCant.setText("");
        pistoleados = 0; // <--- AÑADIDO: Para reiniciar el contador por si acaso

        if (txtUbicacion.getText().trim().contains("TRAN.1007.") || txtUbicacion.getText().trim().contains("TRAN.1003.")) {     //TRANSITO ANTICIPADA o DIRECTA

            CargaAnticipadas();

        } else {

            pnAnticipada.setVisible(false);

        }


    }//GEN-LAST:event_btUbcActionPerformed

    private void txCantKeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_txCantKeyPressed

    }//GEN-LAST:event_txCantKeyPressed

//    private void BuscarCodigo(String Codigo){
//        ExeSql luv = new ExeSql();
//        ExeSql luv2 = new ExeSql();
//        
//        ResultSet Rs;
//        ResultSet Rs2;
//        
//        int stock_luvaly = 0;
//        int stock_disosur = 0;
//        
//        int valor_luvaly = 0;
//        int valor_disosur = 0;
//        
//        double precio = 0;
//        
//        
//        try{
//            Rs = luv.Select("select p.discontinuado, p.sku,p.nombre,u.unidad,u.um \n" +
//                            "from producto p\n" +
//                            "left join par_unidad u on u.codigo=p.unidad \n" +
//                            "where (p.sku='" + Codigo + "' or p.sku = (select sku from codchile where idch = '"+Codigo+"') \n" +
//                            "or p.sku in (select sku from codbar where codbar = '"+Codigo+"'))");
//            
//            if (luv.GetRowCount()==0) {
//                
//                fmMain.Mensaje("El producto Código = " + Codigo + "\n No Existe en nuestra Base de datos.");
//                return;
//            }
//        
//            Rs.next();
//
//            txPistolear.setText(Rs.getString("sku"));
//            
//            if (txPistolear.getText().trim().equals(lbSku.getText().trim())){
//            
//                  int suma = Integer.parseInt(txCant.getText().toString().trim());
//                
//                  suma = suma  + 1;
//                  
//                  int stock = Integer.parseInt(txStock.getText().toString().trim());
//                  
//                  if (suma > stock){
//                  
//                      fmMain.Mensaje("Cantidad supera el Stock..!");
//                      suma = suma - 1;
//                      txPistolear.setText("");
//                      txPistolear.requestFocus();
//                      return;
//                      
//                  
//                  }
//                  
//                  
//                  
//                  txCantidad.setText(""+suma);
//                  txPistolear.setText("");
//                  txPistolear.requestFocus();
//            
//            }else {
//            
//                fmMain.Mensaje("Codigos distintos");
//                txPistolear.setText("");
//                txPistolear.requestFocus();
//            
//            }
//            
//            
//          
//        } catch (Exception e) {
//            JOptionPane.showMessageDialog(null, e);
//            }finally{
//            luv.Close();
//
//        }
//        
//    }

    private void lblAnticipadaMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_lblAnticipadaMouseClicked
        ExeSql SqlAnt = new ExeSql();
        ResultSet RsAnt;
        String qry = "select det.nrodocto, det.cantidad, EXTRACT(day from current_date-o.fcreacion) as dias from ctacteclidet det\n"
                + "left join ctactecli cli on\n"
                + "cli.rut=det.rut and cli.tipdocto=det.tipdocto \n"
                + "and cli.nrodocto=det.nrodocto and cli.anticipado=1 and cli.transporte=false\n"
                + "left join occh o on cli.rut=o.rut and cli.nrodocorigen=o.codigo_oc and cli.occh=o.orden\n"
                + "where det.sku='" + lbSku.getText().trim() + "' \n"
                + "and det.tipdocto='GDC' and cli.anticipado=1 and cli.transporte=false";
        Double db = Double.valueOf(lblAnticipada.getText().trim());
        if (db < 0) {
            try {
                String muestra = "<br>";
                RsAnt = SqlAnt.Select(qry);
                while (RsAnt.next()) {
                    muestra = muestra + "Guia: " + RsAnt.getString("nrodocto").trim()
                            + " || Cantidad: " + RsAnt.getString("cantidad").trim()
                            + " || Dias: " + RsAnt.getString("dias") + "<br>";
                }
                JOptionPane.showMessageDialog(null, String.format("<html><body>" + muestra + "</body></html>", 150, 150));

            } catch (Exception e) {
                fmMain.Mensaje("Error al cargar Anticipadas " + e);
            } finally {
                SqlAnt.Close();
            }
        } else {
            fmMain.Mensaje("No hay");
        }
    }//GEN-LAST:event_lblAnticipadaMouseClicked

    private void mnuCopiarOrdenActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_mnuCopiarOrdenActionPerformed
        //Copiar Ordenes
        if (!Grilla.getValueAt(Grilla_detalle.getSelectedRow(), 1).toString().trim().isEmpty()) {
            StringSelection Voucher = new StringSelection(Grilla_detalle.getValueAt(Grilla_detalle.getSelectedRow(), 1).toString().trim());
            Clipboard cb = Toolkit.getDefaultToolkit().getSystemClipboard();
            cb.setContents(Voucher, null);
        }
    }//GEN-LAST:event_mnuCopiarOrdenActionPerformed

    private void Grilla_detalleMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_Grilla_detalleMouseClicked
        if (lblCodOrigen.getText().equals("TRAN.1001.1")) {
            ExeSql consulta = new ExeSql();
            ResultSet rs = null;
            String query = "select \n"
                    + "CAST(o.codigo_oc as varchar) || '-' || o.orden,\n"
                    + "o.sku,\n"
                    + "p.nombre,\n"
                    + "o.cantidad,\n"
                    + "o.separado,\n"
                    + "o.despachado\n"
                    + "from occhdet o\n"
                    + "left join producto p on p.sku = o.sku\n"
                    + "where CAST(o.codigo_oc as varchar) || '-' || o.orden in ('" + Grilla_detalle.getValueAt(Grilla_detalle.getSelectedRow(), 0).toString() + "')";

            try {
                rs = consulta.Select(query);
                DefaultTableModel modelo = (DefaultTableModel) Grilla_detalle_posibles.getModel();
                while (modelo.getRowCount() > 0) {
                    modelo.removeRow(0);
                }
                for (int i = 0; rs.next(); i++) {
                    modelo.addRow(new Object[]{
                        rs.getString("sku"),
                        rs.getString("nombre"),
                        rs.getString("cantidad"),
                        rs.getString("separado"),
                        rs.getString("despachado")
                    });
                }
            } catch (SQLException ex) {
                Logger.getLogger(jd_UbicacionProductos.class.getName()).log(Level.SEVERE, null, ex);
            }

        }
    }//GEN-LAST:event_Grilla_detalleMouseClicked

    private void txtUbicacionKeyTyped(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_txtUbicacionKeyTyped
        txtUbicacion.setText(txtUbicacion.getText().toUpperCase());
    }//GEN-LAST:event_txtUbicacionKeyTyped

    private void txCantActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_txCantActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_txCantActionPerformed

    private void txCodigoKeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_txCodigoKeyPressed
        if (evt.getKeyCode() == KeyEvent.VK_ENTER) {

            // --- NUEVA VALIDACIÓN ---
            // 1. Obtener el texto del campo ANTES de hacer nada
            String codigoIngresado = txCodigo.getText().trim();

            // 2. Si el "Enter" se presionó en un campo vacío, simplemente ignorarlo.
            if (codigoIngresado.isEmpty()) {
                // No hacer nada. No mostrar error. Solo esperar el siguiente evento.
                return;
            }
            // --- FIN NUEVA VALIDACIÓN ---

            // Si el campo NO estaba vacío, proceder con la lógica normal
            String skuEscaneado = CargaSku(codigoIngresado);

            // Si CargaSku falló (NoEncontrado=0) o devolvió null, salimos.
            if (skuEscaneado == null || NoEncontrado == 0) {
                txCodigo.setText("");
                return;
            }

            // --- ¡VALIDACIÓN IMPORTANTE! ---
            // Compara el SKU que se espera (arriba) con el SKU que se escaneó.
            String skuEsperado = lbSku.getText().trim();

            if (!skuEscaneado.equals(skuEsperado)) {
                fmMain.Mensaje("Producto incorrecto.\nSe esperaba: [" + skuEsperado + "]\nSe escaneó: [" + skuEscaneado + "]");
                txCodigo.setText(""); // Limpia para el próximo intento
                return; // No incrementa el contador
            }
            // --- FIN DE LA VALIDACIÓN ---

            // Si pasó la validación, incrementa el contador
            pistoleados++;
            txCant.setText("" + pistoleados);

            //graba(); // Esto estaba comentado, lo mantengo comentado
            txCodigo.setText(""); // Limpia para el siguiente escaneo

        }
    }//GEN-LAST:event_txCodigoKeyPressed

    private void lblAnticipada_Sala_HMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_lblAnticipada_Sala_HMouseClicked
        // TODO add your handling code here:
    }//GEN-LAST:event_lblAnticipada_Sala_HMouseClicked

    private void txCantKeyTyped(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_txCantKeyTyped

        char validar = evt.getKeyChar();    //Código agregado por R. Lopez
        if (Character.isLetter(validar)) {   //se valida que solo se ingresen 

            evt.consume();                  //números al textfield 
        }

        if (((validar < '0') || (validar > '9'))) {
            evt.consume();
        }


    }//GEN-LAST:event_txCantKeyTyped

    private void Grilla_AntMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_Grilla_AntMouseClicked

        if (evt.getClickCount() == 1) {

            String cant = Grilla_Ant.getValueAt(Grilla_Ant.getSelectedRow(), 4).toString().trim();
            txCant.setText(cant);

        }
    }//GEN-LAST:event_Grilla_AntMouseClicked

    private void lblAnticipada_Sala_PMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_lblAnticipada_Sala_PMouseClicked
        // TODO add your handling code here:
    }//GEN-LAST:event_lblAnticipada_Sala_PMouseClicked

    private void btAuthActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btAuthActionPerformed
        // 1. Crear el campo de contraseña
        javax.swing.JPasswordField pf = new javax.swing.JPasswordField();

        pf.addAncestorListener(new javax.swing.event.AncestorListener() {
            @Override
            public void ancestorAdded(javax.swing.event.AncestorEvent event) {
                // Solicitamos el foco una vez que el componente es visible
                // Usamos invokeLater para asegurar que la ventana esté 100% dibujada antes de pedir foco
                javax.swing.SwingUtilities.invokeLater(new Runnable() {
                    public void run() {
                        pf.requestFocusInWindow();
                    }
                });
            }

            @Override
            public void ancestorRemoved(javax.swing.event.AncestorEvent event) {
            }

            @Override
            public void ancestorMoved(javax.swing.event.AncestorEvent event) {
            }
        });
        
        // 2. Mostrar el diálogo con el campo de contraseña dentro
        // El array 'Object' nos permite personalizar qué mostramos en el cuerpo del mensaje
        int opcion = javax.swing.JOptionPane.showConfirmDialog(
                this,
                pf,
                "Ingrese Código de Habilitación",
                javax.swing.JOptionPane.OK_CANCEL_OPTION,
                javax.swing.JOptionPane.WARNING_MESSAGE
        );

        // 3. Verificar si el usuario presionó OK
        if (opcion == javax.swing.JOptionPane.OK_OPTION) {

            // Convertimos los caracteres del password a String para la consulta
            String codigoIngresado = new String(pf.getPassword());

            // Validación simple: si está vacío no hacemos nada
            if (codigoIngresado.trim().isEmpty()) {
                return;
            }

            ExeSql sql = new ExeSql();
            ResultSet rs = null;

            try {
                // 4. Consultar a la base de datos
                String query = "SELECT codigo FROM auth_productos WHERE codigo = '" + codigoIngresado.trim() + "'";
                rs = sql.Select(query);

                // 5. Verificar resultado
                if (rs.next()) {
                    // ¡CÓDIGO CORRECTO!
                    txCant.setEditable(true);
                    txCant.setEnabled(true);
                    txCant.requestFocus();
                    txCant.selectAll();

                    fmMain.Mensaje("Autorización exitosa. Puede modificar la cantidad.");
                } else {
                    // CÓDIGO INCORRECTO
                    fmMain.Mensaje("El código ingresado no es válido.");
                    txCant.setEditable(false);
                }

            } catch (Exception e) {
                System.out.println("Error al verificar código: " + e.getMessage());
                e.printStackTrace();
                fmMain.Mensaje("Error de conexión.");
            } finally {
                sql.Close();
            }
        }
    }//GEN-LAST:event_btAuthActionPerformed

    private void validaCodigo() {
        ExeSql sqlValidaCodigo = new ExeSql();

    }

    public String CargaSku(String Codigo) {
        ExeSql Sql = new ExeSql();
        ExeSql luv = new ExeSql();
        String inputCodigo = Codigo; // Guardamos el código original

        ResultSet Rs = null;

        int revisa_codbar = 0;
        int revisa_codchile = 0;

        NoEncontrado = 0;

        try {
            String Query;
            //Limpia la Lista

            Rs = luv.Select("select codbar, sku from codbar where sku='" + Codigo + "' or codbar='" + Codigo + "'");
            if (Rs.next()) {
                Codigo = Rs.getString("sku").trim();
                revisa_codbar++;
            }
            Rs = luv.Select("select idch, sku from codchile where sku='" + Codigo + "' or idch='" + Codigo + "'");
            if (Rs.next()) {
                Codigo = Rs.getString("sku").trim();
                revisa_codchile++;
            }
            Rs = luv.Select("select codbar, sku from codbar where sku='" + Codigo + "' or codbar='" + Codigo + "'");
            if (Rs.next()) {
                Codigo = Rs.getString("sku").trim();
                revisa_codbar++;
            }

            Query = "select p.sku,p.nombre from producto p \n"
                    + "where p.sku='" + Codigo + "' or p.sku in (select sku from codbar where codbar='" + Codigo + "')";

            Rs = luv.Select(Query);

            if (luv.GetRowCount() == 0) {
                fmMain.Mensaje("SKU: " + inputCodigo + " no esta en Nuestra Bases de Datos. Comuniquese con Informática");
                txCodigo.setText("");
                txCodigo.requestFocus();
                NoEncontrado = 0;
                return null; // <-- AÑADIDO
            } else {

                NoEncontrado = 1;

            }

            return Codigo; // <-- AÑADIDO (Devuelve el SKU resuelto)

        } catch (SQLException ex) {
            System.out.println(ex);
            return null; // <-- AÑADIDO
        } finally {
            Sql.Close();
            luv.Close();
        }
//        ExeSql Sql = new ExeSql();
//        ExeSql luv = new ExeSql();
//         
//        ResultSet Rs = null;
//        
//        int revisa_codbar =0;
//        int revisa_codchile =0;
//       
//        
//        
//        NoEncontrado=0;
//   
//        try {
//            String Query;
//            //Limpia la Lista
//            
//            Rs = luv.Select("select codbar, sku from codbar where sku='" + Codigo + "' or codbar='"+ Codigo + "'" );        
//                    if (Rs.next())
//                        {
//                        Codigo = Rs.getString("sku").trim();
//                        revisa_codbar++;
//                        }
//            Rs = luv.Select("select idch, sku from codchile where sku='" + Codigo +"' or idch='"+ Codigo + "'" );
//                    if (Rs.next())
//                        {
//                        Codigo = Rs.getString("sku").trim();
//                        revisa_codchile++;
//                        }
//            Rs = luv.Select("select codbar, sku from codbar where sku='" + Codigo + "' or codbar='"+ Codigo + "'" );        
//                    if (Rs.next())
//                        {
//                        Codigo = Rs.getString("sku").trim();
//                        revisa_codbar++;
//                        }
//             
//                    
//                    
//            Query ="select p.sku,p.nombre from producto p \n" +
//                   "where p.sku='" + Codigo + "' or p.sku in (select sku from codbar where codbar='" + Codigo + "')";
//              
//            Rs = luv.Select(Query);
//
//            if(luv.GetRowCount()==0){   
//                 fmMain.Mensaje("SKU: " + txCodigo.getText().trim() + " no esta en Nuestra Bases de Datos. Comuniquese con Informática");
//                 txCodigo.setText("");
//                 txCodigo.requestFocus();
//                 NoEncontrado=0;
//                 return;
//            }else{
//            
//                NoEncontrado=1;
//            
//            }      
//            
//            
//            
//           
//        } catch (SQLException ex) {
//            System.out.println(ex);
//        } finally {
//            Sql.Close();
//            luv.Close();
//        }
    }

    public Boolean selecciona_reg() {
        Grilla.changeSelection(0, 0, false, false);
        return true;
    }

//    private Integer getSucursalIdFromUbicacion(String ubicacionCod) {
//        // Asegúrate de que tu clase ExeSql esté en el paquete correcto si es necesario
//        // Ejemplo: import Conexion.ExeSql;
//        ExeSql sql = null; // Inicializar a null
//        ResultSet rs = null;
//        Integer sucursalId = null;
//
//        // Validar que la ubicación no esté vacía
//        if (ubicacionCod == null || ubicacionCod.trim().isEmpty()) {
//            System.err.println("getSucursalIdFromUbicacion: Código de ubicación vacío.");
//            return null;
//        }
//
//        // Asumo que tu tabla se llama 'mt_codmetro' y las columnas 'codmetro' y 'sucursal'
//        String query = "SELECT sucursal FROM mt_codmetro WHERE codmetro = '" + ubicacionCod.trim() + "' LIMIT 1";
//
//        try {
//            sql = new ExeSql(); // Crear la instancia dentro del try
//            rs = sql.Select(query);
//            if (rs != null && rs.next()) {
//                sucursalId = rs.getInt("sucursal");
//                // Considera ID 0 como inválido o no asignado a una sucursal real
//                if (sucursalId == 0) {
//                    System.out.println("getSucursalIdFromUbicacion: Ubicación " + ubicacionCod + " tiene sucursal 0 o nula.");
//                    sucursalId = null;
//                }
//            } else {
//                System.out.println("getSucursalIdFromUbicacion: No se encontró sucursal para " + ubicacionCod);
//            }
//        } catch (Exception e) {
//            System.err.println("Error buscando sucursalId para: " + ubicacionCod);
//            e.printStackTrace();
//        } finally {
//            // Asegurarse de cerrar la conexión incluso si falló la creación
//            if (sql != null) {
//                sql.Close(); // El método Close debería manejar errores internos si los hay
//            }
//        }
//        return sucursalId;
//    }
    /**
     * @param args the command line arguments
     */
    public static void main(String args[]) {
        /* Set the Nimbus look and feel */
        //<editor-fold defaultstate="collapsed" desc=" Look and feel setting code (optional) ">
        /* If Nimbus (introduced in Java SE 6) is not available, stay with the default look and feel.
         * For details see http://download.oracle.com/javase/tutorial/uiswing/lookandfeel/plaf.html 
         */
        try {
            for (javax.swing.UIManager.LookAndFeelInfo info : javax.swing.UIManager.getInstalledLookAndFeels()) {
                if ("Nimbus".equals(info.getName())) {
                    javax.swing.UIManager.setLookAndFeel(info.getClassName());
                    break;
                }
            }
        } catch (ClassNotFoundException ex) {
            java.util.logging.Logger.getLogger(jd_UbicacionProductos.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (InstantiationException ex) {
            java.util.logging.Logger.getLogger(jd_UbicacionProductos.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (IllegalAccessException ex) {
            java.util.logging.Logger.getLogger(jd_UbicacionProductos.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (javax.swing.UnsupportedLookAndFeelException ex) {
            java.util.logging.Logger.getLogger(jd_UbicacionProductos.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        }
        //</editor-fold>
        //</editor-fold>
        //</editor-fold>
        //</editor-fold>
        //</editor-fold>
        //</editor-fold>
        //</editor-fold>
        //</editor-fold>
        //</editor-fold>
        //</editor-fold>
        //</editor-fold>
        //</editor-fold>
        //</editor-fold>
        //</editor-fold>
        //</editor-fold>
        //</editor-fold>
        //</editor-fold>
        //</editor-fold>
        //</editor-fold>
        //</editor-fold>
        //</editor-fold>
        //</editor-fold>
        //</editor-fold>
        //</editor-fold>
        //</editor-fold>
        //</editor-fold>
        //</editor-fold>
        //</editor-fold>
        //</editor-fold>
        //</editor-fold>
        //</editor-fold>
        //</editor-fold>

        /* Create and display the dialog */
        java.awt.EventQueue.invokeLater(new Runnable() {
            public void run() {
                jd_UbicacionProductos dialog = new jd_UbicacionProductos(new javax.swing.JFrame(), true);

                dialog.addWindowListener(new java.awt.event.WindowAdapter() {
                    @Override
                    public void windowClosing(java.awt.event.WindowEvent e) {
                        System.exit(0);
                    }
                });
                dialog.setVisible(true);
            }
        });
    }

    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JTable Grilla;
    private javax.swing.JTable Grilla_Ant;
    private javax.swing.JTable Grilla_detalle;
    private javax.swing.JTable Grilla_detalle_posibles;
    private javax.swing.JButton btAceptar;
    private javax.swing.JButton btAuth;
    private javax.swing.JButton btOk;
    private javax.swing.JButton btUbc;
    private javax.swing.JCheckBox chkAnticipada_ant;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JLabel jLabel10;
    private javax.swing.JLabel jLabel11;
    private javax.swing.JLabel jLabel12;
    private javax.swing.JLabel jLabel13;
    private javax.swing.JLabel jLabel2;
    private javax.swing.JLabel jLabel3;
    private javax.swing.JLabel jLabel4;
    private javax.swing.JLabel jLabel5;
    private javax.swing.JLabel jLabel6;
    private javax.swing.JLabel jLabel7;
    private javax.swing.JLabel jLabel8;
    private javax.swing.JLabel jLabel9;
    private javax.swing.JPanel jPanel1;
    private javax.swing.JPanel jPanel2;
    private javax.swing.JPanel jPanel3;
    private javax.swing.JPopupMenu jPopupMenu2;
    private javax.swing.JScrollPane jScrollPane1;
    private javax.swing.JScrollPane jScrollPane2;
    private javax.swing.JScrollPane jScrollPane3;
    private javax.swing.JScrollPane jScrollPane4;
    private javax.swing.JLabel lbSku;
    private javax.swing.JLabel lbSkuDesc;
    private javax.swing.JLabel lbStock;
    private javax.swing.JLabel lbTotal;
    private javax.swing.JLabel lblAnticipada;
    private javax.swing.JLabel lblAnticipada_Sala_H;
    private javax.swing.JLabel lblAnticipada_Sala_P;
    private javax.swing.JLabel lblCodOrigen;
    private javax.swing.JLabel lblDescOrigen;
    private javax.swing.JLabel lblPendiente;
    private javax.swing.JLabel lblTotalDesp;
    private javax.swing.JLabel lblUnidad;
    private javax.swing.JMenuItem mnuCopiarOrden;
    private javax.swing.JPanel pnAnticipada;
    private javax.swing.JTextField txCant;
    private javax.swing.JTextField txCodigo;
    private javax.swing.JTextField txNombreUbica;
    private javax.swing.JTextField txtUbicacion;
    // End of variables declaration//GEN-END:variables
}
